<template>
  <div class="game-view">
    <!-- Âä†ËΩΩÂä®Áîª -->
    <GameLoader
      v-if="isLoading"
      :title="'Ê≠£Âú®Âä†ËΩΩÊ∏∏ÊàèËµÑÊ∫ê'"
      :status="loadingStatus"
      :progress="loadingProgress"
      @complete="onLoadingComplete"
    />

    <!-- È°∂ÈÉ®‰ø°ÊÅØÊ†è -->
    <header v-if="!isLoading" class="game-header">
      <div class="left-info">
        <div class="week-indicator">
          <div class="week-label">{{ $t('game.week') }}</div>
          <div class="week-value">{{ currentWeek }}{{ isEndlessMode ? ' / ‚àû' : ' / ' + maxWeeks }}</div>
          <div class="progress-bar">
            <div class="progress" :style="{ width: `${gameProgress}%` }"></div>
          </div>
        </div>
      </div>

      <div class="right-info">
        <button class="menu-button" @click="showGameMenu">
          <span class="menu-icon">‚â°</span>
          <span class="menu-text">{{ $t('game.menu') }}</span>
        </button>
      </div>
    </header>

    <!-- ÈÄöÁü•Âå∫Âüü -->
    <div v-if="!isLoading" class="notifications-container">
      <transition-group name="notification">
        <div
          v-for="notification in notifications"
          :key="notification.id"
          class="notification"
          :class="notification.type"
        >
          <div class="notification-content">
            {{ notification.message }}
          </div>
          <button class="close-btn" @click="dismissNotification(notification.id)">√ó</button>
        </div>
      </transition-group>
    </div>

    <!-- ‰∏ªÊ∏∏ÊàèÂå∫Âüü -->
    <div class="game-content">
      <!-- Â∑¶‰æßÁé©ÂÆ∂‰ø°ÊÅØÈù¢Êùø -->
      <div class="left-panel">
        <PlayerInfo />

        <!-- ‰ºòÂåñËÉåÂåÖÊòæÁ§∫ -->
        <div class="mini-inventory">
          <div class="mini-header">
            <h3 class="mini-title">{{ $t('inventory.title') }}</h3>
            <button
              class="view-all-btn"
              @click="activeTab = 'inventory'"
              title="Êü•ÁúãÂÆåÊï¥ËÉåÂåÖ"
            >
              <i class="icon-expand">‚§¢</i>
            </button>
          </div>
          <div class="inventory-items">
            <div v-if="playerInventory.length === 0" class="empty-inventory">
              {{ $t('inventory.empty') }}
            </div>
            <div v-else class="inventory-list">
              <div v-for="item in playerInventory" :key="item.productId" class="inventory-item">
                <div class="item-name">{{ item.name }}</div>
                <div class="item-details">
                  <span class="item-quantity">x{{ item.quantity }}</span>
                  <span class="item-price">¬•{{ formatNumber(item.purchasePrice) }}</span>
                </div>
              </div>
              <!-- ÁßªÈô§‰∫ÜÊõ¥Â§öÁâ©ÂìÅÊèêÁ§∫ÔºåÁé∞Âú®ÊòæÁ§∫ÊâÄÊúâÁâ©ÂìÅ -->
            </div>
          </div>

          <!-- ÁßªÈô§‰∫ÜÂÆπÈáèËøõÂ∫¶Êù°ÊòæÁ§∫ -->
        </div>

        <!-- Âà†Èô§ËøõÂÖ•‰∏ã‰∏ÄÂë®ÊåâÈíÆ -->
      </div>

      <!-- ‰∏≠Â§ÆÂÜÖÂÆπÂå∫Âüü -->
      <div class="main-content">
        <div class="tab-buttons">
          <button
            :class="['tab-button', { active: activeTab === 'market' }]"
            @click="activeTab = 'market'"
          >
            {{ $t('game.tabs.market') }}
          </button>
          <button
            :class="['tab-button', { active: activeTab === 'inventory' }]"
            @click="activeTab = 'inventory'"
          >
            {{ $t('game.tabs.inventory') }}
          </button>
          <button
            :class="['tab-button', { active: activeTab === 'houses' }]"
            @click="activeTab = 'houses'"
          >
            {{ $t('game.tabs.houses') }}
          </button>
        </div>

        <div class="tab-content">
          <transition name="tab-fade" mode="out-in">
            <!-- Â∏ÇÂú∫Ê†áÁ≠æÈ°µ -->
            <div v-if="activeTab === 'market'" class="market-tab" key="market">
              <Market />
            </div>

            <!-- ËÉåÂåÖÊ†áÁ≠æÈ°µ -->
            <div v-else-if="activeTab === 'inventory'" class="inventory-tab" key="inventory">
              <Inventory />
            </div>

            <!-- ÊàøÂ±ãÊ†áÁ≠æÈ°µ -->
            <div v-else-if="activeTab === 'houses'" class="houses-tab" key="houses">
              <HouseMarket />
            </div>
          </transition>
        </div>
      </div>
    </div>

    <!-- ÊïôÁ®ãÁ≥ªÁªü -->
    <TutorialSystem
      :current-week="currentWeek"
      :current-location="currentLocation"
      :active-tab="activeTab"
      ref="tutorialSystem"
    />

    <!-- ‰∫ã‰ª∂Ê®°ÊÄÅÊ°Ü -->
    <EventModal ref="eventModal" />

    <!-- Ê∏∏ÊàèËèúÂçïÂØπËØùÊ°Ü -->
    <transition name="fade">
      <div v-if="showMenu" class="dialog-overlay" @click.self="hideGameMenu">
        <transition name="zoom-bounce">
          <div class="dialog game-menu-dialog">
            <h2 class="dialog-title">{{ $t('gameMenu.title') }}</h2>
            <div class="menu-options">
              <transition-group name="menu-item">
                <button class="menu-option" @click="saveGame" key="save">
                  <span class="menu-icon">üíæ</span>
                  {{ $t('gameMenu.save') }}
                </button>
                <button class="menu-option" @click="goToMainMenu" key="main">
                  <span class="menu-icon">üè†</span>
                  {{ $t('gameMenu.mainMenu') }}
                </button>
                <button class="menu-option" @click="hideGameMenu" key="continue">
                  <span class="menu-icon">‚ñ∂Ô∏è</span>
                  {{ $t('gameMenu.continue') }}
                </button>
              </transition-group>
            </div>
          </div>
        </transition>
      </div>
    </transition>

    <!-- ‰øùÂ≠òÊ∏∏ÊàèÂØπËØùÊ°Ü -->
    <transition name="fade">
      <div v-if="showSaveDialog" class="dialog-overlay" @click.self="cancelSave">
        <transition name="slide-up">
          <div class="dialog save-dialog">
            <h2 class="dialog-title">{{ $t('saveDialog.title') }}</h2>
            <div class="save-form">
              <input
                v-model="saveName"
                type="text"
                class="save-input"
                :placeholder="$t('saveDialog.namePlaceholder')"
                ref="saveInput"
                @keyup.enter="confirmSave"
              />
              <div class="dialog-buttons">
                <button class="dialog-button confirm" @click="confirmSave" :disabled="!saveName">
                  {{ $t('common.confirm') }}
                </button>
                <button class="dialog-button cancel" @click="cancelSave">
                  {{ $t('common.cancel') }}
                </button>
              </div>
            </div>
          </div>
        </transition>
      </div>
    </transition>

    <!-- Ê∏∏ÊàèÁªìÊùüÂØπËØùÊ°Ü -->
    <transition name="fade">
      <div v-if="gameOver && showGameOverDialog" class="dialog-overlay game-over-overlay">
        <transition name="scale-bounce">
          <GameOverView
            :gameState="gameState"
            :player="player"
            :gameStats="gameResult"
            @return-to-main="goToMainMenu"
            @restart-game="restartGame"
            @continue-game="continueFromVictory"
          />
        </transition>
      </div>
    </transition>

    <!-- ÁßªÈô§ËØ¶ÁªÜÁªüËÆ°ÂØπËØùÊ°Ü -->
  </div>

  <!-- Ê∑ªÂä†‰∫§ÊòìToastÊèêÁ§∫ -->
  <transition name="fade">
    <div v-if="showTransactionToast" class="transaction-toast" :class="transactionToastClass">
      <div class="toast-content">
        <span class="toast-icon">{{ transactionToastIcon }}</span>
        <span class="toast-message">{{ transactionToastMessage }}</span>
      </div>
      <div class="toast-progress-bar"></div>
    </div>
  </transition>
</template>

<script setup>
import { ref, computed, onMounted, onBeforeUnmount, nextTick, watch, useTemplateRef } from 'vue';
import { useRouter } from 'vue-router';
import { useI18n } from 'vue-i18n';
import { useGameCoreStore } from '@/stores/gameCore';
import { useSettingsStore } from '@/stores/settingsStore';
import { useUiStore } from '@/stores/uiStore';
import { usePlayerStore } from '@/stores/player';
import { useMarketStore } from '@/stores/market';
import { useEventStore } from '@/stores/events';
import { useSaveStore } from '@/stores/persistence';
import eventEmitter from '@/infrastructure/eventEmitter';

// ‚úÖ ÂºïÂÖ•Service ComposablesÔºàÁî®‰∫éÂ∞ëÊï∞ÈúÄË¶ÅÁöÑ‰∏öÂä°Êìç‰ΩúÔºâ
import { useGameState } from '@/ui/composables';

// Vue 3.5 ÊÄßËÉΩ‰ºòÂåñÔºöÁªÑ‰ª∂ÂºÇÊ≠•Âä†ËΩΩÁ≠ñÁï•
// Ê†∏ÂøÉÊ∏∏ÊàèÁªÑ‰ª∂ - Á´ãÂç≥Âä†ËΩΩÔºàÁî®Êà∑Á´ãÂç≥ÂèØËßÅÔºâ
import PlayerInfo from '@/ui/components/player/PlayerInfo.vue';
import Market from '@/ui/components/market/Market.vue';

// ÂäüËÉΩÊâ©Â±ïÁªÑ‰ª∂ - ÂºÇÊ≠•Âä†ËΩΩÔºàÂª∂ËøüÂä†ËΩΩÔºâ
import { defineAsyncComponent } from 'vue';
const Inventory = defineAsyncComponent(() => import('@/ui/components/player/Inventory.vue'));
const HouseMarket = defineAsyncComponent(() => import('@/ui/components/market/HouseMarket.vue'));
const EventModal = defineAsyncComponent(() => import('@/ui/components/common/EventModal.vue'));
const GameOverView = defineAsyncComponent(() => import('@/ui/views/GameOverView.vue'));
const TutorialSystem = defineAsyncComponent(() => import('@/ui/components/common/TutorialSystem.vue'));
const GameLoader = defineAsyncComponent(() => import('@/ui/components/common/GameLoader.vue'));
import { handleError, ErrorType, ErrorSeverity } from '../../infrastructure/utils/errorHandler'; // ÂØºÂÖ•GameLoaderÁªÑ‰ª∂

const router = useRouter();
const gameCoreStore = useGameCoreStore(); // Ê∏∏ÊàèÊ†∏ÂøÉÂ≠òÂÇ®
const playerStore = usePlayerStore(); // Áé©ÂÆ∂Â≠òÂÇ®
const marketStore = useMarketStore(); // Â∏ÇÂú∫Â≠òÂÇ®
const eventStore = useEventStore(); // ‰∫ã‰ª∂Â≠òÂÇ®
const settingsStore = useSettingsStore();
const uiStore = useUiStore();
const { t } = useI18n();

// ‚úÖ Service Composables - Áî®‰∫éÁªü‰∏ÄÁä∂ÊÄÅÁÆ°ÁêÜ
const { 
  currentWeek: currentWeekFromService, 
  maxWeeks: maxWeeksFromService,
  gameOver: gameOverFromService 
} = useGameState();
// Vue 3.5 Êñ∞ÁâπÊÄßÔºöÁ±ªÂûãÂÆâÂÖ®ÁöÑÊ®°ÊùøÂºïÁî®
const eventModal = useTemplateRef('eventModal');
const tutorialSystem = useTemplateRef('tutorialSystem');
const saveInput = useTemplateRef('saveInput');

// ÁªÑ‰ª∂ÂàùÂßãÂåñÂÆåÊàê

// Ê∏∏ÊàèÁä∂ÊÄÅ
const activeTab = ref('market');
const showMenu = ref(false);
const showSaveDialog = ref(false);
const showGameOverDialog = ref(false);
const saveName = ref('');
const isDevelopmentMode = ref(false); // ÂºÄÂèëÊ®°ÂºèÊ†áÂøó

// Âä†ËΩΩÁä∂ÊÄÅ
const isLoading = ref(true);
const loadingStatus = ref('ÂàùÂßãÂåñÊ∏∏Êàè...');
const loadingProgress = ref(0);

// Ëé∑ÂèñÊ∏∏ÊàèÁä∂ÊÄÅ
const currentWeek = computed(() => gameCoreStore.currentWeek);
const maxWeeks = computed(() => gameCoreStore.maxWeeks);
const gameOver = computed(() => gameCoreStore.gameOver);
const notifications = computed(() => gameCoreStore.notifications);
const gameResult = computed(() => gameCoreStore.gameResult);
const player = computed(() => playerStore);
const currentLocation = computed(() => marketStore.currentLocation);
// ‰øÆÂ§çÔºö‰ΩøÁî®Ê≠£Á°ÆÁöÑÊñπÂºèËé∑ÂèñplayerInventory
const playerInventory = computed(() => playerStore.inventory || []);
const gameState = computed(() => ({
  currentWeek: currentWeek.value,
  maxWeeks: maxWeeks.value,
  gameOver: gameOver.value
}));

// Ëé∑ÂèñÊ∏∏ÊàèÁõ∏ÂÖ≥Áä∂ÊÄÅ
const gameProgress = computed(() => gameCoreStore.gameProgress);
const isEndlessMode = computed(() => gameCoreStore.isEndlessMode);

// ÂΩìÊ∏∏ÊàèÁªìÊùüÊó∂ÊòæÁ§∫ÁªìÊùüÂØπËØùÊ°Ü
watch(() => gameCoreStore.gameOver, (newValue) => {
  if (newValue) {
    // Ê∑ªÂä†ËØ¶ÁªÜË∞ÉËØïÊó•Âøó
    // Ê∏∏ÊàèÁªìÊùüÂ§ÑÁêÜ
    console.log('ËØ¶ÁªÜÊ∏∏ÊàèÁªìÊûúÊï∞ÊçÆ:', {
      gameResult: gameCoreStore.gameResult,
      score: gameCoreStore.gameResult?.score,
      scoreDetails: gameCoreStore.gameResult?.scoreDetails,
      endReason: gameCoreStore.gameResult?.endReason,
      playerNetWorth: playerStore.netWorth,
      purchasedHouses: playerStore.purchasedHouses?.length || 0
    });

    nextTick(() => {
      showGameOverDialog.value = true;
    });
  }
});

// ‰∫§ÊòìÊèêÁ§∫Áõ∏ÂÖ≥Áä∂ÊÄÅ
const showTransactionToast = ref(false);
const transactionToastMessage = ref('');
const transactionToastClass = ref('');
const transactionToastIcon = ref('');

// ÁªÑ‰ª∂ÊåÇËΩΩÊó∂
onMounted(() => {
  // ÁªÑ‰ª∂ÊåÇËΩΩ

  // ÂàùÂßãÂåñÂä†ËΩΩÁä∂ÊÄÅ
  isLoading.value = true;
  loadingProgress.value = 0;

  // Ê£ÄÊü•ÊòØÂê¶‰∏∫ÂºÄÂèëÊ®°Âºè
  try {
    isDevelopmentMode.value = true; // ÈªòËÆ§ËÆæ‰∏∫ÂºÄÂèëÊ®°Âºè
    // ÂºÄÂèëÊ®°ÂºèÊ†áËÆ∞
  } catch (error) {
    console.warn('GameView - Êó†Ê≥ïÊ£ÄÊµãÁéØÂ¢ÉÊ®°Âºè:', error);
    isDevelopmentMode.value = true; // ÈªòËÆ§‰∏∫ÂºÄÂèëÊ®°Âºè
  }

  // Ê£ÄÊü•Ê∏∏ÊàèÊòØÂê¶Â∑≤ÁªèÂàùÂßãÂåñ
  if (!gameCoreStore.gameStarted) {
    // Â∞ùËØï‰ªéÊú¨Âú∞Â≠òÂÇ®Ëé∑ÂèñÁé©ÂÆ∂‰ø°ÊÅØ
    const savedPlayerName = localStorage.getItem('lastPlayerName') || 'Áé©ÂÆ∂';
    console.log('Ëé∑ÂèñÂà∞Áé©ÂÆ∂ÂêçÁß∞:', savedPlayerName);

    // ËÆæÁΩÆÁé©ÂÆ∂ÂêçÁß∞ - ÂÆâÂÖ®Ê£ÄÊü•
    const currentName = typeof playerStore.name === 'object' && 'value' in playerStore.name 
      ? playerStore.name.value 
      : playerStore.name;
    
    if (!currentName && savedPlayerName) {
      if (typeof playerStore.name === 'object' && 'value' in playerStore.name) {
        playerStore.name.value = savedPlayerName;
      }
    }
  }

  // Á°Æ‰øùÊ∏∏Êàè‰∏ç‰ºöÂú®ÂàùÂßãÁä∂ÊÄÅ‰∏ãÊòæÁ§∫‰∏∫ÁªìÊùü
  if (gameCoreStore.gameOver) {
    console.log('ÈáçÁΩÆÊ∏∏ÊàèÁªìÊùüÁä∂ÊÄÅ');
    gameCoreStore.gameOver = false;
    showGameOverDialog.value = false;

    // ÂêåÊó∂ÈáçÁΩÆ‰∫ã‰ª∂Á≥ªÁªüÔºåÈò≤Ê≠¢‰∫ã‰ª∂ÈáçÊñ∞Ëß¶Âèë
    const eventStore = useEventStore();
    eventStore.resetEvents();
    eventStore.activeEvent = null;
    eventStore.activeEvents = [];
  }

  // Âä†ËΩΩÊ∏∏ÊàèËµÑÊ∫ê
  loadGameResources();

  // Ê∑ªÂä†ÈîÆÁõò‰∫ã‰ª∂ÁõëÂê¨
  window.addEventListener('keydown', handleKeyDown);

  // Ê∑ªÂä†beforeunload‰∫ã‰ª∂ÁõëÂê¨
  window.addEventListener('beforeunload', handleBeforeUnload);

  // ËÆæÁΩÆÂÆöÊó∂Âô®ÔºåÂÆöÊúüÊ£ÄÊü•ÊòØÂê¶ÊúâÊ¥ªË∑É‰∫ã‰ª∂ÈúÄË¶ÅÊòæÁ§∫
  setInterval(() => {
    // Âè™Âú®Ê∏∏ÊàèÊú™ÁªìÊùüÊó∂Ê£ÄÊü•‰∫ã‰ª∂
    if (!gameCoreStore.gameOver) {
      checkActiveEvents();
    }
  }, 2000); // ÊØè2ÁßíÊ£ÄÊü•‰∏ÄÊ¨°

  // Ê∑ªÂä†‰∫§ÊòìÊèêÁ§∫‰∫ã‰ª∂ÁõëÂê¨
  eventEmitter.on('show:transaction_toast', handleTransactionToast);
});

onBeforeUnmount(() => {
  // ÁßªÈô§ÈîÆÁõò‰∫ã‰ª∂ÁõëÂê¨
  window.removeEventListener('keydown', handleKeyDown);

  // ÁßªÈô§ÂÖ≥Èó≠Ââç‰øùÂ≠ò‰∫ã‰ª∂
  window.removeEventListener('beforeunload', handleBeforeUnload);

  // ÁßªÈô§‰∫§ÊòìÊèêÁ§∫‰∫ã‰ª∂ÁõëÂê¨
  eventEmitter.off('show:transaction_toast', handleTransactionToast);
});

// Â§ÑÁêÜÈîÆÁõòÂø´Êç∑ÈîÆ
const handleKeyDown = (event) => {
  // Â¶ÇÊûúÊúâÊ®°ÊÄÅÊ°ÜÊâìÂºÄÔºå‰∏çÂ§ÑÁêÜÂø´Êç∑ÈîÆ
  if (showMenu.value || showSaveDialog.value || showGameOverDialog.value) {
    return;
  }

  switch (event.key) {
    case ' ': // Á©∫Ê†ºÈîÆ
      // ËøõÂÖ•‰∏ã‰∏ÄÂë®
      advanceWeek();
      break;
    case 'Tab': // TabÈîÆ
      // ÂàáÊç¢Ê†áÁ≠æÈ°µ
      event.preventDefault(); // ÈòªÊ≠¢ÈªòËÆ§TabË°å‰∏∫
      if (event.shiftKey) {
        // Shift+Tab ÂêëÂâçÂàáÊç¢
        if (activeTab.value === 'market') activeTab.value = 'houses';
        else if (activeTab.value === 'inventory') activeTab.value = 'market';
        else if (activeTab.value === 'houses') activeTab.value = 'inventory';
      } else {
        // Tab ÂêëÂêéÂàáÊç¢
        if (activeTab.value === 'market') activeTab.value = 'inventory';
        else if (activeTab.value === 'inventory') activeTab.value = 'houses';
        else if (activeTab.value === 'houses') activeTab.value = 'market';
      }
      break;
    case 'Escape': // EscÈîÆ
      // ÊâìÂºÄ/ÂÖ≥Èó≠ËèúÂçï
      if (showMenu.value) {
        hideGameMenu();
      } else {
        showGameMenu();
      }
      break;
    case 'h': // HÈîÆ
    case 'H':
      // ÊâìÂºÄÂ∏ÆÂä©Èù¢Êùø
      if (tutorialSystem.value) {
        tutorialSystem.value.toggleHelpPanel();
      }
      break;
  }
};

// ÊñπÊ≥ï
const formatNumber = (num) => {
  return num.toLocaleString('zh-CN');
};

// ÊòæÁ§∫‰∫ã‰ª∂
const showEvent = (event) => {
  if (!event || !eventModal.value) return;

  eventModal.value.showEvent(event);

  // Â∞ùËØïËß¶ÂèëÊïôÁ®ã‰∫ã‰ª∂
  try {
    if (typeof gameCoreStore.triggerTutorialEvent === 'function') {
      gameCoreStore.triggerTutorialEvent('tutorial_trading');
    } else {
      console.warn('triggerTutorialEventÊñπÊ≥ï‰∏çÂ≠òÂú®');
    }
  } catch (error) {
    handleError(error, 'GameView (views)', ErrorType.UNKNOWN, ErrorSeverity.ERROR);
    console.error('Ëß¶ÂèëÊïôÁ®ã‰∫ã‰ª∂Êó∂Âá∫Èîô:', error);
  }
};

// Ëß¶ÂèëËøûÈîÅ‰∫ã‰ª∂
const triggerNextEvent = (eventId) => {
  if (!eventId) return;

  // Âª∂Ëøü‰∏ÄÁÇπÊó∂Èó¥ÂÜçËß¶Âèë‰∏ã‰∏Ä‰∏™‰∫ã‰ª∂Ôºå‰ΩøUIÊúâÊó∂Èó¥Êõ¥Êñ∞
  setTimeout(() => {
    gameCoreStore.triggerSpecificEvent(eventId);
  }, 500);
};

// ËøõÂÖ•‰∏ã‰∏ÄÂë®
const advanceWeek = () => {
  if (gameCoreStore.advanceWeek()) {
    // ‰∏çÈúÄË¶ÅÂÜçÊ¨°Ë∞ÉÁî®generateRandomEventÔºåÂõ†‰∏∫advanceWeekÊñπÊ≥ï‰∏≠Â∑≤ÁªèË∞ÉÁî®‰∫Ü
    // gameCoreStore.generateRandomEvent();

    // Ê£ÄÊü•ÊòØÂê¶ÊúâÊ¥ªË∑É‰∫ã‰ª∂ÈúÄË¶ÅÊòæÁ§∫
    checkActiveEvents();
  }
};

const checkActiveEvents = () => {
  // Â¶ÇÊûúÊ∏∏ÊàèÂ∑≤ÁªìÊùüÔºå‰∏çÊ£ÄÊü•‰∫ã‰ª∂
  if (gameCoreStore.gameOver) {
    console.log('GameView - Ê∏∏ÊàèÂ∑≤ÁªìÊùüÔºåË∑≥Ëøá‰∫ã‰ª∂Ê£ÄÊü•');
    return;
  }

  console.log('GameView - Ê£ÄÊü•Ê¥ªË∑É‰∫ã‰ª∂');

  // Ê£ÄÊü•‰∫ã‰ª∂Â≠òÂÇ®‰∏≠ÊòØÂê¶ÊúâÊ¥ªË∑É‰∫ã‰ª∂
  const eventStore = useEventStore();
  if (eventStore.activeEvent) {
    console.log('GameView - Âú®EventStore‰∏≠ÂèëÁé∞Ê¥ªË∑É‰∫ã‰ª∂:', eventStore.activeEvent.id, eventStore.activeEvent.title);

    // ÊòæÁ§∫‰∫ã‰ª∂ÂØπËØùÊ°Ü
    nextTick(() => {
      if (eventModal.value) {
        console.log('GameView - ÊòæÁ§∫EventStore‰∏≠ÁöÑÊ¥ªË∑É‰∫ã‰ª∂');
        eventModal.value.showEvent(eventStore.activeEvent);
      } else {
        console.error('GameView - ‰∫ã‰ª∂ÂØπËØùÊ°ÜÁªÑ‰ª∂Êú™ÊâæÂà∞');
      }
    });
    return;
  }

  // Â¶ÇÊûúÊ∏∏ÊàèÂ∑≤ÁªìÊùüÔºå‰∏çÊ£ÄÊü•GameCore‰∏≠ÁöÑ‰∫ã‰ª∂
  if (gameCoreStore.gameOver) {
    console.log('GameView - Ê∏∏ÊàèÂ∑≤ÁªìÊùüÔºåË∑≥ËøáGameCore‰∫ã‰ª∂Ê£ÄÊü•');
    return;
  }

  // Ê£ÄÊü•Ê∏∏ÊàèÊ†∏ÂøÉÂ≠òÂÇ®‰∏≠ÊòØÂê¶ÊúâÊ¥ªË∑É‰∫ã‰ª∂
  console.log('GameView - Ê£ÄÊü•GameCore‰∏≠ÁöÑÊ¥ªË∑É‰∫ã‰ª∂ÈòüÂàó:', gameCoreStore.activeEvents?.length || 0);
  if (gameCoreStore.activeEvents && gameCoreStore.activeEvents.length > 0) {
    // Ëé∑ÂèñÁ¨¨‰∏Ä‰∏™‰∫ã‰ª∂Âπ∂ÊòæÁ§∫
    const event = gameCoreStore.activeEvents[0];
    console.log('GameView - Âú®GameCore‰∏≠ÂèëÁé∞Ê¥ªË∑É‰∫ã‰ª∂:', event.id, event.title);
    gameCoreStore.activeEvents.shift(); // ‰ªéÈòüÂàóÁßªÈô§

    // ÊòæÁ§∫‰∫ã‰ª∂ÂØπËØùÊ°Ü
    nextTick(() => {
      if (eventModal.value) {
        console.log('GameView - ÊòæÁ§∫GameCore‰∏≠ÁöÑÊ¥ªË∑É‰∫ã‰ª∂');

        // Á°Æ‰øù‰∫ã‰ª∂Ê®°ÊÄÅÊ°ÜÁªÑ‰ª∂Â∑≤ÁªèÂáÜÂ§áÂ•Ω
        if (typeof eventModal.value.showEvent !== 'function') {
          console.error('GameView - ‰∫ã‰ª∂Ê®°ÊÄÅÊ°ÜÁªÑ‰ª∂Ê≤°ÊúâshowEventÊñπÊ≥ï');
          return;
        }

        // Á°Æ‰øù‰∫ã‰ª∂ÂØπË±°ÊúâÂøÖË¶ÅÁöÑÂ±ûÊÄß
        if (!event.options || !Array.isArray(event.options) || event.options.length === 0) {
          console.warn('GameView - ‰∫ã‰ª∂Ê≤°ÊúâÈÄâÈ°πÔºåÊ∑ªÂä†ÈªòËÆ§ÈÄâÈ°π');
          event.options = [
            {
              id: 'default_option',
              text: 'Á°ÆËÆ§',
              result: '‰Ω†Á°ÆËÆ§‰∫ÜËøô‰∏™‰∫ã‰ª∂„ÄÇ',
              effects: {}
            }
          ];
        }

        // ÊòæÁ§∫‰∫ã‰ª∂
        try {
          eventModal.value.showEvent(event);
          console.log('GameView - ‰∫ã‰ª∂ÊòæÁ§∫ËØ∑Ê±ÇÂ∑≤ÂèëÈÄÅ');
        } catch (error) {
          console.error('GameView - ÊòæÁ§∫‰∫ã‰ª∂Êó∂Âá∫Èîô:', error);
        }
      } else {
        console.error('GameView - ‰∫ã‰ª∂ÂØπËØùÊ°ÜÁªÑ‰ª∂Êú™ÊâæÂà∞');
      }
    });
  } else {
    console.log('GameView - Ê≤°ÊúâÊ¥ªË∑É‰∫ã‰ª∂ÈúÄË¶ÅÊòæÁ§∫');
  }
};

const showGameMenu = () => {
  showMenu.value = true;
};

const hideGameMenu = () => {
  showMenu.value = false;
};

const saveGame = () => {
  showMenu.value = false;
  showSaveDialog.value = true;
  // ÈªòËÆ§‰ΩøÁî®ÂΩìÂâçÊó•Êúü‰Ωú‰∏∫Â≠òÊ°£Âêç
  const now = new Date();
  saveName.value = `Â≠òÊ°£-${now.getFullYear()}${(now.getMonth()+1).toString().padStart(2, '0')}${now.getDate().toString().padStart(2, '0')}-${now.getHours().toString().padStart(2, '0')}${now.getMinutes().toString().padStart(2, '0')}`;

  // Á≠âÂæÖDOMÊõ¥Êñ∞ÂêéÔºåËÅöÁÑ¶ËæìÂÖ•Ê°Ü
  nextTick(() => {
    if (saveInput.value) {
      saveInput.value.focus();
      saveInput.value.select(); // ÈÄâÊã©ÂÖ®ÈÉ®ÊñáÂ≠óÔºåÊñπ‰æøÁî®Êà∑Áõ¥Êé•‰øÆÊîπ
    }
  });
};

const confirmSave = async () => {
  if (!saveName.value) return;

  try {
    // ‰ΩøÁî®Ê≠£Á°ÆÁöÑ‰øùÂ≠òÊñπÊ≥ï - saveStore.saveGame
    const saveStore = useSaveStore();
    const result = await saveStore.saveGame(saveName.value);

    if (result.success) {
      showSaveDialog.value = false;
    } else {
      uiStore.showToast({
        type: 'error',
        message: '‰øùÂ≠òÊ∏∏ÊàèÂ§±Ë¥•',
        duration: 3000
      });
    }
  } catch (err) {
    handleError(err, 'GameView (views)', ErrorType.UNKNOWN, ErrorSeverity.ERROR);
    console.error('‰øùÂ≠òÊ∏∏ÊàèÊó∂Âá∫Èîô:', err);
    uiStore.showToast({
      type: 'error',
      message: '‰øùÂ≠òÊ∏∏ÊàèÊó∂Âá∫Èîô: ' + (err.message || 'Êú™Áü•ÈîôËØØ'),
      duration: 3000
    });
  }
};

const cancelSave = () => {
  showSaveDialog.value = false;
  saveName.value = '';
};

const goToMainMenu = () => {
  router.push('/');
};

const dismissNotification = (id) => {
  gameCoreStore.notifications = gameCoreStore.notifications.filter(n => n.id !== id);
};

// Ëé∑ÂèñÂú∞ÁÇπÂêçÁß∞
const getLocationName = (locationId) => {
  const location = gameCoreStore.locations.find(loc => loc.id === locationId);
  return location ? location.name : 'Êú™Áü•Âú∞ÁÇπ';
};

// ÁîüÊàêÊ∏∏ÊàèÁªìÊùüÂª∫ËÆÆ
const generateGameEndSuggestions = () => {
  const suggestions = [];

  // Ê†πÊçÆÊ∏∏ÊàèÁªìÊûúÁîüÊàêÂª∫ËÆÆ
  if (gameCoreStore.gameResult?.endReason === 'bankruptcy') {
    suggestions.push('Â∞ùËØïÂáèÂ∞ëÂÄ∫Âä°ÔºåÈÅøÂÖçËøáÂ∫¶ÂÄüË¥∑');
    suggestions.push('ÂÖ≥Ê≥®ÂïÜÂìÅ‰ª∑Ê†ºË∂ãÂäøÔºåÈÅøÂÖçÂú®È´ò‰ª∑Êó∂Ë¥≠ÂÖ•');
  } else if (gameCoreStore.gameResult?.endReason === 'timeLimit') {
    suggestions.push('Â∞ùËØïÊõ¥È¢ëÁπÅÂú∞‰∫§ÊòìÔºåÂ¢ûÂä†‰∫§ÊòìÈáè');
    suggestions.push('ÂÖ≥Ê≥®ÁâπËâ≤ÂïÜÂìÅÔºåÂÆÉ‰ª¨ÈÄöÂ∏∏ÊúâÊõ¥Â§ßÁöÑÂà©Ê∂¶Á©∫Èó¥');
  }

  // Ê†πÊçÆ‰∫§ÊòìÊï∞ÊçÆÁîüÊàêÂª∫ËÆÆ
  if ((gameCoreStore.player.statistics.totalProfit || 0) / (gameCoreStore.player.statistics.transactionCount || 1) < 1000) {
    suggestions.push('ÊèêÈ´òÊØèÁ¨î‰∫§ÊòìÁöÑÂπ≥ÂùáÂà©Ê∂¶ÔºåÂÖ≥Ê≥®‰ª∑Ê†ºÊ≥¢Âä®ËæÉÂ§ßÁöÑÂïÜÂìÅ');
  }

  // Ê†πÊçÆÂú∞ÁÇπËÆøÈóÆÊï∞ÊçÆÁîüÊàêÂª∫ËÆÆ
  const locationVisits = gameCoreStore.player.statistics.locationVisits || {};
  const visitCounts = Object.values(locationVisits);
  if (visitCounts.length > 0 && Math.max(...visitCounts) > 3 * Math.min(...visitCounts)) {
    suggestions.push('Â∞ùËØïÊé¢Á¥¢Êõ¥Â§ö‰∏çÂêåÁöÑÂú∞ÁÇπÔºåÊØè‰∏™Âú∞ÁÇπÈÉΩÊúâÁã¨ÁâπÁöÑÂïÜÂìÅ‰ºòÂäø');
  }

  // Â¶ÇÊûúÂª∫ËÆÆÂ§™Â∞ëÔºåÊ∑ªÂä†‰∏Ä‰∫õÈÄöÁî®Âª∫ËÆÆ
  if (suggestions.length < 3) {
    suggestions.push('ÂÖ≥Ê≥®Â∏ÇÂú∫Ë∂ãÂäøÔºåÂú®‰Ωé‰ª∑Êó∂Ë¥≠ÂÖ•ÔºåÈ´ò‰ª∑Êó∂ÂçñÂá∫');
    suggestions.push('ÂêàÁêÜÂà©Áî®Ë¥∑Ê¨æÔºå‰ΩÜË¶ÅÊ≥®ÊÑèÊéßÂà∂ÂÄ∫Âä°ÊØî‰æã');
    suggestions.push('ÁßØÊûÅÂèÇ‰∏é‰∫ã‰ª∂ÈÄâÊã©ÔºåÂèØËÉΩÂ∏¶Êù•ÊÑèÂ§ñÊî∂Áõä');
  }

  return suggestions.slice(0, 5); // ÊúÄÂ§öËøîÂõû5Êù°Âª∫ËÆÆ
};

// Ê∑ªÂä†ÁªßÁª≠Ê∏∏ÊàèÊñπÊ≥ï
const continueFromVictory = () => {
  // ÈöêËóèÁªìÁÆóÈ°µÈù¢
  showGameOverDialog.value = false;
  // ÈÄöÁü•Ê∏∏ÊàèÊ†∏ÂøÉÁªßÁª≠Ê∏∏Êàè
  gameCoreStore.continueGame();
};

// ÈáçÊñ∞ÂºÄÂßãÊ∏∏Êàè
const restartGame = () => {
  // ÂÖàÈáçÁΩÆ‰∫ã‰ª∂Á≥ªÁªü
  const eventStore = useEventStore();
  eventStore.resetEvents();

  // ÂàõÂª∫‰∏Ä‰∏™Êñ∞Ê∏∏Êàè
  gameCoreStore.startNewGame(player.value.name);
  showGameOverDialog.value = false;

  // Ê∏ÖÈô§ÊâÄÊúâÊ¥ªË∑É‰∫ã‰ª∂
  eventStore.activeEvent = null;
  eventStore.activeEvents = [];
};

// Âä†ËΩΩÊ∏∏ÊàèËµÑÊ∫ê
const loadGameResources = async () => {
 try {
    // ÂÆö‰πâÂä†ËΩΩÊ≠•È™§
    const loadSteps = [
      { name: 'Ê∏∏ÊàèÊ†∏ÂøÉ', weight: 20, action: () => Promise.resolve(console.log('Ê∏∏ÊàèÊ†∏ÂøÉÂ∑≤ÂáÜÂ§áÂ∞±Áª™')) },
      { name: 'Áé©ÂÆ∂Êï∞ÊçÆ', weight: 20, action: () => playerStore.initializePlayer(player.value.name) },
      { name: 'Â∏ÇÂú∫Êï∞ÊçÆ', weight: 25, action: () => marketStore.initializeMarket() },
      { name: '‰∫ã‰ª∂Á≥ªÁªü', weight: 15, action: () => eventStore.initializeEvents() },
      { name: 'ÊïôÁ®ã‰∫ã‰ª∂', weight: 10, action: () => Promise.resolve(checkForTutorialEvents()) },
      { name: 'Ê∏∏ÊàèÁïåÈù¢', weight: 10, action: () => new Promise(resolve => setTimeout(resolve, 200)) }
    ];

    let progressSoFar = 5; // Ëµ∑ÂßãËøõÂ∫¶

    // ‰æùÊ¨°ÊâßË°åÊØè‰∏™Âä†ËΩΩÊ≠•È™§
    for (const step of loadSteps) {
      loadingStatus.value = `Âä†ËΩΩ‰∏≠: ${step.name}`;
      console.log(`Âä†ËΩΩÊ≠•È™§: ${step.name}`);

      try {
        await step.action();
        progressSoFar += step.weight;
        loadingProgress.value = progressSoFar;
      } catch (error) {
        handleError(error, 'GameView (views)', ErrorType.UNKNOWN, ErrorSeverity.ERROR);
        console.error(`Âä†ËΩΩÂ§±Ë¥•: ${step.name}`, error);
        // ÁªßÁª≠ÊâßË°å‰∏ã‰∏ÄÊ≠•Ôºå‰∏ç‰∏≠Êñ≠Êï¥‰∏™Âä†ËΩΩÊµÅÁ®ã
      }
    }

    // ÂÆåÊàêÂä†ËΩΩ
    loadingStatus.value = 'Âä†ËΩΩÂÆåÊàêÔºÅ';
    loadingProgress.value = 100;

    // Âª∂Ëøü‰∏ÄÂ∞èÊÆµÊó∂Èó¥ÂêéÈöêËóèÂä†ËΩΩÁïåÈù¢
    setTimeout(() => {
      isLoading.value = false;
      console.log('Ê∏∏ÊàèËµÑÊ∫êÂä†ËΩΩÂÆåÊàêÔºåÈöêËóèÂä†ËΩΩÁïåÈù¢');

      // Ê£ÄÊü•ÊòØÂê¶ÊúâÊ¥ªË∑É‰∫ã‰ª∂
      checkActiveEvents();
    }, 500);
  } catch (error) {
    console.error('Âä†ËΩΩÊ∏∏ÊàèËµÑÊ∫êÂ§±Ë¥•:', error);
    loadingStatus.value = 'Âä†ËΩΩÂ§±Ë¥•ÔºåËØ∑Âà∑Êñ∞È°µÈù¢ÈáçËØï';
  }
};

// Ê£ÄÊü•ÊòØÂê¶ÈúÄË¶ÅÊòæÁ§∫ÊïôÁ®ã‰∫ã‰ª∂
const checkForTutorialEvents = () => {
  console.log('Ê£ÄÊü•ÊïôÁ®ã‰∫ã‰ª∂');
  try {
    if (tutorialSystem.value) {
      console.log('Ê£ÄÊü•ÊïôÁ®ãÊèêÁ§∫Á≥ªÁªü');
      return true;
    }

    // Ëß¶ÂèëÂàùÂßãÊïôÁ®ã‰∫ã‰ª∂
    if (gameCoreStore.currentWeek === 1 && typeof eventStore.triggerTutorialEvent === 'function') {
      console.log('Â∞ùËØïËß¶ÂèëÂàùÂßãÊïôÁ®ã‰∫ã‰ª∂');
      eventStore.triggerTutorialEvent('tutorial_trading');
    }

    return true;
  } catch (error) {
    handleError(error, 'GameView (views)', ErrorType.UNKNOWN, ErrorSeverity.WARNING);
    console.warn('Ê£ÄÊü•ÊïôÁ®ã‰∫ã‰ª∂Êó∂Âá∫Èîô:', error);
    return false;
  }
};

// Âä†ËΩΩÂÆåÊàêÂõûË∞É
const onLoadingComplete = () => {
  console.log('GameView - Âä†ËΩΩÂÆåÊàêÂõûË∞É');
  isLoading.value = false;

  // Ê£ÄÊü•ÊòØÂê¶ÊúâÊ¥ªË∑É‰∫ã‰ª∂
  checkActiveEvents();
};

// Â§ÑÁêÜÈ°µÈù¢ÂÖ≥Èó≠ÂâçÁöÑËá™Âä®‰øùÂ≠ò
const handleBeforeUnload = async (event) => {
  // Â¶ÇÊûúÊ∏∏ÊàèÂ∑≤ÁªèÂºÄÂßã‰ΩÜËøòÊú™ÁªìÊùü
  if (gameCoreStore.gameStarted && !gameCoreStore.gameOver) {
    // Ëé∑ÂèñËÆæÁΩÆ
    const settings = settingsStore.gameSettings;

    // Ê£ÄÊü•ÊòØÂê¶ÂºÄÂêØËá™Âä®‰øùÂ≠òÂäüËÉΩ
    if (settings && settings.autoSaveEnabled) {
      try {
        const now = new Date();
        const timestamp = `${now.getFullYear()}${String(now.getMonth() + 1).padStart(2, '0')}${String(now.getDate()).padStart(2, '0')}_${String(now.getHours()).padStart(2, '0')}${String(now.getMinutes()).padStart(2, '0')}${String(now.getSeconds()).padStart(2, '0')}`;
        const saveName = `autoSave_exit_W${gameCoreStore.currentWeek}_${timestamp}`;

        // ËøõË°å‰øùÂ≠ò
        await gameCoreStore.saveGame(saveName, true);
      } catch (error) {
        handleError(error, 'GameView (views)', ErrorType.UNKNOWN, ErrorSeverity.ERROR);
        console.error('ÈÄÄÂá∫Êó∂Ëá™Âä®‰øùÂ≠òÂ§±Ë¥•:', error);
      }
    }
  }
};

// Â§ÑÁêÜ‰∫§ÊòìÊèêÁ§∫
const handleTransactionToast = (data) => {
  transactionToastMessage.value = data.message;
  transactionToastClass.value = data.class;
  transactionToastIcon.value = data.icon;

  // ÈáçÁΩÆ‰πãÂâçÁöÑÊèêÁ§∫ÔºàÂ¶ÇÊûúÂ≠òÂú®Ôºâ
  showTransactionToast.value = false;

  // Âª∂Ëøü‰∏ÄÂ∏ßÂêéÊòæÁ§∫ÔºåÁ°Æ‰øùÂä®ÁîªÊ≠£Á°ÆÊí≠Êîæ
  requestAnimationFrame(() => {
    showTransactionToast.value = true;

    // ÂºπÁ™óÂ∞ÜÈÄöËøáCSSÂä®ÁîªËá™Âä®Ê∑°Âá∫
    setTimeout(() => {
      showTransactionToast.value = false;
    }, 3000);
  });
};
</script>

<style scoped>
  /* Ê∏∏ÊàèËßÜÂõæÂÆπÂô® */
.game-view {
  display: flex;
  flex-direction: column;
  height: 100vh;
  background-color: #f0f2f5;
  color: #333;
  font-family: 'Helvetica Neue', Arial, sans-serif;
  padding: 0; /* ÁßªÈô§Ê∞¥Âπ≥ÂÜÖËæπË∑ù */
}

/* È°∂ÈÉ®‰ø°ÊÅØÊ†è */
.game-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 12px 24px;
  background: linear-gradient(135deg, #2980b9, #3498db);
  color: white;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
  z-index: 10;
  border-bottom: 2px solid rgba(255, 255, 255, 0.1);
  position: relative;
  overflow: hidden;
  width: 100%; /* Á°Æ‰øùÂÆΩÂ∫¶‰∏∫100% */
  margin: 0; /* ÁßªÈô§Â§ñËæπË∑ù */
}

/* Ê∑ªÂä†‰∏Ä‰∏™ËÉåÊôØË£ÖÈ•∞ÊïàÊûú */
.game-header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  /* ÁßªÈô§Êó†ÊïàÁöÑËÉåÊôØÂõæÂÉè */
  background: rgba(0, 0, 0, 0.02);
  background-size: cover;
  opacity: 0.05;
  z-index: -1;
}

.left-info {
  flex: 1;
  display: flex;
  justify-content: flex-start;
}

.right-info {
  flex: 1;
  display: flex;
  justify-content: flex-end;
}

.week-indicator {
  display: flex;
  align-items: center;
    gap: 10px;
  background-color: rgba(255, 255, 255, 0.1);
  padding: 6px 12px;
  border-radius: 20px;
  backdrop-filter: blur(5px);
  transition: all 0.3s ease;
  border: 1px solid rgba(255, 255, 255, 0.2);
}

.week-indicator:hover {
  background-color: rgba(255, 255, 255, 0.15);
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.1);
}

.week-label {
    font-weight: 500;
  opacity: 0.8;
  font-size: 0.9rem;
}

.week-value {
  font-weight: 700;
    background-color: rgba(255, 255, 255, 0.2);
  padding: 3px 12px;
    border-radius: 12px;
  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  letter-spacing: 0.5px;
  display: flex;
  align-items: center;
  justify-content: center;
}

.progress-bar {
  width: 100px;
  height: 6px;
  background-color: rgba(255, 255, 255, 0.3);
  border-radius: 3px;
  overflow: hidden;
  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);
}

.progress {
  height: 100%;
  background-color: #2ecc71;
    border-radius: 3px;
  transition: width 0.3s ease;
  box-shadow: 0 0 4px rgba(46, 204, 113, 0.5);
}

.menu-button {
  background-color: rgba(255, 255, 255, 0.15);
  border: 1px solid rgba(255, 255, 255, 0.3);
    color: white;
  padding: 8px 16px;
  border-radius: 20px;
  cursor: pointer;
  font-weight: 500;
  transition: all 0.2s ease;
    float: right;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
  display: flex;
  align-items: center;
  gap: 8px;
}

.menu-icon {
  font-size: 1.2rem;
  line-height: 1;
}

.menu-button:hover {
  background-color: rgba(255, 255, 255, 0.25);
  transform: translateY(-1px);
  box-shadow: 0 3px 5px rgba(0, 0, 0, 0.15);
}

.menu-button:active {
  transform: translateY(0);
  box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}

/* ÈÄöÁü•Âå∫Âüü */
.notifications-container {
  padding: 10px 24px; /* ‰∏éÈ°∂ÈÉ®ÂØºËà™Ê†èÁöÑÂ∑¶Âè≥ÂÜÖËæπË∑ù‰øùÊåÅ‰∏ÄËá¥ */
  background-color: #f8f9fa;
  border-bottom: 1px solid #e9ecef;
  width: 100%; /* Á°Æ‰øùÂÆΩÂ∫¶‰∏∫100% */
}

.notification {
    padding: 10px 15px;
  margin-bottom: 10px;
  border-radius: 4px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    animation: slideIn 0.3s ease-out;
  }

  .notification:last-child {
    margin-bottom: 0;
  }

  .notification.info {
    background-color: #d1ecf1;
    border-left: 4px solid #17a2b8;
}

.notification.success {
  background-color: #d4edda;
  border-left: 4px solid #28a745;
}

  .notification.warning {
    background-color: #fff3cd;
    border-left: 4px solid #ffc107;
  }

.notification.error {
  background-color: #f8d7da;
  border-left: 4px solid #dc3545;
}

  .close-btn {
  background: none;
  border: none;
    font-size: 1.2rem;
  cursor: pointer;
    color: #6c757d;
    transition: color 0.2s;
  }

  .close-btn:hover {
    color: #343a40;
}

  @keyframes slideIn {
  from {
      transform: translateY(-20px);
    opacity: 0;
  }
  to {
      transform: translateY(0);
    opacity: 1;
  }
}

/* ‰∏ªÊ∏∏ÊàèÂå∫Âüü */
.game-content {
  display: flex;
  flex: 1;
  overflow: hidden;
  padding: 16px;
  gap: 16px;
  align-items: stretch; /* Êãâ‰º∏ÂØπÈΩêÔºåÁ°Æ‰øùÂ∑¶Âè≥‰∏§‰æßÈ´òÂ∫¶‰∏ÄËá¥ */
  height: calc(100vh - 120px); /* ËÆæÁΩÆÂêàÈÄÇÁöÑÈ´òÂ∫¶ÔºåÂáèÂéªÂ§¥ÈÉ®ÂíåÂÖ∂‰ªñÂÖÉÁ¥†ÁöÑÈ´òÂ∫¶ */
  background-color: #f0f2f5; /* ËÆæÁΩÆËÉåÊôØËâ≤ */
  border-radius: 16px; /* ËÆæÁΩÆÊï¥‰ΩìÂúÜËßí */
  margin: 0; /* ÁßªÈô§Â∑¶Âè≥ËæπË∑ù */
  width: 100%; /* Á°Æ‰øùÂÆΩÂ∫¶‰∏∫100% */
}

/* Â∑¶‰æßÈù¢Êùø */
.left-panel {
    width: 280px;
    background-color: #f8f9fa;
    border-right: 1px solid #e9ecef;
    padding: 16px;
  display: flex;
  flex-direction: column;
    gap: 18px; /* Â¢ûÂä†Èó¥Ë∑ù */
    overflow-y: auto; /* Ê∑ªÂä†ÂûÇÁõ¥ÊªöÂä®Êù° */
    height: 100%; /* Á°Æ‰øùÂç†Êª°Êï¥‰∏™È´òÂ∫¶ */
    scrollbar-width: thin; /* Firefox ÊªöÂä®Êù°Ê†∑Âºè */
    scrollbar-color: #cbd5e0 #f8f9fa; /* Firefox ÊªöÂä®Êù°È¢úËâ≤ */
    border-radius: 12px; /* ÂõõÂë®ÈÉΩÊ∑ªÂä†ÂúÜËßí */
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08); /* Ê∑ªÂä†Èò¥ÂΩ±ÊïàÊûú */
    margin: 4px; /* Ê∑ªÂä†Â§ñËæπË∑ùÔºåÁ°Æ‰øùÂúÜËßíÊïàÊûúÂèØËßÅ */
    min-height: calc(100vh - 140px); /* ËÆæÁΩÆÊúÄÂ∞èÈ´òÂ∫¶Ôºå‰∏éÂè≥‰æßÂÜÖÂÆπÂå∫Âüü‰øùÊåÅ‰∏ÄËá¥ */
  }

  /* Â∑¶‰æßÈù¢ÊùøÊªöÂä®Êù°Ê†∑Âºè (WebkitÊµèËßàÂô®) */
  .left-panel::-webkit-scrollbar {
    width: 6px;
  }

  .left-panel::-webkit-scrollbar-track {
    background: #f8f9fa;
  }

  .left-panel::-webkit-scrollbar-thumb {
    background-color: #cbd5e0;
    border-radius: 4px;
  }

  .mini-inventory {
    background-color: #f0f8ff; /* ‰∏éÁé©ÂÆ∂‰ø°ÊÅØÂç°ÁâáËÉåÊôØËâ≤‰∏ÄËá¥ */
    border-radius: 12px; /* Â¢ûÂä†ÂúÜËßí */
    box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08); /* Â¢ûÂº∫Èò¥ÂΩ±ÊïàÊûú */
    padding: 16px;
    display: flex;
    flex-direction: column;
    height: auto; /* Ëá™Âä®È´òÂ∫¶ */
    max-height: 400px; /* ËÆæÁΩÆÂêàÁêÜÁöÑÊúÄÂ§ßÈ´òÂ∫¶ */
    flex: 1; /* Âç†Áî®Ââ©‰ΩôÁ©∫Èó¥ */
    overflow: hidden; /* Èò≤Ê≠¢Êï¥‰ΩìÊ∫¢Âá∫ */
    transition: box-shadow 0.3s ease;
  }

  .mini-inventory:hover {
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
  }

  .mini-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
    padding-bottom: 8px;
    /* ÁßªÈô§‰∫ÜÂàÜÂâ≤Á∫ø */
  }

  .mini-title {
    font-size: 1.2rem;
    margin: 0;
    color: #2c3e50;
    font-weight: 600;
  }

  .view-all-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.2rem;
    color: #3498db;
    transition: color 0.2s;
  }

  .view-all-btn:hover {
    color: #2980b9;
  }

  .inventory-items {
    height: auto; /* Ëá™Âä®È´òÂ∫¶ */
    max-height: 300px; /* ËÆæÁΩÆÊúÄÂ§ßÈ´òÂ∫¶ */
    border-radius: 4px;
    margin-bottom: 8px; /* Â∫ïÈÉ®Èó¥Ë∑ù */
    overflow-y: auto; /* Ê∑ªÂä†ÂûÇÁõ¥ÊªöÂä®Êù° */
    scrollbar-width: thin; /* Firefox ÊªöÂä®Êù°Ê†∑Âºè */
    scrollbar-color: #cbd5e0 #f8f9fa; /* Firefox ÊªöÂä®Êù°È¢úËâ≤ */
  }

  /* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè (WebkitÊµèËßàÂô®) */
  .inventory-items::-webkit-scrollbar {
    width: 6px;
  }

  .inventory-items::-webkit-scrollbar-track {
    background: #f8f9fa;
  }

  .inventory-items::-webkit-scrollbar-thumb {
    background-color: #cbd5e0;
    border-radius: 4px;
  }

  .empty-inventory {
    color: #6c757d;
    font-style: italic;
    text-align: center;
    padding: 12px 0;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .inventory-list {
    display: flex;
    flex-direction: column;
    gap: 6px;
    padding: 4px;
  }

  .inventory-item {
    padding: 10px 12px; /* Â¢ûÂä†ÂÜÖËæπË∑ù */
    border-radius: 10px; /* Â¢ûÂä†ÂúÜËßí */
    background-color: #fff;
    transition: all 0.2s ease;
    box-shadow: 0 2px 4px rgba(0,0,0,0.04);
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 3px; /* Â¢ûÂä†Â∫ïÈÉ®Èó¥Ë∑ù */
  }

  .inventory-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 3px 6px rgba(0,0,0,0.08);
  }

  .inventory-item:hover {
    background-color: #e9ecef;
  }

  .item-name {
    font-weight: 500;
    font-size: 0.9rem;
    color: #343a40;
    margin: 0;
  }

  .item-details {
    display: flex;
    align-items: center;
    gap: 24px; /* Â¢ûÂä†Èó¥Ë∑ù */
    font-size: 0.85rem;
    color: #495057;
  }

  .item-quantity {
    font-weight: 600;
    color: #495057;
    min-width: 30px; /* ËÆæÁΩÆÊúÄÂ∞èÂÆΩÂ∫¶ */
    text-align: left; /* Â∑¶ÂØπÈΩê */
  }

  .item-price {
    font-weight: bold;
    color: #2c9f2c;
    min-width: 45px; /* ËÆæÁΩÆÊúÄÂ∞èÂÆΩÂ∫¶ */
    text-align: right; /* Âè≥ÂØπÈΩê */
  }

  .more-items {
    text-align: center;
    font-size: 0.8rem;
    color: #6c757d;
    padding: 4px 0;
  }

  /* ÁßªÈô§‰∫ÜÂÆπÈáèÊòæÁ§∫Áõ∏ÂÖ≥Ê†∑Âºè */

.actions-panel {
  margin-top: 15px;
  display: flex;
  justify-content: center;
}

.action-button {
  background-color: #3498db;
  color: white;
  padding: 10px 20px;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 500;
  display: flex;
  align-items: center;
  gap: 8px;
  transition: background-color 0.2s;
}

.action-button:hover:not(:disabled) {
  background-color: #2980b9;
}

.action-button:disabled {
  background-color: #95a5a6;
  cursor: not-allowed;
  color: #7f8c8d;
}

.next-week-icon {
  font-size: 1.2rem;
}

/* ‰∏≠Â§ÆÂÜÖÂÆπÂå∫Âüü */
.main-content {
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* ‰øùÊåÅÂ§ñÂ±ÇÈöêËóèÊ∫¢Âá∫ */
  background-color: #fff;
  border-radius: 12px; /* Â¢ûÂä†ÂúÜËßí‰∏éÂ∑¶‰æßÈù¢Êùø‰∏ÄËá¥ */
  box-shadow: 0 3px 6px rgba(0, 0, 0, 0.08); /* Â¢ûÂº∫Èò¥ÂΩ±ÊïàÊûú‰∏éÂ∑¶‰æßÈù¢Êùø‰∏ÄËá¥ */
  height: 100%; /* Á°Æ‰øùÂç†Êª°Êï¥‰∏™È´òÂ∫¶ */
  min-height: calc(100vh - 140px); /* ËÆæÁΩÆÊúÄÂ∞èÈ´òÂ∫¶Ôºå‰∏éÂ∑¶‰æßÈù¢Êùø‰øùÊåÅ‰∏ÄËá¥ */
  margin: 4px; /* Ê∑ªÂä†Â§ñËæπË∑ùÔºåÁ°Æ‰øùÂúÜËßíÊïàÊûúÂèØËßÅ */
  transition: box-shadow 0.3s ease;
}

.main-content:hover {
  box-shadow: 0 4px 8px rgba(0, 0, 0, 0.12);
}

.tab-buttons {
  display: flex;
    background-color: #f8f9fa;
    border-bottom: 1px solid #e9ecef;
    padding: 0 16px;
}

.tab-button {
    padding: 12px 20px;
  background: none;
  border: none;
    border-bottom: 3px solid transparent;
  font-weight: 500;
    color: #6c757d;
    cursor: pointer;
    transition: all 0.2s ease;
  position: relative;
    overflow: hidden;
  }

  .tab-button:hover {
    color: #495057;
    background-color: rgba(0, 0, 0, 0.03);
}

.tab-button.active {
  color: #3498db;
    border-bottom-color: #3498db;
}

.tab-button.active::after {
  content: '';
  position: absolute;
    bottom: 0;
  left: 0;
    width: 100%;
    height: 3px;
  background-color: #3498db;
}

.tab-content {
  flex: 1;
  overflow-y: auto; /* ÂûÇÁõ¥ÊñπÂêëÊªöÂä® */
    padding: 16px;
  height: 100%; /* Á°Æ‰øùÂç†Êª°È´òÂ∫¶ */
  scrollbar-width: thin; /* Firefox ÊªöÂä®Êù°Ê†∑Âºè */
  scrollbar-color: #cbd5e0 #f8f9fa; /* Firefox ÊªöÂä®Êù°È¢úËâ≤ */
}

/* Ëá™ÂÆö‰πâÊªöÂä®Êù°Ê†∑Âºè (WebkitÊµèËßàÂô®) */
.tab-content::-webkit-scrollbar {
  width: 8px;
}

.tab-content::-webkit-scrollbar-track {
  background: #f8f9fa;
}

.tab-content::-webkit-scrollbar-thumb {
  background-color: #cbd5e0;
  border-radius: 4px;
  }

  /* Ê†áÁ≠æÈ°µÂÜÖÂÆπ */
  .market-tab, .inventory-tab, .houses-tab {
    min-height: 100%;
    height: 100%; /* Á°Æ‰øùÂç†Êª°Êï¥‰∏™È´òÂ∫¶ */
    position: relative;
    display: flex; /* ‰ΩøÁî®flexÂ∏ÉÂ±Ä */
    flex-direction: column; /* ÂûÇÁõ¥ÊñπÂêëÊéíÂàó */
}

/* ÂØπËØùÊ°Ü */
.dialog-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background-color: rgba(0, 0, 0, 0.5);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 1000;
}

.dialog {
  background-color: white;
  border-radius: 8px;
  padding: 20px;
  width: 90%;
  max-width: 500px;
  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
}

.dialog-title {
  margin-top: 0;
  margin-bottom: 20px;
  font-size: 1.5rem;
  color: #2c3e50;
  border-bottom: 1px solid #eee;
  padding-bottom: 10px;
}

.menu-options {
  display: flex;
  flex-direction: column;
}

.menu-option {
  padding: 12px;
  margin-bottom: 10px;
  background-color: #f8f9fa;
  border: none;
  border-radius: 4px;
  cursor: pointer;
  font-size: 1rem;
  font-weight: 500;
  transition: background-color 0.2s;
}

.menu-option:hover {
  background-color: #e9ecef;
}

.save-form {
  display: flex;
  flex-direction: column;
}

.save-input {
  padding: 10px;
  margin-bottom: 20px;
  border: 1px solid #ddd;
  border-radius: 4px;
  font-size: 1rem;
}

.dialog-buttons {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.dialog-button {
  padding: 8px 16px;
  border-radius: 4px;
  border: none;
  cursor: pointer;
  font-weight: 500;
}

.dialog-button.confirm {
  background-color: #3498db;
  color: white;
}

.dialog-button.confirm:hover:not(:disabled) {
  background-color: #2980b9;
}

.dialog-button.confirm:disabled {
  background-color: #95a5a6;
  cursor: not-allowed;
}

.dialog-button.cancel {
  background-color: #f8f9fa;
  color: #333;
}

.dialog-button.cancel:hover {
  background-color: #e9ecef;
}

/* Ê∏∏ÊàèÁªìÊùüÂØπËØùÊ°Ü */
.game-over-dialog {
  max-width: 600px;
}

.game-result-header {
  display: flex;
  justify-content: space-around;
  align-items: center;
  margin-bottom: 20px;
  padding: 15px;
  background-color: #f8f9fa;
  border-radius: 4px;
}

.game-score, .game-rank, .game-achievement {
  text-align: center;
}

.game-score .score-value {
  font-size: 2.5rem;
  font-weight: bold;
  color: #3498db;
}

.game-score .score-label {
  font-size: 0.9rem;
  color: #555;
}

.game-rank {
  font-size: 2rem;
  font-weight: bold;
  color: #2c3e50;
}

.game-rank.rank-s { color: #2ecc71; }
.game-rank.rank-a { color: #2980b9; }
.game-rank.rank-b { color: #f1c40f; }
.game-rank.rank-c { color: #e67e22; }
.game-rank.rank-d { color: #e74c3c; }
.game-rank.rank-e { color: #95a5a6; }

.game-achievement {
  display: flex;
  align-items: center;
  gap: 5px;
}

.game-achievement .achievement-badge {
  font-size: 1.5rem;
}

.game-achievement .achievement-name {
  font-size: 1rem;
  font-weight: bold;
  color: #2c3e50;
}

.game-stats {
  margin: 20px 0;
  padding: 15px;
  background-color: #f8f9fa;
  border-radius: 4px;
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
  gap: 15px;
  margin-bottom: 15px;
}

.stat-item {
  text-align: center;
}

.stat-label {
  font-size: 0.8rem;
  color: #7f8c8d;
  margin-bottom: 5px;
}

.stat-value {
  font-size: 1.2rem;
  font-weight: bold;
  color: #3498db;
}

.stat-value.positive {
  color: #2ecc71;
}

.stat-value.negative {
  color: #e74c3c;
}

.purchased-houses {
  margin-top: 15px;
}

.purchased-houses h3 {
  margin-bottom: 10px;
  font-size: 1.1rem;
}

.houses-list {
  list-style: none;
  padding: 0;
  margin: 0;
}

.house-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 0;
  border-bottom: 1px dashed #eee;
}

.house-item:last-child {
  border-bottom: none;
}

.house-name {
  flex-grow: 1;
  margin-right: 10px;
  font-weight: bold;
}

.house-price, .house-week {
  font-size: 0.9rem;
  color: #555;
}

.game-end-description {
  margin-top: 15px;
  padding-top: 15px;
  border-top: 1px solid #eee;
  font-size: 0.95rem;
  color: #555;
}

.game-end-description p {
  margin-bottom: 10px;
}

.game-end-description p:last-child {
  margin-bottom: 0;
}

@media (max-width: 768px) {
  .game-content {
    flex-direction: column;
  }

  .left-panel {
    width: 100%;
    padding: 10px;
  }
}

/* Âú®styleÂùóÁöÑÊú´Â∞æÊ∑ªÂä†Ëøô‰∫õÂä®ÁîªCSS */

/* ÈÄöÁî®Ê∑°ÂÖ•Ê∑°Âá∫ÊïàÊûú */
.fade-enter-active,
.fade-leave-active {
  transition: opacity 0.3s ease;
}

.fade-enter-from,
.fade-leave-to {
  opacity: 0;
}

/* Áº©ÊîæÂºπË∑≥ÊïàÊûú - Áî®‰∫éËèúÂçïÂØπËØùÊ°Ü */
.zoom-bounce-enter-active {
  animation: zoom-bounce-in 0.5s;
}
.zoom-bounce-leave-active {
  animation: zoom-bounce-out 0.3s;
}
@keyframes zoom-bounce-in {
  0% {
    transform: scale(0.5);
    opacity: 0;
  }
  50% {
    transform: scale(1.05);
    opacity: 1;
  }
  70% {
    transform: scale(0.95);
  }
  100% {
    transform: scale(1);
  }
}
@keyframes zoom-bounce-out {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(0.5);
    opacity: 0;
  }
}

/* Áº©ÊîæÂºπË∑≥ÊïàÊûú - Áî®‰∫éÊ∏∏ÊàèÁªìÊùüÂØπËØùÊ°Ü */
.scale-bounce-enter-active {
  animation: scale-bounce-in 0.8s;
}
.scale-bounce-leave-active {
  animation: scale-bounce-out 0.4s;
}
@keyframes scale-bounce-in {
  0% {
    transform: scale(0.8);
    opacity: 0;
  }
  60% {
    transform: scale(1.03);
    opacity: 1;
  }
  80% {
    transform: scale(0.97);
  }
  100% {
    transform: scale(1);
  }
}
@keyframes scale-bounce-out {
  0% {
    transform: scale(1);
    opacity: 1;
  }
  100% {
    transform: scale(0.8);
    opacity: 0;
  }
}

/* ËèúÂçïÈ°πÂä®Áîª */
.menu-item-enter-active {
  transition: opacity 0.5s ease, transform 0.5s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  transition-delay: calc(0.1s * var(--order));
}
.menu-item-leave-active {
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.menu-item-enter-from {
  opacity: 0;
  transform: translateY(15px);
}
.menu-item-leave-to {
  opacity: 0;
  transform: translateY(15px);
}

/* ‰ªé‰∏ãÂêë‰∏äÊªëÂÖ•ÊïàÊûú - Áî®‰∫é‰øùÂ≠òÂØπËØùÊ°Ü */
.slide-up-enter-active {
  animation: slide-up-in 0.4s;
}
.slide-up-leave-active {
  animation: slide-up-out 0.3s;
}
@keyframes slide-up-in {
  0% {
    transform: translateY(30px);
    opacity: 0;
  }
  100% {
    transform: translateY(0);
    opacity: 1;
  }
}
@keyframes slide-up-out {
  0% {
    transform: translateY(0);
    opacity: 1;
  }
  100% {
    transform: translateY(30px);
    opacity: 0;
  }
}

/* ‰ªéÂ∑¶ÂêëÂè≥ÊªëÂÖ•ÊïàÊûú - Áî®‰∫éËØ¶ÁªÜÁªüËÆ°ÂØπËØùÊ°Ü */
.slide-left-enter-active {
  animation: slide-left-in 0.4s;
}
.slide-left-leave-active {
  animation: slide-left-out 0.3s;
}
@keyframes slide-left-in {
  0% {
    transform: translateX(-50px);
    opacity: 0;
  }
  100% {
    transform: translateX(0);
    opacity: 1;
  }
}
@keyframes slide-left-out {
  0% {
    transform: translateX(0);
    opacity: 1;
  }
  100% {
    transform: translateX(-50px);
    opacity: 0;
  }
}

/* Ê†áÁ≠æÂÜÖÂÆπÊ∑°ÂÖ•Ê∑°Âá∫ÊïàÊûú */
.tab-fade-enter-active,
.tab-fade-leave-active {
  transition: opacity 0.3s ease, transform 0.3s ease;
}
.tab-fade-enter-from {
  opacity: 0;
  transform: translateY(10px);
}
.tab-fade-leave-to {
  opacity: 0;
  transform: translateY(-10px);
}

/* ÈÄöÁü•Âä®Áîª */
.notification-enter-active {
  animation: notification-in 0.5s ease-out;
}
.notification-leave-active {
  animation: notification-out 0.3s ease-in;
}
@keyframes notification-in {
  0% {
    transform: translateX(100%);
    opacity: 0;
  }
  60% {
    transform: translateX(-5%);
  }
  80% {
    transform: translateX(2%);
  }
  100% {
    transform: translateX(0);
    opacity: 1;
  }
}
@keyframes notification-out {
  0% {
    transform: translateX(0);
    opacity: 1;
  }
  100% {
    transform: translateX(110%);
    opacity: 0;
  }
}

/* ËèúÂçïÂõæÊ†áÊ†∑Âºè */
.menu-icon {
  display: inline-block;
  margin-right: 10px;
  font-size: 1.2em;
}

/* ÊîπËøõÈÄöÁü•Ê†∑Âºè */
.notification {
  display: flex;
  align-items: center;
  justify-content: space-between;
  padding: 10px 15px;
  margin-bottom: 10px;
  border-radius: 6px;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
  background-color: #fff;
  transition: all 0.3s ease;
  animation: notification-pulse 2s infinite alternate;
}

.notification-content {
  flex-grow: 1;
  padding-right: 10px;
}

@keyframes notification-pulse {
  0% {
    box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
  }
  100% {
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.25);
  }
}

/* ‰∏∫ÂØπËØùÊ°ÜÊ∑ªÂä†Èò¥ÂΩ±ÊïàÊûú */
.dialog {
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.25);
  border-radius: 10px;
  overflow: hidden;
}

/* ËèúÂçïÈÄâÈ°πÊÇ¨ÂÅúÊïàÊûú */
.menu-option {
  transition: all 0.3s ease;
  border-left: 4px solid transparent;
}

.menu-option:hover {
  transform: translateX(5px);
  border-left-color: #3498db;
  background-color: #f8f9fa;
}

/* Ê∏∏ÊàèÁªìÊùüÂØπËØùÊ°ÜÊ†∑Âºè */
.game-over-overlay {
  padding: 0; /* ÁßªÈô§ÂÜÖËæπË∑ù */
  display: flex;
  justify-content: center;
  align-items: center;
  background-color: rgba(0, 0, 0, 0.75); /* Á∫ØÈªëËâ≤ÂçäÈÄèÊòéËÉåÊôØ */
  backdrop-filter: blur(3px);
  -webkit-backdrop-filter: blur(3px);
}

/* ÁßªÈô§game-over-frameÁõ∏ÂÖ≥Ê†∑Âºè */

/* ÁªìÁÆóÂä®ÁîªÊïàÊûú */
.scale-bounce-enter-active {
  animation: scale-bounce 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275); /* Ê∑ªÂä†ÂºπÊÄßÊõ≤Á∫ø */
}

.scale-bounce-leave-active {
  animation: scale-bounce 0.4s cubic-bezier(0.6, -0.28, 0.735, 0.045) reverse; /* Ê∑ªÂä†ÂºπÊÄßÊõ≤Á∫ø */
}

@keyframes scale-bounce {
  0% { transform: scale(0.8); opacity: 0; }
  70% { transform: scale(1.03); opacity: 1; }
  100% { transform: scale(1); opacity: 1; }
}

/* ‰∫§ÊòìÊèêÁ§∫Ê†∑Âºè */
.transaction-toast {
  position: fixed;
  bottom: 30px;
  left: 50%;
  transform: translateX(-50%);
  padding: 12px 20px;
  border-radius: 10px;
  background-color: rgba(44, 62, 80, 0.9);
  color: white;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.2);
  z-index: 9999; /* ÊèêÈ´òz-indexÁ°Æ‰øùÂú®ÊúÄ‰∏äÂ±Ç */
  min-width: 220px;
  backdrop-filter: blur(4px);
  animation: toast-in 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
  text-align: center;
  overflow: hidden;
  pointer-events: none; /* Èò≤Ê≠¢ÊèêÁ§∫Ê°ÜÂΩ±Âìç‰∏ãÊñπÂÖÉÁ¥†ÁöÑ‰∫§‰∫í */
}

/* ËøõÂ∫¶Êù°Âä®Áîª */
.toast-progress-bar {
  position: absolute;
  bottom: 0;
  left: 0;
  height: 3px;
  width: 100%;
  background: rgba(255, 255, 255, 0.3);
}

.toast-progress-bar::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  height: 100%;
  width: 100%;
  background: rgba(255, 255, 255, 0.7);
  animation: progress 3s linear forwards;
}

@keyframes progress {
  from { width: 100%; }
  to { width: 0%; }
}

@keyframes toast-in {
  from {
    transform: translate(-50%, 20px);
    opacity: 0;
  }
  to {
    transform: translate(-50%, 0);
    opacity: 1;
  }
}

.toast-content {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
}

.toast-icon {
  font-size: 18px;
  width: 24px;
  height: 24px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 50%;
}

.toast-message {
  font-weight: 500;
  letter-spacing: 0.2px;
}

.purchase-success {
  border-top: 3px solid #2ecc71;
}

.purchase-success .toast-icon {
  background-color: rgba(46, 204, 113, 0.2);
  color: #2ecc71;
}

.purchase-failed {
  border-top: 3px solid #e74c3c;
}

.purchase-failed .toast-icon {
  background-color: rgba(231, 76, 60, 0.2);
  color: #e74c3c;
}

.sale-success {
  border-top: 3px solid #3498db;
}

.sale-success .toast-icon {
  background-color: rgba(52, 152, 219, 0.2);
  color: #3498db;
}

.location-change {
  border-top: 3px solid #f39c12;
}

.location-change .toast-icon {
  background-color: rgba(243, 156, 18, 0.2);
  color: #f39c12;
}
</style>
