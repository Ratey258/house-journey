import{h as ee,E as te,a as se,i as pe,u as Me,b as mt,c as we,d as Te,e as St,f as fe,g as xe,j as wt,k as et,l as Dt,m as He,n as Vt,P as J,o as Gt,p as Ht,q as Je,r as Wt,s as pt,t as Bt,v as qt,_ as Le,w as Ut,x as Ct,y as Qt}from"./stores-b6778457.js";import{t as v,v as m,x as e,_ as o,Y as T,ac as ue,e as O,F,ak as oe,a as C,d as ce,E as qe,$ as j,V as ie,Q as H,a9 as Ze,L as Ft,b as ve,bX as We,R as Ce,W as B,a0 as ut,aH as ne,u as E,bY as _e,U as Be,q as zt,aC as ke,n as ye,bZ as jt,b_ as Kt,b$ as Yt,c0 as Xt,ao as Oe,c1 as Jt,c2 as Zt,c3 as De,c4 as es,c5 as ts,c6 as ss,c7 as ns,c8 as os,c9 as as,ca as ls,cb as is,cc as rs,cd as us,ce as cs,cf as ds,cg as vs,ch as ms,a1 as re,al as Pt,aA as Ve,Z as W,ay as ct,a3 as ps,a5 as gs,b2 as ys}from"./vendor-e7c44fa3.js";import{u as Ee,a as Ie,s as fs,b as hs,e as _s,f as bs}from"./vue-core-cd9800c2.js";import{i as $s,z as ks}from"./element-plus-c3799c73.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function s(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(r){if(r.ep)return;r.ep=!0;const i=s(r);fetch(r.href,i)}})();const ae=(l,t)=>{const s=l.__vccOpts||l;for(const[n,r]of t)s[n]=r;return s},Ss={name:"ErrorDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"错误"},message:{type:String,default:"应用程序发生错误"},details:{type:String,default:""},timestamp:{type:String,default:""},context:{type:String,default:""},fatal:{type:Boolean,default:!1}},emits:["close"],computed:{showRestartButton(){return this.fatal}},methods:{handleClose(){this.fatal||this.$emit("close")},restartApp(){window.electronAPI&&window.electronAPI.quitApp?window.electronAPI.quitApp():window.location.reload()},formatTimestamp(l){try{return new Date(l).toLocaleString()}catch(t){return ee(t,"ErrorDialog (common)",se.UNKNOWN,te.ERROR),l}}}},ws={class:"error-dialog",role:"dialog","aria-modal":"true"},Cs={class:"error-dialog-header"},Ps={class:"error-dialog-body"},Ts={class:"error-content"},Ms={class:"error-message"},Es={key:0,class:"error-timestamp"},Is={key:1,class:"error-context"},Ns={key:0,class:"error-details"},Ls={class:"error-stack"},xs={class:"error-dialog-footer"};function Rs(l,t,s,n,r,i){return s.show?(v(),m("div",{key:0,class:"error-dialog-overlay",onClick:t[3]||(t[3]=ue((...u)=>i.handleClose&&i.handleClose(...u),["self"]))},[e("div",ws,[e("div",Cs,[e("h3",null,o(s.title||"错误"),1),e("button",{class:"close-button",onClick:t[0]||(t[0]=(...u)=>i.handleClose&&i.handleClose(...u))},"×")]),e("div",Ps,[t[4]||(t[4]=e("div",{class:"error-icon"},[e("svg",{viewBox:"0 0 24 24",width:"48",height:"48"},[e("circle",{cx:"12",cy:"12",r:"11",fill:"#f56c6c"}),e("path",{d:"M12 7v6M12 17v.1",stroke:"white","stroke-width":"2","stroke-linecap":"round"})])],-1)),e("div",Ts,[e("div",Ms,o(s.message),1),s.timestamp?(v(),m("div",Es,o(i.formatTimestamp(s.timestamp)),1)):T("",!0),s.context?(v(),m("div",Is,o(s.context),1)):T("",!0)])]),s.details?(v(),m("div",Ns,[e("details",null,[t[5]||(t[5]=e("summary",null,"显示详细信息",-1)),e("div",Ls,[e("pre",null,o(s.details),1)])])])):T("",!0),e("div",xs,[i.showRestartButton?(v(),m("button",{key:0,class:"restart-button",onClick:t[1]||(t[1]=(...u)=>i.restartApp&&i.restartApp(...u))}," 重启应用 ")):T("",!0),e("button",{class:"dismiss-button",onClick:t[2]||(t[2]=(...u)=>i.handleClose&&i.handleClose(...u))}," 关闭 ")])])])):T("",!0)}const As=ae(Ss,[["render",Rs],["__scopeId","data-v-cb85fd19"]]);function A(l){return l==null?"0":pe&&pe.global&&typeof pe.global.formatNumber=="function"?pe.global.formatNumber(l):l.toLocaleString("zh-CN")}function gt(l,t="¥"){return l==null?`${t}0`:pe&&pe.global&&typeof pe.global.formatCurrency=="function"?pe.global.formatCurrency(l):`${t}${A(l)}`}function Os(l){return l==null?"0.0%":`${l>0?"+":""}${l.toFixed(1)}%`}function Ds(l,t="datetime"){if(!l)return"";if(pe&&pe.global&&typeof pe.global.formatDate=="function")return pe.global.formatDate(new Date(l),t);const s=new Date(l);switch(t){case"date":return s.toLocaleDateString("zh-CN");case"time":return s.toLocaleTimeString("zh-CN");case"datetime":default:return s.toLocaleString("zh-CN")}}function _t(l){return l==null?"change-neutral":l>3?"change-up-strong":l>0?"change-up":l<-3?"change-down-strong":l<0?"change-down":"change-neutral"}const Vs={name:"ErrorRecoveryDialog",props:{show:{type:Boolean,default:!1},snapshot:{type:Object,default:null},message:{type:String,default:""},title:{type:String,default:""},allowCancel:{type:Boolean,default:!0}},emits:["recover","cancel"],computed:{defaultTitle(){return this.$t("recovery.title","游戏恢复")}},methods:{formatMoney(l){return l===void 0?"":gt(l)},handleRecover(){this.$emit("recover")},handleCancel(){this.$emit("cancel")},cancelIfAllowed(){this.allowCancel&&this.handleCancel()}}},Gs={key:0,class:"error-recovery-dialog"},Hs={class:"dialog-content"},Ws={key:0,class:"recovery-info"},Bs={class:"info-row"},qs={class:"label"},Us={class:"value"},Qs={class:"info-row"},Fs={class:"label"},zs={class:"value"},js={key:0,class:"info-row"},Ks={class:"label"},Ys={class:"value"},Xs={key:1,class:"info-row"},Js={class:"label"},Zs={class:"value"},en={class:"message"},tn={key:0},sn={key:1},nn={class:"button-group"};function on(l,t,s,n,r,i){var u,g;return s.show?(v(),m("div",Gs,[e("div",{class:"dialog-backdrop",onClick:t[0]||(t[0]=(...b)=>i.cancelIfAllowed&&i.cancelIfAllowed(...b))}),e("div",Hs,[e("h2",null,o(s.title||i.defaultTitle),1),s.snapshot?(v(),m("div",Ws,[e("div",Bs,[e("span",qs,o(l.$t("recovery.date"))+":",1),e("span",Us,o(l.formatDate(s.snapshot.timestamp)),1)]),e("div",Qs,[e("span",Fs,o(l.$t("recovery.gameWeek"))+":",1),e("span",zs,o(l.$t("recovery.weekNumber",{week:s.snapshot.currentWeek})),1)]),(u=s.snapshot.player)!=null&&u.name?(v(),m("div",js,[e("span",Ks,o(l.$t("recovery.playerName"))+":",1),e("span",Ys,o(s.snapshot.player.name),1)])):T("",!0),((g=s.snapshot.player)==null?void 0:g.money)!==void 0?(v(),m("div",Xs,[e("span",Js,o(l.$t("recovery.money"))+":",1),e("span",Zs,o(i.formatMoney(s.snapshot.player.money)),1)])):T("",!0)])):T("",!0),e("div",en,[s.message?(v(),m("p",tn,o(s.message),1)):(v(),m("p",sn,o(l.$t("recovery.defaultMessage")),1))]),e("div",nn,[e("button",{class:"btn-recover",onClick:t[1]||(t[1]=(...b)=>i.handleRecover&&i.handleRecover(...b))},o(l.$t("recovery.recover")),1),s.allowCancel?(v(),m("button",{key:0,class:"btn-cancel",onClick:t[2]||(t[2]=(...b)=>i.handleCancel&&i.handleCancel(...b))},o(l.$t("recovery.cancel")),1)):T("",!0)])])])):T("",!0)}const an=ae(Vs,[["render",on],["__scopeId","data-v-2a9eaae0"]]);const ln={class:"dialog-container"},rn={class:"dialog-header"},un={class:"dialog-title"},cn={class:"dialog-content"},dn={class:"dialog-actions"},vn={__name:"GameDialog",setup(l){Ee();const t=Me(),s=O(()=>t.dialogVisible),n=O(()=>t.dialogData||{}),r=O(()=>n.value.message?n.value.message.split(`
`):[]),i=()=>{t.closeDialog()},u=()=>{typeof n.value.onConfirm=="function"&&n.value.onConfirm(),i()},g=()=>{typeof n.value.onCancel=="function"&&n.value.onCancel(),i()},b=()=>{n.value.closeOnBackdrop!==!1&&i()};return(k,_)=>s.value?(v(),m("div",{key:0,class:"dialog-overlay",onClick:ue(b,["self"])},[e("div",ln,[e("div",rn,[e("h2",un,o(n.value.title),1),n.value.showClose!==!1?(v(),m("button",{key:0,class:"dialog-close",onClick:i}," × ")):T("",!0)]),e("div",cn,[(v(!0),m(F,null,oe(r.value,(y,M)=>(v(),m("p",{key:M},o(y),1))),128))]),e("div",dn,[n.value.showCancel!==!1?(v(),m("button",{key:0,class:"dialog-button cancel-button",onClick:g},o(n.value.cancelText||k.$t("common.cancel")),1)):T("",!0),e("button",{class:"dialog-button confirm-button",onClick:u},o(n.value.confirmText||k.$t("common.confirm")),1)])])])):T("",!0)}},mn=ae(vn,[["__scopeId","data-v-2aa9e908"]]);const pn={class:"toast-icon"},gn={key:0},yn={key:1},fn={key:2},hn={key:3},_n={class:"toast-content"},bn={key:0,class:"toast-title"},$n={class:"toast-message"},kn=["onClick"],Sn={__name:"Toast",setup(l){const t=Me(),s=O(()=>t.toasts),n=C(!1),r=()=>{n.value=!!document.querySelector(".modal-backdrop")},i=k=>{t.removeToast(k)},u=k=>{console.log(`模拟播放Toast音效: ${k}（音频功能已禁用）`)},g=C(0),b=()=>{if(s.value.length>g.value){const k=s.value[0];k&&u(k.type),r()}g.value=s.value.length};return ce(()=>{g.value=s.value.length,r();const k=setInterval(()=>{b(),r()},100);qe(()=>{clearInterval(k)})}),(k,_)=>(v(),m("div",{class:H(["toast-container",{"modal-open":n.value}])},[j(Ze,{name:"toast"},{default:ie(()=>[(v(!0),m(F,null,oe(s.value,y=>(v(),m("div",{key:y.id,class:H(["toast",`toast-${y.type}`])},[e("div",pn,[y.type==="success"?(v(),m("span",gn,"✓")):y.type==="info"?(v(),m("span",yn,"ℹ")):y.type==="warning"?(v(),m("span",fn,"⚠")):y.type==="error"?(v(),m("span",hn,"✖")):T("",!0)]),e("div",_n,[y.title?(v(),m("div",bn,o(y.title),1)):T("",!0),e("div",$n,o(y.message),1)]),e("button",{class:"toast-close",onClick:M=>i(y.id)},"×",8,kn)],2))),128))]),_:1})],2))}},wn=ae(Sn,[["__scopeId","data-v-8ad994ac"]]),Cn={class:"audio-manager",style:{display:"none"}},Pn={__name:"AudioManager",setup(l,{expose:t}){const s=mt(),n=C({sounds:{},load:(r,i)=>(console.log(`模拟加载音效: ${r}, 路径: ${i}（音频功能已禁用）`),n.value.sounds[r]={id:r,path:i,volume:u=>(console.log(`模拟设置音效 ${r} 音量: ${u}`),n.value.sounds[r]),play:()=>(console.log(`模拟播放音效: ${r}（音频功能已禁用）`),n.value.sounds[r]),stop:()=>(console.log(`模拟停止音效: ${r}（音频功能已禁用）`),n.value.sounds[r])},n.value.sounds[r]),play:r=>(console.log(`模拟播放音效: ${r}（音频功能已禁用）`),null),stop:r=>(console.log(`模拟停止音效: ${r}（音频功能已禁用）`),null),setVolume:r=>{console.log(`模拟设置全局音量: ${r}（音频功能已禁用）`)}});return Ft("audio",n.value),ce(()=>{console.log("AudioManager初始化（音频功能已禁用）")}),ve(()=>s.soundVolume,r=>{console.log(`音效音量变化: ${r}（音频功能已禁用）`)}),ve(()=>s.musicVolume,r=>{console.log(`音乐音量变化: ${r}（音频功能已禁用）`)}),t({playSound:r=>{console.log(`模拟播放音效: ${r}（音频功能已禁用）`)},stopSound:r=>{console.log(`模拟停止音效: ${r}（音频功能已禁用）`)},playBackgroundMusic:r=>{console.log(`模拟播放背景音乐: ${r}（音频功能已禁用）`)},stopBackgroundMusic:()=>{console.log("模拟停止背景音乐（音频功能已禁用）")},setMusicVolume:r=>{console.log(`模拟设置背景音乐音量: ${r}（音频功能已禁用）`)},setSoundVolume:r=>{console.log(`模拟设置音效音量: ${r}（音频功能已禁用）`)},pauseAll:()=>{console.log("模拟暂停所有音频（音频功能已禁用）")},resumeAll:()=>{console.log("模拟恢复所有音频（音频功能已禁用）")}}),(r,i)=>(v(),m("div",Cn))}};const Tn={class:"loading-content"},Mn={key:0,class:"loading-title"},En={class:"loading-status"},In={class:"progress-container"},Nn={class:"progress-bar"},Ln={class:"progress-text"},xn={key:1,class:"loading-tips"},Rn={class:"tip-content"},An={__name:"CssLoader",props:{title:{type:String,default:"正在加载"},status:{type:String,default:"加载中..."},progress:{type:Number,default:0},tips:{type:Array,default:()=>["正在加载游戏资源...","初始化市场数据...","准备房产信息...","生成游戏事件...","加载游戏界面...","游戏即将开始..."]}},emits:["complete"],setup(l,{emit:t}){const s=l,n=t,r=C(0),i=O(()=>s.tips[r.value]),u=C(!1);ve(()=>s.progress,_=>{_>=100&&k()});let g=null;const b=()=>{g=setInterval(()=>{r.value=(r.value+1)%s.tips.length},3e3)},k=()=>{u.value=!0,setTimeout(()=>{n("complete")},1e3)};return ce(()=>{b()}),qe(()=>{g&&clearInterval(g)}),(_,y)=>(v(),m("div",{class:H(["css-loader-container",{"fade-out":u.value}])},[y[0]||(y[0]=We('<div class="spinner" data-v-22459b56><div class="circle" data-v-22459b56></div><div class="circle" data-v-22459b56></div><div class="circle" data-v-22459b56></div><div class="circle" data-v-22459b56></div></div>',1)),e("div",Tn,[l.title?(v(),m("h2",Mn,o(l.title),1)):T("",!0),e("div",En,o(l.status),1),e("div",In,[e("div",Nn,[e("div",{class:"progress-fill",style:Ce({width:`${l.progress}%`})},null,4)]),e("div",Ln,o(l.progress)+"%",1)]),l.tips.length>0?(v(),m("div",xn,[e("div",Rn,o(i.value),1)])):T("",!0)])],2))}},On=ae(An,[["__scopeId","data-v-22459b56"]]);const Dn={class:"header-buttons"},Vn={class:"tool-content"},Gn={class:"tab-buttons"},Hn=["onClick"],Wn={key:0,class:"tab-panel"},Bn={class:"tool-group"},qn={class:"input-group"},Un={class:"tool-group"},Qn={class:"input-group"},Fn={class:"tool-group"},zn={class:"input-group"},jn=["max"],Kn={key:1,class:"tab-panel"},Yn={class:"tool-group"},Xn={class:"input-group"},Jn={class:"tool-group"},Zn={class:"input-group"},eo={key:2,class:"tab-panel"},to={class:"tool-group"},so={class:"input-group"},no={class:"tool-group"},oo={class:"input-group"},ao=["value"],lo={class:"tool-group"},io={class:"input-group"},ro=["value"],uo={key:3,class:"tab-panel"},co={class:"tool-group"},vo={class:"house-list"},mo={key:0,class:"empty-message"},po={class:"house-info"},go={class:"house-name"},yo={class:"house-price"},fo=["onClick"],ho={key:4,class:"tab-panel"},_o={class:"tool-group"},bo={class:"event-list"},$o={class:"event-info"},ko={class:"event-name"},So={class:"event-desc"},wo=["onClick"],Co={key:5,class:"tab-panel"},Po={class:"tool-group"},To={class:"input-group"},Mo={class:"tool-group"},Eo={class:"save-list"},Io={key:0,class:"empty-message"},No={class:"save-info"},Lo={class:"save-name"},xo={class:"save-date"},Ro=["onClick"],Ao={key:6,class:"tab-panel"},Oo={class:"tool-group"},Do={class:"status-info"},Vo={class:"status-row"},Go={class:"status-value"},Ho={class:"status-row"},Wo={class:"status-value"},Bo={class:"status-row"},qo={class:"status-value"},Uo={class:"status-row"},Qo={class:"status-value"},Fo={__name:"FloatingDevTools",setup(l){const t=we(),s=C(!1),n=C(20),r=C(80),i=C(320),u=C(400),g=C("basic"),b=C(!1),k=C(!1),_=C(0),y=C(0),M=C(0),G=C(0),Q=C(1e3),N=C(0),L=C(1),q=C(100),Z=C(1),X=C(null),x=C(1),h=C(null),f=C(3),w=C(null),P=C(null),S=C("快速存档"),p=C([]),c=[{id:"basic",name:"基础"},{id:"inventory",name:"库存"},{id:"market",name:"市场"},{id:"house",name:"房产"},{id:"events",name:"事件"},{id:"status",name:"状态"},{id:"save",name:"存档"}],a=O(()=>({left:`${n.value}px`,top:`${r.value}px`,width:`${i.value}px`,height:s.value?"auto":`${u.value}px`})),d=K=>{K.button===0&&(b.value=!0,_.value=K.clientX-n.value,y.value=K.clientY-r.value,document.addEventListener("mousemove",$),document.addEventListener("mouseup",D),K.preventDefault())},$=K=>{b.value&&(n.value=K.clientX-_.value,r.value=K.clientY-y.value,n.value=Math.max(0,Math.min(window.innerWidth-i.value,n.value)),r.value=Math.max(0,Math.min(window.innerHeight-40,r.value)))},D=()=>{b.value=!1,document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",D)},le=K=>{k.value=!0,M.value=i.value,G.value=u.value,_.value=K.clientX,y.value=K.clientY,document.addEventListener("mousemove",me),document.addEventListener("mouseup",z),K.preventDefault()},me=K=>{if(k.value){const I=M.value+(K.clientX-_.value),V=G.value+(K.clientY-y.value);i.value=Math.max(300,I),u.value=Math.max(200,V)}},z=()=>{k.value=!1,document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",z)},de=()=>{s.value=!s.value},be=()=>{const K=new CustomEvent("close-dev-tools");window.dispatchEvent(K)},Ne=()=>{Q.value&&(t.player.money+=Q.value)},he=()=>{Q.value!==null&&Q.value>=0&&(t.player.money=Q.value)},Ue=()=>{N.value!==null&&N.value>=0&&(t.player.debt=N.value)},Ae=()=>{t.advanceWeek()},st=K=>{for(let I=0;I<K&&!t.gameOver;I++)t.advanceWeek()},Qe=()=>{L.value!==null&&L.value>=1&&L.value<=t.maxWeeks&&(t.currentWeek=L.value)},Fe=()=>{q.value!==null&&q.value>0&&(t.player.capacity=q.value)},ze=()=>{t.player.inventory=[],t.player.inventoryUsed=0},nt=()=>{const K=Z.value;if(K<1)return;const I=t.products;if(!I||I.length===0)return;const V=Math.floor(Math.random()*I.length),Pe=I[V],ht=St(),Ye=Pe.minPrice||Pe.basePrice*.7,At=Pe.maxPrice||Pe.basePrice*1.3,Ot=Math.floor(Ye+Math.random()*(At-Ye));ht.addToInventory(Pe,K,Ot)},ot=()=>{X.value&&t.addMarketModifier("product",{productId:X.value,value:x.value,duration:f.value})},at=()=>{h.value&&t.addMarketModifier("category",{category:h.value,value:x.value,duration:f.value})},lt=()=>{t.addMarketModifier("global",{value:x.value,duration:f.value})},it=()=>{t.updateMarketState(t.currentWeek)},rt=()=>{if(w.value){const K=$e.value.find(Ye=>Ye.id===w.value);if(!K)return;const I=fe();t.player.money<K.price&&(t.player.money=K.price+1e3),xe().purchaseHouse(K)?(console.log("开发工具 - 成功购买房屋:",K.name),I.achieveVictoryWithHouse(K)):(console.error("开发工具 - 购买房屋失败"),alert("购买失败，请检查开发者控制台获取更多信息"))}},je=()=>{if(P.value){const I=wt().triggerSpecificEvent(P.value);I?console.log("成功触发事件:",I.id,I.title):console.error("触发事件失败:",P.value)}},Ke=()=>{t.saveGame(S.value||"快速存档",!1)},R=K=>{t.loadGame(K)},Y=async()=>{const K=await t.getSaves();p.value=K||[]};ce(()=>{L.value=t.currentWeek,N.value=t.player.debt,q.value=t.player.capacity});const U=O(()=>t.products||[]),ge=O(()=>["DAILY","FOOD","ELECTRONICS","LUXURY","COLLECTIBLE"]),$e=O(()=>t.houses||[]),Rt=O(()=>{try{const K=Te();if(K.eventSystem&&K.eventSystem.events)return K.eventSystem.events.map(I=>({id:I.id,name:I.title||I.id,description:I.description||""}))}catch(K){console.error("获取事件列表失败:",K)}return[{id:"market_crash",name:"市场崩盘",description:"商品价格大幅下降"},{id:"market_boom",name:"市场繁荣",description:"商品价格大幅上涨"},{id:"debt_collector",name:"讨债人",description:"债务催收事件"},{id:"lucky_find",name:"幸运发现",description:"获得随机奖励"}]});return qe(()=>{document.removeEventListener("mousemove",$),document.removeEventListener("mouseup",D),document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",z)}),(K,I)=>(v(),m("div",{class:H(["floating-dev-tools",{minimized:s.value}]),style:Ce(a.value)},[e("div",{class:"tool-header",onMousedown:d},[I[13]||(I[13]=e("h3",null,"游戏开发工具",-1)),e("div",Dn,[e("button",{class:"minimize-btn",onClick:de},o(s.value?"↗":"↘"),1),e("button",{class:"close-btn",onClick:be},"✕")])],32),B(e("div",Vn,[e("div",Gn,[(v(),m(F,null,oe(c,V=>e("button",{key:V.id,onClick:Pe=>g.value=V.id,class:H([{active:g.value===V.id},"tab-btn"])},o(V.name),11,Hn)),64))]),g.value==="basic"?(v(),m("div",Wn,[e("div",Bn,[I[14]||(I[14]=e("h4",null,"玩家资金",-1)),e("div",qn,[B(e("input",{type:"number","onUpdate:modelValue":I[0]||(I[0]=V=>Q.value=V),placeholder:"金额"},null,512),[[ne,Q.value,void 0,{number:!0}]]),e("button",{onClick:Ne,class:"action-button"},"增加"),e("button",{onClick:he,class:"action-button"},"设置")])]),e("div",Un,[I[15]||(I[15]=e("h4",null,"玩家债务",-1)),e("div",Qn,[B(e("input",{type:"number","onUpdate:modelValue":I[1]||(I[1]=V=>N.value=V),placeholder:"债务"},null,512),[[ne,N.value,void 0,{number:!0}]]),e("button",{onClick:Ue,class:"action-button"},"设置")])]),e("div",Fn,[I[16]||(I[16]=e("h4",null,"游戏周数",-1)),e("div",zn,[e("button",{onClick:Ae,class:"action-button"},"+1周"),e("button",{onClick:I[2]||(I[2]=V=>st(5)),class:"action-button"},"+5周"),B(e("input",{type:"number","onUpdate:modelValue":I[3]||(I[3]=V=>L.value=V),min:"1",max:E(t).maxWeeks,placeholder:"周数"},null,8,jn),[[ne,L.value,void 0,{number:!0}]]),e("button",{onClick:Qe,class:"action-button"},"设置")])])])):T("",!0),g.value==="inventory"?(v(),m("div",Kn,[e("div",Yn,[I[17]||(I[17]=e("h4",null,"背包容量",-1)),e("div",Xn,[B(e("input",{type:"number","onUpdate:modelValue":I[4]||(I[4]=V=>q.value=V),placeholder:"容量",min:"1"},null,512),[[ne,q.value,void 0,{number:!0}]]),e("button",{onClick:Fe,class:"action-button"},"设置")])]),e("div",Jn,[I[18]||(I[18]=e("h4",null,"库存操作",-1)),e("div",Zn,[e("button",{onClick:ze,class:"action-button warning"},"清空库存"),B(e("input",{type:"number","onUpdate:modelValue":I[5]||(I[5]=V=>Z.value=V),placeholder:"物品数量",min:"1",max:"10"},null,512),[[ne,Z.value,void 0,{number:!0}]]),e("button",{onClick:nt,class:"action-button"},"添加随机物品")])])])):T("",!0),g.value==="market"?(v(),m("div",eo,[e("div",to,[I[19]||(I[19]=e("h4",null,"全局市场修正",-1)),e("div",so,[B(e("input",{type:"number","onUpdate:modelValue":I[6]||(I[6]=V=>x.value=V),step:"0.1",min:"0.5",max:"2.0",placeholder:"修正值"},null,512),[[ne,x.value,void 0,{number:!0}]]),B(e("input",{type:"number","onUpdate:modelValue":I[7]||(I[7]=V=>f.value=V),min:"1",max:"10",placeholder:"持续周数"},null,512),[[ne,f.value,void 0,{number:!0}]]),e("button",{onClick:lt,class:"action-button"},"应用全局修正")])]),e("div",no,[I[21]||(I[21]=e("h4",null,"商品分类修正",-1)),e("div",oo,[B(e("select",{"onUpdate:modelValue":I[8]||(I[8]=V=>h.value=V)},[I[20]||(I[20]=e("option",{value:""},"-- 选择分类 --",-1)),(v(!0),m(F,null,oe(ge.value,V=>(v(),m("option",{key:V,value:V},o(V),9,ao))),128))],512),[[_e,h.value]]),B(e("input",{type:"number","onUpdate:modelValue":I[9]||(I[9]=V=>x.value=V),step:"0.1",min:"0.5",max:"2.0",placeholder:"修正值"},null,512),[[ne,x.value,void 0,{number:!0}]]),e("button",{onClick:at,class:"action-button"},"应用修正")])]),e("div",lo,[I[23]||(I[23]=e("h4",null,"单个商品修正",-1)),e("div",io,[B(e("select",{"onUpdate:modelValue":I[10]||(I[10]=V=>X.value=V)},[I[22]||(I[22]=e("option",{value:""},"-- 选择商品 --",-1)),(v(!0),m(F,null,oe(U.value,V=>(v(),m("option",{key:V.id,value:V.id},o(V.name),9,ro))),128))],512),[[_e,X.value]]),B(e("input",{type:"number","onUpdate:modelValue":I[11]||(I[11]=V=>x.value=V),step:"0.1",min:"0.5",max:"2.0",placeholder:"修正值"},null,512),[[ne,x.value,void 0,{number:!0}]]),e("button",{onClick:ot,class:"action-button"},"应用修正")])]),e("div",{class:"tool-group"},[e("div",{class:"input-group"},[e("button",{onClick:it,class:"action-button"},"刷新市场价格")])])])):T("",!0),g.value==="house"?(v(),m("div",uo,[e("div",co,[I[24]||(I[24]=e("h4",null,"房产操作",-1)),e("div",vo,[$e.value.length===0?(v(),m("div",mo," 无可用房产 ")):(v(!0),m(F,{key:1},oe($e.value,V=>(v(),m("div",{key:V.id,class:"house-item"},[e("div",po,[e("div",go,o(V.name),1),e("div",yo,"¥"+o(E(A)(V.price)),1)]),e("button",{onClick:()=>{w.value=V.id,rt()},class:"action-button"}," 购买 ",8,fo)]))),128))])])])):T("",!0),g.value==="events"?(v(),m("div",ho,[e("div",_o,[I[25]||(I[25]=e("h4",null,"触发事件",-1)),e("div",bo,[(v(!0),m(F,null,oe(Rt.value,V=>(v(),m("div",{key:V.id,class:"event-item"},[e("div",$o,[e("div",ko,o(V.name),1),e("div",So,o(V.description),1)]),e("button",{onClick:()=>{P.value=V.id,je()},class:"action-button"}," 触发 ",8,wo)]))),128))])])])):T("",!0),g.value==="save"?(v(),m("div",Co,[e("div",Po,[I[26]||(I[26]=e("h4",null,"快速保存",-1)),e("div",To,[B(e("input",{type:"text","onUpdate:modelValue":I[12]||(I[12]=V=>S.value=V),placeholder:"存档名称"},null,512),[[ne,S.value]]),e("button",{onClick:Ke,class:"action-button"},"保存游戏")])]),e("div",Mo,[I[27]||(I[27]=e("h4",null,"存档列表",-1)),e("button",{onClick:Y,class:"action-button"},"刷新列表"),e("div",Eo,[p.value.length===0?(v(),m("div",Io," 无可用存档 ")):(v(!0),m(F,{key:1},oe(p.value,V=>(v(),m("div",{key:V.id,class:"save-item"},[e("div",No,[e("div",Lo,o(V.name),1),e("div",xo,o(new Date(V.date).toLocaleString()),1)]),e("button",{onClick:()=>R(V.id),class:"action-button"}," 加载 ",8,Ro)]))),128))])])])):T("",!0),g.value==="status"?(v(),m("div",Ao,[e("div",Oo,[I[32]||(I[32]=e("h4",null,"游戏状态",-1)),e("div",Do,[e("div",Vo,[I[28]||(I[28]=e("span",{class:"status-label"},"当前周数:",-1)),e("span",Go,o(E(t).currentWeek),1)]),e("div",Ho,[I[29]||(I[29]=e("span",{class:"status-label"},"资金:",-1)),e("span",Wo,"¥"+o(E(A)(E(t).player.money)),1)]),e("div",Bo,[I[30]||(I[30]=e("span",{class:"status-label"},"债务:",-1)),e("span",qo,"¥"+o(E(A)(E(t).player.debt)),1)]),e("div",Uo,[I[31]||(I[31]=e("span",{class:"status-label"},"库存用量:",-1)),e("span",Qo,o(E(t).player.inventoryUsed||0)+"/"+o(E(t).player.capacity||100),1)])])])])):T("",!0)],512),[[ut,!s.value]]),B(e("div",{class:"resize-handle",onMousedown:le},null,544),[[ut,!s.value]])],6))}},zo=ae(Fo,[["__scopeId","data-v-1c309122"]]),jo={__name:"DevToolsManager",setup(l){const t=C(!1);function s(){t.value=!0}function n(){t.value=!1}function r(i){i.ctrlKey&&i.shiftKey&&i.key==="D"&&(i.preventDefault(),t.value=!t.value)}return ce(()=>{window.addEventListener("show-dev-tools",s),window.addEventListener("close-dev-tools",n),document.addEventListener("keydown",r)}),qe(()=>{window.removeEventListener("show-dev-tools",s),window.removeEventListener("close-dev-tools",n),document.removeEventListener("keydown",r)}),(i,u)=>(v(),m("div",null,[t.value?(v(),Be(zo,{key:0})):T("",!0)]))}};const Ko=zt({name:"App",components:{ErrorDialog:As,ErrorRecoveryDialog:an,GameDialog:mn,Toast:wn,AudioManager:Pn,CssLoader:On,DevToolsManager:jo},setup(){Ie();const l=C(!0),t=C("初始化游戏环境..."),s=C(0),n=async()=>{try{t.value="初始化存储...",s.value=10;const i=Me(),u=fe(),g=xe(),b=et(),k=Te();t.value="加载游戏配置...",s.value=30,await new Promise(_=>setTimeout(_,300)),t.value="准备游戏界面...",s.value=60,await ye(),t.value="完成初始化...",s.value=90,await new Promise(_=>setTimeout(_,500)),t.value="加载完成!",s.value=100,setTimeout(()=>{l.value=!1},500)}catch(i){ee(i,"App (src)",se.UNKNOWN,te.ERROR),console.error("初始化应用失败:",i),t.value="初始化失败，请刷新页面重试"}},r=()=>{console.log("应用初始化完成"),l.value=!1};return ce(()=>{n()}),{isLoading:l,loadingStatus:t,loadingProgress:s,onLoadingComplete:r}}}),Yo={id:"app"};function Xo(l,t,s,n,r,i){const u=ke("CssLoader"),g=ke("router-view"),b=ke("ErrorDialog"),k=ke("ErrorRecoveryDialog"),_=ke("GameDialog"),y=ke("Toast"),M=ke("AudioManager"),G=ke("DevToolsManager");return v(),m("div",Yo,[l.isLoading?(v(),Be(u,{key:0,title:"正在初始化游戏",status:l.loadingStatus,progress:l.loadingProgress,onComplete:l.onLoadingComplete},null,8,["status","progress","onComplete"])):T("",!0),l.isLoading?T("",!0):(v(),Be(g,{key:1})),j(b),j(k),j(_),j(y),j(M),j(G)])}const Jo=ae(Ko,[["render",Xo]]),yt="game_state_snapshot",ft="game_state_emergency";let Ge=null;const Se=[];let bt=0;const Zo=6e4,$t=5;let Xe=null;async function tt(){return Xe||(Xe=new Promise((l,t)=>{try{Ge=new Dt,Ge.initializeElectronAPI().then(()=>{console.log("状态快照存储服务初始化成功"),l(Ge)}).catch(s=>{ee(s,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("初始化存储服务失败:",s),Ge={async getData(n){try{const r=localStorage.getItem(n);return r?JSON.parse(r):null}catch(r){return console.error("从localStorage获取数据失败:",r),null}},async setData(n,r){try{return localStorage.setItem(n,JSON.stringify(r)),!0}catch(i){return ee(i,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("保存数据到localStorage失败:",i),!1}},async removeData(n){try{return localStorage.removeItem(n),!0}catch(r){return ee(r,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("从localStorage删除数据失败:",r),!1}}},console.log("使用备用存储服务"),l(Ge)})}catch(s){ee(s,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("创建存储服务实例失败:",s),t(s)}}),Xe)}async function ea(l){if(!l||!l.currentWeek)return console.warn("无法创建快照：游戏存储无效"),null;const t=Date.now();if(t-bt<Zo)return null;const s={timestamp:t,currentWeek:l.currentWeek,gameStarted:l.gameStarted,gameOver:l.gameOver,player:l.player?{name:l.player.name,money:l.player.money,debt:l.player.debt,inventory:Array.isArray(l.player.inventory)?[...l.player.inventory]:[]}:null,marketState:l.currentLocation?{currentLocation:l.currentLocation.id,productPrices:{...l.productPrices||{}}}:null};Se.unshift(s),Se.length>$t&&(Se.length=$t);try{await(await tt()).setData(yt,s),bt=t}catch(n){ee(n,"stateSnapshot (persistence)",se.UNKNOWN,te.WARNING),console.warn("保存快照到存储服务失败:",n)}return s}function ta(l){var t,s,n,r,i,u;try{if(!l||!l.currentWeek)return!1;const g={timestamp:Date.now(),currentWeek:l.currentWeek,playerName:(t=l.player)==null?void 0:t.name,playerMoney:(s=l.player)==null?void 0:s.money,playerDebt:(n=l.player)==null?void 0:n.debt,inventoryCount:((i=(r=l.player)==null?void 0:r.inventory)==null?void 0:i.length)||0,currentLocation:(u=l.currentLocation)==null?void 0:u.id,gameStarted:l.gameStarted,gameOver:l.gameOver};return localStorage.setItem(ft,JSON.stringify(g)),!0}catch(g){return ee(g,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("创建紧急快照失败:",g),!1}}function sa(){return Se[0]||null}async function Tt(){try{if(Se.length>0)return Se[0];try{const t=await(await tt()).getData(yt);if(t)return Se.unshift(t),t}catch(l){ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.WARNING),console.warn("从存储服务加载快照失败:",l)}try{const l=localStorage.getItem(ft);if(l)return JSON.parse(l)}catch(l){ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.WARNING),console.warn("加载紧急快照失败:",l)}return null}catch(l){return console.error("加载最新快照时出错:",l),null}}async function na(l,t){try{if(!t||!l)return!1;if(l.currentWeek=t.currentWeek||1,l.gameStarted=t.gameStarted||!1,l.gameOver=t.gameOver||!1,t.player&&(l.player||(l.player={}),l.player.name=t.player.name||"",l.player.money=t.player.money||0,l.player.debt=t.player.debt||0,t.player.inventory&&Array.isArray(t.player.inventory)&&(l.player.inventory=[...t.player.inventory])),t.marketState){if(t.marketState.currentLocation&&l.locations){const s=l.locations.find(n=>n.id===t.marketState.currentLocation);s&&(l.currentLocation=s)}t.marketState.productPrices&&(l.productPrices={...t.marketState.productPrices})}return!0}catch(s){return ee(s,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("应用快照时出错:",s),!1}}async function oa(){try{return Se.length=0,await(await tt()).removeData(yt),localStorage.removeItem(ft),!0}catch(l){return ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("清除快照时出错:",l),!1}}async function Mt(){try{return console.log("初始化快照系统..."),await tt(),await Tt(),console.log("快照系统初始化完成"),!0}catch(l){return ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("初始化快照系统时出错:",l),!1}}const aa=Object.freeze(Object.defineProperty({__proto__:null,applySnapshot:na,clearAllSnapshots:oa,createEmergencySnapshot:ta,createStateSnapshot:ea,getLatestSnapshot:sa,initSnapshotSystem:Mt,loadLatestSnapshot:Tt},Symbol.toStringTag,{value:"Module"}));function la(){return Kt([es,ts,ss,ns,os,as,ls,is,rs,us,cs,ds,vs,ms]),Yt("buyHouseTheme",{color:["#3498DB","#F39C12","#2ECC71","#E74C3C","#9B59B6","#1ABC9C","#34495E"],backgroundColor:"rgba(255, 255, 255, 0)",textStyle:{},title:{textStyle:{color:"#34495E",fontSize:16},subtextStyle:{color:"#95A5A6"}},line:{itemStyle:{borderWidth:2},lineStyle:{width:3},symbolSize:8,symbol:"circle",smooth:!0},radar:{itemStyle:{borderWidth:1},lineStyle:{width:2},symbolSize:6,symbol:"circle",smooth:!0}}),Xt}function ia(){return Oe.extend(Jt),Oe.extend(Zt),Oe.locale("zh-cn"),Oe.updateLocale("zh-cn",{relativeTime:{future:"%s后",past:"%s前",s:"几秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",w:"1周",ww:"%d周",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"}}),Oe}function ra(){return De.Howler.autoUnlock=!0,De.Howler.autoSuspend=!0,De.Howler.html5PoolSize=10,{sounds:{},load(t,s,n={}){return this.sounds[t]=new De.Howl({src:Array.isArray(s)?s:[s],volume:n.volume||1,loop:n.loop||!1,preload:n.preload!==!1,html5:n.html5||!1,onload:n.onload||null,onloaderror:n.onloaderror||null}),this.sounds[t]},play(t,s={}){const n=this.sounds[t];if(!n)return null;const r=n.play();return s.volume!==void 0&&n.volume(s.volume,r),s.rate!==void 0&&n.rate(s.rate,r),r},stop(t){const s=this.sounds[t];s&&s.stop()},pause(t){const s=this.sounds[t];s&&s.pause()},setGlobalVolume(t){De.Howler.volume(t)}}}function ua(l){const t=la();l.config.globalProperties.$echarts=t;const s=ia();l.config.globalProperties.$dayjs=s;const n=ra();l.config.globalProperties.$audio=n,l.use($s,{locale:ks,size:"default",zIndex:2e3}),l.use(jt)}const ca={class:"main-menu"},da={class:"menu-container"},va={class:"menu-buttons"},ma={key:0,class:"dialog magic-card"},pa={class:"dialog-content"},ga={class:"form-group animate-item"},ya={class:"input-container"},fa={class:"form-group animate-item"},ha={class:"difficulty-options"},_a={class:"form-group animate-item"},ba={class:"mode-options"},$a={class:"dialog-actions animate-item"},ka=["disabled"],Sa=["disabled"],wa={key:0,class:"loading-overlay"},Ca={class:"loading-container"},Pa={class:"loading-tip"},Ta={__name:"MainMenu",setup(l){const t=Ie(),s=fe(),n=xe();et(),Te();const r=C(!1),i=C(""),u=C("standard"),g=C("classic"),b=C(!1),k=C(0),_=C(!1),y=C(""),M=C(!1),G=["正在准备市场数据...","正在生成商品价格...","正在初始化玩家数据...","正在加载游戏界面...","准备开始您的买房之旅..."];function Q(){r.value=!0,setTimeout(()=>{N()},100)}function N(){const S=document.querySelector(".magic-card");if(S){S.addEventListener("mousemove",d=>{const $=S.getBoundingClientRect(),D=(d.clientX-$.left)/$.width*100,le=(d.clientY-$.top)/$.height*100;S.style.setProperty("--x",`${D}%`),S.style.setProperty("--y",`${le}%`)});const p=S.querySelector(".input-container");if(p){const d=p.querySelector(".input-shine");p.addEventListener("mousemove",D=>{const le=p.getBoundingClientRect(),me=D.clientX-le.left;d&&(d.style.opacity="0.6",d.style.left=`${me-20}px`)}),p.addEventListener("mouseleave",()=>{d&&(d.style.opacity="0")});const $=p.querySelector("input");$&&($.addEventListener("focus",()=>{p.style.transform="translateY(-2px)",p.style.boxShadow="0 4px 15px rgba(58, 99, 184, 0.15), 0 0 0 1px rgba(58, 99, 184, 0.3)"}),$.addEventListener("blur",()=>{p.style.transform="",p.style.boxShadow=""}))}S.querySelectorAll(".menu-option-card").forEach(d=>{d.addEventListener("mouseenter",()=>{const $=d.querySelector("span");$&&($.style.transform="translateY(-2px)")}),d.addEventListener("mouseleave",()=>{if(!d.classList.contains("selected")){const $=d.querySelector("span");$&&($.style.transform="")}})}),S.querySelectorAll(".game-btn").forEach(d=>{d.addEventListener("mouseenter",()=>{d.style.transform="translateY(-2px)",d.classList.contains("primary-btn")?(d.getBoundingClientRect(),d.style.boxShadow="0 6px 20px rgba(58, 99, 184, 0.3)"):d.style.boxShadow="0 6px 15px rgba(0, 0, 0, 0.15)"}),d.addEventListener("mouseleave",()=>{d.style.transform="",d.style.boxShadow=""})})}}function L(S){y.value=`${S}功能正在开发中，敬请期待！`,_.value=!0}function q(){_.value=!1}function Z(){M.value=!0}function X(){M.value=!1}async function x(){try{b.value=!0,h();const S=i.value.trim()||"玩家";console.log("正在开始新游戏，玩家名称:",S,"难度:",u.value,"模式:",g.value),await new Promise(p=>setTimeout(p,100)),s.currentWeek=1,s.gameStarted=!0,s.gamePaused=!1,s.gameOver=!1,s.victoryAchieved=!1,s.gameResult=null,s.notifications=[],g.value==="endless"?s.maxWeeks=999999:s.maxWeeks=52,await s.startNewGame(S),n.name||(n.name=S),u.value==="hard"?(n.money=2e3,n.debt=5e3):u.value==="easy"&&(n.money=5e3,n.debt=2e3),localStorage.setItem("lastPlayerName",S),t.push("/game")}catch(S){ee(S,"MainMenu (views)",se.UNKNOWN,te.ERROR),console.error("初始化游戏时出错:",S),alert("初始化游戏时出错: "+S.message),b.value=!1}}function h(){k.value=0;const S=setInterval(()=>{k.value=(k.value+1)%G.length,b.value||clearInterval(S)},1500)}function f(){b.value||(r.value=!1,i.value="")}function w(){t.push("/saves")}async function P(){try{await window.electronAPI.quitApp()}catch(S){ee(S,"MainMenu (views)",se.UNKNOWN,te.ERROR),console.error("Error quitting app:",S)}}return ce(()=>{const S=localStorage.getItem("lastPlayerName");S&&(i.value=S);const{action:p}=t.currentRoute.value.query;p==="new-game"&&setTimeout(()=>{Q()},300)}),(S,p)=>(v(),m("div",ca,[p[32]||(p[32]=e("div",{class:"animated-bg"},null,-1)),e("div",da,[p[16]||(p[16]=e("div",{class:"title-section"},[e("h1",{class:"game-title"},"买房记"),e("p",{class:"game-version"},"v0.1.1")],-1)),e("div",va,[e("button",{class:"menu-button new-game-btn",onClick:Q},p[10]||(p[10]=[e("i",{class:"menu-icon"},"🎮",-1),e("span",null,"新游戏",-1)])),e("button",{class:"menu-button load-game-btn",onClick:w},p[11]||(p[11]=[e("i",{class:"menu-icon"},"📂",-1),e("span",null,"读取存档",-1)])),e("button",{class:"menu-button leaderboard-btn",onClick:p[0]||(p[0]=c=>L("排行榜"))},p[12]||(p[12]=[e("i",{class:"menu-icon"},"🏆",-1),e("span",null,"排行榜",-1)])),e("button",{class:"menu-button settings-btn",onClick:p[1]||(p[1]=c=>L("设置"))},p[13]||(p[13]=[e("i",{class:"menu-icon"},"⚙️",-1),e("span",null,"设置",-1)])),e("button",{class:"menu-button about-btn",onClick:Z},p[14]||(p[14]=[e("i",{class:"menu-icon"},"ℹ️",-1),e("span",null,"关于",-1)])),e("button",{class:"menu-button exit-btn",onClick:P},p[15]||(p[15]=[e("i",{class:"menu-icon"},"🚪",-1),e("span",null,"退出游戏",-1)]))])]),j(re,{name:"dialog-fade"},{default:ie(()=>[r.value?(v(),m("div",{key:0,class:"dialog-overlay",onClick:ue(f,["self"])},[j(re,{name:"dialog-zoom"},{default:ie(()=>[r.value?(v(),m("div",ma,[p[26]||(p[26]=e("h2",{class:"dialog-title animate-item"},"开始新游戏",-1)),e("div",pa,[e("div",ga,[p[18]||(p[18]=e("label",{for:"playerName"},"用户名：",-1)),e("div",ya,[B(e("input",{type:"text",id:"playerName","onUpdate:modelValue":p[2]||(p[2]=c=>i.value=c),placeholder:"请输入用户名",maxlength:"12",onKeydown:Pt(x,["enter"]),class:"shine-input"},null,544),[[ne,i.value]]),p[17]||(p[17]=e("div",{class:"input-shine"},null,-1))])]),e("div",fa,[p[22]||(p[22]=e("label",null,"选择难度：",-1)),e("div",ha,[e("label",{class:H(["menu-option-card",{selected:u.value==="easy"}])},[B(e("input",{type:"radio","onUpdate:modelValue":p[3]||(p[3]=c=>u.value=c),value:"easy"},null,512),[[Ve,u.value]]),p[19]||(p[19]=e("span",null,"简单",-1))],2),e("label",{class:H(["menu-option-card",{selected:u.value==="standard"}])},[B(e("input",{type:"radio","onUpdate:modelValue":p[4]||(p[4]=c=>u.value=c),value:"standard"},null,512),[[Ve,u.value]]),p[20]||(p[20]=e("span",null,"标准",-1))],2),e("label",{class:H(["menu-option-card",{selected:u.value==="hard"}])},[B(e("input",{type:"radio","onUpdate:modelValue":p[5]||(p[5]=c=>u.value=c),value:"hard"},null,512),[[Ve,u.value]]),p[21]||(p[21]=e("span",null,"困难",-1))],2)])]),e("div",_a,[p[25]||(p[25]=e("label",null,"选择模式：",-1)),e("div",ba,[e("label",{class:H(["menu-option-card",{selected:g.value==="classic"}])},[B(e("input",{type:"radio","onUpdate:modelValue":p[6]||(p[6]=c=>g.value=c),value:"classic"},null,512),[[Ve,g.value]]),p[23]||(p[23]=e("span",null,"经典模式",-1))],2),e("label",{class:H(["menu-option-card",{selected:g.value==="endless"}])},[B(e("input",{type:"radio","onUpdate:modelValue":p[7]||(p[7]=c=>g.value=c),value:"endless"},null,512),[[Ve,g.value]]),p[24]||(p[24]=e("span",null,"无尽模式",-1))],2)])])]),e("div",$a,[e("button",{class:"game-btn cancel-btn",onClick:f,disabled:b.value},"取消",8,ka),e("button",{class:"game-btn primary-btn",onClick:x,disabled:!i.value.trim()||b.value},o(b.value?"加载中...":"开始游戏"),9,Sa)])])):T("",!0)]),_:1})])):T("",!0)]),_:1}),b.value?(v(),m("div",wa,[e("div",Ca,[p[27]||(p[27]=e("div",{class:"loading-spinner"},null,-1)),p[28]||(p[28]=e("p",{class:"loading-text"},"正在加载游戏，请稍候...",-1)),e("p",Pa,o(G[k.value]),1)])])):T("",!0),_.value?(v(),m("div",{key:1,class:"dialog-overlay",onClick:q},[e("div",{class:"dev-toast",onClick:p[8]||(p[8]=ue(()=>{},["stop"]))},[p[29]||(p[29]=e("div",{class:"dev-toast-icon"},"🚧",-1)),p[30]||(p[30]=e("h3",null,"功能开发中",-1)),e("p",null,o(y.value),1),e("button",{class:"button primary",onClick:q},"确定")])])):T("",!0),M.value?(v(),m("div",{key:2,class:"dialog-overlay",onClick:X},[e("div",{class:"about-dialog",onClick:p[9]||(p[9]=ue(()=>{},["stop"]))},[p[31]||(p[31]=We('<div class="about-header" data-v-eeb56141><h3 data-v-eeb56141>关于买房记</h3></div><div class="about-content" data-v-eeb56141><div class="about-logo" data-v-eeb56141>买房记</div><div class="about-version" data-v-eeb56141>版本：v0.1.1</div><div class="about-description" data-v-eeb56141><p data-v-eeb56141>这是一款模拟经营策略游戏，玩家将在游戏中体验市场变化带来的乐趣与挑战。</p></div><div class="about-history" data-v-eeb56141><p data-v-eeb56141>《买房记》原作是由郑昉开发的一款模拟经营类手机游戏，发布于2016年。本作者首次接触原作《买房记》是在2016年，通过观看B站UP主“敖厂长”发布的视频《【敖厂长】屌丝买房》。其玩法和创意带来的乐趣，时至今日仍记忆犹新。受条件限制，数年后才得以真正上手游玩，熟悉的玩法，却再也找不回曾经的感觉。原作最后一次更新在2022年，至今已有三年。出于对童年的回忆和对原作的致敬，遂决定开发同名PC端游戏。目前游戏仍处于早期开发阶段，感谢您的试玩。</p></div><div class="credits-section" data-v-eeb56141><h4 data-v-eeb56141>制作团队</h4><div class="developer-info" data-v-eeb56141> 开发者： <span class="dev-name" data-v-eeb56141>春卷</span></div></div></div>',2)),e("div",{class:"about-actions"},[e("button",{class:"about-close-btn",onClick:X},"关闭")])])])):T("",!0)]))}},Ma=ae(Ta,[["__scopeId","data-v-eeb56141"]]);const Ea={class:"notification-icon"},Ia={key:0},Na={key:1},La={class:"notification-message"},xa={class:"modal-content"},Ra={class:"modal-header bank-header"},Aa={class:"modal-title-container"},Oa={class:"modal-title"},Da={class:"modal-body"},Va={class:"bank-overview"},Ga={class:"overview-cards"},Ha={class:"overview-card deposit-card"},Wa={class:"card-header"},Ba={class:"card-title"},qa={class:"card-amount deposit-value"},Ua={class:"card-info"},Qa={class:"overview-card debt-card"},Fa={class:"card-header"},za={class:"card-title"},ja={class:"card-amount debt-value"},Ka={class:"card-info"},Ya={class:"info-grid"},Xa={class:"info-item pulse-hover"},Ja={class:"info-label"},Za={class:"info-value money-value"},el={class:"info-item pulse-hover"},tl={class:"info-label"},sl={class:"info-value available-loan-value"},nl={class:"bank-tabs"},ol={class:"tab-buttons"},al={class:"tab-content"},ll={key:0,class:"operation-tab"},il={class:"amount-control"},rl={class:"amount-header"},ul={class:"amount-value"},cl=["max"],dl={class:"amount-actions"},vl={class:"summary-info no-border"},ml={class:"summary-row"},pl={class:"summary-row"},gl={class:"button-row"},yl=["disabled"],fl={key:1,class:"operation-tab"},hl={class:"amount-control"},_l={class:"amount-header"},bl={class:"amount-value"},$l=["max","disabled"],kl={class:"amount-actions"},Sl={class:"summary-info no-border"},wl={class:"summary-row"},Cl={class:"summary-row"},Pl={class:"button-row"},Tl=["disabled"],Ml={key:2,class:"operation-tab"},El={class:"amount-control"},Il={class:"amount-header"},Nl={class:"amount-value"},Ll=["max","disabled"],xl={class:"amount-actions"},Rl={class:"summary-info no-border"},Al={class:"summary-row"},Ol={class:"summary-row"},Dl={class:"button-row"},Vl=["disabled"],Gl={key:3,class:"operation-tab"},Hl={class:"amount-control"},Wl={class:"amount-header"},Bl={class:"amount-value"},ql=["max"],Ul={class:"amount-actions"},Ql={class:"summary-info no-border"},Fl={class:"summary-row"},zl={class:"summary-row"},jl={class:"button-row"},Kl=["disabled"],Yl={__name:"BankModal",props:{show:{type:Boolean,default:!1}},emits:["update:show"],setup(l,{emit:t}){const s=xe(),{t:n}=Ee(),r=t,i=C("deposit"),u=C(0),g=C(0),b=C(0),k=C(0),_=C({show:!1,type:"success",message:"",timeout:null}),y=(h,f,w=2500)=>{console.log("显示通知:",h,f),_.value={show:!0,type:h,message:f,timeout:null},_.value.timeout&&clearTimeout(_.value.timeout),_.value.timeout=setTimeout(()=>{M()},w)},M=()=>{console.log("隐藏通知"),_.value.show=!1,_.value.timeout&&(clearTimeout(_.value.timeout),_.value.timeout=null)},G=()=>{M(),r("update:show",!1),u.value=0,g.value=0,b.value=0,k.value=0},Q=h=>`${(h*100).toFixed(1)}%`,N=(h,f,w,P=500)=>{if(!h)return;const S=performance.now(),p=c=>{const a=c-S;if(a>=P){h.textContent=A(w);return}const d=a/P,$=f+(w-f)*d;h.textContent=A(Math.floor($)),requestAnimationFrame(p)};requestAnimationFrame(p)},L=()=>{const h=Number(u.value);if(h<=0)return;const f=document.querySelector(".deposit-value"),w=document.querySelector(".money-value"),P=s.bankDeposit,S=s.money;s.depositToBank(h)?(N(f,P,s.bankDeposit),N(w,S,s.money),f.classList.add("value-change-success"),setTimeout(()=>{f.classList.remove("value-change-success")},1e3),console.log("存款操作成功，调用showNotification"),y("success",n("bank.depositSuccess")),u.value=0):(console.log("存款操作失败，调用showNotification"),y("error",n("bank.notEnoughMoney")))},q=()=>{const h=Number(g.value);if(h<=0)return;const f=document.querySelector(".deposit-value"),w=document.querySelector(".money-value"),P=s.bankDeposit,S=s.money;s.withdrawFromBank(h)?(N(f,P,s.bankDeposit),N(w,S,s.money),w.classList.add("value-change-success"),setTimeout(()=>{w.classList.remove("value-change-success")},1e3),console.log("取款操作成功，调用showNotification"),y("success",n("bank.withdrawSuccess")),g.value=0):(console.log("取款操作失败，调用showNotification"),y("error",n("bank.notEnoughMoney")))},Z=()=>{const h=Number(b.value);if(h<=0)return;const f=document.querySelector(".debt-value"),w=document.querySelector(".money-value"),P=s.debt,S=s.money;s.takeLoan(h)?(N(f,P,s.debt),N(w,S,s.money),w.classList.add("value-change-success"),setTimeout(()=>{w.classList.remove("value-change-success")},1e3),console.log("贷款操作成功，调用showNotification"),y("success",n("bank.loanSuccess")),b.value=0):(console.log("贷款操作失败，调用showNotification"),y("error",n("common.error")))},X=()=>{const h=Number(k.value);if(h<=0)return;const f=document.querySelector(".debt-value"),w=document.querySelector(".money-value"),P=s.debt,S=s.money;s.repayDebt(h)?(N(f,P,s.debt),N(w,S,s.money),f.classList.add("value-change-success"),setTimeout(()=>{f.classList.remove("value-change-success")},1e3),console.log("还款操作成功，调用showNotification"),y("success",n("bank.repaySuccess")),k.value=0):(console.log("还款操作失败，调用showNotification"),y("error",n("bank.notEnoughMoney")))},x=(h,f,w,P="default")=>{if(!h)return;let S;switch(P){case"deposit":S="#2ecc71";break;case"withdraw":S="#3498db";break;case"loan":S="#f39c12";break;case"repay":S="#e74c3c";break;default:S="#3498db"}if(w<=0){const c=P==="withdraw"?"#a0c8e7":P==="loan"?"#f8d29b":P==="repay"?"#f5b7b1":"#a0c8e7";h.style.background=c;return}const p=Math.min(f/w*100,100);h.style.background=`linear-gradient(to right, ${S} ${p}%, #e9ecef ${p}%)`};return ve(()=>u.value,h=>{ye(()=>{const f=document.querySelector(".deposit-slider");f&&x(f,Number(h),s.money,"deposit")})}),ve(()=>g.value,h=>{ye(()=>{const f=document.querySelector(".withdraw-slider");f&&x(f,Number(h),s.bankDeposit,"withdraw")})}),ve(()=>b.value,h=>{ye(()=>{const f=document.querySelector(".loan-slider");f&&x(f,Number(h),s.availableLoanAmount,"loan")})}),ve(()=>k.value,h=>{ye(()=>{const f=document.querySelector(".repay-slider");if(f){const w=Math.min(s.money,s.debt);x(f,Number(h),w,"repay")}})}),ve(()=>i.value,()=>{ye(()=>{const f={deposit:{slider:".deposit-slider",value:u.value,max:s.money,type:"deposit"},withdraw:{slider:".withdraw-slider",value:g.value,max:s.bankDeposit,type:"withdraw"},loan:{slider:".loan-slider",value:b.value,max:s.availableLoanAmount,type:"loan"},repay:{slider:".repay-slider",value:k.value,max:Math.min(s.money,s.debt),type:"repay"}}[i.value];if(f){const w=document.querySelector(f.slider);w&&x(w,Number(f.value),f.max,f.type)}})}),ce(()=>{ye(()=>{const f={deposit:{slider:".deposit-slider",value:u.value,max:s.money,type:"deposit"},withdraw:{slider:".withdraw-slider",value:g.value,max:s.bankDeposit,type:"withdraw"},loan:{slider:".loan-slider",value:b.value,max:s.availableLoanAmount,type:"loan"},repay:{slider:".repay-slider",value:k.value,max:Math.min(s.money,s.debt),type:"repay"}}[i.value];if(f){const w=document.querySelector(f.slider);w&&x(w,Number(f.value),f.max,f.type)}})}),(h,f)=>l.show?(v(),m("div",{key:0,class:"modal-backdrop",onClick:ue(G,["self"])},[j(re,{name:"bank-notification"},{default:ie(()=>[_.value.show?(v(),m("div",{key:0,class:H(["bank-notification",`notification-${_.value.type}`])},[e("div",Ea,[_.value.type==="success"?(v(),m("span",Ia,"✓")):_.value.type==="error"?(v(),m("span",Na,"✖")):T("",!0)]),e("div",La,o(_.value.message),1)],2)):T("",!0)]),_:1}),e("div",xa,[e("div",Ra,[e("div",Aa,[f[20]||(f[20]=e("span",{class:"bank-icon"},"🏦",-1)),e("h3",Oa,o(h.$t("bank.title")),1)]),e("button",{class:"modal-close",onClick:G},"×")]),e("div",Da,[e("div",Va,[e("div",Ga,[e("div",Ha,[e("div",Wa,[f[21]||(f[21]=e("span",{class:"card-icon sparkle"},"💹",-1)),e("span",Ba,o(h.$t("bank.currentDeposit")),1)]),e("div",qa,"¥"+o(E(A)(E(s).bankDeposit)),1),e("div",Ua,o(h.$t("bank.depositInterest"))+": "+o(Q(E(s).depositInterestRate)),1)]),e("div",Qa,[e("div",Fa,[f[22]||(f[22]=e("span",{class:"card-icon sparkle"},"💸",-1)),e("span",za,o(h.$t("playerInfo.debt")),1)]),e("div",ja,"¥"+o(E(A)(E(s).debt)),1),e("div",Ka,o(h.$t("bank.loanInterest"))+": "+o(Q(E(s).loanInterestRate)),1)])]),e("div",Ya,[e("div",Xa,[f[23]||(f[23]=e("span",{class:"info-icon"},"💰",-1)),e("span",Ja,o(h.$t("playerInfo.money"))+":",1),e("span",Za,"¥"+o(E(A)(E(s).money)),1)]),e("div",el,[f[24]||(f[24]=e("span",{class:"info-icon"},"📊",-1)),e("span",tl,o(h.$t("bank.availableLoan"))+":",1),e("span",sl,"¥"+o(E(A)(E(s).availableLoanAmount)),1)])])]),e("div",nl,[e("div",ol,[e("button",{class:H(["tab-button",{active:i.value==="deposit"}]),onClick:f[0]||(f[0]=w=>i.value="deposit")},[f[25]||(f[25]=e("span",{class:"tab-icon"},"💹",-1)),W(" "+o(h.$t("bank.deposit")),1)],2),e("button",{class:H(["tab-button",{active:i.value==="withdraw"}]),onClick:f[1]||(f[1]=w=>i.value="withdraw")},[f[26]||(f[26]=e("span",{class:"tab-icon"},"💰",-1)),W(" "+o(h.$t("bank.withdraw")),1)],2),e("button",{class:H(["tab-button",{active:i.value==="loan"}]),onClick:f[2]||(f[2]=w=>i.value="loan")},[f[27]||(f[27]=e("span",{class:"tab-icon"},"💸",-1)),W(" "+o(h.$t("bank.loan")),1)],2),e("button",{class:H(["tab-button",{active:i.value==="repay"}]),onClick:f[3]||(f[3]=w=>i.value="repay")},[f[28]||(f[28]=e("span",{class:"tab-icon"},"💳",-1)),W(" "+o(h.$t("bank.repay")),1)],2)]),e("div",al,[i.value==="deposit"?(v(),m("div",ll,[e("div",il,[e("div",rl,[e("span",null,o(h.$t("bank.amountToDeposit")),1),e("span",ul,"¥"+o(E(A)(Number(u.value))),1)]),B(e("input",{type:"range",min:"0",max:E(s).money,"onUpdate:modelValue":f[4]||(f[4]=w=>u.value=w),step:"1",class:"styled-slider deposit-slider"},null,8,cl),[[ne,u.value]]),e("div",dl,[e("button",{class:"amount-btn",onClick:f[5]||(f[5]=w=>u.value=0)},"0"),e("button",{class:"amount-btn",onClick:f[6]||(f[6]=w=>u.value=Math.floor(E(s).money/2))},"50%"),e("button",{class:"amount-btn",onClick:f[7]||(f[7]=w=>u.value=E(s).money)},"全部")])]),e("div",vl,[e("div",ml,[e("div",null,o(h.$t("bank.weeklyInterest")),1),e("div",null,"¥"+o(E(A)(Math.floor(Number(u.value)*E(s).depositInterestRate))),1)]),e("div",pl,[e("div",null,o(h.$t("bank.remainingMoney")),1),e("div",null,"¥"+o(E(A)(E(s).money-Number(u.value))),1)])]),e("div",gl,[e("button",{onClick:G,class:"cancel-btn"},o(h.$t("common.cancel")),1),e("button",{onClick:L,class:"confirm-btn",disabled:Number(u.value)<=0},o(h.$t("bank.confirmDeposit")),9,yl)])])):T("",!0),i.value==="withdraw"?(v(),m("div",fl,[e("div",hl,[e("div",_l,[e("span",null,o(h.$t("bank.amountToWithdraw")),1),e("span",bl,"¥"+o(E(A)(Number(g.value))),1)]),B(e("input",{type:"range",min:"0",max:Math.max(E(s).bankDeposit,1),"onUpdate:modelValue":f[8]||(f[8]=w=>g.value=w),step:"1",class:"styled-slider withdraw-slider",disabled:E(s).bankDeposit<=0},null,8,$l),[[ne,g.value]]),e("div",kl,[e("button",{class:"amount-btn",onClick:f[9]||(f[9]=w=>g.value=0)},"0"),e("button",{class:"amount-btn",onClick:f[10]||(f[10]=w=>g.value=Math.floor(E(s).bankDeposit/2))},"50%"),e("button",{class:"amount-btn",onClick:f[11]||(f[11]=w=>g.value=E(s).bankDeposit)},"全部")])]),e("div",Sl,[e("div",wl,[e("div",null,o(h.$t("bank.remainingDeposit")),1),e("div",null,"¥"+o(E(A)(E(s).bankDeposit-Number(g.value))),1)]),e("div",Cl,[e("div",null,o(h.$t("bank.remainingMoney")),1),e("div",null,"¥"+o(E(A)(E(s).money+Number(g.value))),1)])]),e("div",Pl,[e("button",{onClick:G,class:"cancel-btn"},o(h.$t("common.cancel")),1),e("button",{onClick:q,class:"confirm-btn",disabled:Number(g.value)<=0},o(h.$t("bank.confirmWithdraw")),9,Tl)])])):T("",!0),i.value==="loan"?(v(),m("div",Ml,[e("div",El,[e("div",Il,[e("span",null,o(h.$t("bank.amountToLoan")),1),e("span",Nl,"¥"+o(E(A)(Number(b.value))),1)]),B(e("input",{type:"range",min:"0",max:Math.max(E(s).availableLoanAmount,1),"onUpdate:modelValue":f[12]||(f[12]=w=>b.value=w),step:"1",class:"styled-slider loan-slider",disabled:E(s).availableLoanAmount<=0},null,8,Ll),[[ne,b.value]]),e("div",xl,[e("button",{class:"amount-btn",onClick:f[13]||(f[13]=w=>b.value=0)},"0"),e("button",{class:"amount-btn",onClick:f[14]||(f[14]=w=>b.value=Math.floor(E(s).availableLoanAmount/2))},"50%"),e("button",{class:"amount-btn",onClick:f[15]||(f[15]=w=>b.value=E(s).availableLoanAmount)},"全部")])]),e("div",Rl,[e("div",Al,[e("div",null,o(h.$t("bank.weeklyInterest")),1),e("div",null,"¥"+o(E(A)(Math.floor(Number(b.value)*E(s).loanInterestRate))),1)]),e("div",Ol,[e("div",null,o(h.$t("bank.remainingLoan")),1),e("div",null,"¥"+o(E(A)(E(s).debt+Number(b.value))),1)])]),e("div",Dl,[e("button",{onClick:G,class:"cancel-btn"},o(h.$t("common.cancel")),1),e("button",{onClick:Z,class:"confirm-btn",disabled:Number(b.value)<=0},o(h.$t("bank.confirmLoan")),9,Vl)])])):T("",!0),i.value==="repay"?(v(),m("div",Gl,[e("div",Hl,[e("div",Wl,[e("span",null,o(h.$t("bank.amountToRepay")),1),e("span",Bl,"¥"+o(E(A)(Number(k.value))),1)]),B(e("input",{type:"range",min:"0",max:Math.min(E(s).money,E(s).debt),"onUpdate:modelValue":f[16]||(f[16]=w=>k.value=w),step:"1",class:"styled-slider repay-slider"},null,8,ql),[[ne,k.value]]),e("div",Ul,[e("button",{class:"amount-btn",onClick:f[17]||(f[17]=w=>k.value=0)},"0"),e("button",{class:"amount-btn",onClick:f[18]||(f[18]=w=>k.value=Math.floor(Math.min(E(s).money,E(s).debt)/2))},"50%"),e("button",{class:"amount-btn",onClick:f[19]||(f[19]=w=>k.value=Math.min(E(s).money,E(s).debt))},"全部")])]),e("div",Ql,[e("div",Fl,[e("div",null,o(h.$t("bank.remainingDebt")),1),e("div",null,"¥"+o(E(A)(Math.max(0,E(s).debt-Number(k.value)))),1)]),e("div",zl,[e("div",null,o(h.$t("bank.remainingMoney")),1),e("div",null,"¥"+o(E(A)(Math.max(0,E(s).money-Number(k.value)))),1)])]),e("div",jl,[e("button",{onClick:G,class:"cancel-btn"},o(h.$t("common.cancel")),1),e("button",{onClick:X,class:"confirm-btn",disabled:Number(k.value)<=0},o(h.$t("bank.confirmRepay")),9,Kl)])])):T("",!0)])])])])])):T("",!0)}},Xl=ae(Yl,[["__scopeId","data-v-0bab4abf"]]);const Jl={class:"player-info"},Zl={class:"player-header"},ei={class:"avatar-container"},ti={class:"avatar"},si={class:"player-name-container"},ni={class:"player-name"},oi={class:"player-week"},ai={class:"finance-list"},li={class:"finance-item money-item"},ii={class:"finance-value money"},ri={class:"finance-label"},ui={class:"finance-item debt-item"},ci={class:"finance-value debt"},di={class:"finance-label"},vi={class:"finance-item deposit-item"},mi={class:"finance-value deposit"},pi={class:"finance-label"},gi={class:"finance-item loan-item"},yi={class:"finance-value loan"},fi={class:"finance-label"},hi={class:"capacity-container"},_i={class:"capacity-label"},bi={class:"label"},$i={class:"capacity-value"},ki={class:"capacity-bar"},Si={class:"action-buttons"},wi={__name:"PlayerInfo",setup(l){const t=we(),s=fe(),n=O(()=>t.player),r=O(()=>t.currentWeek),i=O(()=>t.isEndlessMode),u=C(!1),g=()=>{s.advanceWeek()},b=()=>{if(!n.value||!n.value.name)return"玩";const k=n.value.name.trim();return k?/[\u4e00-\u9fa5]/.test(k[0])?k[0]:k[0].toUpperCase():"玩"};return(k,_)=>(v(),m("div",Jl,[e("div",Zl,[e("div",ei,[e("div",ti,o(b()),1)]),e("div",si,[e("h2",ni,o(n.value.name),1),e("div",oi,o(i.value?`第 ${r.value} / ∞ 周`:`第 ${r.value} / 52 周`),1)])]),e("div",ai,[e("div",li,[_[2]||(_[2]=e("span",{class:"finance-icon"},"💰",-1)),e("div",ii,"¥"+o(E(A)(n.value.money)),1),e("div",ri,o(k.$t("playerInfo.money")),1)]),e("div",ui,[_[3]||(_[3]=e("span",{class:"finance-icon"},"💸",-1)),e("div",ci,"¥"+o(E(A)(n.value.debt)),1),e("div",di,o(k.$t("playerInfo.debt")),1)]),e("div",vi,[_[4]||(_[4]=e("span",{class:"finance-icon"},"🏦",-1)),e("div",mi,"¥"+o(E(A)(n.value.bankDeposit)),1),e("div",pi,o(k.$t("bank.currentDeposit")),1)]),e("div",gi,[_[5]||(_[5]=e("span",{class:"finance-icon"},"📊",-1)),e("div",yi,"¥"+o(E(A)(n.value.availableLoanAmount)),1),e("div",fi,o(k.$t("bank.availableLoan")),1)])]),e("div",hi,[e("div",_i,[e("span",bi,o(k.$t("playerInfo.capacity")),1),e("span",$i,o(n.value.inventoryUsed)+" / "+o(n.value.capacity),1)]),e("div",ki,[e("div",{class:H(["capacity-fill",{"nearly-full":n.value.inventoryUsed/n.value.capacity>.8}]),style:Ce({width:`${n.value.inventoryUsed/n.value.capacity*100}%`})},null,6)])]),e("div",Si,[e("button",{class:"btn next-week-btn",onClick:g},_[6]||(_[6]=[e("span",{class:"btn-icon"},"⏭️",-1),e("span",{class:"btn-text"},"下一周",-1)])),e("button",{class:"btn bank-btn",onClick:_[0]||(_[0]=y=>u.value=!0)},_[7]||(_[7]=[e("span",{class:"btn-icon"},"🏦",-1),e("span",{class:"btn-text"},"银行",-1)]))]),j(Xl,{show:u.value,"onUpdate:show":_[1]||(_[1]=y=>u.value=y)},null,8,["show"])]))}},Ci=ae(wi,[["__scopeId","data-v-cc122936"]]);const Pi=["width","height"],Ti=["points"],Mi=["cx","cy"],Ei={__name:"MiniPriceChart",props:{history:{type:Array,default:()=>[]},width:{type:Number,default:100},height:{type:Number,default:30}},setup(l){const t=l,s=O(()=>t.history.length===0?0:Math.min(...t.history)),n=O(()=>t.history.length===0?100:Math.max(...t.history));function r(g){const b=s.value,k=n.value;return k===b?15:(g-b)/(k-b)*30}const i=O(()=>{if(t.history.length<2)return[];const g=[],b=100/(t.history.length-1);return t.history.forEach((k,_)=>{const y=_*b,M=30-r(k);g.push({x:y,y:M})}),g}),u=O(()=>i.value.map(g=>`${g.x},${g.y}`).join(" "));return O(()=>{if(t.history.length<2)return"#6c757d";const g=t.history[0],b=t.history[t.history.length-1];return b>g?"#28a745":b<g?"#dc3545":"#6c757d"}),(g,b)=>(v(),m("div",{class:"mini-price-chart",style:Ce({height:`${l.height}px`})},[(v(),m("svg",{width:l.width,height:l.height,viewBox:"0 0 100 30",preserveAspectRatio:"none"},[e("polyline",{points:u.value,class:"price-line",fill:"none"},null,8,Ti),i.value.length>0?(v(),m("circle",{key:0,cx:i.value[i.value.length-1].x,cy:i.value[i.value.length-1].y,r:"1.5",class:"latest-price-point"},null,8,Mi)):T("",!0)],8,Pi))],4))}},Et=ae(Ei,[["__scopeId","data-v-534e9b3f"]]);const Ii={class:"enhanced-trade-panel"},Ni={class:"panel-header"},Li={class:"trade-type-selector"},xi={key:0,class:"trade-detail"},Ri={class:"price-info"},Ai={class:"current-price"},Oi={class:"price-value"},Di={key:0,class:"prediction-info"},Vi={class:"prediction-icon"},Gi={class:"trade-form"},Hi={class:"form-row"},Wi={class:"quantity-control"},Bi=["max"],qi={class:"quick-quantity"},Ui={class:"trade-summary"},Qi={class:"summary-row"},Fi={class:"total-value"},zi={key:0,class:"summary-row"},ji={key:1,class:"summary-row inventory-info"},Ki={key:2,class:"summary-row avg-price-info"},Yi={class:"action-buttons"},Xi=["disabled"],Ji={__name:"EnhancedTradePanel",props:{selectedProduct:{type:Object,default:null}},emits:["close"],setup(l,{emit:t}){const s=l,n=t,r=C("buy"),i=C(s.selectedProduct),u=C(1),g=we();ve(()=>s.selectedProduct,a=>{i.value=a});const b=O(()=>{if(!i.value)return 0;if(r.value==="buy"){const a=i.value.currentPrice||w(i.value.id),d=Math.floor(g.player.money/a),$=g.player.capacity-g.player.inventoryUsed;return Math.max(0,Math.min(d,$))}else return Q.value}),k=O(()=>i.value?(i.value.currentPrice||w(i.value.id))*u.value:0),_=O(()=>{if(r.value!=="sell"||!i.value)return 0;const a=w(i.value.id),d=N();return d?u.value*(a-d):0}),y=O(()=>{var D;const a=N();return a?((w((D=i.value)==null?void 0:D.id)/a-1)*100).toFixed(1):"0"}),M=O(()=>{const a=parseFloat(y.value);return a>0?"profit-positive":a<0?"profit-negative":""}),G=O(()=>{if(!i.value||u.value<=0)return!1;if(r.value==="buy"){if((i.value.currentPrice||w(i.value.id))*u.value>g.player.money)return!1;const $=g.player.capacity-g.player.inventoryUsed;return!(u.value>$)}else return Q.value>=u.value}),Q=O(()=>i.value?g.player.inventory.filter(a=>a.productId===i.value.id).reduce((a,d)=>a+d.quantity,0):0),N=()=>{if(!i.value)return 0;const a=g.player.inventory.filter(D=>D.productId===i.value.id);if(a.length===0)return 0;const d=a.reduce((D,le)=>D+le.purchasePrice*le.quantity,0),$=a.reduce((D,le)=>D+le.quantity,0);return $>0?d/$:0},L=a=>{var $;if(!a)return"";const d=(($=g.productPrices[a.id])==null?void 0:$.trend)||"stable";return d==="rising"?"prediction-up":d==="falling"?"prediction-down":"prediction-stable"},q=a=>{var $;if(!a)return"?";const d=(($=g.productPrices[a.id])==null?void 0:$.trend)||"stable";return d==="rising"?"📈":d==="falling"?"📉":"📊"},Z=a=>{var $;if(!a)return"无法预测";const d=(($=g.productPrices[a.id])==null?void 0:$.trend)||"stable";return d==="rising"?"价格可能上涨，建议购买":d==="falling"?"价格可能下跌，谨慎购买":"价格相对稳定"},X=a=>{r.value=a,u.value=1};function x(){u.value=Math.min(u.value+1,b.value)}function h(){u.value=Math.max(1,u.value-1)}function f(a){u.value=Math.max(1,Math.floor(a))}function w(a){if(!a)return 0;const d=String(a),$=g.getCurrentProductPrice(d);if($===0&&i.value){if(String(i.value.id)===d&&i.value.currentPrice)return i.value.currentPrice;const D=g.marketStore.products.find(le=>String(le.id)===d);if(D&&D.basePrice)return D.basePrice}return $}function P(a){var d;return((d=g.productPrices[a])==null?void 0:d.history)||[]}function S(a){return gt(a)}function p(){if(!(!G.value||!i.value))try{if(w(i.value.id)<=0){c("error","无法确定商品价格，请稍后再试");return}let d;if(r.value==="buy")d=g.buyProduct(i.value.id,u.value),d.success?c("success",`已购买 ${u.value} 个 ${i.value.name}`):c("error",d.message||"购买失败");else if(d=g.sellProduct(i.value.id,u.value),d.success){let $=`已出售 ${u.value} 个 ${i.value.name}`;if(d.income&&($+=`，获得 ${A(d.income)} 元`),d.profit){const D=d.profit>0?`，盈利 ${A(d.profit)}`:`，亏损 ${A(Math.abs(d.profit))}`;$+=D}c(d.profit>=0?"success":"warning",$)}else c("error",d.message||"出售失败");u.value=1,n("close")}catch(a){console.error("交易执行出错:",a),c("error","交易过程中发生错误")}}const c=(a,d)=>{He.emit("show:transaction_toast",{message:d,type:a,icon:r.value==="buy"?a==="success"?"✓":a==="warning"?"⚠️":a==="error"?"✗":"📣":"💰",class:a==="success"?r.value==="buy"?"purchase-success":"sale-success":r.value==="sell"&&a==="warning"?"sale-success":"purchase-failed"})};return ve(i,()=>{u.value=1}),(a,d)=>(v(),m("div",Ii,[e("div",Ni,[e("h3",null,o(i.value?i.value.name:"交易"),1),e("div",Li,[e("button",{class:H(["type-btn",{active:r.value==="buy"}]),onClick:d[0]||(d[0]=$=>X("buy"))}," 购买 ",2),e("button",{class:H(["type-btn",{active:r.value==="sell"}]),onClick:d[1]||(d[1]=$=>X("sell"))}," 出售 ",2)])]),i.value?(v(),m("div",xi,[e("div",Ri,[e("div",Ai,[d[7]||(d[7]=e("span",null,"当前价格:",-1)),e("span",Oi,o(S(w(i.value.id))),1)]),j(Et,{history:P(i.value.id),height:40},null,8,["history"])]),r.value==="buy"?(v(),m("div",Di,[e("div",{class:H(["prediction-badge",L(i.value)])},[e("span",Vi,o(q(i.value)),1),e("span",null,o(Z(i.value)),1)],2)])):T("",!0),e("div",Gi,[e("div",Hi,[e("div",Wi,[e("button",{onClick:h},"-"),B(e("input",{"onUpdate:modelValue":d[2]||(d[2]=$=>u.value=$),type:"number",min:"1",max:b.value},null,8,Bi),[[ne,u.value,void 0,{number:!0}]]),e("button",{onClick:x},"+")]),e("div",qi,[e("button",{onClick:d[3]||(d[3]=$=>f(b.value/4))},"25%"),e("button",{onClick:d[4]||(d[4]=$=>f(b.value/2))},"50%"),e("button",{onClick:d[5]||(d[5]=$=>f(b.value))},"最大")])]),e("div",Ui,[e("div",Qi,[d[8]||(d[8]=e("span",null,"总计:",-1)),e("span",Fi,o(S(k.value)),1)]),r.value==="sell"&&N()?(v(),m("div",zi,[d[9]||(d[9]=e("span",null,"预计利润:",-1)),e("span",{class:H(["profit-value",M.value])},o(S(_.value))+" ("+o(y.value)+"%) ",3)])):T("",!0),Q.value>0?(v(),m("div",ji,[d[10]||(d[10]=e("span",null,"当前持有:",-1)),e("span",null,o(Q.value)+" 个",1)])):T("",!0),r.value==="sell"&&N()?(v(),m("div",Ki,[d[11]||(d[11]=e("span",null,"平均买入价:",-1)),e("span",null,o(S(N())),1)])):T("",!0)]),e("div",Yi,[e("button",{class:"cancel-btn",onClick:d[6]||(d[6]=$=>a.$emit("close"))},"取消"),e("button",{class:"execute-trade-btn",disabled:!G.value,onClick:p},o(r.value==="buy"?"购买":"出售"),9,Xi)])])])):T("",!0)]))}},Zi=ae(Ji,[["__scopeId","data-v-979dd061"]]);const er=["title"],tr={class:"trend-value"},sr={__name:"PriceTrend",props:{trend:{type:String,default:"stable",validator:l=>["rising_strong","rising","stable_high","stable","stable_low","falling","falling_strong","volatile"].includes(l)},percent:{type:Number,default:0},animate:{type:Boolean,default:!0},showTrendLine:{type:Boolean,default:!1}},setup(l){const t=l,s=O(()=>({rising_strong:"icon-arrow-up-double",rising:"icon-arrow-up",stable_high:"icon-arrow-right-up",stable:"icon-arrow-right",stable_low:"icon-arrow-right-down",falling:"icon-arrow-down",falling_strong:"icon-arrow-down-double",volatile:"icon-volatile"})[t.trend]||"icon-arrow-right"),n=O(()=>t.trend.includes("rising_strong")?"trend-up-strong":t.trend.includes("rising")?"trend-up":t.trend.includes("stable_high")?"trend-stable-high":t.trend.includes("stable_low")?"trend-stable-low":t.trend.includes("falling_strong")?"trend-down-strong":t.trend.includes("falling")?"trend-down":t.trend.includes("volatile")?"trend-volatile":"trend-stable"),r=O(()=>`${t.percent>0?"+":""}${t.percent.toFixed(1)}%`),i=O(()=>`${{rising_strong:"价格大幅上涨",rising:"价格上涨",stable_high:"高位稳定",stable:"价格稳定",stable_low:"低位稳定",falling:"价格下跌",falling_strong:"价格大幅下跌",volatile:"价格波动"}[t.trend]||"价格稳定"} (${r.value})`);return(u,g)=>(v(),m("div",{class:H(["price-trend",[n.value,{"with-animation":l.animate}]]),title:i.value},[e("i",{class:H(["trend-icon",s.value])},null,2),e("span",tr,o(r.value),1),l.showTrendLine?(v(),m("div",{key:0,class:H(["trend-line",n.value])},null,2)):T("",!0)],10,er))}},kt=ae(sr,[["__scopeId","data-v-dd5a525a"]]);const nr={class:"market"},or={class:"title"},ar={class:"market-header"},lr={class:"header-row"},ir={class:"location-buttons"},rr=["onClick"],ur={class:"view-toggle"},cr={key:0,class:"products-container"},dr={class:"products-table"},vr={class:"product-name"},mr={key:0,class:"special-badge",title:"特色商品，价格更优惠"},pr={class:"price"},gr={class:"trend-column"},yr={class:"trend-container"},fr={class:"owned-quantity"},hr={class:"action-buttons"},_r={class:"button-group"},br=["disabled","onClick"],$r=["disabled","onClick"],kr=["disabled","onClick"],Sr={key:0,class:"button-group"},wr=["onClick"],Cr=["onClick"],Pr=["onClick"],Tr={key:0},Mr={colspan:"6",class:"no-products"},Er={key:1,class:"products-grid"},Ir={class:"product-card-header"},Nr={class:"product-name"},Lr={key:0,class:"special-badge",title:"特色商品，价格更优惠"},xr={class:"product-card-body"},Rr={class:"price-section"},Ar={class:"current-price"},Or={class:"trend-price-change"},Dr={class:"owned-quantity-card"},Vr={class:"product-actions"},Gr={class:"action-row"},Hr={class:"button-group"},Wr=["disabled","onClick"],Br=["disabled","onClick"],qr=["disabled","onClick"],Ur={key:0,class:"button-group"},Qr=["onClick"],Fr=["onClick"],zr=["onClick"],jr={key:0,class:"no-products-card"},Kr={class:"modal-container"},Yr={class:"toast-content"},Xr={class:"toast-icon"},Jr={class:"toast-message"},Zr={__name:"Market",setup(l){Ee();const t=we(),s=fe(),n=O(()=>t.locations||[]),r=O(()=>t.currentLocation||{id:"",name:"加载中..."}),i=O(()=>t.availableProducts||[]),u=O(()=>t.player||{money:0,capacity:0,inventoryUsed:0}),g=C(!1),b=C(null),k=C(!1),_=C(""),y=C(""),M=C(""),G=C("table"),Q=c=>c===0?"0%":`${c>0?"+":""}${c.toFixed(1)}%`,N=c=>{var a;if(c&&c!==((a=r.value)==null?void 0:a.id)){s.advanceWeek(),t.changeLocation(c);const d=n.value.find($=>$.id===c);d&&(_.value=`已前往${d.name}，进入下一周`,y.value="location-change",M.value="🚶",k.value=!0,setTimeout(()=>{k.value=!1},3e3))}},L=c=>!(!c||c.currentPrice>u.value.money||u.value.inventoryUsed>=u.value.capacity),q=c=>c?(u.value.inventory||[]).some(d=>d.productId===c.id&&d.quantity>0):!1,Z=c=>(u.value.inventory||[]).filter(d=>d.productId===c).reduce((d,$)=>d+$.quantity,0),X=c=>{b.value=c,g.value=!0},x=c=>{b.value=c,g.value=!0,setTimeout(()=>{document.querySelector(".enhanced-trade-panel .type-btn:nth-child(2)").click()},100)},h=()=>{g.value=!1,b.value=null},f=c=>{var a,d;return((d=(a=t.productPrices)==null?void 0:a[c])==null?void 0:d.history)||[]},w=c=>{if(L(c))try{const a=t.buyProduct(c.id,1);a.success?(_.value=`已购买 1 个 ${c.name}`,y.value="purchase-success",M.value="✓",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)})):(_.value=a.message||"购买失败",y.value="purchase-failed",M.value="✗",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)}))}catch(a){console.error("快速购买出错:",a)}},P=(c,a)=>{if(L(c))try{const d=t.buyProduct(c.id,a);d.success?(_.value=`已购买 ${a} 个 ${c.name}`,y.value="purchase-success",M.value="✓",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)})):(_.value=d.message||"购买失败",y.value="purchase-failed",M.value="✗",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)}))}catch(d){console.error("快速购买多个出错:",d)}},S=c=>{if(q(c))try{const a=t.sellProduct(c.id,1);if(a.success){let d=`已出售 1 个 ${c.name}`;if(a.income&&(d+=`，获得 ${A(a.income)} 元`),a.profit){const $=a.profit>0?`，盈利 ${A(a.profit)}`:`，亏损 ${A(Math.abs(a.profit))}`;d+=$}_.value=d,y.value="sale-success",M.value="💰",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)})}else _.value=a.message||"出售失败",y.value="purchase-failed",M.value="✗",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)})}catch(a){console.error("快速出售出错:",a)}},p=(c,a)=>{if(q(c))try{const d=t.sellProduct(c.id,a);if(d.success){let $=`已出售 ${a} 个 ${c.name}`;if(d.income&&($+=`，获得 ${A(d.income)} 元`),d.profit){const D=d.profit>0?`，盈利 ${A(d.profit)}`:`，亏损 ${A(Math.abs(d.profit))}`;$+=D}_.value=$,y.value="sale-success",M.value="💰",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)})}else _.value=d.message||"出售失败",y.value="purchase-failed",M.value="✗",k.value=!1,requestAnimationFrame(()=>{k.value=!0,setTimeout(()=>{k.value=!1},3e3)})}catch(d){console.error("快速出售多个出错:",d)}};return(c,a)=>(v(),m("div",nr,[e("h2",or,o(c.$t("market.title",{location:r.value.name})),1),e("div",ar,[e("div",lr,[e("div",ir,[(v(!0),m(F,null,oe(n.value,d=>(v(),m("button",{key:d.id,class:H(["location-btn",{active:d.id===r.value.id}]),onClick:$=>N(d.id)},o(d.name),11,rr))),128))]),e("div",ur,[e("button",{class:H(["view-btn",{active:G.value==="table"}]),onClick:a[0]||(a[0]=d=>G.value="table")},a[2]||(a[2]=[e("i",{class:"icon-table"},null,-1),W(" 表格视图 ")]),2),e("button",{class:H(["view-btn",{active:G.value==="card"}]),onClick:a[1]||(a[1]=d=>G.value="card")},a[3]||(a[3]=[e("i",{class:"icon-card"},null,-1),W(" 卡片视图 ")]),2)])])]),G.value==="table"?(v(),m("div",cr,[e("table",dr,[e("thead",null,[e("tr",null,[e("th",null,o(c.$t("market.productName")),1),e("th",null,o(c.$t("market.price")),1),e("th",null,o(c.$t("market.trend")),1),e("th",null,o(c.$t("market.change")),1),a[4]||(a[4]=e("th",null,"拥有数量",-1)),e("th",null,o(c.$t("market.action")),1)])]),e("tbody",null,[(v(!0),m(F,null,oe(i.value,d=>(v(),m("tr",{key:d.id,class:H({"special-product":d.isSpecial})},[e("td",null,[e("div",vr,[W(o(d.name)+" ",1),d.isSpecial?(v(),m("span",mr,"✦")):T("",!0)])]),e("td",pr," ¥"+o(E(A)(d.currentPrice)),1),e("td",gr,[e("div",yr,[j(kt,{trend:d.trend,percent:d.changePercent},null,8,["trend","percent"])])]),e("td",{class:H(["price-change",E(_t)(d.changePercent)])},o(Q(d.changePercent)),3),e("td",fr,o(Z(d.id)||0),1),e("td",null,[e("div",hr,[e("div",_r,[e("button",{class:"buy-btn",disabled:!L(d),onClick:$=>X(d)}," 购买 ",8,br),e("button",{class:"quick-buy-btn",disabled:!L(d),title:"快速买入1个",onClick:$=>w(d)}," +1 ",8,$r),e("button",{class:"quick-buy-btn-10",disabled:!L(d),title:"快速买入10个",onClick:$=>P(d,10)}," +10 ",8,kr)]),q(d)?(v(),m("div",Sr,[e("button",{class:"sell-btn",title:"出售该物品",onClick:$=>x(d)}," 出售 ",8,wr),e("button",{class:"quick-sell-btn",title:"快速卖出1个",onClick:$=>S(d)}," -1 ",8,Cr),e("button",{class:"quick-sell-btn-10",title:"快速卖出10个",onClick:$=>p(d,10)}," -10 ",8,Pr)])):T("",!0)])])],2))),128)),i.value.length===0?(v(),m("tr",Tr,[e("td",Mr,o(c.$t("market.noProducts")),1)])):T("",!0)])])])):(v(),m("div",Er,[(v(!0),m(F,null,oe(i.value,d=>(v(),m("div",{key:d.id,class:H(["product-card",{"special-product":d.isSpecial}])},[e("div",Ir,[e("h3",Nr,[W(o(d.name)+" ",1),d.isSpecial?(v(),m("span",Lr,"✦")):T("",!0)])]),e("div",xr,[e("div",Rr,[e("div",Ar," ¥"+o(E(A)(d.currentPrice)),1),e("div",Or,[j(kt,{trend:d.trend,percent:d.changePercent},null,8,["trend","percent"]),e("span",{class:H(["card-price-change",E(_t)(d.changePercent)])},o(Q(d.changePercent)),3)]),e("div",Dr,[a[5]||(a[5]=W(" 拥有: ")),e("span",null,o(Z(d.id)||0),1)])]),f(d.id).length>1?(v(),Be(Et,{key:0,history:f(d.id),height:40},null,8,["history"])):T("",!0),e("div",Vr,[e("div",Gr,[e("div",Hr,[e("button",{class:"buy-btn",disabled:!L(d),onClick:$=>X(d)}," 购买 ",8,Wr),e("button",{class:"quick-buy-btn",disabled:!L(d),title:"快速买入1个",onClick:$=>w(d)}," +1 ",8,Br),e("button",{class:"quick-buy-btn-10",disabled:!L(d),title:"快速买入10个",onClick:$=>P(d,10)}," +10 ",8,qr)]),q(d)?(v(),m("div",Ur,[e("button",{class:"sell-btn",title:"出售该物品",onClick:$=>x(d)}," 出售 ",8,Qr),e("button",{class:"quick-sell-btn",title:"快速卖出1个",onClick:$=>S(d)}," -1 ",8,Fr),e("button",{class:"quick-sell-btn-10",title:"快速卖出10个",onClick:$=>p(d,10)}," -10 ",8,zr)])):T("",!0)])])])],2))),128)),i.value.length===0?(v(),m("div",jr,o(c.$t("market.noProducts")),1)):T("",!0)])),j(re,{name:"modal",appear:""},{default:ie(()=>[g.value?(v(),m("div",{key:0,class:"modal-backdrop",onClick:ue(h,["self"])},[e("div",Kr,[j(Zi,{"selected-product":b.value,onClose:h},null,8,["selected-product"])])])):T("",!0)]),_:1}),j(re,{name:"fade"},{default:ie(()=>[k.value?(v(),m("div",{key:0,class:H(["transaction-toast",y.value])},[e("div",Yr,[e("span",Xr,o(M.value),1),e("span",Jr,o(_.value),1)]),a[6]||(a[6]=e("div",{class:"toast-progress-bar"},null,-1))],2)):T("",!0)]),_:1})]))}},eu=ae(Zr,[["__scopeId","data-v-bca3cc9a"]]);const tu={name:"TradePanel",props:{product:{type:Object,required:!0}},setup(l,{emit:t}){const s=we(),n=C("buy"),r=C(1),i=C(1),u=O(()=>s.player),g=O(()=>s.getProductPriceHistory(l.product.id)||[]),b=O(()=>{const z=Math.floor(u.value.money/l.product.currentPrice),de=u.value.capacity-u.value.inventoryUsed;return Math.max(0,Math.min(z,de))}),k=O(()=>l.product.currentPrice*r.value),_=O(()=>u.value.inventory.find(z=>z.productId===l.product.id)),y=O(()=>_.value?_.value.quantity:0),M=O(()=>y.value>0),G=O(()=>b.value>0),Q=O(()=>l.product.currentPrice*i.value);return{activeTab:n,buyQuantity:r,sellQuantity:i,player:u,priceHistory:g,maxBuyQuantity:b,buyTotalCost:k,ownedItem:_,ownedQuantity:y,canSell:M,canBuy:G,sellTotalIncome:Q,formatNumber:A,formatChange:z=>Os(z),getTrendText:z=>Vt(z),getTrendIcon:z=>{switch(z){case J.RISING_STRONG:return"↑↑";case J.RISING:return"↑";case J.STABLE_HIGH:return"▲";case J.STABLE:return"→";case J.STABLE_LOW:return"▼";case J.FALLING:return"↓";case J.FALLING_STRONG:return"↓↓";case J.VOLATILE:return"↕";default:return"→"}},getTrendClass:z=>{switch(z){case J.RISING_STRONG:return"trend-rising-strong";case J.RISING:return"trend-rising";case J.STABLE_HIGH:return"trend-stable-high";case J.STABLE:return"trend-stable";case J.STABLE_LOW:return"trend-stable-low";case J.FALLING:return"trend-falling";case J.FALLING_STRONG:return"trend-falling-strong";case J.VOLATILE:return"trend-volatile";default:return"trend-stable"}},getChangeClass:z=>z>3?"change-up-strong":z>0?"change-up":z<-3?"change-down-strong":z<0?"change-down":"change-neutral",getProductImage:()=>{const z={food:"food.png",electronics:"electronics.png",clothing:"clothing.png",luxury:"luxury.png",daily:"daily.png"},de=l.product.category||"daily";return require(`@/assets/images/products/${z[de]}`)},getBarHeight:z=>{const de=[l.product.currentPrice,...g.value],be=Math.max(...de),Ne=Math.min(...de),he=be-Ne;return he===0?50:(z-Ne)/he*80+10},getBarColor:(z,de)=>z>de?"#e53e3e":z<de?"#38a169":"#4299e1",getProfitClass:()=>{if(!_.value)return"";const z=l.product.currentPrice-_.value.purchasePrice;return z>0?"profit-positive":z<0?"profit-negative":""},getProfitText:()=>{if(!_.value)return"";const z=(l.product.currentPrice-_.value.purchasePrice)*i.value,de=(l.product.currentPrice/_.value.purchasePrice-1)*100,be=z>0?"+":"";return`${be}¥${A(z)} (${be}${de.toFixed(1)}%)`},incrementBuyQuantity:()=>{r.value<b.value&&r.value++},decrementBuyQuantity:()=>{r.value>1&&r.value--},setBuyQuantity:z=>{r.value=Math.min(z,b.value)},incrementSellQuantity:()=>{i.value<y.value&&i.value++},decrementSellQuantity:()=>{i.value>1&&i.value--},setSellQuantity:z=>{i.value=Math.min(z,y.value)},executeBuy:()=>{r.value>0&&(s.buyProduct(l.product.id,r.value),t("transaction-complete",{type:"buy",productId:l.product.id,quantity:r.value,price:l.product.currentPrice}))},executeSell:()=>{i.value>0&&M.value&&(s.sellProduct(l.product.id,i.value),t("transaction-complete",{type:"sell",productId:l.product.id,quantity:i.value,price:l.product.currentPrice}))},close:()=>{t("close")}}}},su={class:"trade-panel"},nu={class:"panel-header"},ou={class:"panel-title"},au={class:"product-details"},lu={class:"product-image-container"},iu=["src"],ru={key:0,class:"product-badge"},uu={class:"product-info"},cu={class:"price-info"},du={class:"current-price"},vu={class:"value"},mu={class:"price-trend"},pu={class:"trend-icon"},gu={class:"trend-text"},yu={class:"price-history"},fu={class:"price-chart"},hu=["title"],_u={class:"trade-actions"},bu={class:"tabs"},$u=["disabled"],ku={class:"tab-content"},Su={key:0,class:"buy-panel"},wu={class:"player-resources"},Cu={class:"resource"},Pu={class:"value"},Tu={class:"resource"},Mu={class:"value"},Eu={class:"quantity-control"},Iu={class:"quantity-slider-container"},Nu=["max","disabled"],Lu={class:"slider-labels"},xu={class:"quantity-input"},Ru=["disabled"],Au=["max","disabled"],Ou=["disabled"],Du={class:"quantity-presets"},Vu=["disabled"],Gu=["disabled"],Hu=["disabled"],Wu=["disabled"],Bu={class:"transaction-summary"},qu={class:"summary-item"},Uu={class:"value"},Qu={class:"summary-item"},Fu={class:"value"},zu={class:"summary-item total"},ju={class:"value"},Ku={class:"action-buttons"},Yu=["disabled"],Xu={key:1,class:"sell-panel"},Ju={class:"player-resources"},Zu={class:"resource"},ec={class:"value"},tc={class:"resource"},sc={class:"value"},nc={class:"value"},oc={class:"quantity-control"},ac={class:"quantity-slider-container"},lc=["max","disabled"],ic={class:"slider-labels"},rc={class:"quantity-input"},uc=["disabled"],cc=["max","disabled"],dc=["disabled"],vc={class:"quantity-presets"},mc=["disabled"],pc=["disabled"],gc=["disabled"],yc=["disabled"],fc={class:"transaction-summary"},hc={class:"summary-item"},_c={class:"value"},bc={class:"summary-item"},$c={class:"value"},kc={class:"summary-item total"},Sc={class:"value"},wc={class:"action-buttons"},Cc=["disabled"];function Pc(l,t,s,n,r,i){return v(),m("div",su,[e("div",nu,[e("h3",ou,o(s.product.name),1),e("button",{class:"close-btn",onClick:t[0]||(t[0]=(...u)=>n.close&&n.close(...u))},"×")]),e("div",au,[e("div",lu,[e("img",{src:n.getProductImage(),alt:"商品图片",class:"product-image"},null,8,iu),s.product.isSpecial?(v(),m("div",ru,"特色商品")):T("",!0)]),e("div",uu,[e("div",cu,[e("div",du,[t[21]||(t[21]=e("span",{class:"label"},"当前价格",-1)),e("span",vu,"¥"+o(n.formatNumber(s.product.currentPrice)),1)]),e("div",mu,[e("div",{class:H(["trend-indicator",n.getTrendClass(s.product.trend)])},[e("span",pu,o(n.getTrendIcon(s.product.trend)),1),e("span",gu,o(n.getTrendText(s.product.trend)),1)],2),e("div",{class:H(["price-change",n.getChangeClass(s.product.changePercent)])},o(n.formatChange(s.product.changePercent))+"% ",3)])]),e("div",yu,[t[22]||(t[22]=e("h4",null,"价格历史",-1)),e("div",fu,[(v(!0),m(F,null,oe(n.priceHistory,(u,g)=>(v(),m("div",{key:g,class:"price-bar",style:Ce({height:`${n.getBarHeight(u)}%`,backgroundColor:n.getBarColor(u,s.product.currentPrice)}),title:`¥${n.formatNumber(u)}`},null,12,hu))),128))])])])]),e("div",_u,[e("div",bu,[e("button",{class:H(["tab-btn",{active:n.activeTab==="buy"}]),onClick:t[1]||(t[1]=u=>n.activeTab="buy")}," 买入 ",2),e("button",{class:H(["tab-btn",{active:n.activeTab==="sell"}]),onClick:t[2]||(t[2]=u=>n.activeTab="sell"),disabled:!n.canSell}," 卖出 ",10,$u)]),e("div",ku,[n.activeTab==="buy"?(v(),m("div",Su,[e("div",wu,[e("div",Cu,[t[23]||(t[23]=e("span",{class:"label"},"可用资金",-1)),e("span",Pu,"¥"+o(n.formatNumber(n.player.money)),1)]),e("div",Tu,[t[24]||(t[24]=e("span",{class:"label"},"可用空间",-1)),e("span",Mu,o(n.player.capacity-n.player.inventoryUsed),1)])]),e("div",Eu,[e("div",Iu,[B(e("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=u=>n.buyQuantity=u),min:1,max:n.maxBuyQuantity,disabled:n.maxBuyQuantity<=0,class:"quantity-slider"},null,8,Nu),[[ne,n.buyQuantity]]),e("div",Lu,[t[25]||(t[25]=e("span",null,"1",-1)),e("span",null,o(Math.floor(n.maxBuyQuantity/2)),1),e("span",null,o(n.maxBuyQuantity),1)])]),e("div",xu,[e("button",{onClick:t[4]||(t[4]=(...u)=>n.decrementBuyQuantity&&n.decrementBuyQuantity(...u)),disabled:n.buyQuantity<=1||n.maxBuyQuantity<=0},"-",8,Ru),B(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=u=>n.buyQuantity=u),min:1,max:n.maxBuyQuantity,disabled:n.maxBuyQuantity<=0},null,8,Au),[[ne,n.buyQuantity]]),e("button",{onClick:t[6]||(t[6]=(...u)=>n.incrementBuyQuantity&&n.incrementBuyQuantity(...u)),disabled:n.buyQuantity>=n.maxBuyQuantity||n.maxBuyQuantity<=0},"+",8,Ou)]),e("div",Du,[e("button",{onClick:t[7]||(t[7]=u=>n.setBuyQuantity(1)),disabled:n.maxBuyQuantity<1},"1",8,Vu),e("button",{onClick:t[8]||(t[8]=u=>n.setBuyQuantity(5)),disabled:n.maxBuyQuantity<5},"5",8,Gu),e("button",{onClick:t[9]||(t[9]=u=>n.setBuyQuantity(10)),disabled:n.maxBuyQuantity<10},"10",8,Hu),e("button",{onClick:t[10]||(t[10]=u=>n.setBuyQuantity(n.maxBuyQuantity)),disabled:n.maxBuyQuantity<=0},"最大",8,Wu)])]),e("div",Bu,[e("div",qu,[t[26]||(t[26]=e("span",{class:"label"},"数量",-1)),e("span",Uu,o(n.buyQuantity),1)]),e("div",Qu,[t[27]||(t[27]=e("span",{class:"label"},"单价",-1)),e("span",Fu,"¥"+o(n.formatNumber(s.product.currentPrice)),1)]),e("div",zu,[t[28]||(t[28]=e("span",{class:"label"},"总价",-1)),e("span",ju,"¥"+o(n.formatNumber(n.buyTotalCost)),1)])]),e("div",Ku,[e("button",{class:"action-btn buy-btn",onClick:t[11]||(t[11]=(...u)=>n.executeBuy&&n.executeBuy(...u)),disabled:!n.canBuy||n.buyQuantity<=0}," 确认买入 ",8,Yu)])])):T("",!0),n.activeTab==="sell"?(v(),m("div",Xu,[e("div",Ju,[e("div",Zu,[t[29]||(t[29]=e("span",{class:"label"},"持有数量",-1)),e("span",ec,o(n.ownedQuantity),1)]),e("div",tc,[t[30]||(t[30]=e("span",{class:"label"},"购买价格",-1)),e("span",sc,"¥"+o(n.formatNumber(n.ownedItem?n.ownedItem.purchasePrice:0)),1)])]),e("div",{class:H(["profit-preview",n.getProfitClass()])},[t[31]||(t[31]=e("span",{class:"label"},"预计盈亏",-1)),e("span",nc,o(n.getProfitText()),1)],2),e("div",oc,[e("div",ac,[B(e("input",{type:"range","onUpdate:modelValue":t[12]||(t[12]=u=>n.sellQuantity=u),min:1,max:n.ownedQuantity,disabled:!n.canSell,class:"quantity-slider"},null,8,lc),[[ne,n.sellQuantity]]),e("div",ic,[t[32]||(t[32]=e("span",null,"1",-1)),e("span",null,o(Math.floor(n.ownedQuantity/2)),1),e("span",null,o(n.ownedQuantity),1)])]),e("div",rc,[e("button",{onClick:t[13]||(t[13]=(...u)=>n.decrementSellQuantity&&n.decrementSellQuantity(...u)),disabled:n.sellQuantity<=1||!n.canSell},"-",8,uc),B(e("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=u=>n.sellQuantity=u),min:1,max:n.ownedQuantity,disabled:!n.canSell},null,8,cc),[[ne,n.sellQuantity]]),e("button",{onClick:t[15]||(t[15]=(...u)=>n.incrementSellQuantity&&n.incrementSellQuantity(...u)),disabled:n.sellQuantity>=n.ownedQuantity||!n.canSell},"+",8,dc)]),e("div",vc,[e("button",{onClick:t[16]||(t[16]=u=>n.setSellQuantity(1)),disabled:!n.canSell},"1",8,mc),e("button",{onClick:t[17]||(t[17]=u=>n.setSellQuantity(5)),disabled:n.ownedQuantity<5},"5",8,pc),e("button",{onClick:t[18]||(t[18]=u=>n.setSellQuantity(10)),disabled:n.ownedQuantity<10},"10",8,gc),e("button",{onClick:t[19]||(t[19]=u=>n.setSellQuantity(n.ownedQuantity)),disabled:!n.canSell},"全部",8,yc)])]),e("div",fc,[e("div",hc,[t[33]||(t[33]=e("span",{class:"label"},"数量",-1)),e("span",_c,o(n.sellQuantity),1)]),e("div",bc,[t[34]||(t[34]=e("span",{class:"label"},"单价",-1)),e("span",$c,"¥"+o(n.formatNumber(s.product.currentPrice)),1)]),e("div",kc,[t[35]||(t[35]=e("span",{class:"label"},"总收入",-1)),e("span",Sc,"¥"+o(n.formatNumber(n.sellTotalIncome)),1)])]),e("div",wc,[e("button",{class:"action-btn sell-btn",onClick:t[20]||(t[20]=(...u)=>n.executeSell&&n.executeSell(...u)),disabled:!n.canSell||n.sellQuantity<=0}," 确认卖出 ",8,Cc)])])):T("",!0)])])])}const Tc=ae(tu,[["render",Pc],["__scopeId","data-v-9aebc149"]]);const Mc={class:"inventory"},Ec={class:"title"},Ic={class:"inventory-container"},Nc={class:"inventory-table"},Lc={class:"price"},xc={class:"price"},Rc={class:"trend-icon"},Ac={class:"action-buttons"},Oc={class:"button-group"},Dc=["onClick"],Vc=["onClick"],Gc=["onClick","disabled"],Hc={key:0},Wc={colspan:"7",class:"no-items"},Bc={class:"toast-content"},qc={class:"toast-icon"},Uc={class:"toast-message"},Qc={__name:"Inventory",setup(l){Ee();const t=we();O(()=>t.player);const s=O(()=>t.player.inventory||[]);O(()=>t.currentLocation);const n=C(!1),r=C(null),i=C(null),u=C(1),g=C(!1),b=C(""),k=C(""),_=C("");O(()=>i.value?y(i.value)*u.value:0);const y=P=>P?t.getCurrentProductPrice(P.productId):0,M=P=>P?t.getProductPriceTrend(P.productId):J.STABLE,G=P=>{switch(M(P)){case J.RISING_STRONG:return"↑↑";case J.RISING:return"↑";case J.STABLE_HIGH:return"▲";case J.STABLE:return"→";case J.STABLE_LOW:return"▼";case J.FALLING:return"↓";case J.FALLING_STRONG:return"↓↓";case J.VOLATILE:return"↕";default:return"→"}},Q=P=>{switch(M(P)){case J.RISING_STRONG:return"trend-rising-strong";case J.RISING:return"trend-rising";case J.STABLE_HIGH:return"trend-stable-high";case J.STABLE:return"trend-stable";case J.STABLE_LOW:return"trend-stable-low";case J.FALLING:return"trend-falling";case J.FALLING_STRONG:return"trend-falling-strong";case J.VOLATILE:return"trend-volatile";default:return"trend-stable"}},N=P=>{const S=y(P);return S>P.purchasePrice?"price-up":S<P.purchasePrice?"price-down":""},L=P=>{const S=y(P);return S>P.purchasePrice?"profit profit-positive":S<P.purchasePrice?"profit profit-negative":"profit"},q=P=>{const p=y(P)-P.purchasePrice,c=p/P.purchasePrice*100;return p===0?"0%":`${p>0?"+":""}${c.toFixed(1)}%`},Z=P=>{const S={id:P.productId,name:P.name,currentPrice:y(P),trend:M(P),changePercent:h(P),category:P.category||"unknown"};r.value=S,n.value=!0},X=()=>{n.value=!1,r.value=null},x=P=>{if(X(),P.type==="sell"){let S=`已出售 ${P.quantity} 个 ${P.productName||P.productId}`;if(P.income&&(S+=`，获得 ${A(P.income)} 元`),P.profit){const p=P.profit>0?`，盈利 ${A(P.profit)}`:`，亏损 ${A(Math.abs(P.profit))}`;S+=p}b.value=S,k.value="sale-success",_.value="💰",g.value=!1,requestAnimationFrame(()=>{g.value=!0,setTimeout(()=>{g.value=!1},3e3)})}},h=P=>{const S=y(P),p=P.purchasePrice;return p===0?0:(S-p)/p*100},f=P=>{if(P.quantity>0){const S=t.sellProduct(P.productId,1);if(S.success){let p=`已出售 1 个 ${P.name}`;if(S.income&&(p+=`，获得 ${A(S.income)} 元`),S.profit){const c=S.profit>0?`，盈利 ${A(S.profit)}`:`，亏损 ${A(Math.abs(S.profit))}`;p+=c}b.value=p,k.value="sale-success",_.value="💰",g.value=!1,requestAnimationFrame(()=>{g.value=!0,setTimeout(()=>{g.value=!1},3e3)})}}},w=(P,S)=>{const p=Math.min(P.quantity,S);if(p>0){const c=t.sellProduct(P.productId,p);if(c.success){let a=`已出售 ${p} 个 ${P.name}`;if(c.income&&(a+=`，获得 ${A(c.income)} 元`),c.profit){const d=c.profit>0?`，盈利 ${A(c.profit)}`:`，亏损 ${A(Math.abs(c.profit))}`;a+=d}b.value=a,k.value="sale-success",_.value="💰",g.value=!1,requestAnimationFrame(()=>{g.value=!0,setTimeout(()=>{g.value=!1},3e3)})}}};return(P,S)=>(v(),m("div",Mc,[e("h2",Ec,o(P.$t("inventory.title")),1),e("div",Ic,[e("table",Nc,[e("thead",null,[e("tr",null,[e("th",null,o(P.$t("inventory.productName")),1),e("th",null,o(P.$t("inventory.quantity")),1),e("th",null,o(P.$t("inventory.purchasePrice")),1),e("th",null,o(P.$t("inventory.currentPrice")),1),e("th",null,o(P.$t("inventory.trend")),1),e("th",null,o(P.$t("inventory.profit")),1),e("th",null,o(P.$t("inventory.action")),1)])]),e("tbody",null,[(v(!0),m(F,null,oe(s.value,p=>(v(),m("tr",{key:p.productId},[e("td",null,o(p.name),1),e("td",null,o(p.quantity),1),e("td",Lc,"¥"+o(E(A)(p.purchasePrice)),1),e("td",xc,[e("span",{class:H(N(p))},"¥"+o(E(A)(y(p))),3)]),e("td",null,[e("div",{class:H(["trend-indicator",Q(p)])},[e("span",Rc,o(G(p)),1)],2)]),e("td",{class:H(L(p))},o(q(p)),3),e("td",null,[e("div",Ac,[e("div",Oc,[e("button",{class:"sell-btn",onClick:c=>Z(p)},o(P.$t("inventory.sell")),9,Dc),e("button",{class:"quick-sell-btn",onClick:c=>f(p),title:"快速卖出1个"}," -1 ",8,Vc),e("button",{class:"quick-sell-btn-10",onClick:c=>w(p,10),title:"快速卖出10个",disabled:p.quantity<10}," -10 ",8,Gc)])])])]))),128)),s.value.length===0?(v(),m("tr",Hc,[e("td",Wc,o(P.$t("inventory.empty")),1)])):T("",!0)])])]),n.value?(v(),m("div",{key:0,class:"modal-backdrop",onClick:ue(X,["self"])},[j(Tc,{product:r.value,onClose:X,onTransactionComplete:x},null,8,["product"])])):T("",!0),j(re,{name:"fade"},{default:ie(()=>[g.value?(v(),m("div",{key:0,class:H(["transaction-toast",k.value])},[e("div",Bc,[e("span",qc,o(_.value),1),e("span",Uc,o(b.value),1)]),S[0]||(S[0]=e("div",{class:"toast-progress-bar"},null,-1))],2)):T("",!0)]),_:1})]))}},Fc=ae(Qc,[["__scopeId","data-v-91f0d922"]]);const zc={class:"house-market"},jc={class:"title"},Kc={class:"houses-container"},Yc={class:"house-image"},Xc=["src"],Jc={key:0,class:"affordable-badge"},Zc={key:1,class:"purchased-badge"},ed={class:"house-info"},td={class:"house-description"},sd={class:"house-details"},nd={class:"detail-item"},od={class:"detail-label"},ad={class:"detail-value"},ld={class:"detail-item"},id={class:"detail-label"},rd={class:"detail-value"},ud={class:"house-actions"},cd=["disabled","onClick"],dd={class:"modal-content"},vd={class:"house-purchase-info"},md={class:"detail-item"},pd={class:"detail-label"},gd={class:"detail-value"},yd={class:"detail-item"},fd={class:"detail-label"},hd={class:"detail-value"},_d={class:"detail-item"},bd={class:"detail-label"},$d={class:"detail-value"},kd={class:"modal-actions"},Sd={__name:"HouseMarket",setup(l){const{t}=Ee(),s=fe(),n=xe(),r=Me(),{money:i}=fs(n),u=C([]);ce(()=>{const N=Gt();u.value=N.map(L=>{const Z={apartment:"small",second_hand:"medium",highend:"large",villa:"luxury",mansion:"mansion"}[L.id]||L.id;return{id:L.id,name:t(`houses.${Z}.name`),description:t(`houses.${Z}.description`),price:L.price,level:L.level,image:L.image}})});const g=C(!1),b=C(null),k=N=>{if(N&&N.image)return N.image.startsWith("./")?N.image.replace("./","/"):N.image.startsWith("/")?N.image:`/${N.image}`;const L="/resources/assets/images/house_1.jpeg";if(!N||!N.id)return L;try{const q=Ht(N.id);return q.startsWith("/")?q:`/${q}`}catch(q){return console.warn("获取房屋图片时出错:",q),L}},_=N=>n.money>=N.price,y=N=>n.purchasedHouses.some(L=>L.houseId===N),M=N=>{if(!_(N)){r.showToast({type:"error",message:t("market.houseMarket.notEnoughMoney",{price:A(N.price),money:A(n.money),shortfall:A(N.price-n.money)}),duration:5e3});return}b.value=N,g.value=!0},G=()=>{g.value=!1,b.value=null},Q=()=>{if(!b.value)return;if(n.money<b.value.price){r.showToast({type:"error",message:t("market.houseMarket.fundsChanged",{price:A(b.value.price),money:A(n.money),shortfall:A(b.value.price-n.money)}),duration:5e3}),G();return}if(b.value.price>n.money*.9&&!confirm(t("market.houseMarket.significantConfirm",{percent:Math.round(b.value.price/n.money*100)}))){G();return}if(n.purchaseHouse(b.value)){try{Je().triggerImportantActionAutoSave("housePurchase")}catch(L){ee(L,"HouseMarket (market)",se.UNKNOWN,te.WARNING),console.warn("购房后自动保存失败",L)}s.achieveVictoryWithHouse(b.value)}else r.showToast({type:"error",message:t("market.houseMarket.purchaseFailed"),duration:5e3});G()};return(N,L)=>{var q,Z,X;return v(),m("div",zc,[e("h2",jc,o(N.$t("market.houseMarket.title")),1),e("div",Kc,[(v(!0),m(F,null,oe(u.value,x=>(v(),m("div",{key:x.id,class:H(["house-card",{affordable:_(x)&&!y(x.id),purchased:y(x.id)}])},[e("div",Yc,[e("img",{src:k(x),alt:"房屋图片"},null,8,Xc),_(x)&&!y(x.id)?(v(),m("span",Jc,o(N.$t("market.houseMarket.affordable")),1)):T("",!0),y(x.id)?(v(),m("span",Zc,o(N.$t("market.houseMarket.purchased")),1)):T("",!0)]),e("div",ed,[e("h3",null,o(x.name),1),e("p",td,o(x.description),1),e("div",sd,[e("div",nd,[e("span",od,o(N.$t("market.houseMarket.price")),1),e("span",ad,"¥"+o(E(A)(x.price)),1)]),e("div",ld,[e("span",id,o(N.$t("market.houseMarket.level")),1),e("span",rd,o(x.level),1)])]),e("div",ud,[e("button",{disabled:!_(x)||y(x.id),class:"buy-btn",onClick:h=>M(x)},o(y(x.id)?N.$t("market.houseMarket.alreadyOwned"):N.$t("market.houseMarket.buyButton")),9,cd)])])],2))),128))]),g.value?(v(),m("div",{key:0,class:"modal-backdrop",onClick:ue(G,["self"])},[e("div",dd,[e("h3",null,o(N.$t("market.houseMarket.confirmTitle")),1),e("p",null,o(N.$t("market.houseMarket.confirmMessage",{house:(q=b.value)==null?void 0:q.name})),1),e("div",vd,[e("div",md,[e("span",pd,o(N.$t("market.houseMarket.price")),1),e("span",gd,"¥"+o(E(A)((Z=b.value)==null?void 0:Z.price)),1)]),e("div",yd,[e("span",fd,o(N.$t("market.houseMarket.yourMoney")),1),e("span",hd,"¥"+o(E(A)(E(i))),1)]),e("div",_d,[e("span",bd,o(N.$t("market.houseMarket.remaining")),1),e("span",$d,"¥"+o(E(A)(E(i)-(((X=b.value)==null?void 0:X.price)||0))),1)])]),e("div",kd,[e("button",{class:"btn cancel-btn",onClick:G},o(N.$t("common.cancel")),1),e("button",{class:"btn confirm-btn",onClick:Q},o(N.$t("common.confirm")),1)])])])):T("",!0)])}}},wd=ae(Sd,[["__scopeId","data-v-aca00268"]]);const Cd={class:"event-modal-container"},Pd={class:"event-header"},Td={class:"event-header-content"},Md={class:"event-title"},Ed={class:"event-icon"},Id={class:"event-content"},Nd={class:"event-description"},Ld={key:0,class:"event-image"},xd=["src","alt"],Rd={class:"event-options"},Ad={key:0,class:"event-result"},Od={class:"result-message"},Dd={key:0,class:"effect-results"},Vd={class:"effect-list"},Gd=["data-error"],Hd={key:0,class:"effect-icon"},Wd={key:1,class:"effect-icon"},Bd={key:2,class:"effect-icon"},qd={key:3,class:"effect-icon"},Ud={key:4,class:"effect-icon"},Qd={key:5,class:"effect-icon"},Fd={key:6,class:"effect-icon"},zd={class:"effect-description"},jd={class:"effect-description"},Kd={key:1,class:"event-option-list"},Yd=["onClick","disabled"],Xd={__name:"EventModal",setup(l,{expose:t}){const s=C(null),n=C(!1),r=C(null),i=C(null),u=C(!1),g=C([]),b=C([]);fe();const k=wt();ce(()=>{ye(()=>{console.log("EventModal - 组件挂载完成，模态框状态:",n.value)})});const _=h=>{if(!h)return null;if(h.startsWith("/assets/"))return h.replace(/^\/assets\//,"./resources/assets/");if(h.startsWith("/resources/"))return h.replace(/^\/resources\//,"./resources/");if(h.includes("/assets/images/")){const f=h.match(/\/assets\/images\/.*/);if(f)return`./resources${f[0]}`}return h},y=h=>{switch(h){case"market":return"📊";case"player":return"👤";case"house":return"🏠";case"random":return"🎲";case"news":return"📰";case"disaster":return"🌪️";case"opportunity":return"💼";default:return"📣"}},M=O(()=>{if(!s.value)return null;if(s.value.imageUrl)return console.log("EventModal - 从imageUrl属性获取图片:",s.value.imageUrl),_(s.value.imageUrl);const h=Object.values(s.value);return h.length>=9&&typeof h[8]=="string"&&h[8].includes("/assets/images/")?(console.log("EventModal - 从事件对象第9个参数获取图片:",h[8]),_(h[8])):null}),G=h=>({luck:"幸运",charisma:"魅力",intelligence:"智力",stamina:"体力",realEstateInsight:"房产市场洞察力",realEstateAdvice:"房产投资建议",housingInvestment:"房产投资",propertyValue:"房产价值",hasHouse:"拥有房产",businessSkill:"商业技能",creditRating:"信用评级",risk_tolerance:"风险承受能力",negotiation:"谈判能力"})[h]||h,Q=h=>{if(!h||!h.effect)return["未知市场变化"];const f=h.effect,w=[];let P="";if(f.duration){let S=f.duration;f.duration>52&&(S=Math.round(f.duration/(7*24*3600))),P=`，持续 ${S} 周`}if(f.globalPriceModifier){const S=Math.round((f.globalPriceModifier-1)*100);S>0?w.push(`全球价格上涨 ${S}%${P}`):S<0&&w.push(`全球价格下跌 ${Math.abs(S)}%${P}`)}if(f.categoryModifiers)for(const[S,p]of Object.entries(f.categoryModifiers)){const c=Math.round((p-1)*100);c>0?w.push(`${S}类别价格上涨 ${c}%${P}`):c<0&&w.push(`${S}类别价格下跌 ${Math.abs(c)}%${P}`)}if(f.locationModifiers)for(const[S,p]of Object.entries(f.locationModifiers)){const c=Math.round((p-1)*100),a=N(S);c>0?w.push(`${a}价格上涨 ${c}%${P}`):c<0&&w.push(`${a}价格下跌 ${Math.abs(c)}%${P}`)}if(f.locationProductModifiers)for(const[S,p]of Object.entries(f.locationProductModifiers)){const c=N(S);for(const[a,d]of Object.entries(p)){const $=Math.round((d-1)*100),D=L(a);$>0?w.push(`${c}的${D}价格上涨 ${$}%${P}`):$<0&&w.push(`${c}的${D}价格下跌 ${Math.abs($)}%${P}`)}}if(f.productModifiers){const S=Object.entries(f.productModifiers);for(const[p,c]of S){const a=Math.round((c-1)*100),d=L(p);a>0?w.push(`${d}价格上涨 ${a}%${P}`):a<0&&w.push(`${d}价格下跌 ${Math.abs(a)}%${P}`)}}return w.length===0&&w.push(`市场没有明显变化${P}`),w},N=h=>({commodity_market:"大宗商品市场",second_hand_market:"二手市场",premium_mall:"高端商场",electronics_hub:"电子产品中心",black_market:"黑市"})[h]||h,L=h=>{var p,c;console.log("EventModal - 获取产品名称:",h,"类型:",typeof h);const f=et();if(f.products&&f.products.length>0){const a=f.products.find(d=>d.id===h||d.id===Number(h)||String(d.id)===String(h));if(a)return console.log("EventModal - 从marketStore找到产品:",a.name),a.name}const w=String(h);if(w==="apartment")return"单身公寓";if(w==="second_hand")return"二手旧房";if(w==="highend")return"高档小区";if(w==="villa")return"现代别墅";if(w==="mansion")return"私人庄园";if(w.startsWith("house_"))return`${((p=w.split("_")[1])==null?void 0:p.toUpperCase())||""}型房产`;if(w.startsWith("land_"))return`${((c=w.split("_")[1])==null?void 0:c.toUpperCase())||""}类土地`;const S={phone:"手机",laptop:"笔记本电脑",smartwatch:"智能手表",tablet:"平板电脑",camera:"相机",tv:"电视",console:"游戏机",headphones:"耳机",speaker:"音箱",watch:"手表",jewelry:"珠宝",handbag:"手提包",painting:"画作",antique:"古董",collectible:"收藏品",gold:"黄金",silver:"白银",oil:"原油",wheat:"小麦",corn:"玉米",coffee:"咖啡",copper:"铜",steel:"钢铁",cotton:"棉花",rice:"大米",antique_painting:"古画",101:"卫生纸",102:"洗发水",103:"牙膏",104:"肥皂",105:"毛巾",106:"二手iPhone",107:"二手笔记本",108:"复古相机",109:"二手游戏机",110:"旧书籍",201:"鸡蛋",202:"大米",203:"食用油",204:"新鲜蔬菜",205:"水果",301:"手机",302:"电视",303:"笔记本电脑",304:"平板电脑",305:"智能手表",401:"名牌手表",402:"钻石项链",403:"设计师包包",404:"高级香水",405:"名牌服装",406:"高级红酒",501:"古董钟表",502:"邮票",503:"古画",504:"老式相机",505:"纪念币"}[w];return console.log(`EventModal - 产品名称查找结果: ${w} => ${S||"未找到"}`),S||`商品(${w})`},q=()=>{(!s.value.options||s.value.options.length===0)&&x()},Z=h=>{if(console.log("EventModal - 尝试显示事件:",h?h.id:"undefined"),!h){console.warn("EventModal - 没有传入事件对象，无法显示事件");return}try{console.log("EventModal - 显示事件:",h.id,h.title),console.log("EventModal - 事件详情:",{title:h.title,description:h.description,options:h.options?h.options.length:0,imageUrl:h.imageUrl,rawEvent:JSON.stringify(h)}),(!h.options||!Array.isArray(h.options)||h.options.length===0)&&(console.warn("EventModal - 事件没有选项，添加默认选项"),h.options=[{id:"default_option",text:"确认",result:"你确认了这个事件。",effects:{}}]),s.value=h,n.value=!0,r.value=null,i.value&&(i.value=null),u.value&&(u.value=!1),b.value=[],h.id&&!g.value.includes(h.id)&&g.value.push(h.id),He.emit("event:shown",{eventId:h.id}),console.log("EventModal - 事件模态框已显示"),console.log("EventModal - 模态框状态:",{showModal:n.value,currentEvent:s.value?s.value.id:null,hasOptions:s.value&&s.value.options?s.value.options.length:0})}catch(f){console.error("EventModal - 显示事件时出错:",f)}},X=h=>{var f;if(console.log("EventModal - 选择选项:",h),!u.value){u.value=!0;try{if(r.value=h,i.value=h.result||"你做出了选择。",b.value=[],k&&typeof k.handleEventOption=="function"){console.log("EventModal - 调用事件操作模块处理选项");const w=k.handleEventOption(h);if(console.log("EventModal - 选项处理结果:",w),w){const P=[];if(w.appliedEffects){const c=w.appliedEffects.filter(D=>D.type!=="next_event"&&D.type!=="location_change"),a=c.filter(D=>D.type==="money"),d=c.filter(D=>D.type==="item_add"||D.type==="item_remove"),$=c.filter(D=>D.type!=="money"&&D.type!=="item_add"&&D.type!=="item_remove");P.push(...a,...d,...$)}w.failedEffects&&w.failedEffects.forEach(c=>{c.type==="item_remove"&&c.reason==="insufficient_items"?P.push({type:"info",description:`你没有足够的商品(${L(c.productId)})可出售`,isError:!0}):c.type==="item_remove"&&c.reason==="product_not_found"?P.push({type:"info",description:`你当前没有${L(c.productId)}可出售`,isError:!0}):c.type==="item_remove"&&c.reason==="category_not_found"&&P.push({type:"info",description:"你当前没有此类商品可出售",isError:!0})}),b.value=P,console.log("EventModal - 应用的效果:",b.value);const S=[],p=new Set;if(b.value.forEach(c=>{if(c.type==="market"){const a=JSON.stringify(c.effect);p.has(a)||(p.add(a),S.push(c))}else c.type==="info"&&c.isError?S.push(c):p.has(c.type)||(p.add(c.type),S.push(c))}),b.value=S,b.value.length===0){let c="选项已生效";const a=s.value.title||"";a.includes("市场")||a.includes("价格")||a.includes("商品")?c="你将在市场中看到价格变化":a.includes("投资")||a.includes("理财")?c="你的投资决策已记录，结果将在后续显现":(a.includes("对话")||a.includes("交流")||a.includes("顾问"))&&(c="这次交流增加了你的见识和人脉"),b.value=[{type:"info",description:c}]}else b.value=b.value.map(c=>c.type==="info"&&!c.description?{...c,description:"选项已成功执行"}:typeof c.description=="object"?{...c,description:"选项效果已应用"}:c)}else{const P=s.value.title||"";let S="选项已执行，效果将逐渐显现";P.includes("市场")||P.includes("价格")?S="你的决策将影响后续市场行情":P.includes("投资")&&(S="你的投资已完成，回报将在未来显现"),b.value=[{type:"info",description:S}]}}else console.warn("EventModal - 事件操作模块不可用，无法处理选项效果"),b.value=[{type:"info",description:"选项已执行，但系统无法显示具体效果"}];He.emit("event:option_selected",{eventId:(f=s.value)==null?void 0:f.id,optionId:h.id||h.text}),setTimeout(()=>{u.value=!1},1e3)}catch(w){console.error("EventModal - 处理选项时出错:",w),u.value=!1,i.value="处理选项时出错，请稍后再试。",b.value=[{type:"error",description:"处理选项时出错: "+(w.message||"未知错误")}]}}},x=()=>{n.value=!1,s.value={}};return t({showEvent:Z,hideModal:x}),(h,f)=>{var w,P,S,p,c;return B((v(),m("div",Cd,[e("div",{class:"event-modal-overlay",onClick:ue(q,["self"])},[e("div",{class:H(["event-modal",{"with-result":i.value}])},[e("div",Pd,[e("div",Td,[e("h2",Md,o(((w=s.value)==null?void 0:w.title)||"事件"),1),e("div",Ed,o(y((P=s.value)==null?void 0:P.type)),1)])]),e("div",Id,[e("p",Nd,o((S=s.value)==null?void 0:S.description),1),M.value?(v(),m("div",Ld,[e("img",{src:M.value,alt:(p=s.value)==null?void 0:p.title},null,8,xd)])):T("",!0)]),e("div",Rd,[i.value?(v(),m("div",Ad,[e("div",Od,[f[0]||(f[0]=e("div",{class:"result-icon"},"✓",-1)),e("p",null,o(i.value),1)]),b.value.length>0?(v(),m("div",Dd,[f[3]||(f[3]=e("h3",null,"效果变化",-1)),e("div",Vd,[(v(!0),m(F,null,oe(b.value.filter(a=>a.type!=="market"),(a,d)=>(v(),m("div",{key:`normal-${d}`,class:H(["effect-item",a.type]),"data-error":a.isError},[a.type==="money"?(v(),m("span",Hd,o(a.value>0?"💰":"💸"),1)):a.type==="debt"?(v(),m("span",Wd,o(a.value<0?"📉":"📈"),1)):a.type==="capacity"?(v(),m("span",Bd,"🎒")):a.type==="item_add"?(v(),m("span",qd,"📦")):a.type==="item_remove"?(v(),m("span",Ud,"🗑️")):a.type==="info"?(v(),m("span",Qd,"ℹ️")):(v(),m("span",Fd,"🔄")),e("span",zd,[a.type==="money"?(v(),m(F,{key:0},[a.isPercentage?(v(),m(F,{key:0},[W(o(a.value>0?"获得金钱: ":"支出金钱: ")+o(Math.abs(a.value))+"元 ("+o(a.percentage)+"%) ",1)],64)):(v(),m(F,{key:1},[W(o(a.value>0?"获得金钱: ":"支出金钱: ")+o(Math.abs(a.value))+"元 ",1)],64))],64)):a.type==="debt"?(v(),m(F,{key:1},[a.isPercentage?(v(),m(F,{key:0},[W(o(a.value>0?"增加债务: ":"减少债务: ")+o(Math.abs(a.value))+"元 ("+o(a.percentage)+"%) ",1)],64)):(v(),m(F,{key:1},[W(o(a.value>0?"增加债务: ":"减少债务: ")+o(Math.abs(a.value))+"元 ",1)],64))],64)):a.type==="capacity"?(v(),m(F,{key:2},[W(" 背包容量增加: "+o(a.value),1)],64)):a.type==="item_add"?(v(),m(F,{key:3},[W(" 获得物品: "+o(L(a.productId)||`商品#${a.productId}`)+" x "+o(a.quantity),1)],64)):a.type==="item_remove"?(v(),m(F,{key:4},[W(" 失去物品: "+o(L(a.productId)||`商品#${a.productId}`)+" x "+o(a.quantity),1)],64)):a.type==="attribute"?(v(),m(F,{key:5},[a.attribute==="realEstateAdvice"?(v(),m(F,{key:0},[f[1]||(f[1]=e("div",null,"房产市场建议:",-1)),(v(!0),m(F,null,oe(a.newValue,($,D)=>(v(),m("div",{key:D,style:{"margin-left":"10px"}},o(L(D))+": "+o($),1))),128))],64)):(v(),m(F,{key:1},[W(o(G(a.attribute))+": "+o(a.oldValue)+" → "+o(a.newValue),1)],64))],64)):a.type==="info"?(v(),m(F,{key:6},[W(o(a.description||"信息"),1)],64)):(v(),m(F,{key:7},[W(o(a.description||a.type),1)],64))])],10,Gd))),128)),(v(!0),m(F,null,oe(b.value.filter(a=>a.type==="market"),(a,d)=>(v(),m(F,{key:`market-${d}`},[(v(!0),m(F,null,oe(Q(a),($,D)=>(v(),m("div",{key:`market-${d}-${D}`,class:"effect-item market"},[f[2]||(f[2]=e("span",{class:"effect-icon"},"📊",-1)),e("span",jd,o($),1)]))),128))],64))),128))])])):T("",!0),e("button",{class:"event-confirm-button",onClick:x},"确定")])):(c=s.value)!=null&&c.options?(v(),m("div",Kd,[(v(!0),m(F,null,oe(s.value.options,a=>(v(),m("button",{key:a.id,class:"event-option-button",onClick:d=>X(a),disabled:u.value},o(a.text),9,Yd))),128))])):T("",!0)])],2)])],512)),[[ut,n.value]])}}},Jd=ae(Xd,[["__scopeId","data-v-44f7d3c7"]]);const Zd={name:"GameOverView",props:{gameState:{type:Object,required:!0},player:{type:Object,required:!0},gameStats:{type:Object,required:!0}},data(){return{showDetailedView:!1,achievements:[]}},computed:{canContinueGame(){const l=this.gameStats.endReason==="houseVictory",t=this.gameStats.canContinue===!0,s=this.player.purchasedHouses&&this.player.purchasedHouses.length>0;return console.log("GameOverView - 继续游戏条件检查:",{isHouseVictory:l,hasCanContinueFlag:t,hasPurchasedHouse:s,endReason:this.gameStats.endReason,playerHouses:this.player.purchasedHouses}),(s||t||l)&&this.gameStats.endReason!=="bankruptcy"},resultClass(){const l=this.gameStats.endReason;return l==="victory"||l==="houseVictory"?"result-house-victory":l==="victoryTimeLimit"?"result-game-complete":l==="bankruptcy"?"result-bankruptcy":l==="timeLimit"?"result-time-expired":"result-neutral"},isVictory(){const l=this.gameStats.endReason;return l==="victory"||l==="achievement"||l==="victoryTimeLimit"||l==="victoryOther"||l==="houseVictory"},isBankruptcy(){return this.gameStats.endReason==="bankruptcy"},hasAchievements(){return this.achievements&&this.achievements.length>0},getGameOverTitle(){var r,i,u,g;const l=this.gameStats.endReason;let t="";const s=((r=this.player.purchasedHouses)==null?void 0:r.length)||0,n=((i=this.gameStats.purchasedHouse)==null?void 0:i.name)||((g=(u=this.player.purchasedHouses)==null?void 0:u[0])==null?void 0:g.name)||"房产";switch(s>1?t=`🏆 购置${s}套房产！`:t=`🎉 恭喜购得${n}！`,l){case"houseVictory":case"victory":return t;case"victoryTimeLimit":return"🏆 完美通关！事业有成！";case"timeLimit":return"⌛ 时间已到，未能实现购房梦";case"bankruptcy":return"💸 破产清算，游戏结束";case"playerChoice":return"你选择了结束游戏";default:return"游戏结束"}},getResultDescription(){var g,b,k,_,y;const l=this.gameStats.endReason,t=(g=this.gameStats.data)==null?void 0:g.firstVictoryWeek,s=Math.min(this.gameStats.weeksPassed||0,this.gameState.maxWeeks),n=this.formatNumber(this.gameStats.finalAssets||0),r=((b=this.gameStats.tradeStats)==null?void 0:b.totalTrades)||0,i=this.formatNumber(Math.abs(((k=this.gameStats.tradeStats)==null?void 0:k.totalProfit)||0)),u=(((_=this.gameStats.tradeStats)==null?void 0:_.totalProfit)||0)>=0?"盈利":"亏损";switch(l){case"victory":case"houseVictory":return`恭喜你在第 ${s} 周成功实现购房梦想！
通过 ${r} 次交易，总计${u} ¥${i}。`;case"victoryTimeLimit":return`你用 ${t} 周买到了心仪的房子，并继续奋斗到第 ${s} 周！
最终资产达到 ¥${n}，完美诠释了"赢家通吃"！`;case"timeLimit":return`游戏结束，你在52周内累积了 ¥${n} 的资产。
通过 ${r} 次交易，总计${u} ¥${i}。继续努力，下次一定能实现购房梦！`;case"bankruptcy":return`很遗憾，由于无力偿还 ¥${this.formatNumber(((y=this.gameStats.data)==null?void 0:y.debt)||0)} 的债务导致破产。
通过 ${r} 次交易，总计${u} ¥${i}。吸取教训，东山再起！`;case"playerChoice":return`你在第 ${this.gameStats.weeksPassed||0} 周选择结束游戏，最终资产达到 ¥${this.formatNumber(this.gameStats.finalAssets||0)}。`;default:return"游戏结束了，感谢你的游玩！"}},getBestHouse(){return!this.player.purchasedHouses||this.player.purchasedHouses.length===0?{}:this.player.purchasedHouses.reduce((l,t)=>t.level>l.level||t.level===l.level&&t.price>l.price?t:l,this.player.purchasedHouses[0])},getMostExpensiveHouse(){return!this.player.purchasedHouses||this.player.purchasedHouses.length===0?{}:this.player.purchasedHouses.reduce((l,t)=>t.price>l.price?t:l,this.player.purchasedHouses[0])},getVictoryBadgeText(){return this.player.purchasedHouses&&this.player.purchasedHouses.length>0?this.player.purchasedHouses.length>1?"豪华置业":"安家置业":"游戏通关!"},getVictoryDescription(){const l=this.player.purchasedHouses&&this.player.purchasedHouses.length>0?this.player.purchasedHouses[0]:null;if(!l)return`在${this.gameState.maxWeeks}周游戏中，您成功通关!`;const t=l.purchaseWeek||this.gameStats.week,s=this.player.purchasedHouses.length;return s>1?`在${this.gameState.maxWeeks}周游戏中，您共购买了${s}套房产，首套房产仅用了${t}周就购得!`:`在${this.gameState.maxWeeks}周游戏中，您仅用了${t}周就完成了购房目标!`},getScoreRank(){return this.gameStats.score?this.gameStats.score.rank?this.gameStats.score.rank:this.gameStats.score.score>=1e6?"S":this.gameStats.score.score>=8e5?"A":this.gameStats.score.score>=6e5?"B":this.gameStats.score.score>=4e5?"C":"D":"D"},getFinalScore(){return this.gameStats.score?this.gameStats.score.score?this.gameStats.score.score:this.gameStats.finalAssets?this.gameStats.finalAssets:0:0}},mounted(){this.loadAchievements(),this.$nextTick(()=>{this.animateScoreElements()}),console.log("GameOverView mounted - 原始游戏统计数据对象:",this.gameStats),console.log("GameOverView mounted - 游戏得分数据:",{score:this.gameStats.score,scoreDetails:this.gameStats.scoreDetails,endReason:this.gameStats.endReason,finalAssets:this.gameStats.finalAssets,reason:this.gameStats.reason}),this.gameStats.score!==void 0&&console.log("得分格式检查:",{scoreType:typeof this.gameStats.score,isNumber:!isNaN(this.gameStats.score),stringValue:String(this.gameStats.score)}),setTimeout(()=>{this.updateScoreDisplay()},100)},methods:{updateScoreDisplay(){if(console.log("强制刷新得分显示..."),this.getFinalScore===0&&this.gameStats.finalAssets>0){console.log("检测到得分为0但有净资产，尝试计算默认得分");const l=Math.floor(this.gameStats.finalAssets/500);this.$set(this.gameStats,"score",{score:l,rank:this.calculateScoreRank(l),details:{assetsScore:Math.floor(this.gameStats.finalAssets/800),timeScore:0,houseScore:0,tradeScore:0,bankScore:0,totalScore:l}})}this.$forceUpdate()},calculateScoreRank(l){return l>=1e6?"S":l>=8e5?"A":l>=6e5?"B":l>=4e5?"C":(l>=2e5,"D")},formatNumber(l){return A(l)},getHouseImage(l){if(!l)return"/resources/assets/images/house_1.jpeg";if(console.log("正在获取房产图片:",l),l.id||l.houseId){const t=l.id||l.houseId,s={apartment:"/resources/assets/images/house_1.jpeg",second_hand:"/resources/assets/images/house_2.jpeg",highend:"/resources/assets/images/house_3.jpeg",villa:"/resources/assets/images/house_4.jpeg",mansion:"/resources/assets/images/house_5.jpeg"};if(s[t])return s[t];const n=parseInt(t);return`/resources/assets/images/house_${isNaN(n)?1:n%5||1}.jpeg`}return l.imageUrl?l.imageUrl:l.image?l.image.startsWith("./")?l.image.replace("./","/"):l.image.startsWith("/")?l.image.includes("NaN")?"/resources/assets/images/house_1.jpeg":l.image:`/${l.image}`:"/resources/assets/images/house_1.jpeg"},returnToMainMenu(){this.$emit("return-to-main")},restartGame(){this.$emit("restart-game")},continueGame(){console.log("GameOverView - 继续游戏按钮被点击");try{const l=fe();if(console.log("GameOverView - 获取到gameStore:",!!l),!l){console.error("GameOverView - 无法获取gameStore");return}l.gameOver=!1,l.victoryAchieved=!0,typeof l.continueGame=="function"?(l.continueGame(),console.log("GameOverView - 成功调用continueGame方法")):console.error("GameOverView - continueGame方法不存在");try{const t=Me();t&&t.showToast&&t.showToast({type:"success",message:"您选择继续游戏！您可以继续赚钱并购买更多房产，直到第52周游戏结束。",duration:5e3})}catch(t){console.warn("显示继续游戏提示失败",t)}this.$emit("continue-game"),console.log("GameOverView - 已发送continue-game事件")}catch(l){console.error("GameOverView - 继续游戏失败:",l)}},loadAchievements(){var n;this.achievements=[];const l=this.gameStats.endReason,t=this.gameStats.weeksPassed,s=((n=this.gameStats.data)==null?void 0:n.firstVictoryWeek)||t;this.isVictory&&(this.achievements.push({name:"安家梦想",description:"成功购买豪宅"}),s<30?this.achievements.push({name:"房产投资大师",description:"在30周内购买豪宅"}):s<40&&this.achievements.push({name:"高效购房",description:"在40周内购买豪宅"}),l==="victoryTimeLimit"&&(this.achievements.push({name:"坚持不懈",description:"在购买豪宅后继续游戏到最后一周"}),this.gameStats.finalAssets>2e6&&this.achievements.push({name:"财富帝国",description:"最终资产超过200万"}))),l==="achievement"&&this.achievements.push({name:"百万富翁",description:"资产超过100万"}),this.gameStats.tradeStats&&this.gameStats.tradeStats.totalProfit>5e5&&this.achievements.push({name:"交易大师",description:"总交易利润超过50万"}),this.gameStats.tradeStats&&this.gameStats.tradeStats.totalTrades>100&&this.achievements.push({name:"频繁交易者",description:"交易次数超过100次"}),this.player.purchasedHouses&&this.player.purchasedHouses.length>0&&(this.achievements.push({name:"房产投资专家",description:"成功购买至少一套房产"}),this.player.purchasedHouses.length>1&&this.achievements.push({name:"豪华置业",description:"成功购买多套房产"}),this.player.purchasedHouses.length>5&&this.achievements.push({name:"房产大亨",description:"成功购买超过5套房产"}),this.player.purchasedHouses.length>10&&this.achievements.push({name:"房产巨富",description:"成功购买超过10套房产"})),l==="bankruptcy"&&this.achievements.push({name:"东山再起",description:"经历破产是成功的第一步"}),this.achievements.length===0&&this.achievements.push({name:"初次尝试",description:"完成一次游戏"})},animateScoreElements(){document.querySelectorAll(".stat-item:not(.core-stats .stat-item), .achievement-item").forEach((s,n)=>{setTimeout(()=>{s.classList.add("animate-in")},n*100)});const t=document.querySelector(".rank-animation");t&&t.classList.add("animate")}}},ev={class:"game-over-container"},tv={class:"header-section"},sv={class:"subtitle"},nv={class:"result-summary"},ov={class:"rank-display"},av={class:"rank-value"},lv={class:"score-display"},iv={class:"score-value"},rv={class:"core-stats"},uv={class:"stat-item"},cv={class:"stat-value"},dv={class:"stat-item"},vv={class:"stat-value"},mv={class:"stat-item"},pv={class:"stat-value"},gv={key:0,class:"house-info"},yv={class:"house-details"},fv={class:"house-image-container"},hv=["src"],_v={class:"house-text"},bv={class:"house-name"},$v={class:"best-house-badge"},kv={class:"house-price"},Sv={class:"house-week"},wv={key:0,class:"all-houses-container"},Cv={class:"houses-grid"},Pv={class:"mini-house-image"},Tv=["src"],Mv={class:"mini-house-info"},Ev={class:"mini-house-name"},Iv={class:"mini-house-price"},Nv={class:"mini-house-week"},Lv={key:1,class:"house-info"},xv={class:"house-details"},Rv={class:"house-image-container"},Av=["src"],Ov={class:"house-text"},Dv={class:"house-name"},Vv={class:"house-price"},Gv={class:"house-week"},Hv={key:2,class:"statistics-section"},Wv={class:"statistics-grid"},Bv={class:"stat-item"},qv={class:"stat-content"},Uv={class:"stat-value"},Qv={class:"stat-item"},Fv={class:"stat-content"},zv={key:3,class:"score-details-section"},jv={class:"score-details-grid"},Kv={class:"stat-item"},Yv={class:"stat-content"},Xv={class:"stat-value"},Jv={class:"stat-item"},Zv={class:"stat-content"},em={class:"stat-value"},tm={key:0,class:"stat-bonus"},sm={class:"stat-item"},nm={class:"stat-content"},om={class:"stat-value"},am={class:"stat-item"},lm={class:"stat-content"},im={class:"stat-value"},rm={class:"stat-item"},um={class:"stat-content"},cm={class:"stat-value"},dm={key:4,class:"achievements-section"},vm={class:"achievements-grid"},mm={class:"achievement-content"},pm={class:"achievement-name"},gm={class:"achievement-desc"},ym={class:"actions"};function fm(l,t,s,n,r,i){var u,g,b,k,_,y,M,G,Q,N;return v(),m("div",{class:H(["game-over-view",i.resultClass])},[e("div",ev,[e("div",tv,[e("h1",{class:H(["title",{victory:i.isVictory,failure:i.isBankruptcy}])},o(i.getGameOverTitle),3),e("p",sv,o(i.getResultDescription),1)]),e("div",nv,[e("div",ov,[e("div",{class:H(["rank-animation","rank-"+(i.getScoreRank||"D")])},[e("span",av,o(i.getScoreRank||"D"),1)],2),e("div",lv,[t[3]||(t[3]=e("div",{class:"score-label"},"最终得分",-1)),e("div",iv,o(i.formatNumber(i.getFinalScore||0)),1)])]),e("div",rv,[e("div",uv,[t[4]||(t[4]=e("div",{class:"stat-label"},"游戏周数",-1)),e("div",cv,o(Math.min(s.gameStats.weeksPassed||0,s.gameState.maxWeeks))+" / "+o(s.gameState.maxWeeks),1)]),e("div",dv,[t[5]||(t[5]=e("div",{class:"stat-label"},"最终资金",-1)),e("div",vv,"¥"+o(i.formatNumber(s.gameStats.finalMoney||0)),1)]),e("div",mv,[t[6]||(t[6]=e("div",{class:"stat-label"},"净资产",-1)),e("div",pv,"¥"+o(i.formatNumber(s.gameStats.finalAssets||0)),1)])])]),s.player.purchasedHouses&&s.player.purchasedHouses.length>0?(v(),m("div",gv,[e("h2",null,"已购房产 ("+o(s.player.purchasedHouses.length)+"套)",1),e("div",yv,[e("div",fv,[e("img",{src:i.getHouseImage(i.getBestHouse),alt:"房屋图片",class:"house-image"},null,8,hv)]),e("div",_v,[e("h3",bv,[W(o(i.getBestHouse.name)+" ",1),e("span",$v,o(i.getBestHouse===i.getMostExpensiveHouse?"最贵房产":"最高级房产"),1)]),e("p",kv,"价格: ¥"+o(i.formatNumber(i.getBestHouse.purchasePrice||i.getBestHouse.price)),1),e("p",Sv,"购买时间: 第 "+o(i.getBestHouse.purchaseWeek||s.gameStats.week)+" 周",1)])]),s.player.purchasedHouses.length>1?(v(),m("div",wv,[t[7]||(t[7]=e("h3",null,"全部房产",-1)),e("div",Cv,[(v(!0),m(F,null,oe(s.player.purchasedHouses,L=>(v(),m("div",{key:L.houseId,class:"mini-house-card"},[e("div",Pv,[e("img",{src:i.getHouseImage(L),alt:"房屋图片"},null,8,Tv)]),e("div",Mv,[e("div",Ev,o(L.name),1),e("div",Iv,"¥"+o(i.formatNumber(L.purchasePrice)),1),e("div",Nv,"第"+o(L.purchaseWeek)+"周",1)])]))),128))])])):T("",!0)])):s.gameStats.purchasedHouse||s.gameStats.data&&s.gameStats.data.house?(v(),m("div",Lv,[e("div",xv,[e("div",Rv,[e("img",{src:i.getHouseImage(s.gameStats.purchasedHouse||s.gameStats.data.house),alt:"房屋图片",class:"house-image"},null,8,Av)]),e("div",Ov,[e("h3",Dv,o((s.gameStats.purchasedHouse||s.gameStats.data.house).name),1),e("p",Vv,"价格: ¥"+o(i.formatNumber((s.gameStats.purchasedHouse||s.gameStats.data.house).price)),1),e("p",Gv,"购买时间: 第 "+o(s.gameStats.week)+" 周",1)])])])):T("",!0),s.gameStats.tradeStats?(v(),m("div",Hv,[t[12]||(t[12]=e("h2",null,"交易统计",-1)),e("div",Wv,[e("div",Bv,[t[9]||(t[9]=e("div",{class:"stat-icon"},"📊",-1)),e("div",qv,[t[8]||(t[8]=e("div",{class:"stat-label"},"交易笔数",-1)),e("div",Uv,o(((u=s.gameStats.tradeStats)==null?void 0:u.totalTrades)||0)+"次",1)])]),e("div",Qv,[t[11]||(t[11]=e("div",{class:"stat-icon"},"📈",-1)),e("div",Fv,[t[10]||(t[10]=e("div",{class:"stat-label"},"总交易利润",-1)),e("div",{class:H(["stat-value",{positive:(((g=s.gameStats.tradeStats)==null?void 0:g.totalProfit)||0)>0,negative:(((b=s.gameStats.tradeStats)==null?void 0:b.totalProfit)||0)<0}])},o((((k=s.gameStats.tradeStats)==null?void 0:k.totalProfit)||0)>0?"+":"")+"¥"+o(i.formatNumber(((_=s.gameStats.tradeStats)==null?void 0:_.totalProfit)||0)),3)])])])])):T("",!0),s.gameStats.scoreDetails?(v(),m("div",zv,[t[23]||(t[23]=e("h2",null,"得分明细",-1)),e("div",jv,[e("div",Kv,[t[14]||(t[14]=e("div",{class:"stat-icon"},"💰",-1)),e("div",Yv,[t[13]||(t[13]=e("div",{class:"stat-label"},"资产得分",-1)),e("div",Xv,o(i.formatNumber(((y=s.gameStats.scoreDetails)==null?void 0:y.assetsScore)||0)),1)])]),e("div",Jv,[t[16]||(t[16]=e("div",{class:"stat-icon"},"🏡",-1)),e("div",Zv,[t[15]||(t[15]=e("div",{class:"stat-label"},"房产得分",-1)),e("div",em,o(i.formatNumber(((M=s.gameStats.scoreDetails)==null?void 0:M.houseScore)||0)),1),s.player.purchasedHouses&&s.player.purchasedHouses.length>1?(v(),m("div",tm," 含"+o(s.player.purchasedHouses.length)+"套房产加成 ",1)):T("",!0)])]),e("div",sm,[t[18]||(t[18]=e("div",{class:"stat-icon"},"⏱️",-1)),e("div",nm,[t[17]||(t[17]=e("div",{class:"stat-label"},"时间效率",-1)),e("div",om,o(i.formatNumber(((G=s.gameStats.scoreDetails)==null?void 0:G.timeScore)||0)),1)])]),e("div",am,[t[20]||(t[20]=e("div",{class:"stat-icon"},"🔄",-1)),e("div",lm,[t[19]||(t[19]=e("div",{class:"stat-label"},"交易得分",-1)),e("div",im,o(i.formatNumber(((Q=s.gameStats.scoreDetails)==null?void 0:Q.tradeScore)||0)),1)])]),e("div",rm,[t[22]||(t[22]=e("div",{class:"stat-icon"},"🏦",-1)),e("div",um,[t[21]||(t[21]=e("div",{class:"stat-label"},"银行管理",-1)),e("div",cm,o(i.formatNumber(((N=s.gameStats.scoreDetails)==null?void 0:N.bankScore)||0)),1)])])])])):T("",!0),i.hasAchievements?(v(),m("div",dm,[t[25]||(t[25]=e("h2",null,"解锁成就",-1)),e("div",vm,[(v(!0),m(F,null,oe(r.achievements,(L,q)=>(v(),m("div",{key:q,class:"achievement-item"},[t[24]||(t[24]=e("div",{class:"achievement-icon"},"🏆",-1)),e("div",mm,[e("div",pm,o(L.name),1),e("div",gm,o(L.description),1)])]))),128))])])):T("",!0),e("div",ym,[i.canContinueGame?(v(),m("button",{key:0,onClick:t[0]||(t[0]=(...L)=>i.continueGame&&i.continueGame(...L)),class:"btn btn-primary"},t[26]||(t[26]=[e("span",{class:"btn-icon"},"🎮",-1),e("span",{class:"btn-text"},"继续游戏",-1)]))):T("",!0),e("button",{onClick:t[1]||(t[1]=(...L)=>i.restartGame&&i.restartGame(...L)),class:"btn btn-success"},t[27]||(t[27]=[e("span",{class:"btn-icon"},"🔄",-1),e("span",{class:"btn-text"},"重新开始",-1)])),e("button",{onClick:t[2]||(t[2]=(...L)=>i.returnToMainMenu&&i.returnToMainMenu(...L)),class:"btn btn-primary"},t[28]||(t[28]=[e("span",{class:"btn-icon"},"🏠",-1),e("span",{class:"btn-text"},"返回主菜单",-1)]))])])],2)}const It=ae(Zd,[["render",fm],["__scopeId","data-v-323b5f05"]]);const hm={name:"TutorialSystem",props:{currentWeek:{type:Number,required:!0},currentLocation:{type:Object,required:!0},activeTab:{type:String,required:!0}},setup(l){fe();const{t}=Ee(),s=C(!1),n=C(0),r=C(!1),i=C(!1),u=C(!1),g=C("basics"),b=[{id:"basics",name:t("tutorial.help.basics")},{id:"trading",name:t("tutorial.help.trading")},{id:"events",name:t("tutorial.help.events")},{id:"settings",name:t("tutorial.help.settings")}],k=[{id:"welcome",title:t("tutorial.tips.welcome.title"),content:t("tutorial.tips.welcome.content"),trigger:{week:1,location:null,tab:null,onlyOnce:!0},seen:!1},{id:"market_intro",title:t("tutorial.tips.market_intro.title"),content:t("tutorial.tips.market_intro.content"),trigger:{week:1,location:null,tab:"market"},seen:!1},{id:"inventory_intro",title:t("tutorial.tips.inventory_intro.title"),content:t("tutorial.tips.inventory_intro.content"),trigger:{week:1,location:null,tab:"inventory"},seen:!1}],_=O(()=>k.filter(x=>{const h=!x.trigger.week||l.currentWeek>=x.trigger.week,f=!x.trigger.location||l.currentLocation&&l.currentLocation.id===x.trigger.location,w=!x.trigger.tab||l.activeTab===x.trigger.tab;return x.trigger.onlyOnce&&x.id==="welcome"&&(k.some(p=>p.seen)||localStorage.getItem("welcome_tutorial_shown"))?!1:h&&f&&w&&!x.seen})),y=O(()=>_.value[n.value]||null);function M(){i.value||_.value.length>0&&!s.value&&(s.value=!0,n.value=0,r.value=!1)}ve(()=>l.currentWeek,M),ve(()=>l.activeTab,M),ve(()=>l.currentLocation,(x,h)=>{k.filter(w=>w.id!=="welcome"&&!w.seen&&(!w.trigger.tab||w.trigger.tab===l.activeTab)&&(!w.trigger.location||w.trigger.location===(x==null?void 0:x.id))).length>0&&M()},{deep:!0});function G(){n.value<_.value.length-1&&n.value++}function Q(){n.value>0&&n.value--}function N(){if(y.value){const x=k.findIndex(h=>h.id===y.value.id);x!==-1&&(k[x].seen=!0,k[x].id==="welcome"&&localStorage.setItem("welcome_tutorial_shown","true")),n.value<_.value.length-1?n.value++:s.value=!1}}function L(){s.value=!1}function q(){r.value=!r.value}function Z(){u.value=!u.value}function X(){u.value=!1}return ce(()=>{M()}),{showTutorialTip:s,currentTipIndex:n,minimized:r,dontShowAgain:i,showHelpPanel:u,activeHelpTab:g,helpTabs:b,filteredTips:_,currentTip:y,showNextTip:G,showPreviousTip:Q,acknowledgeTip:N,closeTip:L,toggleMinimize:q,toggleHelpPanel:Z,closeHelpPanel:X}}},_m={class:"tutorial-system"},bm={class:"tip-title"},$m={class:"tip-controls"},km={key:0,class:"tip-content"},Sm=["innerHTML"],wm={class:"tip-footer"},Cm={class:"tip-navigation"},Pm=["disabled"],Tm={class:"tip-counter"},Mm=["disabled"],Em={class:"tip-actions"},Im={class:"dont-show-again"},Nm={class:"help-button-container"},Lm={class:"help-panel"},xm={class:"help-header"},Rm={class:"help-content"},Am={class:"help-tabs"},Om=["onClick"],Dm={class:"tab-content"},Vm={key:0,class:"help-section"},Gm={key:1,class:"help-section"},Hm={key:2,class:"help-section"},Wm={key:3,class:"help-section"};function Bm(l,t,s,n,r,i){return v(),m("div",_m,[n.showTutorialTip&&n.currentTip?(v(),m("div",{key:0,class:H(["tutorial-tip",{minimized:n.minimized}])},[e("div",{class:"tip-header",onClick:t[2]||(t[2]=(...u)=>n.toggleMinimize&&n.toggleMinimize(...u))},[e("div",bm,[t[10]||(t[10]=e("span",{class:"tip-icon"},"💡",-1)),e("span",null,o(n.currentTip.title),1)]),e("div",$m,[n.minimized?T("",!0):(v(),m("button",{key:0,class:"minimize-btn",onClick:t[0]||(t[0]=ue(u=>n.minimized=!0,["stop"]))},t[11]||(t[11]=[e("span",{class:"minimize-icon"},null,-1)]))),e("button",{class:"close-btn",onClick:t[1]||(t[1]=ue((...u)=>n.closeTip&&n.closeTip(...u),["stop"]))},"×")])]),n.minimized?T("",!0):(v(),m("div",km,[e("div",{class:"tip-body",innerHTML:n.currentTip.content},null,8,Sm),e("div",wm,[e("div",Cm,[e("button",{class:"nav-btn prev",onClick:t[3]||(t[3]=(...u)=>n.showPreviousTip&&n.showPreviousTip(...u)),disabled:n.currentTipIndex<=0}," ← "+o(l.$t("tutorial.help.prev")),9,Pm),e("span",Tm,o(n.currentTipIndex+1)+"/"+o(n.filteredTips.length),1),e("button",{class:"nav-btn next",onClick:t[4]||(t[4]=(...u)=>n.showNextTip&&n.showNextTip(...u)),disabled:n.currentTipIndex>=n.filteredTips.length-1},o(l.$t("tutorial.help.next"))+" → ",9,Mm)]),e("div",Em,[e("label",Im,[B(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=u=>n.dontShowAgain=u)},null,512),[[ct,n.dontShowAgain]]),W(" "+o(l.$t("tutorial.help.dontShowAgain")),1)]),e("button",{class:"got-it-btn",onClick:t[6]||(t[6]=(...u)=>n.acknowledgeTip&&n.acknowledgeTip(...u))},o(l.$t("tutorial.help.gotIt")),1)])])]))],2)):T("",!0),e("div",Nm,[e("button",{class:"help-button",onClick:t[7]||(t[7]=(...u)=>n.toggleHelpPanel&&n.toggleHelpPanel(...u))},t[12]||(t[12]=[e("span",{class:"help-icon"},"?",-1)]))]),n.showHelpPanel?(v(),m("div",{key:1,class:"help-panel-overlay",onClick:t[9]||(t[9]=ue((...u)=>n.closeHelpPanel&&n.closeHelpPanel(...u),["self"]))},[e("div",Lm,[e("div",xm,[e("h2",null,o(l.$t("tutorial.help.title")),1),e("button",{class:"close-btn",onClick:t[8]||(t[8]=(...u)=>n.closeHelpPanel&&n.closeHelpPanel(...u))},"×")]),e("div",Rm,[e("div",Am,[(v(!0),m(F,null,oe(n.helpTabs,(u,g)=>(v(),m("button",{key:g,class:H(["tab-btn",{active:n.activeHelpTab===u.id}]),onClick:b=>n.activeHelpTab=u.id},o(u.name),11,Om))),128))]),e("div",Dm,[n.activeHelpTab==="basics"?(v(),m("div",Vm,[e("h3",null,o(l.$t("game.title")),1),t[13]||(t[13]=We("<p data-v-1c9e21ea>在《买房记》中，你的目标是在52周的游戏时间内，通过商品交易赚取足够的资金来购买房产。游戏结束时，你的表现将根据获得的资产、购买的房屋和其他因素进行评分。</p><h3 data-v-1c9e21ea>基本操作</h3><ul data-v-1c9e21ea><li data-v-1c9e21ea><strong data-v-1c9e21ea>交易商品</strong>：在市场标签页中，你可以买入商品；在库存标签页中，你可以卖出商品。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>切换地点</strong>：在市场页面顶部的下拉菜单中选择不同地点，每个地点有不同的商品和价格。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>进入下一周</strong>：点击右上角的&quot;下一周&quot;按钮，游戏将进入下一周，商品价格会发生变化。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>购买房产</strong>：当你积累了足够的资金后，可以在房产标签页中购买房屋。</li></ul>",3))])):T("",!0),n.activeHelpTab==="trading"?(v(),m("div",Gm,[t[22]||(t[22]=e("h3",null,"价格波动",-1)),t[23]||(t[23]=e("p",null,"商品价格会随时间波动，关注价格趋势是获利的关键。价格趋势分为以下几种：",-1)),e("ul",null,[e("li",null,[e("strong",null,o(l.$t("trends.rising_strong")),1),t[14]||(t[14]=W("：价格快速上涨，可能是卖出的好时机。"))]),e("li",null,[e("strong",null,o(l.$t("trends.rising")),1),t[15]||(t[15]=W("：价格稳步上涨，可以考虑持有或卖出。"))]),e("li",null,[e("strong",null,o(l.$t("trends.stable_high")),1),t[16]||(t[16]=W("：价格略有上涨，可能会继续上涨。"))]),e("li",null,[e("strong",null,o(l.$t("trends.stable")),1),t[17]||(t[17]=W("：价格相对稳定，波动较小。"))]),e("li",null,[e("strong",null,o(l.$t("trends.stable_low")),1),t[18]||(t[18]=W("：价格略有下跌，可能是买入的好时机。"))]),e("li",null,[e("strong",null,o(l.$t("trends.falling")),1),t[19]||(t[19]=W("：价格稳步下跌，可以考虑等待更低价格再买入。"))]),e("li",null,[e("strong",null,o(l.$t("trends.falling_strong")),1),t[20]||(t[20]=W("：价格快速下跌，可能是买入的好时机，但也要小心可能继续下跌。"))]),e("li",null,[e("strong",null,o(l.$t("trends.volatile")),1),t[21]||(t[21]=W("：价格波动较大，风险较高。"))])]),t[24]||(t[24]=e("h3",null,"交易策略",-1)),t[25]||(t[25]=e("ul",null,[e("li",null,[e("strong",null,"低买高卖"),W("：在价格低时购买，价格高时卖出，赚取差价。")]),e("li",null,[e("strong",null,"关注特色商品"),W("：每个地点都有特色商品，价格更优惠。")]),e("li",null,[e("strong",null,"利用价格趋势"),W("：根据价格趋势做出买卖决策。")]),e("li",null,[e("strong",null,"多地点比较"),W("：不同地点的同一商品价格可能不同，可以利用这一点赚取差价。")])],-1))])):T("",!0),n.activeHelpTab==="events"?(v(),m("div",Hm,t[26]||(t[26]=[We("<h3 data-v-1c9e21ea>事件类型</h3><p data-v-1c9e21ea>游戏中会随机触发各种事件，这些事件可能会影响商品价格、你的资金或其他游戏状态。事件类型包括：</p><ul data-v-1c9e21ea><li data-v-1c9e21ea><strong data-v-1c9e21ea>随机事件</strong>：任何时候都可能触发的普通事件。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>故事事件</strong>：与游戏剧情相关的事件，可能会连锁触发。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>地点事件</strong>：在特定地点才会触发的事件。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>市场事件</strong>：影响商品价格的事件。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>个人事件</strong>：与玩家状态相关的事件。</li></ul><h3 data-v-1c9e21ea>事件选择</h3><p data-v-1c9e21ea>大多数事件会提供多个选择，不同的选择会导致不同的结果。选择时要考虑当前的游戏状态和长期目标。</p>",5)]))):T("",!0),n.activeHelpTab==="settings"?(v(),m("div",Wm,[t[31]||(t[31]=e("h3",null,"游戏存档",-1)),t[32]||(t[32]=e("p",null,"你可以通过游戏菜单保存游戏进度，以便稍后继续。游戏也会在某些关键时刻自动保存。",-1)),t[33]||(t[33]=e("h3",null,"游戏设置",-1)),t[34]||(t[34]=e("p",null,"在设置菜单中，你可以调整游戏音量、显示设置等。",-1)),e("h3",null,o(l.$t("tutorial.help.shortcuts.title")),1),e("ul",null,[e("li",null,[t[27]||(t[27]=e("strong",null,"空格",-1)),W("："+o(l.$t("tutorial.help.shortcuts.space")),1)]),e("li",null,[t[28]||(t[28]=e("strong",null,"Tab",-1)),W("："+o(l.$t("tutorial.help.shortcuts.tab")),1)]),e("li",null,[t[29]||(t[29]=e("strong",null,"Esc",-1)),W("："+o(l.$t("tutorial.help.shortcuts.esc")),1)]),e("li",null,[t[30]||(t[30]=e("strong",null,"H",-1)),W("："+o(l.$t("tutorial.help.shortcuts.h")),1)])])])):T("",!0)])])])])):T("",!0)])}const qm=ae(hm,[["render",Bm],["__scopeId","data-v-1c9e21ea"]]);const Um={key:0,class:"game-loader"},Qm={class:"loader-container"},Fm={class:"loader-content"},zm={class:"loader-title"},jm={class:"loader-animation"},Km={class:"progress-bar"},Ym={class:"loader-status"},Xm={class:"loader-tip"},Jm={__name:"GameLoader",props:{visible:{type:Boolean,default:!0},title:{type:String,default:"正在加载游戏"},status:{type:String,default:"加载中..."},progress:{type:Number,default:0},autoProgress:{type:Boolean,default:!0}},emits:["update:progress","complete"],setup(l,{emit:t}){const s=l,n=t,r=["游戏提示：低买高卖是致富的关键！","游戏提示：关注市场趋势，把握最佳交易时机","游戏提示：不同地区的商品价格有差异，可以利用这一点赚取差价","游戏提示：随时关注你的资金状况，避免破产","游戏提示：购买房产是游戏的最终目标","游戏提示：每周市场价格都会变动，要把握时机","游戏提示：注意债务利息，不要让债务超过你的承受能力","游戏提示：特色商品通常有更高的利润空间","游戏提示：随机事件可能带来意外收获或损失","游戏提示：合理规划你的库存容量"],i=C(r[0]),u=C(s.progress);let g=null,b=null;function k(){let y=0;g=setInterval(()=>{y=(y+1)%r.length,i.value=r[y]},3e3)}function _(){s.autoProgress&&(b=setInterval(()=>{if(u.value<100){const y=Math.max(.1,(100-u.value)/50);u.value=Math.min(99,u.value+y),n("update:progress",u.value)}else clearInterval(b),n("complete")},100))}return ve(()=>s.progress,y=>{u.value=y,y>=100&&(clearInterval(b),n("complete"))}),ce(()=>{k(),s.autoProgress&&_()}),ps(()=>{clearInterval(g),clearInterval(b)}),(y,M)=>l.visible?(v(),m("div",Um,[e("div",Qm,[e("div",Fm,[e("h2",zm,o(l.title||"正在加载游戏"),1),e("div",jm,[M[0]||(M[0]=e("div",{class:"spinner"},null,-1)),e("div",Km,[e("div",{class:"progress-fill",style:Ce({width:`${l.progress}%`})},null,4)])]),e("div",Ym,o(l.status||"加载中..."),1),e("div",Xm,o(i.value),1)])])])):T("",!0)}},Nt=ae(Jm,[["__scopeId","data-v-45147625"]]);const Zm={class:"game-view"},ep={key:1,class:"game-header"},tp={class:"left-info"},sp={class:"week-indicator"},np={class:"week-label"},op={class:"week-value"},ap={class:"progress-bar"},lp={class:"right-info"},ip={class:"menu-text"},rp={key:2,class:"notifications-container"},up={class:"notification-content"},cp=["onClick"],dp={class:"game-content"},vp={class:"left-panel"},mp={class:"mini-inventory"},pp={class:"mini-header"},gp={class:"mini-title"},yp={class:"inventory-items"},fp={key:0,class:"empty-inventory"},hp={key:1,class:"inventory-list"},_p={class:"item-name"},bp={class:"item-details"},$p={class:"item-quantity"},kp={class:"item-price"},Sp={class:"main-content"},wp={class:"tab-buttons"},Cp={class:"tab-content"},Pp={class:"market-tab",key:"market"},Tp={class:"inventory-tab",key:"inventory"},Mp={class:"houses-tab",key:"houses"},Ep={class:"dialog game-menu-dialog"},Ip={class:"dialog-title"},Np={class:"menu-options"},Lp={class:"dialog save-dialog"},xp={class:"dialog-title"},Rp={class:"save-form"},Ap=["placeholder"],Op={class:"dialog-buttons"},Dp=["disabled"],Vp={key:0,class:"dialog-overlay game-over-overlay"},Gp={class:"toast-content"},Hp={class:"toast-icon"},Wp={class:"toast-message"},Bp={__name:"GameView",setup(l){const t=Ie(),s=fe(),n=xe(),r=et(),i=Te(),u=mt(),g=Me();Ee();const b=C(null),k=C(null),_=C(null);console.log("GameView组件初始化，游戏状态:",{gameStarted:s.gameStarted,currentWeek:s.currentWeek,playerInitialized:n.initialized});const y=C("market"),M=C(!1),G=C(!1),Q=C(!1),N=C(""),L=C(!1),q=C(!0),Z=C("初始化游戏..."),X=C(0),x=O(()=>s.currentWeek),h=O(()=>s.maxWeeks),f=O(()=>s.gameOver),w=O(()=>s.notifications),P=O(()=>s.gameResult),S=O(()=>n),p=O(()=>r.currentLocation),c=O(()=>n.inventory||[]),a=O(()=>({currentWeek:x.value,maxWeeks:h.value,gameOver:f.value})),d=O(()=>s.gameProgress),$=O(()=>s.isEndlessMode);ve(()=>s.gameOver,R=>{var Y,U,ge,$e;R&&(console.log("游戏结束 - GameView监听到gameOver变为true"),console.log("详细游戏结果数据:",{gameResult:s.gameResult,score:(Y=s.gameResult)==null?void 0:Y.score,scoreDetails:(U=s.gameResult)==null?void 0:U.scoreDetails,endReason:(ge=s.gameResult)==null?void 0:ge.endReason,playerNetWorth:n.netWorth,purchasedHouses:(($e=n.purchasedHouses)==null?void 0:$e.length)||0}),ye(()=>{Q.value=!0}))});const D=C(!1),le=C(""),me=C(""),z=C("");ce(()=>{console.log("GameView组件挂载"),q.value=!0,X.value=0;try{L.value=!0,console.log("GameView - 当前模式: 开发模式")}catch(R){console.warn("GameView - 无法检测环境模式:",R),L.value=!0}if(!s.gameStarted){console.log("游戏未初始化，尝试从本地存储获取玩家名称");const R=localStorage.getItem("lastPlayerName")||"玩家";console.log("获取到玩家名称:",R),n.name=R}if(s.gameOver){console.log("重置游戏结束状态"),s.gameOver=!1,Q.value=!1;const R=Te();R.resetEvents(),R.activeEvent=null,R.activeEvents=[]}lt(),window.addEventListener("keydown",de),window.addEventListener("beforeunload",je),setInterval(()=>{s.gameOver||he()},2e3),He.on("show:transaction_toast",Ke)}),qe(()=>{window.removeEventListener("keydown",de),window.removeEventListener("beforeunload",je),He.off("show:transaction_toast",Ke)});const de=R=>{if(!(M.value||G.value||Q.value))switch(R.key){case" ":Ne();break;case"Tab":R.preventDefault(),R.shiftKey?y.value==="market"?y.value="houses":y.value==="inventory"?y.value="market":y.value==="houses"&&(y.value="inventory"):y.value==="market"?y.value="inventory":y.value==="inventory"?y.value="houses":y.value==="houses"&&(y.value="market");break;case"Escape":M.value?Ae():Ue();break;case"h":case"H":k.value&&k.value.toggleHelpPanel();break}},be=R=>R.toLocaleString("zh-CN"),Ne=()=>{s.advanceWeek()&&he()},he=()=>{var Y;if(s.gameOver){console.log("GameView - 游戏已结束，跳过事件检查");return}console.log("GameView - 检查活跃事件");const R=Te();if(R.activeEvent){console.log("GameView - 在EventStore中发现活跃事件:",R.activeEvent.id,R.activeEvent.title),ye(()=>{b.value?(console.log("GameView - 显示EventStore中的活跃事件"),b.value.showEvent(R.activeEvent)):console.error("GameView - 事件对话框组件未找到")});return}if(s.gameOver){console.log("GameView - 游戏已结束，跳过GameCore事件检查");return}if(console.log("GameView - 检查GameCore中的活跃事件队列:",((Y=s.activeEvents)==null?void 0:Y.length)||0),s.activeEvents&&s.activeEvents.length>0){const U=s.activeEvents[0];console.log("GameView - 在GameCore中发现活跃事件:",U.id,U.title),s.activeEvents.shift(),ye(()=>{if(b.value){if(console.log("GameView - 显示GameCore中的活跃事件"),typeof b.value.showEvent!="function"){console.error("GameView - 事件模态框组件没有showEvent方法");return}(!U.options||!Array.isArray(U.options)||U.options.length===0)&&(console.warn("GameView - 事件没有选项，添加默认选项"),U.options=[{id:"default_option",text:"确认",result:"你确认了这个事件。",effects:{}}]);try{b.value.showEvent(U),console.log("GameView - 事件显示请求已发送")}catch(ge){console.error("GameView - 显示事件时出错:",ge)}}else console.error("GameView - 事件对话框组件未找到")})}else console.log("GameView - 没有活跃事件需要显示")},Ue=()=>{M.value=!0},Ae=()=>{M.value=!1},st=()=>{M.value=!1,G.value=!0;const R=new Date;N.value=`存档-${R.getFullYear()}${(R.getMonth()+1).toString().padStart(2,"0")}${R.getDate().toString().padStart(2,"0")}-${R.getHours().toString().padStart(2,"0")}${R.getMinutes().toString().padStart(2,"0")}`,ye(()=>{_.value&&(_.value.focus(),_.value.select())})},Qe=async()=>{if(N.value)try{(await Je().saveGame(N.value)).success?G.value=!1:g.showToast({type:"error",message:"保存游戏失败",duration:3e3})}catch(R){ee(R,"GameView (views)",se.UNKNOWN,te.ERROR),console.error("保存游戏时出错:",R),g.showToast({type:"error",message:"保存游戏时出错: "+(R.message||"未知错误"),duration:3e3})}},Fe=()=>{G.value=!1,N.value=""},ze=()=>{t.push("/")},nt=R=>{s.notifications=s.notifications.filter(Y=>Y.id!==R)},ot=()=>{Q.value=!1,s.continueGame()},at=()=>{const R=Te();R.resetEvents(),s.startNewGame(S.value.name),Q.value=!1,R.activeEvent=null,R.activeEvents=[]},lt=async()=>{try{const R=[{name:"游戏核心",weight:20,action:()=>s.initializeGameCore()},{name:"玩家数据",weight:20,action:()=>n.initializePlayer(S.value.name)},{name:"市场数据",weight:25,action:()=>r.initializeMarket()},{name:"事件系统",weight:15,action:()=>i.initializeEvents()},{name:"教程事件",weight:10,action:()=>Promise.resolve(it())},{name:"游戏界面",weight:10,action:()=>new Promise(U=>setTimeout(U,200))}];let Y=5;for(const U of R){Z.value=`加载中: ${U.name}`,console.log(`加载步骤: ${U.name}`);try{await U.action(),Y+=U.weight,X.value=Y}catch(ge){ee(ge,"GameView (views)",se.UNKNOWN,te.ERROR),console.error(`加载失败: ${U.name}`,ge)}}Z.value="加载完成！",X.value=100,setTimeout(()=>{q.value=!1,console.log("游戏资源加载完成，隐藏加载界面"),he()},500)}catch(R){console.error("加载游戏资源失败:",R),Z.value="加载失败，请刷新页面重试"}},it=()=>{console.log("检查教程事件");try{return k.value?(console.log("检查教程提示系统"),!0):(s.currentWeek===1&&typeof i.triggerTutorialEvent=="function"&&(console.log("尝试触发初始教程事件"),i.triggerTutorialEvent("tutorial_trading")),!0)}catch(R){return ee(R,"GameView (views)",se.UNKNOWN,te.WARNING),console.warn("检查教程事件时出错:",R),!1}},rt=()=>{console.log("GameView - 加载完成回调"),q.value=!1,he()},je=async R=>{if(s.gameStarted&&!s.gameOver){const Y=u.gameSettings;if(Y&&Y.autoSaveEnabled)try{const U=new Date,ge=`${U.getFullYear()}${String(U.getMonth()+1).padStart(2,"0")}${String(U.getDate()).padStart(2,"0")}_${String(U.getHours()).padStart(2,"0")}${String(U.getMinutes()).padStart(2,"0")}${String(U.getSeconds()).padStart(2,"0")}`,$e=`autoSave_exit_W${s.currentWeek}_${ge}`;await s.saveGame($e,!0)}catch(U){ee(U,"GameView (views)",se.UNKNOWN,te.ERROR),console.error("退出时自动保存失败:",U)}}},Ke=R=>{le.value=R.message,me.value=R.class,z.value=R.icon,D.value=!1,requestAnimationFrame(()=>{D.value=!0,setTimeout(()=>{D.value=!1},3e3)})};return(R,Y)=>(v(),m(F,null,[e("div",Zm,[q.value?(v(),Be(Nt,{key:0,title:"正在加载游戏资源",status:Z.value,progress:X.value,onComplete:rt},null,8,["status","progress"])):T("",!0),q.value?T("",!0):(v(),m("header",ep,[e("div",tp,[e("div",sp,[e("div",np,o(R.$t("game.week")),1),e("div",op,o(x.value)+o($.value?" / ∞":" / "+h.value),1),e("div",ap,[e("div",{class:"progress",style:Ce({width:`${d.value}%`})},null,4)])])]),e("div",lp,[e("button",{class:"menu-button",onClick:Ue},[Y[5]||(Y[5]=e("span",{class:"menu-icon"},"≡",-1)),e("span",ip,o(R.$t("game.menu")),1)])])])),q.value?T("",!0):(v(),m("div",rp,[j(Ze,{name:"notification"},{default:ie(()=>[(v(!0),m(F,null,oe(w.value,U=>(v(),m("div",{key:U.id,class:H(["notification",U.type])},[e("div",up,o(U.message),1),e("button",{class:"close-btn",onClick:ge=>nt(U.id)},"×",8,cp)],2))),128))]),_:1})])),e("div",dp,[e("div",vp,[j(Ci),e("div",mp,[e("div",pp,[e("h3",gp,o(R.$t("inventory.title")),1),e("button",{class:"view-all-btn",onClick:Y[0]||(Y[0]=U=>y.value="inventory"),title:"查看完整背包"},Y[6]||(Y[6]=[e("i",{class:"icon-expand"},"⤢",-1)]))]),e("div",yp,[c.value.length===0?(v(),m("div",fp,o(R.$t("inventory.empty")),1)):(v(),m("div",hp,[(v(!0),m(F,null,oe(c.value,U=>(v(),m("div",{key:U.productId,class:"inventory-item"},[e("div",_p,o(U.name),1),e("div",bp,[e("span",$p,"x"+o(U.quantity),1),e("span",kp,"¥"+o(be(U.purchasePrice)),1)])]))),128))]))])])]),e("div",Sp,[e("div",wp,[e("button",{class:H(["tab-button",{active:y.value==="market"}]),onClick:Y[1]||(Y[1]=U=>y.value="market")},o(R.$t("game.tabs.market")),3),e("button",{class:H(["tab-button",{active:y.value==="inventory"}]),onClick:Y[2]||(Y[2]=U=>y.value="inventory")},o(R.$t("game.tabs.inventory")),3),e("button",{class:H(["tab-button",{active:y.value==="houses"}]),onClick:Y[3]||(Y[3]=U=>y.value="houses")},o(R.$t("game.tabs.houses")),3)]),e("div",Cp,[j(re,{name:"tab-fade",mode:"out-in"},{default:ie(()=>[y.value==="market"?(v(),m("div",Pp,[j(eu)])):y.value==="inventory"?(v(),m("div",Tp,[j(Fc)])):y.value==="houses"?(v(),m("div",Mp,[j(wd)])):T("",!0)]),_:1})])])]),j(qm,{"current-week":x.value,"current-location":p.value,"active-tab":y.value,ref_key:"tutorialSystem",ref:k},null,8,["current-week","current-location","active-tab"]),j(Jd,{ref_key:"eventModal",ref:b},null,512),j(re,{name:"fade"},{default:ie(()=>[M.value?(v(),m("div",{key:0,class:"dialog-overlay",onClick:ue(Ae,["self"])},[j(re,{name:"zoom-bounce"},{default:ie(()=>[e("div",Ep,[e("h2",Ip,o(R.$t("gameMenu.title")),1),e("div",Np,[j(Ze,{name:"menu-item"},{default:ie(()=>[e("button",{class:"menu-option",onClick:st,key:"save"},[Y[7]||(Y[7]=e("span",{class:"menu-icon"},"💾",-1)),W(" "+o(R.$t("gameMenu.save")),1)]),e("button",{class:"menu-option",onClick:ze,key:"main"},[Y[8]||(Y[8]=e("span",{class:"menu-icon"},"🏠",-1)),W(" "+o(R.$t("gameMenu.mainMenu")),1)]),e("button",{class:"menu-option",onClick:Ae,key:"continue"},[Y[9]||(Y[9]=e("span",{class:"menu-icon"},"▶️",-1)),W(" "+o(R.$t("gameMenu.continue")),1)])]),_:1})])])]),_:1})])):T("",!0)]),_:1}),j(re,{name:"fade"},{default:ie(()=>[G.value?(v(),m("div",{key:0,class:"dialog-overlay",onClick:ue(Fe,["self"])},[j(re,{name:"slide-up"},{default:ie(()=>[e("div",Lp,[e("h2",xp,o(R.$t("saveDialog.title")),1),e("div",Rp,[B(e("input",{"onUpdate:modelValue":Y[4]||(Y[4]=U=>N.value=U),type:"text",class:"save-input",placeholder:R.$t("saveDialog.namePlaceholder"),ref_key:"saveInput",ref:_,onKeyup:Pt(Qe,["enter"])},null,40,Ap),[[ne,N.value]]),e("div",Op,[e("button",{class:"dialog-button confirm",onClick:Qe,disabled:!N.value},o(R.$t("common.confirm")),9,Dp),e("button",{class:"dialog-button cancel",onClick:Fe},o(R.$t("common.cancel")),1)])])])]),_:1})])):T("",!0)]),_:1}),j(re,{name:"fade"},{default:ie(()=>[f.value&&Q.value?(v(),m("div",Vp,[j(re,{name:"scale-bounce"},{default:ie(()=>[j(It,{gameState:a.value,player:S.value,gameStats:P.value,onReturnToMain:ze,onRestartGame:at,onContinueGame:ot},null,8,["gameState","player","gameStats"])]),_:1})])):T("",!0)]),_:1})]),j(re,{name:"fade"},{default:ie(()=>[D.value?(v(),m("div",{key:0,class:H(["transaction-toast",me.value])},[e("div",Gp,[e("span",Hp,o(z.value),1),e("span",Wp,o(le.value),1)]),Y[10]||(Y[10]=e("div",{class:"toast-progress-bar"},null,-1))],2)):T("",!0)]),_:1})],64))}},qp=ae(Bp,[["__scopeId","data-v-c88c88ad"]]);const Up={class:"settings-view"},Qp={class:"settings-section"},Fp={class:"setting-group"},zp={class:"setting-item"},jp={class:"setting-item"},Kp={key:0,class:"setting-item description"},Yp={class:"setting-description"},Xp={key:1,class:"setting-item description"},Jp={class:"setting-item"},Zp={class:"settings-item"},e1={for:"language-select"},t1=["value"],s1={class:"setting-group"},n1={class:"setting-item checkbox"},o1={class:"setting-item checkbox"},a1={class:"settings-actions"},l1={__name:"SettingsView",setup(l){const t=Ie(),s=mt(),n=Wt(),r=gs({difficulty:s.gameSettings.difficulty,autoSaveInterval:s.gameSettings.autoSaveInterval,soundEnabled:s.gameSettings.soundEnabled,fullScreen:s.gameSettings.fullScreen,textSpeed:s.gameSettings.textSpeed,language:s.gameSettings.language}),i=(_,y)=>{s.updateSetting(_,y)},u=async()=>{try{await s.updateSetting("language",r.language)}catch(_){ee(_,"SettingsView (views)",se.UNKNOWN,te.ERROR),console.error("Failed to update language:",_),r.language=s.gameSettings.language}},g=async()=>{try{const _=await window.electronAPI.toggleFullscreen();r.fullScreen=_,await s.updateSetting("fullScreen",_)}catch(_){ee(_,"SettingsView (views)",se.UNKNOWN,te.ERROR),console.error("Failed to toggle fullscreen:",_),r.fullScreen=s.gameSettings.fullScreen}},b=async()=>{await s.resetSettings(),r.difficulty=s.gameSettings.difficulty,r.autoSaveInterval=s.gameSettings.autoSaveInterval,r.soundEnabled=s.gameSettings.soundEnabled,r.fullScreen=s.gameSettings.fullScreen,r.textSpeed=s.gameSettings.textSpeed,r.language=s.gameSettings.language},k=()=>{t.back()};return ce(async()=>{await s.loadSettings(),r.difficulty=s.gameSettings.difficulty,r.autoSaveInterval=s.gameSettings.autoSaveInterval,r.soundEnabled=s.gameSettings.soundEnabled,r.fullScreen=s.gameSettings.fullScreen,r.textSpeed=s.gameSettings.textSpeed,r.language=s.gameSettings.language}),(_,y)=>(v(),m("div",Up,[e("h1",null,o(_.$t("settings.title")),1),e("div",Qp,[e("div",Fp,[y[17]||(y[17]=e("h2",null,"游戏设置",-1)),e("div",zp,[y[11]||(y[11]=e("label",{for:"difficulty"},"默认难度",-1)),B(e("select",{id:"difficulty","onUpdate:modelValue":y[0]||(y[0]=M=>r.difficulty=M),onChange:y[1]||(y[1]=M=>i("difficulty"))},y[10]||(y[10]=[e("option",{value:"easy"},"简单",-1),e("option",{value:"standard"},"标准",-1),e("option",{value:"hard"},"困难",-1)]),544),[[_e,r.difficulty]])]),e("div",jp,[y[13]||(y[13]=e("label",{for:"autoSaveInterval"},"自动保存频率",-1)),B(e("select",{id:"autoSaveInterval","onUpdate:modelValue":y[2]||(y[2]=M=>r.autoSaveInterval=M),onChange:y[3]||(y[3]=M=>i("autoSaveInterval"))},y[12]||(y[12]=[e("option",{value:0},"关闭自动保存",-1),e("option",{value:1},"每1周（频繁）",-1),e("option",{value:2},"每2周",-1),e("option",{value:5},"每5周（推荐）",-1),e("option",{value:10},"每10周",-1),e("option",{value:26},"每26周（半年）",-1)]),544),[[_e,r.autoSaveInterval]])]),r.autoSaveInterval>0?(v(),m("div",Kp,[e("div",Yp,[e("p",null," 当前设置：每"+o(r.autoSaveInterval)+"周自动保存一次。自动存档将在周数变化、 购买房产和退出游戏时触发。自动保存不会显示通知，最多保留5个最近的自动存档。 ",1)])])):(v(),m("div",Xp,y[14]||(y[14]=[e("div",{class:"setting-description warning"},[e("p",null,[e("strong",null,"警告："),W("自动保存已关闭。游戏进度将不会自动保存， 请记得手动保存游戏以防止进度丢失。 ")])],-1)]))),e("div",Jp,[y[16]||(y[16]=e("label",{for:"textSpeed"},"文本显示速度",-1)),B(e("select",{id:"textSpeed","onUpdate:modelValue":y[4]||(y[4]=M=>r.textSpeed=M),onChange:y[5]||(y[5]=M=>i("textSpeed"))},y[15]||(y[15]=[e("option",{value:"slow"},"慢速",-1),e("option",{value:"normal"},"中速",-1),e("option",{value:"fast"},"快速",-1),e("option",{value:"instant"},"立即显示",-1)]),544),[[_e,r.textSpeed]])])]),e("div",Zp,[e("label",e1,o(_.$t("settings.language")),1),B(e("select",{id:"language-select","onUpdate:modelValue":y[6]||(y[6]=M=>r.language=M),onChange:u},[(v(!0),m(F,null,oe(E(n),M=>(v(),m("option",{key:M.code,value:M.code},o(M.name),9,t1))),128))],544),[[_e,r.language]])]),e("div",s1,[y[20]||(y[20]=e("h2",null,"显示设置",-1)),e("div",n1,[B(e("input",{type:"checkbox",id:"soundEnabled","onUpdate:modelValue":y[7]||(y[7]=M=>r.soundEnabled=M),onChange:y[8]||(y[8]=M=>i("soundEnabled"))},null,544),[[ct,r.soundEnabled]]),y[18]||(y[18]=e("label",{for:"soundEnabled"},"启用音效",-1))]),e("div",o1,[B(e("input",{type:"checkbox",id:"fullScreen","onUpdate:modelValue":y[9]||(y[9]=M=>r.fullScreen=M),onChange:g},null,544),[[ct,r.fullScreen]]),y[19]||(y[19]=e("label",{for:"fullScreen"},"全屏模式",-1))])])]),e("div",a1,[e("button",{onClick:b,class:"btn-secondary"},o(_.$t("settings.reset")),1),e("button",{onClick:k,class:"btn-primary"},o(_.$t("common.back")),1)])]))}},i1=ae(l1,[["__scopeId","data-v-d4334a25"]]);const r1={class:"saves-view"},u1={class:"saves-container"},c1={class:"saves-content"},d1={key:0,class:"loading"},v1={key:1,class:"error"},m1={key:2,class:"empty-state"},p1={key:3,class:"saves-list"},g1=["onClick"],y1={class:"save-info"},f1={class:"save-header"},h1={key:0,class:"autosave-badge"},_1={class:"save-date"},b1={key:0,class:"save-details"},$1={class:"save-actions"},k1=["onClick"],S1=["onClick"],w1={class:"dialog"},C1={key:0,class:"loading-overlay"},P1={class:"loading-container"},T1={class:"loading-tip"},M1={__name:"SavesView",setup(l){const t=Ie(),s=we(),n=Me(),r=C([]),i=C(null),u=C(!1),g=C(null),b=C({}),k=C(!1),_=C(""),y=C(0),M=["正在读取存档数据...","正在加载市场信息...","正在恢复玩家状态...","正在准备游戏环境...","准备进入游戏世界..."];async function G(){try{u.value=!0,g.value=null;const p=await window.electronAPI.listSaves();if(p.success){r.value=p.saves||[],console.log("已加载存档列表:",r.value);for(const c of r.value)await f(c.name)}else g.value=p.error||"加载存档失败",console.error("加载存档列表失败:",p.error)}catch(p){ee(p,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error("加载存档列表时出错:",p),g.value="加载存档时发生错误: "+(p.message||"未知错误")}finally{u.value=!1}}function Q(p){i.value=p}function N(){y.value=0;const p=setInterval(()=>{y.value=(y.value+1)%M.length,u.value||clearInterval(p)},1500)}async function L(p){try{console.log("尝试加载存档:",p),u.value=!0,N(),n.showToast({type:"info",message:"正在加载存档...",duration:2e3}),await new Promise($=>setTimeout($,200));try{console.log("使用Electron API加载存档:",p);const $=await window.electronAPI.loadGame(p);if($&&$.success&&$.gameState){console.log("存档从Electron加载成功，数据:",$.gameState),await Je().loadStoresFromSaveData($.gameState),s.gameStarted=!0,n.showToast({type:"success",message:"存档加载成功！",duration:2e3}),t.push("/game");return}}catch($){console.warn("Electron API加载存档失败，尝试备用方法:",$)}const c=Je();await c.loadSaveList();const a=c.saveList.find($=>$.name===p);if(!a)throw new Error("找不到存档信息，无法加载");console.log("找到存档信息:",a);const d=await c.loadGame(a.id);d.success?(n.showToast({type:"success",message:"存档加载成功！",duration:2e3}),t.push("/game")):(n.showToast({type:"error",message:`加载失败: ${d.message||"未知错误"}`,duration:3e3}),u.value=!1)}catch(c){ee(c,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error("加载存档时出错:",c),n.showToast({type:"error",message:`加载存档时发生错误: ${c.message||"未知错误"}`,duration:3e3}),u.value=!1}}function q(p){_.value=p,k.value=!0}async function Z(){try{const p=await window.electronAPI.deleteSave(_.value);p.success?(i.value===_.value&&(i.value=null),await G(),n.showToast({type:"success",message:"存档已成功删除",duration:2e3})):n.showToast({type:"error",message:`删除存档失败: ${p.error||"未知错误"}`,duration:3e3})}catch(p){ee(p,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error("删除存档时出错:",p),n.showToast({type:"error",message:`删除存档时发生错误: ${p.message||"未知错误"}`,duration:3e3})}finally{k.value=!1,_.value=""}}function X(){k.value=!1,_.value=""}function x(p){if(h(p)){const c=p.match(/W(\d+)/),a=c?c[1]:"?";let d="周期";return p.includes("_exit_")?d="退出时":p.includes("_buyHouse_")&&(d="购房时"),`自动存档 (${d}, 第${a}周)`}return p}function h(p){return p.startsWith("autosave_")}async function f(p){try{const c=await window.electronAPI.loadGame(p);if(c.success&&c.gameState){let a="未知位置",d="?",$=0;if(c.gameState.gameCore&&(d=c.gameState.gameCore.currentWeek||"?"),c.gameState.player&&($=c.gameState.player.money||0),c.gameState.market&&c.gameState.market.currentLocation){const D=c.gameState.market.currentLocation;if(typeof D=="string"&&c.gameState.market.locations){const le=c.gameState.market.locations.find(me=>me.id===D);le&&(a=le.name||"未知位置")}else typeof D=="object"&&D.name&&(a=D.name)}b.value[p]={currentWeek:d,playerMoney:$,locationName:a},console.log(`加载存档 ${p} 详情:`,b.value[p])}else console.warn(`无法获取存档 ${p} 的详情:`,c.error||"未知错误")}catch(c){ee(c,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error(`获取存档 ${p} 详情失败:`,c)}}function w(){t.push("/")}function P(){t.push({path:"/",query:{action:"new-game"}})}function S(){t.push("/")}return ce(()=>{G()}),(p,c)=>(v(),m("div",r1,[c[12]||(c[12]=e("div",{class:"game-particles"},null,-1)),e("div",u1,[e("div",{class:"header"},[c[0]||(c[0]=e("h1",null,[e("span",{class:"title-icon"},"💾"),W(" 游戏存档")],-1)),e("button",{class:"back-button",onClick:S},"返回")]),e("div",c1,[u.value?(v(),m("div",d1,c[1]||(c[1]=[e("div",{class:"loading-spinner-mini"},null,-1),e("p",null,"正在加载存档列表...",-1)]))):g.value?(v(),m("div",v1,[e("p",null,o(g.value),1),e("button",{class:"button",onClick:G},"重试")])):r.value.length===0?(v(),m("div",m1,[c[2]||(c[2]=e("div",{class:"empty-icon"},"📁",-1)),c[3]||(c[3]=e("h3",null,"暂无游戏存档",-1)),c[4]||(c[4]=e("p",null,"开始新游戏并保存进度后，存档将显示在这里",-1)),e("div",{class:"empty-actions"},[e("button",{class:"button primary",onClick:w},"返回主菜单"),e("button",{class:"button new-game",onClick:P},"开始新游戏")])])):(v(),m("div",p1,[j(Ze,{name:"save-item"},{default:ie(()=>[(v(!0),m(F,null,oe(r.value,(a,d)=>(v(),m("div",{key:a.name,class:H(["save-item",{selected:i.value===a.name,autosave:h(a.name)}]),onClick:$=>Q(a.name),style:Ce({"--delay":d*.05+"s"})},[e("div",y1,[e("div",f1,[e("h3",null,o(x(a.name)),1),h(a.name)?(v(),m("span",h1,"自动")):T("",!0)]),e("p",_1,o(E(Ds)(a.lastModified)),1),b.value[a.name]?(v(),m("p",b1," 第"+o(b.value[a.name].currentWeek)+"周 | 金钱: "+o(E(gt)(b.value[a.name].playerMoney))+" | 地点: "+o(b.value[a.name].locationName||"未知"),1)):T("",!0)]),e("div",$1,[e("button",{class:"load-button",onClick:ue($=>L(a.name),["stop"])},c[5]||(c[5]=[e("span",{class:"button-icon"},"▶️",-1),W("读取 ")]),8,k1),e("button",{class:"delete-button",onClick:ue($=>q(a.name),["stop"])},c[6]||(c[6]=[e("span",{class:"button-icon"},"🗑️",-1),W("删除 ")]),8,S1)])],14,g1))),128))]),_:1})]))])]),j(re,{name:"fade"},{default:ie(()=>[k.value?(v(),m("div",{key:0,class:"dialog-overlay",onClick:ue(X,["self"])},[j(re,{name:"zoom"},{default:ie(()=>[e("div",w1,[c[9]||(c[9]=e("h2",{class:"dialog-title"},"确认删除",-1)),e("p",null,'您确定要删除存档"'+o(_.value)+'"吗？此操作不可撤销。',1),e("div",{class:"dialog-actions"},[e("button",{class:"button danger",onClick:Z},c[7]||(c[7]=[e("span",{class:"button-icon"},"🗑️",-1),W("删除 ")])),e("button",{class:"button",onClick:X},c[8]||(c[8]=[e("span",{class:"button-icon"},"❌",-1),W("取消 ")]))])])]),_:1})])):T("",!0)]),_:1}),j(re,{name:"fade"},{default:ie(()=>[u.value?(v(),m("div",C1,[j(re,{name:"zoom"},{default:ie(()=>[e("div",P1,[c[10]||(c[10]=e("div",{class:"loading-spinner"},null,-1)),c[11]||(c[11]=e("p",{class:"loading-text"},"正在加载游戏，请稍候...",-1)),e("p",T1,o(M[y.value]),1)])]),_:1})])):T("",!0)]),_:1})]))}},E1=ae(M1,[["__scopeId","data-v-8a96e221"]]);function I1(){console.log("===== 价格波动系统测试 =====");const l=[{id:101,name:"日常用品测试",category:"DAILY",minPrice:10,maxPrice:30,basePrice:15,volatility:2},{id:201,name:"食品测试",category:"FOOD",minPrice:20,maxPrice:60,basePrice:35,volatility:4},{id:301,name:"电子产品测试",category:"ELECTRONICS",minPrice:1e3,maxPrice:3e3,basePrice:1800,volatility:6},{id:401,name:"奢侈品测试",category:"LUXURY",minPrice:5e3,maxPrice:15e3,basePrice:8e3,volatility:8},{id:501,name:"收藏品测试",category:"COLLECTIBLE",minPrice:500,maxPrice:5e3,basePrice:1500,volatility:10}],t=[1,5,10,20,30,40,52],s={};l.forEach(r=>{s[r.id]={price:r.basePrice,trend:J.STABLE,history:[r.basePrice]}}),t.forEach(r=>{console.log(`
--- 第 ${r} 周价格 ---`),l.forEach(i=>{const u=s[i.id],g=pt(i,r,u);s[i.id]={price:g.price,trend:g.trend,history:[...u.history,g.price].slice(-10)},console.log(`${i.name}:`,`¥${g.price}`,`(${g.changePercent>0?"+":""}${g.changePercent.toFixed(1)}%)`,`趋势: ${g.trend}`,`价格范围: ${(100*(g.price-i.minPrice)/(i.maxPrice-i.minPrice)).toFixed(1)}%`)})}),console.log(`
--- 价格范围验证 ---`);let n=!0;return l.forEach(r=>{const i=s[r.id].history,u=Math.min(...i),g=Math.max(...i),b=u>=r.minPrice,k=g<=r.maxPrice,_=b&&k;console.log(`${r.name}:`,`范围检查: ${_?"通过":"失败"}`,`最低: ¥${u}`,`最高: ¥${g}`,`(预期范围: ¥${r.minPrice}-¥${r.maxPrice})`),_||(n=!1)}),console.log(`
总结: 价格范围测试 ${n?"全部通过":"存在失败"}`),n}function N1(){console.log(`
===== 地点价格修正测试 =====`);const l={id:101,name:"测试商品",category:"DAILY",minPrice:100,maxPrice:300,basePrice:200,volatility:5},t=[{id:"loc1",name:"便宜地点",priceModifier:.8,specialProducts:[]},{id:"loc2",name:"普通地点",priceModifier:1,specialProducts:[]},{id:"loc3",name:"昂贵地点",priceModifier:1.2,specialProducts:[]},{id:"loc4",name:"特价地点",priceModifier:1,specialProducts:[101]}],s={price:l.basePrice,trend:J.STABLE};t.forEach(n=>{const r={specialProducts:n.specialProducts},i=pt(l,10,s,n.priceModifier,r),u=i.price/l.basePrice;console.log(`${n.name}:`,`¥${i.price}`,`(基础价格比例: ${u.toFixed(2)})`,`修正系数: ${n.priceModifier}`,`特价商品: ${n.specialProducts.includes(l.id)?"是":"否"}`)})}function L1(){console.log(`
===== 市场修正因子测试 =====`);const l={id:201,name:"测试商品",category:"FOOD",minPrice:100,maxPrice:300,basePrice:200,volatility:5},t={price:l.basePrice,trend:J.STABLE};[{name:"无修正",modifiers:{}},{name:"全局上涨",modifiers:{globalPriceModifier:1.2}},{name:"全局下跌",modifiers:{globalPriceModifier:.8}},{name:"类别修正",modifiers:{categoryModifier:"FOOD",modifier:1.3}},{name:"商品修正",modifiers:{productModifiers:{201:1.5}}},{name:"组合修正",modifiers:{globalPriceModifier:1.1,categoryModifier:"FOOD",modifier:1.2,productModifiers:{201:1.1}}}].forEach(n=>{const r=pt(l,10,t,1,n.modifiers),i=r.price/l.basePrice;console.log(`${n.name}:`,`¥${r.price}`,`(基础价格比例: ${i.toFixed(2)})`)})}function Lt(){const l=I1();return N1(),L1(),console.log(`
===== 测试完成 =====`),l}typeof window<"u"&&window.runTest&&Lt();const x1={class:"dev-tools"},R1={class:"tool-section"},A1={key:0,class:"test-output"},O1={class:"tool-section"},D1={class:"tool-group"},V1={class:"control-buttons"},G1={class:"tool-group"},H1={class:"input-group"},W1={class:"tool-group"},B1={class:"input-group param-row"},q1={class:"input-group param-row"},U1={class:"input-group param-row"},Q1={class:"input-group"},F1={class:"tool-group"},z1={class:"input-group param-row"},j1=["max"],K1={class:"tool-group"},Y1={class:"input-group"},X1=["value"],J1={class:"tool-section"},Z1={class:"scenarios"},eg={class:"tool-section"},tg={class:"status-grid"},sg={class:"status-item"},ng={class:"status-item"},og={class:"status-item"},ag={class:"status-item"},lg={class:"status-item"},ig={class:"status-item"},rg={class:"status-item"},ug={class:"json-display"},cg={__name:"DevToolsView",setup(l){const t=we(),s=Ie(),n=C(""),r=C(1e3),i=C("global"),u=C(1.2),g=C(3),b=C("DAILY"),k=C(null),_=C({money:0,debt:0,capacity:0}),y=C(1),M=C(t.currentWeek),G=O(()=>t.products),Q=O(()=>t.isEndlessMode),N=()=>{s.push("/")},L=()=>{const c=console.log;let a="";console.log=(...d)=>{a+=d.join(" ")+`
`,c(...d)};try{Lt(),n.value=a}finally{console.log=c}},q=()=>{t.advanceWeek()},Z=c=>{for(let a=0;a<c&&!t.gameOver;a++)t.advanceWeek()},X=()=>{r.value&&(t.player.money+=r.value)},x=()=>{let c={value:u.value,duration:g.value};switch(i.value){case"category":c.category=b.value;break;case"product":c.productId=k.value;break}t.addMarketModifier(i.value,c)},h=()=>{_.value.money!==null&&_.value.money>=0&&(t.player.money=_.value.money),_.value.debt!==null&&_.value.debt>=0&&(t.player.debt=_.value.debt),_.value.capacity!==null&&_.value.capacity>0&&(t.player.capacity=_.value.capacity)},f=()=>{_.value={money:t.player.money,debt:t.player.debt,capacity:t.player.capacity}},w=()=>{t.player.inventory=[],t.player.inventoryUsed=0},P=()=>{const c=y.value;if(c<1)return;const a=G.value;if(a.length===0)return;const d=Math.floor(Math.random()*a.length),$=a[d],D=St(),le=$.minPrice||$.basePrice*.7,me=$.maxPrice||$.basePrice*1.3,z=Math.floor(le+Math.random()*(me-le));D.addToInventory($,c,z)},S=()=>{M.value!==null&&M.value>=1&&M.value<=t.maxWeeks&&(t.currentWeek=M.value)},p=c=>{switch(c){case"early":t.currentWeek=5,t.player.money=3e3,t.player.debt=4500;break;case"mid":t.currentWeek=20,t.player.money=5e4,t.player.debt=2e3;break;case"late":t.currentWeek=35,t.player.money=2e5,t.player.debt=0;break}};return ce(()=>{G.value.length>0&&(k.value=G.value[0].id),f()}),(c,a)=>{var d;return v(),m("div",x1,[e("div",{class:"header-with-back"},[e("button",{class:"back-button",onClick:N},a[16]||(a[16]=[e("span",{class:"back-icon"},"←",-1),W(" 返回 ")])),a[17]||(a[17]=e("h1",null,"开发工具",-1))]),e("div",R1,[a[18]||(a[18]=e("h2",null,"价格系统测试",-1)),e("button",{onClick:L,class:"test-button"},"运行价格系统测试"),n.value?(v(),m("pre",A1,o(n.value),1)):T("",!0)]),e("div",O1,[a[31]||(a[31]=e("h2",null,"游戏操作",-1)),e("div",D1,[a[19]||(a[19]=e("h3",null,"周数控制",-1)),e("div",V1,[e("button",{onClick:q,class:"action-button"},"前进一周"),e("button",{onClick:a[0]||(a[0]=$=>Z(5)),class:"action-button"},"前进5周"),e("button",{onClick:a[1]||(a[1]=$=>Z(10)),class:"action-button"},"前进10周")])]),e("div",G1,[a[20]||(a[20]=e("h3",null,"资金调整",-1)),e("div",H1,[B(e("input",{type:"number","onUpdate:modelValue":a[2]||(a[2]=$=>r.value=$),placeholder:"金额"},null,512),[[ne,r.value,void 0,{number:!0}]]),e("button",{onClick:X,class:"action-button"},"增加资金")])]),e("div",W1,[a[24]||(a[24]=e("h3",null,"玩家参数调整",-1)),e("div",B1,[a[21]||(a[21]=e("label",null,"当前资金:",-1)),B(e("input",{type:"number","onUpdate:modelValue":a[3]||(a[3]=$=>_.value.money=$),placeholder:"资金"},null,512),[[ne,_.value.money,void 0,{number:!0}]])]),e("div",q1,[a[22]||(a[22]=e("label",null,"当前债务:",-1)),B(e("input",{type:"number","onUpdate:modelValue":a[4]||(a[4]=$=>_.value.debt=$),placeholder:"债务"},null,512),[[ne,_.value.debt,void 0,{number:!0}]])]),e("div",U1,[a[23]||(a[23]=e("label",null,"背包容量:",-1)),B(e("input",{type:"number","onUpdate:modelValue":a[5]||(a[5]=$=>_.value.capacity=$),placeholder:"容量"},null,512),[[ne,_.value.capacity,void 0,{number:!0}]])]),e("div",{class:"input-group actions"},[e("button",{onClick:h,class:"action-button success"},"应用参数"),e("button",{onClick:f,class:"action-button warning"},"重置参数")]),a[25]||(a[25]=e("h4",null,"库存操作",-1)),e("div",Q1,[e("button",{onClick:w,class:"action-button warning"},"清空库存"),e("button",{onClick:P,class:"action-button"},"添加随机物品"),B(e("input",{type:"number","onUpdate:modelValue":a[6]||(a[6]=$=>y.value=$),placeholder:"物品数量",min:"1",max:"10"},null,512),[[ne,y.value,void 0,{number:!0}]])])]),e("div",F1,[a[27]||(a[27]=e("h3",null,"游戏周数调整",-1)),e("div",z1,[a[26]||(a[26]=e("label",null,"设置周数:",-1)),B(e("input",{type:"number","onUpdate:modelValue":a[7]||(a[7]=$=>M.value=$),placeholder:"周数",min:"1",max:E(t).maxWeeks},null,8,j1),[[ne,M.value,void 0,{number:!0}]]),e("button",{onClick:S,class:"action-button"},"设置周数")])]),e("div",K1,[a[30]||(a[30]=e("h3",null,"市场修正",-1)),e("div",Y1,[B(e("select",{"onUpdate:modelValue":a[8]||(a[8]=$=>i.value=$)},a[28]||(a[28]=[e("option",{value:"global"},"全局修正",-1),e("option",{value:"category"},"类别修正",-1),e("option",{value:"product"},"商品修正",-1)]),512),[[_e,i.value]]),i.value==="category"?B((v(),m("select",{key:0,"onUpdate:modelValue":a[9]||(a[9]=$=>b.value=$)},a[29]||(a[29]=[We('<option value="DAILY" data-v-dd5bff4d>日常用品</option><option value="FOOD" data-v-dd5bff4d>食品</option><option value="ELECTRONICS" data-v-dd5bff4d>电子产品</option><option value="LUXURY" data-v-dd5bff4d>奢侈品</option><option value="COLLECTIBLE" data-v-dd5bff4d>收藏品</option>',5)]),512)),[[_e,b.value]]):T("",!0),i.value==="product"?B((v(),m("select",{key:1,"onUpdate:modelValue":a[10]||(a[10]=$=>k.value=$)},[(v(!0),m(F,null,oe(G.value,$=>(v(),m("option",{key:$.id,value:$.id},o($.name),9,X1))),128))],512)),[[_e,k.value]]):T("",!0),B(e("input",{type:"number","onUpdate:modelValue":a[11]||(a[11]=$=>u.value=$),step:"0.1",min:"0.1",max:"2.0",placeholder:"修正值(0.1-2.0)"},null,512),[[ne,u.value,void 0,{number:!0}]]),B(e("input",{type:"number","onUpdate:modelValue":a[12]||(a[12]=$=>g.value=$),min:"1",placeholder:"持续周数"},null,512),[[ne,g.value,void 0,{number:!0}]]),e("button",{onClick:x,class:"action-button"},"应用修正")])])]),e("div",J1,[a[35]||(a[35]=e("h2",null,"游戏场景预设",-1)),e("div",Z1,[e("div",{class:"scenario-card",onClick:a[13]||(a[13]=$=>p("early"))},a[32]||(a[32]=[e("h3",null,"前期阶段",-1),e("p",null,"设置为游戏前期状态：",-1),e("ul",null,[e("li",null,"周数：5周"),e("li",null,"资金：3000元"),e("li",null,"债务：4500元")],-1)])),e("div",{class:"scenario-card",onClick:a[14]||(a[14]=$=>p("mid"))},a[33]||(a[33]=[e("h3",null,"中期阶段",-1),e("p",null,"设置为游戏中期状态：",-1),e("ul",null,[e("li",null,"周数：20周"),e("li",null,"资金：50000元"),e("li",null,"债务：2000元")],-1)])),e("div",{class:"scenario-card",onClick:a[15]||(a[15]=$=>p("late"))},a[34]||(a[34]=[e("h3",null,"后期阶段",-1),e("p",null,"设置为游戏后期状态：",-1),e("ul",null,[e("li",null,"周数：35周"),e("li",null,"资金：200000元"),e("li",null,"债务：0元")],-1)]))])]),e("div",eg,[a[43]||(a[43]=e("h2",null,"当前游戏状态",-1)),e("div",tg,[e("div",sg,[a[36]||(a[36]=e("strong",null,"玩家名称:",-1)),W(" "+o(c.playerStore.name),1)]),e("div",ng,[a[37]||(a[37]=e("strong",null,"当前周数:",-1)),W(" "+o(E(t).currentWeek)+o(Q.value?"":"/"+E(t).maxWeeks),1)]),e("div",og,[a[38]||(a[38]=e("strong",null,"玩家资金:",-1)),W(" ¥"+o(E(A)(E(t).player.money)),1)]),e("div",ag,[a[39]||(a[39]=e("strong",null,"玩家债务:",-1)),W(" ¥"+o(E(A)(E(t).player.debt)),1)]),e("div",lg,[a[40]||(a[40]=e("strong",null,"背包使用:",-1)),W(" "+o(E(t).player.inventoryUsed)+"/"+o(E(t).player.capacity),1)]),e("div",ig,[a[41]||(a[41]=e("strong",null,"当前地点:",-1)),W(" "+o((d=E(t).currentLocation)==null?void 0:d.name),1)]),e("div",rg,[a[42]||(a[42]=e("strong",null,"市场状态:",-1)),W(" "+o(E(t).marketStatus),1)])]),a[44]||(a[44]=e("h3",null,"市场调整因子",-1)),e("pre",ug,o(JSON.stringify(E(t).marketModifiers,null,2)),1)])])}}},dg=ae(cg,[["__scopeId","data-v-dd5bff4d"]]);const vg={class:"loading-test"},mg={key:0,class:"test-complete"},pg={__name:"LoadingTest",setup(l){const t=Ie(),s=C(!0),n=C("测试加载中..."),r=C(0);function i(){s.value=!1}return ce(()=>{const u=["初始化测试环境...","加载测试数据...","处理测试资源...","准备测试结果...","完成测试加载"];let g=0;const b=setInterval(()=>{g<u.length?(n.value=u[g],r.value=Math.min(100,(g+1)*20),g++):clearInterval(b)},1e3)}),(u,g)=>(v(),m("div",vg,[j(Nt,{title:"测试加载动画",status:n.value,progress:r.value,onComplete:i},null,8,["status","progress"]),s.value?T("",!0):(v(),m("div",mg,[g[1]||(g[1]=e("h1",null,"加载测试完成",-1)),e("button",{onClick:g[0]||(g[0]=b=>E(t).push("/"))},"返回主菜单")]))]))}},gg=ae(pg,[["__scopeId","data-v-2aa48468"]]);console.log("应用初始化开始");Bt();const dt=hs({history:_s(),routes:[{path:"/",component:Ma},{path:"/game",component:qp},{path:"/settings",component:i1},{path:"/saves",component:E1},{path:"/dev-tools",component:dg},{path:"/game-over",component:It},{path:"/loading-test",component:gg}]});console.log("路由初始化完成");const yg=bs(),Re=ys(Jo);Re.use(yg);Re.use(dt);Re.use(pe);console.log("插件注册完成");ua(Re);qt(Re);console.log("第三方库和错误处理设置完成");(async function(){try{const{useUiStore:t}=await Le(()=>import("./stores-b6778457.js").then(g=>g.z),["./stores-b6778457.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),{useGameCoreStore:s}=await Le(()=>import("./stores-b6778457.js").then(g=>g.B),["./stores-b6778457.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),{useSettingsStore:n}=await Le(()=>import("./stores-b6778457.js").then(g=>g.A),["./stores-b6778457.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),r=t(),i=s(),u=n();console.log("Pinia存储预初始化完成:",{uiStore:!!r,gameCoreStore:!!i,settingsStore:!!u}),fg()}catch(t){ee(t,"main.pinitaInit",se.SYSTEM,te.ERROR),console.error("Pinia存储预初始化失败:",t)}})();function fg(){try{console.log("开始验证关键资源..."),console.log("关键资源验证完成")}catch(l){console.error("验证资源时出错:",l)}}(async function(){try{if(Ut()){console.info("检测到异常退出，准备恢复");try{const s=await Le(()=>import("./stores-b6778457.js").then(u=>u.z),["./stores-b6778457.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),n=await Le(()=>import("./stores-b6778457.js").then(u=>u.B),["./stores-b6778457.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url);await Mt();const r=s.useUiStore(),i=n.useGameCoreStore();if(!r||!i)throw new Error("无法获取存储实例");setTimeout(async()=>{try{const u=await Le(()=>Promise.resolve().then(()=>aa),void 0,import.meta.url),{loadLatestSnapshot:g,applySnapshot:b}=u,k=await g();k&&r.showRecoveryDialog({snapshot:k,message:"检测到游戏异常退出。是否恢复上次的游戏状态？",title:"游戏恢复",allowCancel:!0,onRecover:async()=>{try{await b(i,k)&&(r.showToast({type:"success",message:"游戏状态已成功恢复"}),dt.currentRoute.value.path!=="/game"&&dt.push("/game"))}catch(_){ee(_,"main.applySnapshot",se.STORAGE,te.ERROR),console.error("恢复游戏状态时出错:",_),r.showToast({type:"error",message:"恢复游戏状态失败"})}},onCancel:()=>{console.log("用户取消了恢复操作")}})}catch(u){ee(u,"main.loadSnapshot",se.STORAGE,te.ERROR),console.error("加载快照时出错:",u)}},1e3)}catch(s){ee(s,"main.initRecovery",se.SYSTEM,te.ERROR),console.error("准备恢复游戏状态时出错:",s)}}}catch(t){ee(t,"main.checkAbnormalExit",se.SYSTEM,te.ERROR),console.error("检查异常退出时出错:",t)}})();Ct();window.addEventListener("beforeunload",()=>{Qt()});setInterval(()=>{Ct()},6e4);let vt=!1;function xt(){if(!vt)try{document.getElementById("app")?(console.log("找到挂载点，挂载应用"),Re.mount("#app"),vt=!0,console.log("应用挂载完成"),window.dispatchEvent(new Event("app-loaded")),window.electronAPI&&window.electronAPI.onMenuAction&&window.electronAPI.onMenuAction(t=>{console.log("收到菜单事件:",t),t==="menu:open-dev-tools"&&window.dispatchEvent(new CustomEvent("show-dev-tools"))})):console.error("找不到挂载点 #app")}catch(l){ee(l,"main.mountApp",se.SYSTEM,te.FATAL),console.error("应用挂载失败:",l)}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM已加载，准备挂载应用"),xt()});setTimeout(()=>{vt||(console.log("使用备用方法挂载应用"),xt())},1e3);
