import{h as ee,E as te,a as se,i as pe,u as Pe,b as vt,c as we,d as Ge,e as St,f as _e,g as Le,j as wt,k as mt,l as Dt,m as He,n as Vt,P as X,o as Gt,p as Ht,q as Je,r as Wt,s as pt,t as Bt,v as qt,_ as Ne,w as Ut,x as Ct,y as Qt}from"./stores-6663fff5.js";import{t as d,v,x as e,_ as a,Y as P,ac as ue,e as A,F as J,ak as ae,a as S,d as ce,E as qe,$ as z,V as ie,Q as G,a9 as Ze,L as Ft,b as ve,bX as We,R as Ce,W,a0 as rt,aH as ne,u as E,bY as he,U as Be,q as zt,aC as ke,n as ye,bZ as jt,b_ as Kt,b$ as Yt,c0 as Xt,ao as Ae,c1 as Jt,c2 as Zt,c3 as Oe,c4 as es,c5 as ts,c6 as ss,c7 as ns,c8 as as,c9 as os,ca as ls,cb as is,cc as rs,cd as us,ce as cs,cf as ds,cg as vs,ch as ms,a1 as re,al as Tt,aA as De,Z as H,ay as ut,a3 as ps,a5 as gs,b2 as ys}from"./vendor-e7c44fa3.js";import{u as Me,a as Ee,s as fs,b as hs,e as _s,f as bs}from"./vue-core-cd9800c2.js";import{i as $s,z as ks}from"./element-plus-c3799c73.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))n(u);new MutationObserver(u=>{for(const i of u)if(i.type==="childList")for(const c of i.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&n(c)}).observe(document,{childList:!0,subtree:!0});function s(u){const i={};return u.integrity&&(i.integrity=u.integrity),u.referrerPolicy&&(i.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?i.credentials="include":u.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(u){if(u.ep)return;u.ep=!0;const i=s(u);fetch(u.href,i)}})();const oe=(l,t)=>{const s=l.__vccOpts||l;for(const[n,u]of t)s[n]=u;return s},Ss={name:"ErrorDialog",props:{show:{type:Boolean,default:!1},title:{type:String,default:"错误"},message:{type:String,default:"应用程序发生错误"},details:{type:String,default:""},timestamp:{type:String,default:""},context:{type:String,default:""},fatal:{type:Boolean,default:!1}},emits:["close"],computed:{showRestartButton(){return this.fatal}},methods:{handleClose(){this.fatal||this.$emit("close")},restartApp(){window.electronAPI&&window.electronAPI.quitApp?window.electronAPI.quitApp():window.location.reload()},formatTimestamp(l){try{return new Date(l).toLocaleString()}catch(t){return ee(t,"ErrorDialog (common)",se.UNKNOWN,te.ERROR),l}}}},ws={class:"error-dialog",role:"dialog","aria-modal":"true"},Cs={class:"error-dialog-header"},Ts={class:"error-dialog-body"},Ps={class:"error-content"},Ms={class:"error-message"},Es={key:0,class:"error-timestamp"},Is={key:1,class:"error-context"},Ns={key:0,class:"error-details"},Ls={class:"error-stack"},Rs={class:"error-dialog-footer"};function xs(l,t,s,n,u,i){return s.show?(d(),v("div",{key:0,class:"error-dialog-overlay",onClick:t[3]||(t[3]=ue((...c)=>i.handleClose&&i.handleClose(...c),["self"]))},[e("div",ws,[e("div",Cs,[e("h3",null,a(s.title||"错误"),1),e("button",{class:"close-button",onClick:t[0]||(t[0]=(...c)=>i.handleClose&&i.handleClose(...c))},"×")]),e("div",Ts,[t[4]||(t[4]=e("div",{class:"error-icon"},[e("svg",{viewBox:"0 0 24 24",width:"48",height:"48"},[e("circle",{cx:"12",cy:"12",r:"11",fill:"#f56c6c"}),e("path",{d:"M12 7v6M12 17v.1",stroke:"white","stroke-width":"2","stroke-linecap":"round"})])],-1)),e("div",Ps,[e("div",Ms,a(s.message),1),s.timestamp?(d(),v("div",Es,a(i.formatTimestamp(s.timestamp)),1)):P("",!0),s.context?(d(),v("div",Is,a(s.context),1)):P("",!0)])]),s.details?(d(),v("div",Ns,[e("details",null,[t[5]||(t[5]=e("summary",null,"显示详细信息",-1)),e("div",Ls,[e("pre",null,a(s.details),1)])])])):P("",!0),e("div",Rs,[i.showRestartButton?(d(),v("button",{key:0,class:"restart-button",onClick:t[1]||(t[1]=(...c)=>i.restartApp&&i.restartApp(...c))}," 重启应用 ")):P("",!0),e("button",{class:"dismiss-button",onClick:t[2]||(t[2]=(...c)=>i.handleClose&&i.handleClose(...c))}," 关闭 ")])])])):P("",!0)}const As=oe(Ss,[["render",xs],["__scopeId","data-v-cb85fd19"]]);function x(l){return l==null?"0":pe&&pe.global&&typeof pe.global.formatNumber=="function"?pe.global.formatNumber(l):l.toLocaleString("zh-CN")}function gt(l,t="¥"){return l==null?`${t}0`:pe&&pe.global&&typeof pe.global.formatCurrency=="function"?pe.global.formatCurrency(l):`${t}${x(l)}`}function Os(l){return l==null?"0.0%":`${l>0?"+":""}${l.toFixed(1)}%`}function Ds(l,t="datetime"){if(!l)return"";if(pe&&pe.global&&typeof pe.global.formatDate=="function")return pe.global.formatDate(new Date(l),t);const s=new Date(l);switch(t){case"date":return s.toLocaleDateString("zh-CN");case"time":return s.toLocaleTimeString("zh-CN");case"datetime":default:return s.toLocaleString("zh-CN")}}function _t(l){return l==null?"change-neutral":l>3?"change-up-strong":l>0?"change-up":l<-3?"change-down-strong":l<0?"change-down":"change-neutral"}const Vs={name:"ErrorRecoveryDialog",props:{show:{type:Boolean,default:!1},snapshot:{type:Object,default:null},message:{type:String,default:""},title:{type:String,default:""},allowCancel:{type:Boolean,default:!0}},emits:["recover","cancel"],computed:{defaultTitle(){return this.$t("recovery.title","游戏恢复")}},methods:{formatMoney(l){return l===void 0?"":gt(l)},handleRecover(){this.$emit("recover")},handleCancel(){this.$emit("cancel")},cancelIfAllowed(){this.allowCancel&&this.handleCancel()}}},Gs={key:0,class:"error-recovery-dialog"},Hs={class:"dialog-content"},Ws={key:0,class:"recovery-info"},Bs={class:"info-row"},qs={class:"label"},Us={class:"value"},Qs={class:"info-row"},Fs={class:"label"},zs={class:"value"},js={key:0,class:"info-row"},Ks={class:"label"},Ys={class:"value"},Xs={key:1,class:"info-row"},Js={class:"label"},Zs={class:"value"},en={class:"message"},tn={key:0},sn={key:1},nn={class:"button-group"};function an(l,t,s,n,u,i){var c,p;return s.show?(d(),v("div",Gs,[e("div",{class:"dialog-backdrop",onClick:t[0]||(t[0]=(...f)=>i.cancelIfAllowed&&i.cancelIfAllowed(...f))}),e("div",Hs,[e("h2",null,a(s.title||i.defaultTitle),1),s.snapshot?(d(),v("div",Ws,[e("div",Bs,[e("span",qs,a(l.$t("recovery.date"))+":",1),e("span",Us,a(l.formatDate(s.snapshot.timestamp)),1)]),e("div",Qs,[e("span",Fs,a(l.$t("recovery.gameWeek"))+":",1),e("span",zs,a(l.$t("recovery.weekNumber",{week:s.snapshot.currentWeek})),1)]),(c=s.snapshot.player)!=null&&c.name?(d(),v("div",js,[e("span",Ks,a(l.$t("recovery.playerName"))+":",1),e("span",Ys,a(s.snapshot.player.name),1)])):P("",!0),((p=s.snapshot.player)==null?void 0:p.money)!==void 0?(d(),v("div",Xs,[e("span",Js,a(l.$t("recovery.money"))+":",1),e("span",Zs,a(i.formatMoney(s.snapshot.player.money)),1)])):P("",!0)])):P("",!0),e("div",en,[s.message?(d(),v("p",tn,a(s.message),1)):(d(),v("p",sn,a(l.$t("recovery.defaultMessage")),1))]),e("div",nn,[e("button",{class:"btn-recover",onClick:t[1]||(t[1]=(...f)=>i.handleRecover&&i.handleRecover(...f))},a(l.$t("recovery.recover")),1),s.allowCancel?(d(),v("button",{key:0,class:"btn-cancel",onClick:t[2]||(t[2]=(...f)=>i.handleCancel&&i.handleCancel(...f))},a(l.$t("recovery.cancel")),1)):P("",!0)])])])):P("",!0)}const on=oe(Vs,[["render",an],["__scopeId","data-v-2a9eaae0"]]);const ln={class:"dialog-container"},rn={class:"dialog-header"},un={class:"dialog-title"},cn={class:"dialog-content"},dn={class:"dialog-actions"},vn={__name:"GameDialog",setup(l){Me();const t=Pe(),s=A(()=>t.dialogVisible),n=A(()=>t.dialogData||{}),u=A(()=>n.value.message?n.value.message.split(`
`):[]),i=()=>{t.closeDialog()},c=()=>{typeof n.value.onConfirm=="function"&&n.value.onConfirm(),i()},p=()=>{typeof n.value.onCancel=="function"&&n.value.onCancel(),i()},f=()=>{n.value.closeOnBackdrop!==!1&&i()};return($,b)=>s.value?(d(),v("div",{key:0,class:"dialog-overlay",onClick:ue(f,["self"])},[e("div",ln,[e("div",rn,[e("h2",un,a(n.value.title),1),n.value.showClose!==!1?(d(),v("button",{key:0,class:"dialog-close",onClick:i}," × ")):P("",!0)]),e("div",cn,[(d(!0),v(J,null,ae(u.value,(y,M)=>(d(),v("p",{key:M},a(y),1))),128))]),e("div",dn,[n.value.showCancel!==!1?(d(),v("button",{key:0,class:"dialog-button cancel-button",onClick:p},a(n.value.cancelText||$.$t("common.cancel")),1)):P("",!0),e("button",{class:"dialog-button confirm-button",onClick:c},a(n.value.confirmText||$.$t("common.confirm")),1)])])])):P("",!0)}},mn=oe(vn,[["__scopeId","data-v-2aa9e908"]]);const pn={class:"toast-icon"},gn={key:0},yn={key:1},fn={key:2},hn={key:3},_n={class:"toast-content"},bn={key:0,class:"toast-title"},$n={class:"toast-message"},kn=["onClick"],Sn={__name:"Toast",setup(l){const t=Pe(),s=A(()=>t.toasts),n=S(!1),u=()=>{n.value=!!document.querySelector(".modal-backdrop")},i=$=>{t.removeToast($)},c=$=>{console.log(`模拟播放Toast音效: ${$}（音频功能已禁用）`)},p=S(0),f=()=>{if(s.value.length>p.value){const $=s.value[0];$&&c($.type),u()}p.value=s.value.length};return ce(()=>{p.value=s.value.length,u();const $=setInterval(()=>{f(),u()},100);qe(()=>{clearInterval($)})}),($,b)=>(d(),v("div",{class:G(["toast-container",{"modal-open":n.value}])},[z(Ze,{name:"toast"},{default:ie(()=>[(d(!0),v(J,null,ae(s.value,y=>(d(),v("div",{key:y.id,class:G(["toast",`toast-${y.type}`])},[e("div",pn,[y.type==="success"?(d(),v("span",gn,"✓")):y.type==="info"?(d(),v("span",yn,"ℹ")):y.type==="warning"?(d(),v("span",fn,"⚠")):y.type==="error"?(d(),v("span",hn,"✖")):P("",!0)]),e("div",_n,[y.title?(d(),v("div",bn,a(y.title),1)):P("",!0),e("div",$n,a(y.message),1)]),e("button",{class:"toast-close",onClick:M=>i(y.id)},"×",8,kn)],2))),128))]),_:1})],2))}},wn=oe(Sn,[["__scopeId","data-v-8ad994ac"]]),Cn={class:"audio-manager",style:{display:"none"}},Tn={__name:"AudioManager",setup(l,{expose:t}){const s=vt(),n=S({sounds:{},load:(u,i)=>(console.log(`模拟加载音效: ${u}, 路径: ${i}（音频功能已禁用）`),n.value.sounds[u]={id:u,path:i,volume:c=>(console.log(`模拟设置音效 ${u} 音量: ${c}`),n.value.sounds[u]),play:()=>(console.log(`模拟播放音效: ${u}（音频功能已禁用）`),n.value.sounds[u]),stop:()=>(console.log(`模拟停止音效: ${u}（音频功能已禁用）`),n.value.sounds[u])},n.value.sounds[u]),play:u=>(console.log(`模拟播放音效: ${u}（音频功能已禁用）`),null),stop:u=>(console.log(`模拟停止音效: ${u}（音频功能已禁用）`),null),setVolume:u=>{console.log(`模拟设置全局音量: ${u}（音频功能已禁用）`)}});return Ft("audio",n.value),ce(()=>{console.log("AudioManager初始化（音频功能已禁用）")}),ve(()=>s.soundVolume,u=>{console.log(`音效音量变化: ${u}（音频功能已禁用）`)}),ve(()=>s.musicVolume,u=>{console.log(`音乐音量变化: ${u}（音频功能已禁用）`)}),t({playSound:u=>{console.log(`模拟播放音效: ${u}（音频功能已禁用）`)},stopSound:u=>{console.log(`模拟停止音效: ${u}（音频功能已禁用）`)},playBackgroundMusic:u=>{console.log(`模拟播放背景音乐: ${u}（音频功能已禁用）`)},stopBackgroundMusic:()=>{console.log("模拟停止背景音乐（音频功能已禁用）")},setMusicVolume:u=>{console.log(`模拟设置背景音乐音量: ${u}（音频功能已禁用）`)},setSoundVolume:u=>{console.log(`模拟设置音效音量: ${u}（音频功能已禁用）`)},pauseAll:()=>{console.log("模拟暂停所有音频（音频功能已禁用）")},resumeAll:()=>{console.log("模拟恢复所有音频（音频功能已禁用）")}}),(u,i)=>(d(),v("div",Cn))}};const Pn={class:"loading-content"},Mn={key:0,class:"loading-title"},En={class:"loading-status"},In={class:"progress-container"},Nn={class:"progress-bar"},Ln={class:"progress-text"},Rn={key:1,class:"loading-tips"},xn={class:"tip-content"},An={__name:"CssLoader",props:{title:{type:String,default:"正在加载"},status:{type:String,default:"加载中..."},progress:{type:Number,default:0},tips:{type:Array,default:()=>["正在加载游戏资源...","初始化市场数据...","准备房产信息...","生成游戏事件...","加载游戏界面...","游戏即将开始..."]}},emits:["complete"],setup(l,{emit:t}){const s=l,n=t,u=S(0),i=A(()=>s.tips[u.value]),c=S(!1);ve(()=>s.progress,b=>{b>=100&&$()});let p=null;const f=()=>{p=setInterval(()=>{u.value=(u.value+1)%s.tips.length},3e3)},$=()=>{c.value=!0,setTimeout(()=>{n("complete")},1e3)};return ce(()=>{f()}),qe(()=>{p&&clearInterval(p)}),(b,y)=>(d(),v("div",{class:G(["css-loader-container",{"fade-out":c.value}])},[y[0]||(y[0]=We('<div class="spinner" data-v-22459b56><div class="circle" data-v-22459b56></div><div class="circle" data-v-22459b56></div><div class="circle" data-v-22459b56></div><div class="circle" data-v-22459b56></div></div>',1)),e("div",Pn,[l.title?(d(),v("h2",Mn,a(l.title),1)):P("",!0),e("div",En,a(l.status),1),e("div",In,[e("div",Nn,[e("div",{class:"progress-fill",style:Ce({width:`${l.progress}%`})},null,4)]),e("div",Ln,a(l.progress)+"%",1)]),l.tips.length>0?(d(),v("div",Rn,[e("div",xn,a(i.value),1)])):P("",!0)])],2))}},On=oe(An,[["__scopeId","data-v-22459b56"]]);const Dn={class:"header-buttons"},Vn={class:"tool-content"},Gn={class:"tab-buttons"},Hn=["onClick"],Wn={key:0,class:"tab-panel"},Bn={class:"tool-group"},qn={class:"input-group"},Un={class:"tool-group"},Qn={class:"input-group"},Fn={class:"tool-group"},zn={class:"input-group"},jn=["max"],Kn={key:1,class:"tab-panel"},Yn={class:"tool-group"},Xn={class:"input-group"},Jn={class:"tool-group"},Zn={class:"input-group"},ea={key:2,class:"tab-panel"},ta={class:"tool-group"},sa={class:"input-group"},na={class:"tool-group"},aa={class:"input-group"},oa=["value"],la={class:"tool-group"},ia={class:"input-group"},ra=["value"],ua={key:3,class:"tab-panel"},ca={class:"tool-group"},da={class:"house-list"},va={key:0,class:"empty-message"},ma={class:"house-info"},pa={class:"house-name"},ga={class:"house-price"},ya=["onClick"],fa={key:4,class:"tab-panel"},ha={class:"tool-group"},_a={class:"event-list"},ba={class:"event-info"},$a={class:"event-name"},ka={class:"event-desc"},Sa=["onClick"],wa={key:5,class:"tab-panel"},Ca={class:"tool-group"},Ta={class:"input-group"},Pa={class:"tool-group"},Ma={class:"save-list"},Ea={key:0,class:"empty-message"},Ia={class:"save-info"},Na={class:"save-name"},La={class:"save-date"},Ra=["onClick"],xa={key:6,class:"tab-panel"},Aa={class:"tool-group"},Oa={class:"status-info"},Da={class:"status-row"},Va={class:"status-value"},Ga={class:"status-row"},Ha={class:"status-value"},Wa={class:"status-row"},Ba={class:"status-value"},qa={class:"status-row"},Ua={class:"status-value"},Qa={__name:"FloatingDevTools",setup(l){const t=we(),s=S(!1),n=S(20),u=S(80),i=S(320),c=S(400),p=S("basic"),f=S(!1),$=S(!1),b=S(0),y=S(0),M=S(0),V=S(0),U=S(1e3),N=S(0),R=S(1),B=S(100),Z=S(1),Y=S(null),L=S(1),h=S(null),g=S(3),T=S(null),w=S(null),k=S("快速存档"),r=S([]),m=[{id:"basic",name:"基础"},{id:"inventory",name:"库存"},{id:"market",name:"市场"},{id:"house",name:"房产"},{id:"events",name:"事件"},{id:"status",name:"状态"},{id:"save",name:"存档"}],o=A(()=>({left:`${n.value}px`,top:`${u.value}px`,width:`${i.value}px`,height:s.value?"auto":`${c.value}px`})),_=j=>{j.button===0&&(f.value=!0,b.value=j.clientX-n.value,y.value=j.clientY-u.value,document.addEventListener("mousemove",C),document.addEventListener("mouseup",Q),j.preventDefault())},C=j=>{f.value&&(n.value=j.clientX-b.value,u.value=j.clientY-y.value,n.value=Math.max(0,Math.min(window.innerWidth-i.value,n.value)),u.value=Math.max(0,Math.min(window.innerHeight-40,u.value)))},Q=()=>{f.value=!1,document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",Q)},le=j=>{$.value=!0,M.value=i.value,V.value=c.value,b.value=j.clientX,y.value=j.clientY,document.addEventListener("mousemove",me),document.addEventListener("mouseup",F),j.preventDefault()},me=j=>{if($.value){const I=M.value+(j.clientX-b.value),D=V.value+(j.clientY-y.value);i.value=Math.max(300,I),c.value=Math.max(200,D)}},F=()=>{$.value=!1,document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",F)},de=()=>{s.value=!s.value},be=()=>{const j=new CustomEvent("close-dev-tools");window.dispatchEvent(j)},Ie=()=>{U.value&&(t.player.money+=U.value)},fe=()=>{U.value!==null&&U.value>=0&&(t.player.money=U.value)},Ue=()=>{N.value!==null&&N.value>=0&&(t.player.debt=N.value)},xe=()=>{t.advanceWeek()},tt=j=>{for(let I=0;I<j&&!t.gameOver;I++)t.advanceWeek()},Qe=()=>{R.value!==null&&R.value>=1&&R.value<=t.maxWeeks&&(t.currentWeek=R.value)},Fe=()=>{B.value!==null&&B.value>0&&(t.player.capacity=B.value)},ze=()=>{t.player.inventory=[],t.player.inventoryUsed=0},st=()=>{const j=Z.value;if(j<1)return;const I=t.products;if(!I||I.length===0)return;const D=Math.floor(Math.random()*I.length),Te=I[D],ht=St(),Ye=Te.minPrice||Te.basePrice*.7,At=Te.maxPrice||Te.basePrice*1.3,Ot=Math.floor(Ye+Math.random()*(At-Ye));ht.addToInventory(Te,j,Ot)},nt=()=>{Y.value&&t.addMarketModifier("product",{productId:Y.value,value:L.value,duration:g.value})},at=()=>{h.value&&t.addMarketModifier("category",{category:h.value,value:L.value,duration:g.value})},ot=()=>{t.addMarketModifier("global",{value:L.value,duration:g.value})},lt=()=>{t.updateMarketState(t.currentWeek)},it=()=>{if(T.value){const j=$e.value.find(Ye=>Ye.id===T.value);if(!j)return;const I=_e();t.player.money<j.price&&(t.player.money=j.price+1e3),Le().purchaseHouse(j)?(console.log("开发工具 - 成功购买房屋:",j.name),I.achieveVictoryWithHouse(j)):(console.error("开发工具 - 购买房屋失败"),alert("购买失败，请检查开发者控制台获取更多信息"))}},je=()=>{if(w.value){const I=wt().triggerSpecificEvent(w.value);I?console.log("成功触发事件:",I.id,I.title):console.error("触发事件失败:",w.value)}},Ke=()=>{t.saveGame(k.value||"快速存档",!1)},O=j=>{t.loadGame(j)},K=async()=>{const j=await t.getSaves();r.value=j||[]};ce(()=>{R.value=t.currentWeek,N.value=t.player.debt,B.value=t.player.capacity});const q=A(()=>t.products||[]),ge=A(()=>["DAILY","FOOD","ELECTRONICS","LUXURY","COLLECTIBLE"]),$e=A(()=>t.houses||[]),xt=A(()=>{try{const j=Ge();if(j.eventSystem&&j.eventSystem.events)return j.eventSystem.events.map(I=>({id:I.id,name:I.title||I.id,description:I.description||""}))}catch(j){console.error("获取事件列表失败:",j)}return[{id:"market_crash",name:"市场崩盘",description:"商品价格大幅下降"},{id:"market_boom",name:"市场繁荣",description:"商品价格大幅上涨"},{id:"debt_collector",name:"讨债人",description:"债务催收事件"},{id:"lucky_find",name:"幸运发现",description:"获得随机奖励"}]});return qe(()=>{document.removeEventListener("mousemove",C),document.removeEventListener("mouseup",Q),document.removeEventListener("mousemove",me),document.removeEventListener("mouseup",F)}),(j,I)=>(d(),v("div",{class:G(["floating-dev-tools",{minimized:s.value}]),style:Ce(o.value)},[e("div",{class:"tool-header",onMousedown:_},[I[13]||(I[13]=e("h3",null,"游戏开发工具",-1)),e("div",Dn,[e("button",{class:"minimize-btn",onClick:de},a(s.value?"↗":"↘"),1),e("button",{class:"close-btn",onClick:be},"✕")])],32),W(e("div",Vn,[e("div",Gn,[(d(),v(J,null,ae(m,D=>e("button",{key:D.id,onClick:Te=>p.value=D.id,class:G([{active:p.value===D.id},"tab-btn"])},a(D.name),11,Hn)),64))]),p.value==="basic"?(d(),v("div",Wn,[e("div",Bn,[I[14]||(I[14]=e("h4",null,"玩家资金",-1)),e("div",qn,[W(e("input",{type:"number","onUpdate:modelValue":I[0]||(I[0]=D=>U.value=D),placeholder:"金额"},null,512),[[ne,U.value,void 0,{number:!0}]]),e("button",{onClick:Ie,class:"action-button"},"增加"),e("button",{onClick:fe,class:"action-button"},"设置")])]),e("div",Un,[I[15]||(I[15]=e("h4",null,"玩家债务",-1)),e("div",Qn,[W(e("input",{type:"number","onUpdate:modelValue":I[1]||(I[1]=D=>N.value=D),placeholder:"债务"},null,512),[[ne,N.value,void 0,{number:!0}]]),e("button",{onClick:Ue,class:"action-button"},"设置")])]),e("div",Fn,[I[16]||(I[16]=e("h4",null,"游戏周数",-1)),e("div",zn,[e("button",{onClick:xe,class:"action-button"},"+1周"),e("button",{onClick:I[2]||(I[2]=D=>tt(5)),class:"action-button"},"+5周"),W(e("input",{type:"number","onUpdate:modelValue":I[3]||(I[3]=D=>R.value=D),min:"1",max:E(t).maxWeeks,placeholder:"周数"},null,8,jn),[[ne,R.value,void 0,{number:!0}]]),e("button",{onClick:Qe,class:"action-button"},"设置")])])])):P("",!0),p.value==="inventory"?(d(),v("div",Kn,[e("div",Yn,[I[17]||(I[17]=e("h4",null,"背包容量",-1)),e("div",Xn,[W(e("input",{type:"number","onUpdate:modelValue":I[4]||(I[4]=D=>B.value=D),placeholder:"容量",min:"1"},null,512),[[ne,B.value,void 0,{number:!0}]]),e("button",{onClick:Fe,class:"action-button"},"设置")])]),e("div",Jn,[I[18]||(I[18]=e("h4",null,"库存操作",-1)),e("div",Zn,[e("button",{onClick:ze,class:"action-button warning"},"清空库存"),W(e("input",{type:"number","onUpdate:modelValue":I[5]||(I[5]=D=>Z.value=D),placeholder:"物品数量",min:"1",max:"10"},null,512),[[ne,Z.value,void 0,{number:!0}]]),e("button",{onClick:st,class:"action-button"},"添加随机物品")])])])):P("",!0),p.value==="market"?(d(),v("div",ea,[e("div",ta,[I[19]||(I[19]=e("h4",null,"全局市场修正",-1)),e("div",sa,[W(e("input",{type:"number","onUpdate:modelValue":I[6]||(I[6]=D=>L.value=D),step:"0.1",min:"0.5",max:"2.0",placeholder:"修正值"},null,512),[[ne,L.value,void 0,{number:!0}]]),W(e("input",{type:"number","onUpdate:modelValue":I[7]||(I[7]=D=>g.value=D),min:"1",max:"10",placeholder:"持续周数"},null,512),[[ne,g.value,void 0,{number:!0}]]),e("button",{onClick:ot,class:"action-button"},"应用全局修正")])]),e("div",na,[I[21]||(I[21]=e("h4",null,"商品分类修正",-1)),e("div",aa,[W(e("select",{"onUpdate:modelValue":I[8]||(I[8]=D=>h.value=D)},[I[20]||(I[20]=e("option",{value:""},"-- 选择分类 --",-1)),(d(!0),v(J,null,ae(ge.value,D=>(d(),v("option",{key:D,value:D},a(D),9,oa))),128))],512),[[he,h.value]]),W(e("input",{type:"number","onUpdate:modelValue":I[9]||(I[9]=D=>L.value=D),step:"0.1",min:"0.5",max:"2.0",placeholder:"修正值"},null,512),[[ne,L.value,void 0,{number:!0}]]),e("button",{onClick:at,class:"action-button"},"应用修正")])]),e("div",la,[I[23]||(I[23]=e("h4",null,"单个商品修正",-1)),e("div",ia,[W(e("select",{"onUpdate:modelValue":I[10]||(I[10]=D=>Y.value=D)},[I[22]||(I[22]=e("option",{value:""},"-- 选择商品 --",-1)),(d(!0),v(J,null,ae(q.value,D=>(d(),v("option",{key:D.id,value:D.id},a(D.name),9,ra))),128))],512),[[he,Y.value]]),W(e("input",{type:"number","onUpdate:modelValue":I[11]||(I[11]=D=>L.value=D),step:"0.1",min:"0.5",max:"2.0",placeholder:"修正值"},null,512),[[ne,L.value,void 0,{number:!0}]]),e("button",{onClick:nt,class:"action-button"},"应用修正")])]),e("div",{class:"tool-group"},[e("div",{class:"input-group"},[e("button",{onClick:lt,class:"action-button"},"刷新市场价格")])])])):P("",!0),p.value==="house"?(d(),v("div",ua,[e("div",ca,[I[24]||(I[24]=e("h4",null,"房产操作",-1)),e("div",da,[$e.value.length===0?(d(),v("div",va," 无可用房产 ")):(d(!0),v(J,{key:1},ae($e.value,D=>(d(),v("div",{key:D.id,class:"house-item"},[e("div",ma,[e("div",pa,a(D.name),1),e("div",ga,"¥"+a(E(x)(D.price)),1)]),e("button",{onClick:()=>{T.value=D.id,it()},class:"action-button"}," 购买 ",8,ya)]))),128))])])])):P("",!0),p.value==="events"?(d(),v("div",fa,[e("div",ha,[I[25]||(I[25]=e("h4",null,"触发事件",-1)),e("div",_a,[(d(!0),v(J,null,ae(xt.value,D=>(d(),v("div",{key:D.id,class:"event-item"},[e("div",ba,[e("div",$a,a(D.name),1),e("div",ka,a(D.description),1)]),e("button",{onClick:()=>{w.value=D.id,je()},class:"action-button"}," 触发 ",8,Sa)]))),128))])])])):P("",!0),p.value==="save"?(d(),v("div",wa,[e("div",Ca,[I[26]||(I[26]=e("h4",null,"快速保存",-1)),e("div",Ta,[W(e("input",{type:"text","onUpdate:modelValue":I[12]||(I[12]=D=>k.value=D),placeholder:"存档名称"},null,512),[[ne,k.value]]),e("button",{onClick:Ke,class:"action-button"},"保存游戏")])]),e("div",Pa,[I[27]||(I[27]=e("h4",null,"存档列表",-1)),e("button",{onClick:K,class:"action-button"},"刷新列表"),e("div",Ma,[r.value.length===0?(d(),v("div",Ea," 无可用存档 ")):(d(!0),v(J,{key:1},ae(r.value,D=>(d(),v("div",{key:D.id,class:"save-item"},[e("div",Ia,[e("div",Na,a(D.name),1),e("div",La,a(new Date(D.date).toLocaleString()),1)]),e("button",{onClick:()=>O(D.id),class:"action-button"}," 加载 ",8,Ra)]))),128))])])])):P("",!0),p.value==="status"?(d(),v("div",xa,[e("div",Aa,[I[32]||(I[32]=e("h4",null,"游戏状态",-1)),e("div",Oa,[e("div",Da,[I[28]||(I[28]=e("span",{class:"status-label"},"当前周数:",-1)),e("span",Va,a(E(t).currentWeek),1)]),e("div",Ga,[I[29]||(I[29]=e("span",{class:"status-label"},"资金:",-1)),e("span",Ha,"¥"+a(E(x)(E(t).player.money)),1)]),e("div",Wa,[I[30]||(I[30]=e("span",{class:"status-label"},"债务:",-1)),e("span",Ba,"¥"+a(E(x)(E(t).player.debt)),1)]),e("div",qa,[I[31]||(I[31]=e("span",{class:"status-label"},"库存用量:",-1)),e("span",Ua,a(E(t).player.inventoryUsed||0)+"/"+a(E(t).player.capacity||100),1)])])])])):P("",!0)],512),[[rt,!s.value]]),W(e("div",{class:"resize-handle",onMousedown:le},null,544),[[rt,!s.value]])],6))}},Fa=oe(Qa,[["__scopeId","data-v-1c309122"]]),za={__name:"DevToolsManager",setup(l){const t=S(!1);function s(){t.value=!0}function n(){t.value=!1}function u(i){i.ctrlKey&&i.shiftKey&&i.key==="D"&&(i.preventDefault(),t.value=!t.value)}return ce(()=>{window.addEventListener("show-dev-tools",s),window.addEventListener("close-dev-tools",n),document.addEventListener("keydown",u)}),qe(()=>{window.removeEventListener("show-dev-tools",s),window.removeEventListener("close-dev-tools",n),document.removeEventListener("keydown",u)}),(i,c)=>(d(),v("div",null,[t.value?(d(),Be(Fa,{key:0})):P("",!0)]))}};const ja=zt({name:"App",components:{ErrorDialog:As,ErrorRecoveryDialog:on,GameDialog:mn,Toast:wn,AudioManager:Tn,CssLoader:On,DevToolsManager:za},setup(){Ee();const l=S(!0),t=S("初始化游戏环境..."),s=S(0),n=async()=>{try{t.value="初始化存储...",s.value=10;const i=Pe(),c=_e(),p=Le(),f=mt(),$=Ge();t.value="加载游戏配置...",s.value=30,await new Promise(b=>setTimeout(b,300)),t.value="准备游戏界面...",s.value=60,await ye(),t.value="完成初始化...",s.value=90,await new Promise(b=>setTimeout(b,500)),t.value="加载完成!",s.value=100,setTimeout(()=>{l.value=!1},500)}catch(i){ee(i,"App (src)",se.UNKNOWN,te.ERROR),console.error("初始化应用失败:",i),t.value="初始化失败，请刷新页面重试"}},u=()=>{console.log("应用初始化完成"),l.value=!1};return ce(()=>{n()}),{isLoading:l,loadingStatus:t,loadingProgress:s,onLoadingComplete:u}}}),Ka={id:"app"};function Ya(l,t,s,n,u,i){const c=ke("CssLoader"),p=ke("router-view"),f=ke("ErrorDialog"),$=ke("ErrorRecoveryDialog"),b=ke("GameDialog"),y=ke("Toast"),M=ke("AudioManager"),V=ke("DevToolsManager");return d(),v("div",Ka,[l.isLoading?(d(),Be(c,{key:0,title:"正在初始化游戏",status:l.loadingStatus,progress:l.loadingProgress,onComplete:l.onLoadingComplete},null,8,["status","progress","onComplete"])):P("",!0),l.isLoading?P("",!0):(d(),Be(p,{key:1})),z(f),z($),z(b),z(y),z(M),z(V)])}const Xa=oe(ja,[["render",Ya]]),yt="game_state_snapshot",ft="game_state_emergency";let Ve=null;const Se=[];let bt=0;const Ja=6e4,$t=5;let Xe=null;async function et(){return Xe||(Xe=new Promise((l,t)=>{try{Ve=new Dt,Ve.initializeElectronAPI().then(()=>{console.log("状态快照存储服务初始化成功"),l(Ve)}).catch(s=>{ee(s,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("初始化存储服务失败:",s),Ve={async getData(n){try{const u=localStorage.getItem(n);return u?JSON.parse(u):null}catch(u){return console.error("从localStorage获取数据失败:",u),null}},async setData(n,u){try{return localStorage.setItem(n,JSON.stringify(u)),!0}catch(i){return ee(i,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("保存数据到localStorage失败:",i),!1}},async removeData(n){try{return localStorage.removeItem(n),!0}catch(u){return ee(u,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("从localStorage删除数据失败:",u),!1}}},console.log("使用备用存储服务"),l(Ve)})}catch(s){ee(s,"stateSnapshot (persistence)",se.STORAGE,te.ERROR),console.error("创建存储服务实例失败:",s),t(s)}}),Xe)}async function Za(l){if(!l||!l.currentWeek)return console.warn("无法创建快照：游戏存储无效"),null;const t=Date.now();if(t-bt<Ja)return null;const s={timestamp:t,currentWeek:l.currentWeek,gameStarted:l.gameStarted,gameOver:l.gameOver,player:l.player?{name:l.player.name,money:l.player.money,debt:l.player.debt,inventory:Array.isArray(l.player.inventory)?[...l.player.inventory]:[]}:null,marketState:l.currentLocation?{currentLocation:l.currentLocation.id,productPrices:{...l.productPrices||{}}}:null};Se.unshift(s),Se.length>$t&&(Se.length=$t);try{await(await et()).setData(yt,s),bt=t}catch(n){ee(n,"stateSnapshot (persistence)",se.UNKNOWN,te.WARNING),console.warn("保存快照到存储服务失败:",n)}return s}function eo(l){var t,s,n,u,i,c;try{if(!l||!l.currentWeek)return!1;const p={timestamp:Date.now(),currentWeek:l.currentWeek,playerName:(t=l.player)==null?void 0:t.name,playerMoney:(s=l.player)==null?void 0:s.money,playerDebt:(n=l.player)==null?void 0:n.debt,inventoryCount:((i=(u=l.player)==null?void 0:u.inventory)==null?void 0:i.length)||0,currentLocation:(c=l.currentLocation)==null?void 0:c.id,gameStarted:l.gameStarted,gameOver:l.gameOver};return localStorage.setItem(ft,JSON.stringify(p)),!0}catch(p){return ee(p,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("创建紧急快照失败:",p),!1}}function to(){return Se[0]||null}async function Pt(){try{if(Se.length>0)return Se[0];try{const t=await(await et()).getData(yt);if(t)return Se.unshift(t),t}catch(l){ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.WARNING),console.warn("从存储服务加载快照失败:",l)}try{const l=localStorage.getItem(ft);if(l)return JSON.parse(l)}catch(l){ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.WARNING),console.warn("加载紧急快照失败:",l)}return null}catch(l){return console.error("加载最新快照时出错:",l),null}}async function so(l,t){try{if(!t||!l)return!1;if(l.currentWeek=t.currentWeek||1,l.gameStarted=t.gameStarted||!1,l.gameOver=t.gameOver||!1,t.player&&(l.player||(l.player={}),l.player.name=t.player.name||"",l.player.money=t.player.money||0,l.player.debt=t.player.debt||0,t.player.inventory&&Array.isArray(t.player.inventory)&&(l.player.inventory=[...t.player.inventory])),t.marketState){if(t.marketState.currentLocation&&l.locations){const s=l.locations.find(n=>n.id===t.marketState.currentLocation);s&&(l.currentLocation=s)}t.marketState.productPrices&&(l.productPrices={...t.marketState.productPrices})}return!0}catch(s){return ee(s,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("应用快照时出错:",s),!1}}async function no(){try{return Se.length=0,await(await et()).removeData(yt),localStorage.removeItem(ft),!0}catch(l){return ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("清除快照时出错:",l),!1}}async function Mt(){try{return console.log("初始化快照系统..."),await et(),await Pt(),console.log("快照系统初始化完成"),!0}catch(l){return ee(l,"stateSnapshot (persistence)",se.UNKNOWN,te.ERROR),console.error("初始化快照系统时出错:",l),!1}}const ao=Object.freeze(Object.defineProperty({__proto__:null,applySnapshot:so,clearAllSnapshots:no,createEmergencySnapshot:eo,createStateSnapshot:Za,getLatestSnapshot:to,initSnapshotSystem:Mt,loadLatestSnapshot:Pt},Symbol.toStringTag,{value:"Module"}));function oo(){return Kt([es,ts,ss,ns,as,os,ls,is,rs,us,cs,ds,vs,ms]),Yt("buyHouseTheme",{color:["#3498DB","#F39C12","#2ECC71","#E74C3C","#9B59B6","#1ABC9C","#34495E"],backgroundColor:"rgba(255, 255, 255, 0)",textStyle:{},title:{textStyle:{color:"#34495E",fontSize:16},subtextStyle:{color:"#95A5A6"}},line:{itemStyle:{borderWidth:2},lineStyle:{width:3},symbolSize:8,symbol:"circle",smooth:!0},radar:{itemStyle:{borderWidth:1},lineStyle:{width:2},symbolSize:6,symbol:"circle",smooth:!0}}),Xt}function lo(){return Ae.extend(Jt),Ae.extend(Zt),Ae.locale("zh-cn"),Ae.updateLocale("zh-cn",{relativeTime:{future:"%s后",past:"%s前",s:"几秒",m:"1分钟",mm:"%d分钟",h:"1小时",hh:"%d小时",d:"1天",dd:"%d天",w:"1周",ww:"%d周",M:"1个月",MM:"%d个月",y:"1年",yy:"%d年"}}),Ae}function io(){return Oe.Howler.autoUnlock=!0,Oe.Howler.autoSuspend=!0,Oe.Howler.html5PoolSize=10,{sounds:{},load(t,s,n={}){return this.sounds[t]=new Oe.Howl({src:Array.isArray(s)?s:[s],volume:n.volume||1,loop:n.loop||!1,preload:n.preload!==!1,html5:n.html5||!1,onload:n.onload||null,onloaderror:n.onloaderror||null}),this.sounds[t]},play(t,s={}){const n=this.sounds[t];if(!n)return null;const u=n.play();return s.volume!==void 0&&n.volume(s.volume,u),s.rate!==void 0&&n.rate(s.rate,u),u},stop(t){const s=this.sounds[t];s&&s.stop()},pause(t){const s=this.sounds[t];s&&s.pause()},setGlobalVolume(t){Oe.Howler.volume(t)}}}function ro(l){const t=oo();l.config.globalProperties.$echarts=t;const s=lo();l.config.globalProperties.$dayjs=s;const n=io();l.config.globalProperties.$audio=n,l.use($s,{locale:ks,size:"default",zIndex:2e3}),l.use(jt)}const uo={class:"main-menu"},co={class:"menu-container"},vo={class:"menu-buttons"},mo={key:0,class:"dialog magic-card"},po={class:"dialog-content"},go={class:"form-group animate-item"},yo={class:"input-container"},fo={class:"form-group animate-item"},ho={class:"difficulty-options"},_o={class:"form-group animate-item"},bo={class:"mode-options"},$o={class:"dialog-actions animate-item"},ko=["disabled"],So=["disabled"],wo={key:0,class:"loading-overlay"},Co={class:"loading-container"},To={class:"loading-tip"},Po={__name:"MainMenu",setup(l){const t=Ee(),s=_e(),n=Le();mt(),Ge();const u=S(!1),i=S(""),c=S("standard"),p=S("classic"),f=S(!1),$=S(0),b=S(!1),y=S(""),M=S(!1),V=["正在准备市场数据...","正在生成商品价格...","正在初始化玩家数据...","正在加载游戏界面...","准备开始您的买房之旅..."];function U(){u.value=!0,setTimeout(()=>{N()},100)}function N(){const k=document.querySelector(".magic-card");if(k){k.addEventListener("mousemove",_=>{const C=k.getBoundingClientRect(),Q=(_.clientX-C.left)/C.width*100,le=(_.clientY-C.top)/C.height*100;k.style.setProperty("--x",`${Q}%`),k.style.setProperty("--y",`${le}%`)});const r=k.querySelector(".input-container");if(r){const _=r.querySelector(".input-shine");r.addEventListener("mousemove",Q=>{const le=r.getBoundingClientRect(),me=Q.clientX-le.left;_&&(_.style.opacity="0.6",_.style.left=`${me-20}px`)}),r.addEventListener("mouseleave",()=>{_&&(_.style.opacity="0")});const C=r.querySelector("input");C&&(C.addEventListener("focus",()=>{r.style.transform="translateY(-2px)",r.style.boxShadow="0 4px 15px rgba(58, 99, 184, 0.15), 0 0 0 1px rgba(58, 99, 184, 0.3)"}),C.addEventListener("blur",()=>{r.style.transform="",r.style.boxShadow=""}))}k.querySelectorAll(".menu-option-card").forEach(_=>{_.addEventListener("mouseenter",()=>{const C=_.querySelector("span");C&&(C.style.transform="translateY(-2px)")}),_.addEventListener("mouseleave",()=>{if(!_.classList.contains("selected")){const C=_.querySelector("span");C&&(C.style.transform="")}})}),k.querySelectorAll(".game-btn").forEach(_=>{_.addEventListener("mouseenter",()=>{_.style.transform="translateY(-2px)",_.classList.contains("primary-btn")?(_.getBoundingClientRect(),_.style.boxShadow="0 6px 20px rgba(58, 99, 184, 0.3)"):_.style.boxShadow="0 6px 15px rgba(0, 0, 0, 0.15)"}),_.addEventListener("mouseleave",()=>{_.style.transform="",_.style.boxShadow=""})})}}function R(k){y.value=`${k}功能正在开发中，敬请期待！`,b.value=!0}function B(){b.value=!1}function Z(){M.value=!0}function Y(){M.value=!1}async function L(){try{f.value=!0,h();const k=i.value.trim()||"玩家";console.log("正在开始新游戏，玩家名称:",k,"难度:",c.value,"模式:",p.value),await new Promise(r=>setTimeout(r,100)),s.currentWeek=1,s.gameStarted=!0,s.gamePaused=!1,s.gameOver=!1,s.victoryAchieved=!1,s.gameResult=null,s.notifications=[],p.value==="endless"?s.maxWeeks=999999:s.maxWeeks=52,await s.startNewGame(k),n.name||(n.name=k),c.value==="hard"?(n.money=2e3,n.debt=5e3):c.value==="easy"&&(n.money=5e3,n.debt=2e3),localStorage.setItem("lastPlayerName",k),t.push("/game")}catch(k){ee(k,"MainMenu (views)",se.UNKNOWN,te.ERROR),console.error("初始化游戏时出错:",k),alert("初始化游戏时出错: "+k.message),f.value=!1}}function h(){$.value=0;const k=setInterval(()=>{$.value=($.value+1)%V.length,f.value||clearInterval(k)},1500)}function g(){f.value||(u.value=!1,i.value="")}function T(){t.push("/saves")}async function w(){try{await window.electronAPI.quitApp()}catch(k){ee(k,"MainMenu (views)",se.UNKNOWN,te.ERROR),console.error("Error quitting app:",k)}}return ce(()=>{const k=localStorage.getItem("lastPlayerName");k&&(i.value=k);const{action:r}=t.currentRoute.value.query;r==="new-game"&&setTimeout(()=>{U()},300)}),(k,r)=>(d(),v("div",uo,[r[32]||(r[32]=e("div",{class:"animated-bg"},null,-1)),e("div",co,[r[16]||(r[16]=e("div",{class:"title-section"},[e("h1",{class:"game-title"},"买房记"),e("p",{class:"game-version"},"v0.1.1")],-1)),e("div",vo,[e("button",{class:"menu-button new-game-btn",onClick:U},r[10]||(r[10]=[e("i",{class:"menu-icon"},"🎮",-1),e("span",null,"新游戏",-1)])),e("button",{class:"menu-button load-game-btn",onClick:T},r[11]||(r[11]=[e("i",{class:"menu-icon"},"📂",-1),e("span",null,"读取存档",-1)])),e("button",{class:"menu-button leaderboard-btn",onClick:r[0]||(r[0]=m=>R("排行榜"))},r[12]||(r[12]=[e("i",{class:"menu-icon"},"🏆",-1),e("span",null,"排行榜",-1)])),e("button",{class:"menu-button settings-btn",onClick:r[1]||(r[1]=m=>R("设置"))},r[13]||(r[13]=[e("i",{class:"menu-icon"},"⚙️",-1),e("span",null,"设置",-1)])),e("button",{class:"menu-button about-btn",onClick:Z},r[14]||(r[14]=[e("i",{class:"menu-icon"},"ℹ️",-1),e("span",null,"关于",-1)])),e("button",{class:"menu-button exit-btn",onClick:w},r[15]||(r[15]=[e("i",{class:"menu-icon"},"🚪",-1),e("span",null,"退出游戏",-1)]))])]),z(re,{name:"dialog-fade"},{default:ie(()=>[u.value?(d(),v("div",{key:0,class:"dialog-overlay",onClick:ue(g,["self"])},[z(re,{name:"dialog-zoom"},{default:ie(()=>[u.value?(d(),v("div",mo,[r[26]||(r[26]=e("h2",{class:"dialog-title animate-item"},"开始新游戏",-1)),e("div",po,[e("div",go,[r[18]||(r[18]=e("label",{for:"playerName"},"用户名：",-1)),e("div",yo,[W(e("input",{type:"text",id:"playerName","onUpdate:modelValue":r[2]||(r[2]=m=>i.value=m),placeholder:"请输入用户名",maxlength:"12",onKeydown:Tt(L,["enter"]),class:"shine-input"},null,544),[[ne,i.value]]),r[17]||(r[17]=e("div",{class:"input-shine"},null,-1))])]),e("div",fo,[r[22]||(r[22]=e("label",null,"选择难度：",-1)),e("div",ho,[e("label",{class:G(["menu-option-card",{selected:c.value==="easy"}])},[W(e("input",{type:"radio","onUpdate:modelValue":r[3]||(r[3]=m=>c.value=m),value:"easy"},null,512),[[De,c.value]]),r[19]||(r[19]=e("span",null,"简单",-1))],2),e("label",{class:G(["menu-option-card",{selected:c.value==="standard"}])},[W(e("input",{type:"radio","onUpdate:modelValue":r[4]||(r[4]=m=>c.value=m),value:"standard"},null,512),[[De,c.value]]),r[20]||(r[20]=e("span",null,"标准",-1))],2),e("label",{class:G(["menu-option-card",{selected:c.value==="hard"}])},[W(e("input",{type:"radio","onUpdate:modelValue":r[5]||(r[5]=m=>c.value=m),value:"hard"},null,512),[[De,c.value]]),r[21]||(r[21]=e("span",null,"困难",-1))],2)])]),e("div",_o,[r[25]||(r[25]=e("label",null,"选择模式：",-1)),e("div",bo,[e("label",{class:G(["menu-option-card",{selected:p.value==="classic"}])},[W(e("input",{type:"radio","onUpdate:modelValue":r[6]||(r[6]=m=>p.value=m),value:"classic"},null,512),[[De,p.value]]),r[23]||(r[23]=e("span",null,"经典模式",-1))],2),e("label",{class:G(["menu-option-card",{selected:p.value==="endless"}])},[W(e("input",{type:"radio","onUpdate:modelValue":r[7]||(r[7]=m=>p.value=m),value:"endless"},null,512),[[De,p.value]]),r[24]||(r[24]=e("span",null,"无尽模式",-1))],2)])])]),e("div",$o,[e("button",{class:"game-btn cancel-btn",onClick:g,disabled:f.value},"取消",8,ko),e("button",{class:"game-btn primary-btn",onClick:L,disabled:!i.value.trim()||f.value},a(f.value?"加载中...":"开始游戏"),9,So)])])):P("",!0)]),_:1})])):P("",!0)]),_:1}),f.value?(d(),v("div",wo,[e("div",Co,[r[27]||(r[27]=e("div",{class:"loading-spinner"},null,-1)),r[28]||(r[28]=e("p",{class:"loading-text"},"正在加载游戏，请稍候...",-1)),e("p",To,a(V[$.value]),1)])])):P("",!0),b.value?(d(),v("div",{key:1,class:"dialog-overlay",onClick:B},[e("div",{class:"dev-toast",onClick:r[8]||(r[8]=ue(()=>{},["stop"]))},[r[29]||(r[29]=e("div",{class:"dev-toast-icon"},"🚧",-1)),r[30]||(r[30]=e("h3",null,"功能开发中",-1)),e("p",null,a(y.value),1),e("button",{class:"button primary",onClick:B},"确定")])])):P("",!0),M.value?(d(),v("div",{key:2,class:"dialog-overlay",onClick:Y},[e("div",{class:"about-dialog",onClick:r[9]||(r[9]=ue(()=>{},["stop"]))},[r[31]||(r[31]=We('<div class="about-header" data-v-eeb56141><h3 data-v-eeb56141>关于买房记</h3></div><div class="about-content" data-v-eeb56141><div class="about-logo" data-v-eeb56141>买房记</div><div class="about-version" data-v-eeb56141>版本：v0.1.1</div><div class="about-description" data-v-eeb56141><p data-v-eeb56141>这是一款模拟经营策略游戏，玩家将在游戏中体验市场变化带来的乐趣与挑战。</p></div><div class="about-history" data-v-eeb56141><p data-v-eeb56141>《买房记》原作是由郑昉开发的一款模拟经营类手机游戏，发布于2016年。本作者首次接触原作《买房记》是在2016年，通过观看B站UP主“敖厂长”发布的视频《【敖厂长】屌丝买房》。其玩法和创意带来的乐趣，时至今日仍记忆犹新。受条件限制，数年后才得以真正上手游玩，熟悉的玩法，却再也找不回曾经的感觉。原作最后一次更新在2022年，至今已有三年。出于对童年的回忆和对原作的致敬，遂决定开发同名PC端游戏。目前游戏仍处于早期开发阶段，感谢您的试玩。</p></div><div class="credits-section" data-v-eeb56141><h4 data-v-eeb56141>制作团队</h4><div class="developer-info" data-v-eeb56141> 开发者： <span class="dev-name" data-v-eeb56141>春卷</span></div></div></div>',2)),e("div",{class:"about-actions"},[e("button",{class:"about-close-btn",onClick:Y},"关闭")])])])):P("",!0)]))}},Mo=oe(Po,[["__scopeId","data-v-eeb56141"]]);const Eo={class:"notification-icon"},Io={key:0},No={key:1},Lo={class:"notification-message"},Ro={class:"modal-content"},xo={class:"modal-header bank-header"},Ao={class:"modal-title-container"},Oo={class:"modal-title"},Do={class:"modal-body"},Vo={class:"bank-overview"},Go={class:"overview-cards"},Ho={class:"overview-card deposit-card"},Wo={class:"card-header"},Bo={class:"card-title"},qo={class:"card-amount deposit-value"},Uo={class:"card-info"},Qo={class:"overview-card debt-card"},Fo={class:"card-header"},zo={class:"card-title"},jo={class:"card-amount debt-value"},Ko={class:"card-info"},Yo={class:"info-grid"},Xo={class:"info-item pulse-hover"},Jo={class:"info-label"},Zo={class:"info-value money-value"},el={class:"info-item pulse-hover"},tl={class:"info-label"},sl={class:"info-value available-loan-value"},nl={class:"bank-tabs"},al={class:"tab-buttons"},ol={class:"tab-content"},ll={key:0,class:"operation-tab"},il={class:"amount-control"},rl={class:"amount-header"},ul={class:"amount-value"},cl=["max"],dl={class:"amount-actions"},vl={class:"summary-info no-border"},ml={class:"summary-row"},pl={class:"summary-row"},gl={class:"button-row"},yl=["disabled"],fl={key:1,class:"operation-tab"},hl={class:"amount-control"},_l={class:"amount-header"},bl={class:"amount-value"},$l=["max","disabled"],kl={class:"amount-actions"},Sl={class:"summary-info no-border"},wl={class:"summary-row"},Cl={class:"summary-row"},Tl={class:"button-row"},Pl=["disabled"],Ml={key:2,class:"operation-tab"},El={class:"amount-control"},Il={class:"amount-header"},Nl={class:"amount-value"},Ll=["max","disabled"],Rl={class:"amount-actions"},xl={class:"summary-info no-border"},Al={class:"summary-row"},Ol={class:"summary-row"},Dl={class:"button-row"},Vl=["disabled"],Gl={key:3,class:"operation-tab"},Hl={class:"amount-control"},Wl={class:"amount-header"},Bl={class:"amount-value"},ql=["max"],Ul={class:"amount-actions"},Ql={class:"summary-info no-border"},Fl={class:"summary-row"},zl={class:"summary-row"},jl={class:"button-row"},Kl=["disabled"],Yl={__name:"BankModal",props:{show:{type:Boolean,default:!1}},emits:["update:show"],setup(l,{emit:t}){const s=Le(),{t:n}=Me(),u=t,i=S("deposit"),c=S(0),p=S(0),f=S(0),$=S(0),b=S({show:!1,type:"success",message:"",timeout:null}),y=(h,g,T=2500)=>{console.log("显示通知:",h,g),b.value={show:!0,type:h,message:g,timeout:null},b.value.timeout&&clearTimeout(b.value.timeout),b.value.timeout=setTimeout(()=>{M()},T)},M=()=>{console.log("隐藏通知"),b.value.show=!1,b.value.timeout&&(clearTimeout(b.value.timeout),b.value.timeout=null)},V=()=>{M(),u("update:show",!1),c.value=0,p.value=0,f.value=0,$.value=0},U=h=>`${(h*100).toFixed(1)}%`,N=(h,g,T,w=500)=>{if(!h)return;const k=performance.now(),r=m=>{const o=m-k;if(o>=w){h.textContent=x(T);return}const _=o/w,C=g+(T-g)*_;h.textContent=x(Math.floor(C)),requestAnimationFrame(r)};requestAnimationFrame(r)},R=()=>{const h=Number(c.value);if(h<=0)return;const g=document.querySelector(".deposit-value"),T=document.querySelector(".money-value"),w=s.bankDeposit,k=s.money;s.depositToBank(h)?(N(g,w,s.bankDeposit),N(T,k,s.money),g.classList.add("value-change-success"),setTimeout(()=>{g.classList.remove("value-change-success")},1e3),console.log("存款操作成功，调用showNotification"),y("success",n("bank.depositSuccess")),c.value=0):(console.log("存款操作失败，调用showNotification"),y("error",n("bank.notEnoughMoney")))},B=()=>{const h=Number(p.value);if(h<=0)return;const g=document.querySelector(".deposit-value"),T=document.querySelector(".money-value"),w=s.bankDeposit,k=s.money;s.withdrawFromBank(h)?(N(g,w,s.bankDeposit),N(T,k,s.money),T.classList.add("value-change-success"),setTimeout(()=>{T.classList.remove("value-change-success")},1e3),console.log("取款操作成功，调用showNotification"),y("success",n("bank.withdrawSuccess")),p.value=0):(console.log("取款操作失败，调用showNotification"),y("error",n("bank.notEnoughMoney")))},Z=()=>{const h=Number(f.value);if(h<=0)return;const g=document.querySelector(".debt-value"),T=document.querySelector(".money-value"),w=s.debt,k=s.money;s.takeLoan(h)?(N(g,w,s.debt),N(T,k,s.money),T.classList.add("value-change-success"),setTimeout(()=>{T.classList.remove("value-change-success")},1e3),console.log("贷款操作成功，调用showNotification"),y("success",n("bank.loanSuccess")),f.value=0):(console.log("贷款操作失败，调用showNotification"),y("error",n("common.error")))},Y=()=>{const h=Number($.value);if(h<=0)return;const g=document.querySelector(".debt-value"),T=document.querySelector(".money-value"),w=s.debt,k=s.money;s.repayDebt(h)?(N(g,w,s.debt),N(T,k,s.money),g.classList.add("value-change-success"),setTimeout(()=>{g.classList.remove("value-change-success")},1e3),console.log("还款操作成功，调用showNotification"),y("success",n("bank.repaySuccess")),$.value=0):(console.log("还款操作失败，调用showNotification"),y("error",n("bank.notEnoughMoney")))},L=(h,g,T,w="default")=>{if(!h)return;let k;switch(w){case"deposit":k="#2ecc71";break;case"withdraw":k="#3498db";break;case"loan":k="#f39c12";break;case"repay":k="#e74c3c";break;default:k="#3498db"}if(T<=0){const m=w==="withdraw"?"#a0c8e7":w==="loan"?"#f8d29b":w==="repay"?"#f5b7b1":"#a0c8e7";h.style.background=m;return}const r=Math.min(g/T*100,100);h.style.background=`linear-gradient(to right, ${k} ${r}%, #e9ecef ${r}%)`};return ve(()=>c.value,h=>{ye(()=>{const g=document.querySelector(".deposit-slider");g&&L(g,Number(h),s.money,"deposit")})}),ve(()=>p.value,h=>{ye(()=>{const g=document.querySelector(".withdraw-slider");g&&L(g,Number(h),s.bankDeposit,"withdraw")})}),ve(()=>f.value,h=>{ye(()=>{const g=document.querySelector(".loan-slider");g&&L(g,Number(h),s.availableLoanAmount,"loan")})}),ve(()=>$.value,h=>{ye(()=>{const g=document.querySelector(".repay-slider");if(g){const T=Math.min(s.money,s.debt);L(g,Number(h),T,"repay")}})}),ve(()=>i.value,()=>{ye(()=>{const g={deposit:{slider:".deposit-slider",value:c.value,max:s.money,type:"deposit"},withdraw:{slider:".withdraw-slider",value:p.value,max:s.bankDeposit,type:"withdraw"},loan:{slider:".loan-slider",value:f.value,max:s.availableLoanAmount,type:"loan"},repay:{slider:".repay-slider",value:$.value,max:Math.min(s.money,s.debt),type:"repay"}}[i.value];if(g){const T=document.querySelector(g.slider);T&&L(T,Number(g.value),g.max,g.type)}})}),ce(()=>{ye(()=>{const g={deposit:{slider:".deposit-slider",value:c.value,max:s.money,type:"deposit"},withdraw:{slider:".withdraw-slider",value:p.value,max:s.bankDeposit,type:"withdraw"},loan:{slider:".loan-slider",value:f.value,max:s.availableLoanAmount,type:"loan"},repay:{slider:".repay-slider",value:$.value,max:Math.min(s.money,s.debt),type:"repay"}}[i.value];if(g){const T=document.querySelector(g.slider);T&&L(T,Number(g.value),g.max,g.type)}})}),(h,g)=>l.show?(d(),v("div",{key:0,class:"modal-backdrop",onClick:ue(V,["self"])},[z(re,{name:"bank-notification"},{default:ie(()=>[b.value.show?(d(),v("div",{key:0,class:G(["bank-notification",`notification-${b.value.type}`])},[e("div",Eo,[b.value.type==="success"?(d(),v("span",Io,"✓")):b.value.type==="error"?(d(),v("span",No,"✖")):P("",!0)]),e("div",Lo,a(b.value.message),1)],2)):P("",!0)]),_:1}),e("div",Ro,[e("div",xo,[e("div",Ao,[g[20]||(g[20]=e("span",{class:"bank-icon"},"🏦",-1)),e("h3",Oo,a(h.$t("bank.title")),1)]),e("button",{class:"modal-close",onClick:V},"×")]),e("div",Do,[e("div",Vo,[e("div",Go,[e("div",Ho,[e("div",Wo,[g[21]||(g[21]=e("span",{class:"card-icon sparkle"},"💹",-1)),e("span",Bo,a(h.$t("bank.currentDeposit")),1)]),e("div",qo,"¥"+a(E(x)(E(s).bankDeposit)),1),e("div",Uo,a(h.$t("bank.depositInterest"))+": "+a(U(E(s).depositInterestRate)),1)]),e("div",Qo,[e("div",Fo,[g[22]||(g[22]=e("span",{class:"card-icon sparkle"},"💸",-1)),e("span",zo,a(h.$t("playerInfo.debt")),1)]),e("div",jo,"¥"+a(E(x)(E(s).debt)),1),e("div",Ko,a(h.$t("bank.loanInterest"))+": "+a(U(E(s).loanInterestRate)),1)])]),e("div",Yo,[e("div",Xo,[g[23]||(g[23]=e("span",{class:"info-icon"},"💰",-1)),e("span",Jo,a(h.$t("playerInfo.money"))+":",1),e("span",Zo,"¥"+a(E(x)(E(s).money)),1)]),e("div",el,[g[24]||(g[24]=e("span",{class:"info-icon"},"📊",-1)),e("span",tl,a(h.$t("bank.availableLoan"))+":",1),e("span",sl,"¥"+a(E(x)(E(s).availableLoanAmount)),1)])])]),e("div",nl,[e("div",al,[e("button",{class:G(["tab-button",{active:i.value==="deposit"}]),onClick:g[0]||(g[0]=T=>i.value="deposit")},[g[25]||(g[25]=e("span",{class:"tab-icon"},"💹",-1)),H(" "+a(h.$t("bank.deposit")),1)],2),e("button",{class:G(["tab-button",{active:i.value==="withdraw"}]),onClick:g[1]||(g[1]=T=>i.value="withdraw")},[g[26]||(g[26]=e("span",{class:"tab-icon"},"💰",-1)),H(" "+a(h.$t("bank.withdraw")),1)],2),e("button",{class:G(["tab-button",{active:i.value==="loan"}]),onClick:g[2]||(g[2]=T=>i.value="loan")},[g[27]||(g[27]=e("span",{class:"tab-icon"},"💸",-1)),H(" "+a(h.$t("bank.loan")),1)],2),e("button",{class:G(["tab-button",{active:i.value==="repay"}]),onClick:g[3]||(g[3]=T=>i.value="repay")},[g[28]||(g[28]=e("span",{class:"tab-icon"},"💳",-1)),H(" "+a(h.$t("bank.repay")),1)],2)]),e("div",ol,[i.value==="deposit"?(d(),v("div",ll,[e("div",il,[e("div",rl,[e("span",null,a(h.$t("bank.amountToDeposit")),1),e("span",ul,"¥"+a(E(x)(Number(c.value))),1)]),W(e("input",{type:"range",min:"0",max:E(s).money,"onUpdate:modelValue":g[4]||(g[4]=T=>c.value=T),step:"1",class:"styled-slider deposit-slider"},null,8,cl),[[ne,c.value]]),e("div",dl,[e("button",{class:"amount-btn",onClick:g[5]||(g[5]=T=>c.value=0)},"0"),e("button",{class:"amount-btn",onClick:g[6]||(g[6]=T=>c.value=Math.floor(E(s).money/2))},"50%"),e("button",{class:"amount-btn",onClick:g[7]||(g[7]=T=>c.value=E(s).money)},"全部")])]),e("div",vl,[e("div",ml,[e("div",null,a(h.$t("bank.weeklyInterest")),1),e("div",null,"¥"+a(E(x)(Math.floor(Number(c.value)*E(s).depositInterestRate))),1)]),e("div",pl,[e("div",null,a(h.$t("bank.remainingMoney")),1),e("div",null,"¥"+a(E(x)(E(s).money-Number(c.value))),1)])]),e("div",gl,[e("button",{onClick:V,class:"cancel-btn"},a(h.$t("common.cancel")),1),e("button",{onClick:R,class:"confirm-btn",disabled:Number(c.value)<=0},a(h.$t("bank.confirmDeposit")),9,yl)])])):P("",!0),i.value==="withdraw"?(d(),v("div",fl,[e("div",hl,[e("div",_l,[e("span",null,a(h.$t("bank.amountToWithdraw")),1),e("span",bl,"¥"+a(E(x)(Number(p.value))),1)]),W(e("input",{type:"range",min:"0",max:Math.max(E(s).bankDeposit,1),"onUpdate:modelValue":g[8]||(g[8]=T=>p.value=T),step:"1",class:"styled-slider withdraw-slider",disabled:E(s).bankDeposit<=0},null,8,$l),[[ne,p.value]]),e("div",kl,[e("button",{class:"amount-btn",onClick:g[9]||(g[9]=T=>p.value=0)},"0"),e("button",{class:"amount-btn",onClick:g[10]||(g[10]=T=>p.value=Math.floor(E(s).bankDeposit/2))},"50%"),e("button",{class:"amount-btn",onClick:g[11]||(g[11]=T=>p.value=E(s).bankDeposit)},"全部")])]),e("div",Sl,[e("div",wl,[e("div",null,a(h.$t("bank.remainingDeposit")),1),e("div",null,"¥"+a(E(x)(E(s).bankDeposit-Number(p.value))),1)]),e("div",Cl,[e("div",null,a(h.$t("bank.remainingMoney")),1),e("div",null,"¥"+a(E(x)(E(s).money+Number(p.value))),1)])]),e("div",Tl,[e("button",{onClick:V,class:"cancel-btn"},a(h.$t("common.cancel")),1),e("button",{onClick:B,class:"confirm-btn",disabled:Number(p.value)<=0},a(h.$t("bank.confirmWithdraw")),9,Pl)])])):P("",!0),i.value==="loan"?(d(),v("div",Ml,[e("div",El,[e("div",Il,[e("span",null,a(h.$t("bank.amountToLoan")),1),e("span",Nl,"¥"+a(E(x)(Number(f.value))),1)]),W(e("input",{type:"range",min:"0",max:Math.max(E(s).availableLoanAmount,1),"onUpdate:modelValue":g[12]||(g[12]=T=>f.value=T),step:"1",class:"styled-slider loan-slider",disabled:E(s).availableLoanAmount<=0},null,8,Ll),[[ne,f.value]]),e("div",Rl,[e("button",{class:"amount-btn",onClick:g[13]||(g[13]=T=>f.value=0)},"0"),e("button",{class:"amount-btn",onClick:g[14]||(g[14]=T=>f.value=Math.floor(E(s).availableLoanAmount/2))},"50%"),e("button",{class:"amount-btn",onClick:g[15]||(g[15]=T=>f.value=E(s).availableLoanAmount)},"全部")])]),e("div",xl,[e("div",Al,[e("div",null,a(h.$t("bank.weeklyInterest")),1),e("div",null,"¥"+a(E(x)(Math.floor(Number(f.value)*E(s).loanInterestRate))),1)]),e("div",Ol,[e("div",null,a(h.$t("bank.remainingLoan")),1),e("div",null,"¥"+a(E(x)(E(s).debt+Number(f.value))),1)])]),e("div",Dl,[e("button",{onClick:V,class:"cancel-btn"},a(h.$t("common.cancel")),1),e("button",{onClick:Z,class:"confirm-btn",disabled:Number(f.value)<=0},a(h.$t("bank.confirmLoan")),9,Vl)])])):P("",!0),i.value==="repay"?(d(),v("div",Gl,[e("div",Hl,[e("div",Wl,[e("span",null,a(h.$t("bank.amountToRepay")),1),e("span",Bl,"¥"+a(E(x)(Number($.value))),1)]),W(e("input",{type:"range",min:"0",max:Math.min(E(s).money,E(s).debt),"onUpdate:modelValue":g[16]||(g[16]=T=>$.value=T),step:"1",class:"styled-slider repay-slider"},null,8,ql),[[ne,$.value]]),e("div",Ul,[e("button",{class:"amount-btn",onClick:g[17]||(g[17]=T=>$.value=0)},"0"),e("button",{class:"amount-btn",onClick:g[18]||(g[18]=T=>$.value=Math.floor(Math.min(E(s).money,E(s).debt)/2))},"50%"),e("button",{class:"amount-btn",onClick:g[19]||(g[19]=T=>$.value=Math.min(E(s).money,E(s).debt))},"全部")])]),e("div",Ql,[e("div",Fl,[e("div",null,a(h.$t("bank.remainingDebt")),1),e("div",null,"¥"+a(E(x)(Math.max(0,E(s).debt-Number($.value)))),1)]),e("div",zl,[e("div",null,a(h.$t("bank.remainingMoney")),1),e("div",null,"¥"+a(E(x)(Math.max(0,E(s).money-Number($.value)))),1)])]),e("div",jl,[e("button",{onClick:V,class:"cancel-btn"},a(h.$t("common.cancel")),1),e("button",{onClick:Y,class:"confirm-btn",disabled:Number($.value)<=0},a(h.$t("bank.confirmRepay")),9,Kl)])])):P("",!0)])])])])])):P("",!0)}},Xl=oe(Yl,[["__scopeId","data-v-0bab4abf"]]);const Jl={class:"player-info"},Zl={class:"player-header"},ei={class:"avatar-container"},ti={class:"avatar"},si={class:"player-name-container"},ni={class:"player-name"},ai={class:"player-week"},oi={class:"finance-list"},li={class:"finance-item money-item"},ii={class:"finance-value money"},ri={class:"finance-label"},ui={class:"finance-item debt-item"},ci={class:"finance-value debt"},di={class:"finance-label"},vi={class:"finance-item deposit-item"},mi={class:"finance-value deposit"},pi={class:"finance-label"},gi={class:"finance-item loan-item"},yi={class:"finance-value loan"},fi={class:"finance-label"},hi={class:"capacity-container"},_i={class:"capacity-label"},bi={class:"label"},$i={class:"capacity-value"},ki={class:"capacity-bar"},Si={class:"action-buttons"},wi={__name:"PlayerInfo",setup(l){const t=we(),s=A(()=>t.player),n=A(()=>t.currentWeek),u=A(()=>t.isEndlessMode),i=S(!1),c=()=>{if(!s.value||!s.value.name)return"玩";const p=s.value.name.trim();return p?/[\u4e00-\u9fa5]/.test(p[0])?p[0]:p[0].toUpperCase():"玩"};return(p,f)=>(d(),v("div",Jl,[e("div",Zl,[e("div",ei,[e("div",ti,a(c()),1)]),e("div",si,[e("h2",ni,a(s.value.name),1),e("div",ai,a(u.value?`第 ${n.value} / ∞ 周`:`第 ${n.value} / 52 周`),1)])]),e("div",oi,[e("div",li,[f[2]||(f[2]=e("span",{class:"finance-icon"},"💰",-1)),e("div",ii,"¥"+a(E(x)(s.value.money)),1),e("div",ri,a(p.$t("playerInfo.money")),1)]),e("div",ui,[f[3]||(f[3]=e("span",{class:"finance-icon"},"💸",-1)),e("div",ci,"¥"+a(E(x)(s.value.debt)),1),e("div",di,a(p.$t("playerInfo.debt")),1)]),e("div",vi,[f[4]||(f[4]=e("span",{class:"finance-icon"},"🏦",-1)),e("div",mi,"¥"+a(E(x)(s.value.bankDeposit)),1),e("div",pi,a(p.$t("bank.currentDeposit")),1)]),e("div",gi,[f[5]||(f[5]=e("span",{class:"finance-icon"},"📊",-1)),e("div",yi,"¥"+a(E(x)(s.value.availableLoanAmount)),1),e("div",fi,a(p.$t("bank.availableLoan")),1)])]),e("div",hi,[e("div",_i,[e("span",bi,a(p.$t("playerInfo.capacity")),1),e("span",$i,a(s.value.inventoryUsed)+" / "+a(s.value.capacity),1)]),e("div",ki,[e("div",{class:G(["capacity-fill",{"nearly-full":s.value.inventoryUsed/s.value.capacity>.8}]),style:Ce({width:`${s.value.inventoryUsed/s.value.capacity*100}%`})},null,6)])]),e("div",Si,[e("button",{class:"btn bank-btn",onClick:f[0]||(f[0]=$=>i.value=!0)},[f[6]||(f[6]=e("span",{class:"btn-icon"},"🏦",-1)),H(" "+a(p.$t("playerInfo.bank")),1)])]),z(Xl,{show:i.value,"onUpdate:show":f[1]||(f[1]=$=>i.value=$)},null,8,["show"])]))}},Ci=oe(wi,[["__scopeId","data-v-a0cfa47d"]]);const Ti=["width","height"],Pi=["points"],Mi=["cx","cy"],Ei={__name:"MiniPriceChart",props:{history:{type:Array,default:()=>[]},width:{type:Number,default:100},height:{type:Number,default:30}},setup(l){const t=l,s=A(()=>t.history.length===0?0:Math.min(...t.history)),n=A(()=>t.history.length===0?100:Math.max(...t.history));function u(p){const f=s.value,$=n.value;return $===f?15:(p-f)/($-f)*30}const i=A(()=>{if(t.history.length<2)return[];const p=[],f=100/(t.history.length-1);return t.history.forEach(($,b)=>{const y=b*f,M=30-u($);p.push({x:y,y:M})}),p}),c=A(()=>i.value.map(p=>`${p.x},${p.y}`).join(" "));return A(()=>{if(t.history.length<2)return"#6c757d";const p=t.history[0],f=t.history[t.history.length-1];return f>p?"#28a745":f<p?"#dc3545":"#6c757d"}),(p,f)=>(d(),v("div",{class:"mini-price-chart",style:Ce({height:`${l.height}px`})},[(d(),v("svg",{width:l.width,height:l.height,viewBox:"0 0 100 30",preserveAspectRatio:"none"},[e("polyline",{points:c.value,class:"price-line",fill:"none"},null,8,Pi),i.value.length>0?(d(),v("circle",{key:0,cx:i.value[i.value.length-1].x,cy:i.value[i.value.length-1].y,r:"1.5",class:"latest-price-point"},null,8,Mi)):P("",!0)],8,Ti))],4))}},Et=oe(Ei,[["__scopeId","data-v-534e9b3f"]]);const Ii={class:"enhanced-trade-panel"},Ni={class:"panel-header"},Li={class:"trade-type-selector"},Ri={key:0,class:"trade-detail"},xi={class:"price-info"},Ai={class:"current-price"},Oi={class:"price-value"},Di={key:0,class:"prediction-info"},Vi={class:"prediction-icon"},Gi={class:"trade-form"},Hi={class:"form-row"},Wi={class:"quantity-control"},Bi=["max"],qi={class:"quick-quantity"},Ui={class:"trade-summary"},Qi={class:"summary-row"},Fi={class:"total-value"},zi={key:0,class:"summary-row"},ji={key:1,class:"summary-row inventory-info"},Ki={key:2,class:"summary-row avg-price-info"},Yi={class:"action-buttons"},Xi=["disabled"],Ji={__name:"EnhancedTradePanel",props:{selectedProduct:{type:Object,default:null}},emits:["close"],setup(l,{emit:t}){const s=l,n=t,u=S("buy"),i=S(s.selectedProduct),c=S(1),p=we();ve(()=>s.selectedProduct,o=>{i.value=o});const f=A(()=>{if(!i.value)return 0;if(u.value==="buy"){const o=i.value.currentPrice||T(i.value.id),_=Math.floor(p.player.money/o),C=p.player.capacity-p.player.inventoryUsed;return Math.max(0,Math.min(_,C))}else return U.value}),$=A(()=>i.value?(i.value.currentPrice||T(i.value.id))*c.value:0),b=A(()=>{if(u.value!=="sell"||!i.value)return 0;const o=T(i.value.id),_=N();return _?c.value*(o-_):0}),y=A(()=>{var Q;const o=N();return o?((T((Q=i.value)==null?void 0:Q.id)/o-1)*100).toFixed(1):"0"}),M=A(()=>{const o=parseFloat(y.value);return o>0?"profit-positive":o<0?"profit-negative":""}),V=A(()=>{if(!i.value||c.value<=0)return!1;if(u.value==="buy"){if((i.value.currentPrice||T(i.value.id))*c.value>p.player.money)return!1;const C=p.player.capacity-p.player.inventoryUsed;return!(c.value>C)}else return U.value>=c.value}),U=A(()=>i.value?p.player.inventory.filter(o=>o.productId===i.value.id).reduce((o,_)=>o+_.quantity,0):0),N=()=>{if(!i.value)return 0;const o=p.player.inventory.filter(Q=>Q.productId===i.value.id);if(o.length===0)return 0;const _=o.reduce((Q,le)=>Q+le.purchasePrice*le.quantity,0),C=o.reduce((Q,le)=>Q+le.quantity,0);return C>0?_/C:0},R=o=>{var C;if(!o)return"";const _=((C=p.productPrices[o.id])==null?void 0:C.trend)||"stable";return _==="rising"?"prediction-up":_==="falling"?"prediction-down":"prediction-stable"},B=o=>{var C;if(!o)return"?";const _=((C=p.productPrices[o.id])==null?void 0:C.trend)||"stable";return _==="rising"?"📈":_==="falling"?"📉":"📊"},Z=o=>{var C;if(!o)return"无法预测";const _=((C=p.productPrices[o.id])==null?void 0:C.trend)||"stable";return _==="rising"?"价格可能上涨，建议购买":_==="falling"?"价格可能下跌，谨慎购买":"价格相对稳定"},Y=o=>{u.value=o,c.value=1};function L(){c.value=Math.min(c.value+1,f.value)}function h(){c.value=Math.max(1,c.value-1)}function g(o){c.value=Math.max(1,Math.floor(o))}function T(o){if(!o)return 0;const _=String(o),C=p.getCurrentProductPrice(_);if(C===0&&i.value){if(String(i.value.id)===_&&i.value.currentPrice)return i.value.currentPrice;const Q=p.marketStore.products.find(le=>String(le.id)===_);if(Q&&Q.basePrice)return Q.basePrice}return C}function w(o){var _;return((_=p.productPrices[o])==null?void 0:_.history)||[]}function k(o){return gt(o)}function r(){if(!(!V.value||!i.value))try{if(T(i.value.id)<=0){m("error","无法确定商品价格，请稍后再试");return}let _;if(u.value==="buy")_=p.buyProduct(i.value.id,c.value),_.success?m("success",`已购买 ${c.value} 个 ${i.value.name}`):m("error",_.message||"购买失败");else if(_=p.sellProduct(i.value.id,c.value),_.success){let C=`已出售 ${c.value} 个 ${i.value.name}`;if(_.income&&(C+=`，获得 ${x(_.income)} 元`),_.profit){const Q=_.profit>0?`，盈利 ${x(_.profit)}`:`，亏损 ${x(Math.abs(_.profit))}`;C+=Q}m(_.profit>=0?"success":"warning",C)}else m("error",_.message||"出售失败");c.value=1,n("close")}catch(o){console.error("交易执行出错:",o),m("error","交易过程中发生错误")}}const m=(o,_)=>{He.emit("show:transaction_toast",{message:_,type:o,icon:u.value==="buy"?o==="success"?"✓":o==="warning"?"⚠️":o==="error"?"✗":"📣":"💰",class:o==="success"?u.value==="buy"?"purchase-success":"sale-success":u.value==="sell"&&o==="warning"?"sale-success":"purchase-failed"})};return ve(i,()=>{c.value=1}),(o,_)=>(d(),v("div",Ii,[e("div",Ni,[e("h3",null,a(i.value?i.value.name:"交易"),1),e("div",Li,[e("button",{class:G(["type-btn",{active:u.value==="buy"}]),onClick:_[0]||(_[0]=C=>Y("buy"))}," 购买 ",2),e("button",{class:G(["type-btn",{active:u.value==="sell"}]),onClick:_[1]||(_[1]=C=>Y("sell"))}," 出售 ",2)])]),i.value?(d(),v("div",Ri,[e("div",xi,[e("div",Ai,[_[7]||(_[7]=e("span",null,"当前价格:",-1)),e("span",Oi,a(k(T(i.value.id))),1)]),z(Et,{history:w(i.value.id),height:40},null,8,["history"])]),u.value==="buy"?(d(),v("div",Di,[e("div",{class:G(["prediction-badge",R(i.value)])},[e("span",Vi,a(B(i.value)),1),e("span",null,a(Z(i.value)),1)],2)])):P("",!0),e("div",Gi,[e("div",Hi,[e("div",Wi,[e("button",{onClick:h},"-"),W(e("input",{"onUpdate:modelValue":_[2]||(_[2]=C=>c.value=C),type:"number",min:"1",max:f.value},null,8,Bi),[[ne,c.value,void 0,{number:!0}]]),e("button",{onClick:L},"+")]),e("div",qi,[e("button",{onClick:_[3]||(_[3]=C=>g(f.value/4))},"25%"),e("button",{onClick:_[4]||(_[4]=C=>g(f.value/2))},"50%"),e("button",{onClick:_[5]||(_[5]=C=>g(f.value))},"最大")])]),e("div",Ui,[e("div",Qi,[_[8]||(_[8]=e("span",null,"总计:",-1)),e("span",Fi,a(k($.value)),1)]),u.value==="sell"&&N()?(d(),v("div",zi,[_[9]||(_[9]=e("span",null,"预计利润:",-1)),e("span",{class:G(["profit-value",M.value])},a(k(b.value))+" ("+a(y.value)+"%) ",3)])):P("",!0),U.value>0?(d(),v("div",ji,[_[10]||(_[10]=e("span",null,"当前持有:",-1)),e("span",null,a(U.value)+" 个",1)])):P("",!0),u.value==="sell"&&N()?(d(),v("div",Ki,[_[11]||(_[11]=e("span",null,"平均买入价:",-1)),e("span",null,a(k(N())),1)])):P("",!0)]),e("div",Yi,[e("button",{class:"cancel-btn",onClick:_[6]||(_[6]=C=>o.$emit("close"))},"取消"),e("button",{class:"execute-trade-btn",disabled:!V.value,onClick:r},a(u.value==="buy"?"购买":"出售"),9,Xi)])])])):P("",!0)]))}},Zi=oe(Ji,[["__scopeId","data-v-979dd061"]]);const er=["title"],tr={class:"trend-value"},sr={__name:"PriceTrend",props:{trend:{type:String,default:"stable",validator:l=>["rising_strong","rising","stable_high","stable","stable_low","falling","falling_strong","volatile"].includes(l)},percent:{type:Number,default:0},animate:{type:Boolean,default:!0},showTrendLine:{type:Boolean,default:!1}},setup(l){const t=l,s=A(()=>({rising_strong:"icon-arrow-up-double",rising:"icon-arrow-up",stable_high:"icon-arrow-right-up",stable:"icon-arrow-right",stable_low:"icon-arrow-right-down",falling:"icon-arrow-down",falling_strong:"icon-arrow-down-double",volatile:"icon-volatile"})[t.trend]||"icon-arrow-right"),n=A(()=>t.trend.includes("rising_strong")?"trend-up-strong":t.trend.includes("rising")?"trend-up":t.trend.includes("stable_high")?"trend-stable-high":t.trend.includes("stable_low")?"trend-stable-low":t.trend.includes("falling_strong")?"trend-down-strong":t.trend.includes("falling")?"trend-down":t.trend.includes("volatile")?"trend-volatile":"trend-stable"),u=A(()=>`${t.percent>0?"+":""}${t.percent.toFixed(1)}%`),i=A(()=>`${{rising_strong:"价格大幅上涨",rising:"价格上涨",stable_high:"高位稳定",stable:"价格稳定",stable_low:"低位稳定",falling:"价格下跌",falling_strong:"价格大幅下跌",volatile:"价格波动"}[t.trend]||"价格稳定"} (${u.value})`);return(c,p)=>(d(),v("div",{class:G(["price-trend",[n.value,{"with-animation":l.animate}]]),title:i.value},[e("i",{class:G(["trend-icon",s.value])},null,2),e("span",tr,a(u.value),1),l.showTrendLine?(d(),v("div",{key:0,class:G(["trend-line",n.value])},null,2)):P("",!0)],10,er))}},kt=oe(sr,[["__scopeId","data-v-dd5a525a"]]);const nr={class:"market"},ar={class:"title"},or={class:"market-header"},lr={class:"header-row"},ir={class:"location-buttons"},rr=["onClick"],ur={class:"view-toggle"},cr={key:0,class:"products-container"},dr={class:"products-table"},vr={class:"product-name"},mr={key:0,class:"special-badge",title:"特色商品，价格更优惠"},pr={class:"price"},gr={class:"trend-column"},yr={class:"trend-container"},fr={class:"action-buttons"},hr={class:"button-group"},_r=["disabled","onClick"],br=["disabled","onClick"],$r=["disabled","onClick"],kr={key:0,class:"button-group"},Sr=["onClick"],wr=["onClick"],Cr=["onClick"],Tr={key:0},Pr={colspan:"5",class:"no-products"},Mr={key:1,class:"products-grid"},Er={class:"product-card-header"},Ir={class:"product-name"},Nr={key:0,class:"special-badge",title:"特色商品，价格更优惠"},Lr={class:"product-card-body"},Rr={class:"price-section"},xr={class:"current-price"},Ar={class:"trend-price-change"},Or={class:"product-actions"},Dr={class:"action-row"},Vr={class:"button-group"},Gr=["disabled","onClick"],Hr=["disabled","onClick"],Wr=["disabled","onClick"],Br={key:0,class:"button-group"},qr=["onClick"],Ur=["onClick"],Qr=["onClick"],Fr={key:0,class:"no-products-card"},zr={class:"modal-container"},jr={class:"toast-content"},Kr={class:"toast-icon"},Yr={class:"toast-message"},Xr={__name:"Market",setup(l){Me();const t=we(),s=_e(),n=A(()=>t.locations||[]),u=A(()=>t.currentLocation||{id:"",name:"加载中..."}),i=A(()=>t.availableProducts||[]),c=A(()=>t.player||{money:0,capacity:0,inventoryUsed:0}),p=S(!1),f=S(null),$=S(!1),b=S(""),y=S(""),M=S(""),V=S("table"),U=r=>r===0?"0%":`${r>0?"+":""}${r.toFixed(1)}%`,N=r=>{var m;if(r&&r!==((m=u.value)==null?void 0:m.id)){s.advanceWeek(),t.changeLocation(r);const o=n.value.find(_=>_.id===r);o&&(b.value=`已前往${o.name}，进入下一周`,y.value="location-change",M.value="🚶",$.value=!0,setTimeout(()=>{$.value=!1},3e3))}},R=r=>!(!r||r.currentPrice>c.value.money||c.value.inventoryUsed>=c.value.capacity),B=r=>r?(c.value.inventory||[]).some(o=>o.productId===r.id&&o.quantity>0):!1,Z=r=>{f.value=r,p.value=!0},Y=r=>{f.value=r,p.value=!0,setTimeout(()=>{document.querySelector(".enhanced-trade-panel .type-btn:nth-child(2)").click()},100)},L=()=>{p.value=!1,f.value=null},h=r=>{var m,o;return((o=(m=t.productPrices)==null?void 0:m[r])==null?void 0:o.history)||[]},g=r=>{if(R(r))try{const m=t.buyProduct(r.id,1);m.success?(b.value=`已购买 1 个 ${r.name}`,y.value="purchase-success",M.value="✓",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)})):(b.value=m.message||"购买失败",y.value="purchase-failed",M.value="✗",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)}))}catch(m){console.error("快速购买出错:",m)}},T=(r,m)=>{if(R(r))try{const o=t.buyProduct(r.id,m);o.success?(b.value=`已购买 ${m} 个 ${r.name}`,y.value="purchase-success",M.value="✓",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)})):(b.value=o.message||"购买失败",y.value="purchase-failed",M.value="✗",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)}))}catch(o){console.error("快速购买多个出错:",o)}},w=r=>{if(B(r))try{const m=t.sellProduct(r.id,1);if(m.success){let o=`已出售 1 个 ${r.name}`;if(m.income&&(o+=`，获得 ${x(m.income)} 元`),m.profit){const _=m.profit>0?`，盈利 ${x(m.profit)}`:`，亏损 ${x(Math.abs(m.profit))}`;o+=_}b.value=o,y.value="sale-success",M.value="💰",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)})}else b.value=m.message||"出售失败",y.value="purchase-failed",M.value="✗",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)})}catch(m){console.error("快速出售出错:",m)}},k=(r,m)=>{if(B(r))try{const o=t.sellProduct(r.id,m);if(o.success){let _=`已出售 ${m} 个 ${r.name}`;if(o.income&&(_+=`，获得 ${x(o.income)} 元`),o.profit){const C=o.profit>0?`，盈利 ${x(o.profit)}`:`，亏损 ${x(Math.abs(o.profit))}`;_+=C}b.value=_,y.value="sale-success",M.value="💰",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)})}else b.value=o.message||"出售失败",y.value="purchase-failed",M.value="✗",$.value=!1,requestAnimationFrame(()=>{$.value=!0,setTimeout(()=>{$.value=!1},3e3)})}catch(o){console.error("快速出售多个出错:",o)}};return(r,m)=>(d(),v("div",nr,[e("h2",ar,a(r.$t("market.title",{location:u.value.name})),1),e("div",or,[e("div",lr,[e("div",ir,[(d(!0),v(J,null,ae(n.value,o=>(d(),v("button",{key:o.id,class:G(["location-btn",{active:o.id===u.value.id}]),onClick:_=>N(o.id)},a(o.name),11,rr))),128))]),e("div",ur,[e("button",{class:G(["view-btn",{active:V.value==="table"}]),onClick:m[0]||(m[0]=o=>V.value="table")},m[2]||(m[2]=[e("i",{class:"icon-table"},null,-1),H(" 表格视图 ")]),2),e("button",{class:G(["view-btn",{active:V.value==="card"}]),onClick:m[1]||(m[1]=o=>V.value="card")},m[3]||(m[3]=[e("i",{class:"icon-card"},null,-1),H(" 卡片视图 ")]),2)])])]),V.value==="table"?(d(),v("div",cr,[e("table",dr,[e("thead",null,[e("tr",null,[e("th",null,a(r.$t("market.productName")),1),e("th",null,a(r.$t("market.price")),1),e("th",null,a(r.$t("market.trend")),1),e("th",null,a(r.$t("market.change")),1),e("th",null,a(r.$t("market.action")),1)])]),e("tbody",null,[(d(!0),v(J,null,ae(i.value,o=>(d(),v("tr",{key:o.id,class:G({"special-product":o.isSpecial})},[e("td",null,[e("div",vr,[H(a(o.name)+" ",1),o.isSpecial?(d(),v("span",mr,"✦")):P("",!0)])]),e("td",pr," ¥"+a(E(x)(o.currentPrice)),1),e("td",gr,[e("div",yr,[z(kt,{trend:o.trend,percent:o.changePercent},null,8,["trend","percent"])])]),e("td",{class:G(["price-change",E(_t)(o.changePercent)])},a(U(o.changePercent)),3),e("td",null,[e("div",fr,[e("div",hr,[e("button",{class:"buy-btn",disabled:!R(o),onClick:_=>Z(o)}," 购买 ",8,_r),e("button",{class:"quick-buy-btn",disabled:!R(o),title:"快速买入1个",onClick:_=>g(o)}," +1 ",8,br),e("button",{class:"quick-buy-btn-10",disabled:!R(o),title:"快速买入10个",onClick:_=>T(o,10)}," +10 ",8,$r)]),B(o)?(d(),v("div",kr,[e("button",{class:"sell-btn",title:"出售该物品",onClick:_=>Y(o)}," 出售 ",8,Sr),e("button",{class:"quick-sell-btn",title:"快速卖出1个",onClick:_=>w(o)}," -1 ",8,wr),e("button",{class:"quick-sell-btn-10",title:"快速卖出10个",onClick:_=>k(o,10)}," -10 ",8,Cr)])):P("",!0)])])],2))),128)),i.value.length===0?(d(),v("tr",Tr,[e("td",Pr,a(r.$t("market.noProducts")),1)])):P("",!0)])])])):(d(),v("div",Mr,[(d(!0),v(J,null,ae(i.value,o=>(d(),v("div",{key:o.id,class:G(["product-card",{"special-product":o.isSpecial}])},[e("div",Er,[e("h3",Ir,[H(a(o.name)+" ",1),o.isSpecial?(d(),v("span",Nr,"✦")):P("",!0)])]),e("div",Lr,[e("div",Rr,[e("div",xr," ¥"+a(E(x)(o.currentPrice)),1),e("div",Ar,[z(kt,{trend:o.trend,percent:o.changePercent},null,8,["trend","percent"]),e("span",{class:G(["card-price-change",E(_t)(o.changePercent)])},a(U(o.changePercent)),3)])]),h(o.id).length>1?(d(),Be(Et,{key:0,history:h(o.id),height:40},null,8,["history"])):P("",!0),e("div",Or,[e("div",Dr,[e("div",Vr,[e("button",{class:"buy-btn",disabled:!R(o),onClick:_=>Z(o)}," 购买 ",8,Gr),e("button",{class:"quick-buy-btn",disabled:!R(o),title:"快速买入1个",onClick:_=>g(o)}," +1 ",8,Hr),e("button",{class:"quick-buy-btn-10",disabled:!R(o),title:"快速买入10个",onClick:_=>T(o,10)}," +10 ",8,Wr)]),B(o)?(d(),v("div",Br,[e("button",{class:"sell-btn",title:"出售该物品",onClick:_=>Y(o)}," 出售 ",8,qr),e("button",{class:"quick-sell-btn",title:"快速卖出1个",onClick:_=>w(o)}," -1 ",8,Ur),e("button",{class:"quick-sell-btn-10",title:"快速卖出10个",onClick:_=>k(o,10)}," -10 ",8,Qr)])):P("",!0)])])])],2))),128)),i.value.length===0?(d(),v("div",Fr,a(r.$t("market.noProducts")),1)):P("",!0)])),z(re,{name:"modal",appear:""},{default:ie(()=>[p.value?(d(),v("div",{key:0,class:"modal-backdrop",onClick:ue(L,["self"])},[e("div",zr,[z(Zi,{"selected-product":f.value,onClose:L},null,8,["selected-product"])])])):P("",!0)]),_:1}),z(re,{name:"fade"},{default:ie(()=>[$.value?(d(),v("div",{key:0,class:G(["transaction-toast",y.value])},[e("div",jr,[e("span",Kr,a(M.value),1),e("span",Yr,a(b.value),1)]),m[4]||(m[4]=e("div",{class:"toast-progress-bar"},null,-1))],2)):P("",!0)]),_:1})]))}},Jr=oe(Xr,[["__scopeId","data-v-0f46f35e"]]);const Zr={name:"TradePanel",props:{product:{type:Object,required:!0}},setup(l,{emit:t}){const s=we(),n=S("buy"),u=S(1),i=S(1),c=A(()=>s.player),p=A(()=>s.getProductPriceHistory(l.product.id)||[]),f=A(()=>{const F=Math.floor(c.value.money/l.product.currentPrice),de=c.value.capacity-c.value.inventoryUsed;return Math.max(0,Math.min(F,de))}),$=A(()=>l.product.currentPrice*u.value),b=A(()=>c.value.inventory.find(F=>F.productId===l.product.id)),y=A(()=>b.value?b.value.quantity:0),M=A(()=>y.value>0),V=A(()=>f.value>0),U=A(()=>l.product.currentPrice*i.value);return{activeTab:n,buyQuantity:u,sellQuantity:i,player:c,priceHistory:p,maxBuyQuantity:f,buyTotalCost:$,ownedItem:b,ownedQuantity:y,canSell:M,canBuy:V,sellTotalIncome:U,formatNumber:x,formatChange:F=>Os(F),getTrendText:F=>Vt(F),getTrendIcon:F=>{switch(F){case X.RISING_STRONG:return"↑↑";case X.RISING:return"↑";case X.STABLE_HIGH:return"▲";case X.STABLE:return"→";case X.STABLE_LOW:return"▼";case X.FALLING:return"↓";case X.FALLING_STRONG:return"↓↓";case X.VOLATILE:return"↕";default:return"→"}},getTrendClass:F=>{switch(F){case X.RISING_STRONG:return"trend-rising-strong";case X.RISING:return"trend-rising";case X.STABLE_HIGH:return"trend-stable-high";case X.STABLE:return"trend-stable";case X.STABLE_LOW:return"trend-stable-low";case X.FALLING:return"trend-falling";case X.FALLING_STRONG:return"trend-falling-strong";case X.VOLATILE:return"trend-volatile";default:return"trend-stable"}},getChangeClass:F=>F>3?"change-up-strong":F>0?"change-up":F<-3?"change-down-strong":F<0?"change-down":"change-neutral",getProductImage:()=>{const F={food:"food.png",electronics:"electronics.png",clothing:"clothing.png",luxury:"luxury.png",daily:"daily.png"},de=l.product.category||"daily";return require(`@/assets/images/products/${F[de]}`)},getBarHeight:F=>{const de=[l.product.currentPrice,...p.value],be=Math.max(...de),Ie=Math.min(...de),fe=be-Ie;return fe===0?50:(F-Ie)/fe*80+10},getBarColor:(F,de)=>F>de?"#e53e3e":F<de?"#38a169":"#4299e1",getProfitClass:()=>{if(!b.value)return"";const F=l.product.currentPrice-b.value.purchasePrice;return F>0?"profit-positive":F<0?"profit-negative":""},getProfitText:()=>{if(!b.value)return"";const F=(l.product.currentPrice-b.value.purchasePrice)*i.value,de=(l.product.currentPrice/b.value.purchasePrice-1)*100,be=F>0?"+":"";return`${be}¥${x(F)} (${be}${de.toFixed(1)}%)`},incrementBuyQuantity:()=>{u.value<f.value&&u.value++},decrementBuyQuantity:()=>{u.value>1&&u.value--},setBuyQuantity:F=>{u.value=Math.min(F,f.value)},incrementSellQuantity:()=>{i.value<y.value&&i.value++},decrementSellQuantity:()=>{i.value>1&&i.value--},setSellQuantity:F=>{i.value=Math.min(F,y.value)},executeBuy:()=>{u.value>0&&(s.buyProduct(l.product.id,u.value),t("transaction-complete",{type:"buy",productId:l.product.id,quantity:u.value,price:l.product.currentPrice}))},executeSell:()=>{i.value>0&&M.value&&(s.sellProduct(l.product.id,i.value),t("transaction-complete",{type:"sell",productId:l.product.id,quantity:i.value,price:l.product.currentPrice}))},close:()=>{t("close")}}}},eu={class:"trade-panel"},tu={class:"panel-header"},su={class:"panel-title"},nu={class:"product-details"},au={class:"product-image-container"},ou=["src"],lu={key:0,class:"product-badge"},iu={class:"product-info"},ru={class:"price-info"},uu={class:"current-price"},cu={class:"value"},du={class:"price-trend"},vu={class:"trend-icon"},mu={class:"trend-text"},pu={class:"price-history"},gu={class:"price-chart"},yu=["title"],fu={class:"trade-actions"},hu={class:"tabs"},_u=["disabled"],bu={class:"tab-content"},$u={key:0,class:"buy-panel"},ku={class:"player-resources"},Su={class:"resource"},wu={class:"value"},Cu={class:"resource"},Tu={class:"value"},Pu={class:"quantity-control"},Mu={class:"quantity-slider-container"},Eu=["max","disabled"],Iu={class:"slider-labels"},Nu={class:"quantity-input"},Lu=["disabled"],Ru=["max","disabled"],xu=["disabled"],Au={class:"quantity-presets"},Ou=["disabled"],Du=["disabled"],Vu=["disabled"],Gu=["disabled"],Hu={class:"transaction-summary"},Wu={class:"summary-item"},Bu={class:"value"},qu={class:"summary-item"},Uu={class:"value"},Qu={class:"summary-item total"},Fu={class:"value"},zu={class:"action-buttons"},ju=["disabled"],Ku={key:1,class:"sell-panel"},Yu={class:"player-resources"},Xu={class:"resource"},Ju={class:"value"},Zu={class:"resource"},ec={class:"value"},tc={class:"value"},sc={class:"quantity-control"},nc={class:"quantity-slider-container"},ac=["max","disabled"],oc={class:"slider-labels"},lc={class:"quantity-input"},ic=["disabled"],rc=["max","disabled"],uc=["disabled"],cc={class:"quantity-presets"},dc=["disabled"],vc=["disabled"],mc=["disabled"],pc=["disabled"],gc={class:"transaction-summary"},yc={class:"summary-item"},fc={class:"value"},hc={class:"summary-item"},_c={class:"value"},bc={class:"summary-item total"},$c={class:"value"},kc={class:"action-buttons"},Sc=["disabled"];function wc(l,t,s,n,u,i){return d(),v("div",eu,[e("div",tu,[e("h3",su,a(s.product.name),1),e("button",{class:"close-btn",onClick:t[0]||(t[0]=(...c)=>n.close&&n.close(...c))},"×")]),e("div",nu,[e("div",au,[e("img",{src:n.getProductImage(),alt:"商品图片",class:"product-image"},null,8,ou),s.product.isSpecial?(d(),v("div",lu,"特色商品")):P("",!0)]),e("div",iu,[e("div",ru,[e("div",uu,[t[21]||(t[21]=e("span",{class:"label"},"当前价格",-1)),e("span",cu,"¥"+a(n.formatNumber(s.product.currentPrice)),1)]),e("div",du,[e("div",{class:G(["trend-indicator",n.getTrendClass(s.product.trend)])},[e("span",vu,a(n.getTrendIcon(s.product.trend)),1),e("span",mu,a(n.getTrendText(s.product.trend)),1)],2),e("div",{class:G(["price-change",n.getChangeClass(s.product.changePercent)])},a(n.formatChange(s.product.changePercent))+"% ",3)])]),e("div",pu,[t[22]||(t[22]=e("h4",null,"价格历史",-1)),e("div",gu,[(d(!0),v(J,null,ae(n.priceHistory,(c,p)=>(d(),v("div",{key:p,class:"price-bar",style:Ce({height:`${n.getBarHeight(c)}%`,backgroundColor:n.getBarColor(c,s.product.currentPrice)}),title:`¥${n.formatNumber(c)}`},null,12,yu))),128))])])])]),e("div",fu,[e("div",hu,[e("button",{class:G(["tab-btn",{active:n.activeTab==="buy"}]),onClick:t[1]||(t[1]=c=>n.activeTab="buy")}," 买入 ",2),e("button",{class:G(["tab-btn",{active:n.activeTab==="sell"}]),onClick:t[2]||(t[2]=c=>n.activeTab="sell"),disabled:!n.canSell}," 卖出 ",10,_u)]),e("div",bu,[n.activeTab==="buy"?(d(),v("div",$u,[e("div",ku,[e("div",Su,[t[23]||(t[23]=e("span",{class:"label"},"可用资金",-1)),e("span",wu,"¥"+a(n.formatNumber(n.player.money)),1)]),e("div",Cu,[t[24]||(t[24]=e("span",{class:"label"},"可用空间",-1)),e("span",Tu,a(n.player.capacity-n.player.inventoryUsed),1)])]),e("div",Pu,[e("div",Mu,[W(e("input",{type:"range","onUpdate:modelValue":t[3]||(t[3]=c=>n.buyQuantity=c),min:1,max:n.maxBuyQuantity,disabled:n.maxBuyQuantity<=0,class:"quantity-slider"},null,8,Eu),[[ne,n.buyQuantity]]),e("div",Iu,[t[25]||(t[25]=e("span",null,"1",-1)),e("span",null,a(Math.floor(n.maxBuyQuantity/2)),1),e("span",null,a(n.maxBuyQuantity),1)])]),e("div",Nu,[e("button",{onClick:t[4]||(t[4]=(...c)=>n.decrementBuyQuantity&&n.decrementBuyQuantity(...c)),disabled:n.buyQuantity<=1||n.maxBuyQuantity<=0},"-",8,Lu),W(e("input",{type:"number","onUpdate:modelValue":t[5]||(t[5]=c=>n.buyQuantity=c),min:1,max:n.maxBuyQuantity,disabled:n.maxBuyQuantity<=0},null,8,Ru),[[ne,n.buyQuantity]]),e("button",{onClick:t[6]||(t[6]=(...c)=>n.incrementBuyQuantity&&n.incrementBuyQuantity(...c)),disabled:n.buyQuantity>=n.maxBuyQuantity||n.maxBuyQuantity<=0},"+",8,xu)]),e("div",Au,[e("button",{onClick:t[7]||(t[7]=c=>n.setBuyQuantity(1)),disabled:n.maxBuyQuantity<1},"1",8,Ou),e("button",{onClick:t[8]||(t[8]=c=>n.setBuyQuantity(5)),disabled:n.maxBuyQuantity<5},"5",8,Du),e("button",{onClick:t[9]||(t[9]=c=>n.setBuyQuantity(10)),disabled:n.maxBuyQuantity<10},"10",8,Vu),e("button",{onClick:t[10]||(t[10]=c=>n.setBuyQuantity(n.maxBuyQuantity)),disabled:n.maxBuyQuantity<=0},"最大",8,Gu)])]),e("div",Hu,[e("div",Wu,[t[26]||(t[26]=e("span",{class:"label"},"数量",-1)),e("span",Bu,a(n.buyQuantity),1)]),e("div",qu,[t[27]||(t[27]=e("span",{class:"label"},"单价",-1)),e("span",Uu,"¥"+a(n.formatNumber(s.product.currentPrice)),1)]),e("div",Qu,[t[28]||(t[28]=e("span",{class:"label"},"总价",-1)),e("span",Fu,"¥"+a(n.formatNumber(n.buyTotalCost)),1)])]),e("div",zu,[e("button",{class:"action-btn buy-btn",onClick:t[11]||(t[11]=(...c)=>n.executeBuy&&n.executeBuy(...c)),disabled:!n.canBuy||n.buyQuantity<=0}," 确认买入 ",8,ju)])])):P("",!0),n.activeTab==="sell"?(d(),v("div",Ku,[e("div",Yu,[e("div",Xu,[t[29]||(t[29]=e("span",{class:"label"},"持有数量",-1)),e("span",Ju,a(n.ownedQuantity),1)]),e("div",Zu,[t[30]||(t[30]=e("span",{class:"label"},"购买价格",-1)),e("span",ec,"¥"+a(n.formatNumber(n.ownedItem?n.ownedItem.purchasePrice:0)),1)])]),e("div",{class:G(["profit-preview",n.getProfitClass()])},[t[31]||(t[31]=e("span",{class:"label"},"预计盈亏",-1)),e("span",tc,a(n.getProfitText()),1)],2),e("div",sc,[e("div",nc,[W(e("input",{type:"range","onUpdate:modelValue":t[12]||(t[12]=c=>n.sellQuantity=c),min:1,max:n.ownedQuantity,disabled:!n.canSell,class:"quantity-slider"},null,8,ac),[[ne,n.sellQuantity]]),e("div",oc,[t[32]||(t[32]=e("span",null,"1",-1)),e("span",null,a(Math.floor(n.ownedQuantity/2)),1),e("span",null,a(n.ownedQuantity),1)])]),e("div",lc,[e("button",{onClick:t[13]||(t[13]=(...c)=>n.decrementSellQuantity&&n.decrementSellQuantity(...c)),disabled:n.sellQuantity<=1||!n.canSell},"-",8,ic),W(e("input",{type:"number","onUpdate:modelValue":t[14]||(t[14]=c=>n.sellQuantity=c),min:1,max:n.ownedQuantity,disabled:!n.canSell},null,8,rc),[[ne,n.sellQuantity]]),e("button",{onClick:t[15]||(t[15]=(...c)=>n.incrementSellQuantity&&n.incrementSellQuantity(...c)),disabled:n.sellQuantity>=n.ownedQuantity||!n.canSell},"+",8,uc)]),e("div",cc,[e("button",{onClick:t[16]||(t[16]=c=>n.setSellQuantity(1)),disabled:!n.canSell},"1",8,dc),e("button",{onClick:t[17]||(t[17]=c=>n.setSellQuantity(5)),disabled:n.ownedQuantity<5},"5",8,vc),e("button",{onClick:t[18]||(t[18]=c=>n.setSellQuantity(10)),disabled:n.ownedQuantity<10},"10",8,mc),e("button",{onClick:t[19]||(t[19]=c=>n.setSellQuantity(n.ownedQuantity)),disabled:!n.canSell},"全部",8,pc)])]),e("div",gc,[e("div",yc,[t[33]||(t[33]=e("span",{class:"label"},"数量",-1)),e("span",fc,a(n.sellQuantity),1)]),e("div",hc,[t[34]||(t[34]=e("span",{class:"label"},"单价",-1)),e("span",_c,"¥"+a(n.formatNumber(s.product.currentPrice)),1)]),e("div",bc,[t[35]||(t[35]=e("span",{class:"label"},"总收入",-1)),e("span",$c,"¥"+a(n.formatNumber(n.sellTotalIncome)),1)])]),e("div",kc,[e("button",{class:"action-btn sell-btn",onClick:t[20]||(t[20]=(...c)=>n.executeSell&&n.executeSell(...c)),disabled:!n.canSell||n.sellQuantity<=0}," 确认卖出 ",8,Sc)])])):P("",!0)])])])}const Cc=oe(Zr,[["render",wc],["__scopeId","data-v-9aebc149"]]);const Tc={class:"inventory"},Pc={class:"title"},Mc={class:"inventory-container"},Ec={class:"inventory-table"},Ic={class:"price"},Nc={class:"price"},Lc={class:"trend-icon"},Rc={class:"action-buttons"},xc={class:"button-group"},Ac=["onClick"],Oc=["onClick"],Dc=["onClick","disabled"],Vc={key:0},Gc={colspan:"7",class:"no-items"},Hc={class:"toast-content"},Wc={class:"toast-icon"},Bc={class:"toast-message"},qc={__name:"Inventory",setup(l){Me();const t=we();A(()=>t.player);const s=A(()=>t.player.inventory||[]);A(()=>t.currentLocation);const n=S(!1),u=S(null),i=S(null),c=S(1),p=S(!1),f=S(""),$=S(""),b=S("");A(()=>i.value?y(i.value)*c.value:0);const y=w=>w?t.getCurrentProductPrice(w.productId):0,M=w=>w?t.getProductPriceTrend(w.productId):X.STABLE,V=w=>{switch(M(w)){case X.RISING_STRONG:return"↑↑";case X.RISING:return"↑";case X.STABLE_HIGH:return"▲";case X.STABLE:return"→";case X.STABLE_LOW:return"▼";case X.FALLING:return"↓";case X.FALLING_STRONG:return"↓↓";case X.VOLATILE:return"↕";default:return"→"}},U=w=>{switch(M(w)){case X.RISING_STRONG:return"trend-rising-strong";case X.RISING:return"trend-rising";case X.STABLE_HIGH:return"trend-stable-high";case X.STABLE:return"trend-stable";case X.STABLE_LOW:return"trend-stable-low";case X.FALLING:return"trend-falling";case X.FALLING_STRONG:return"trend-falling-strong";case X.VOLATILE:return"trend-volatile";default:return"trend-stable"}},N=w=>{const k=y(w);return k>w.purchasePrice?"price-up":k<w.purchasePrice?"price-down":""},R=w=>{const k=y(w);return k>w.purchasePrice?"profit profit-positive":k<w.purchasePrice?"profit profit-negative":"profit"},B=w=>{const r=y(w)-w.purchasePrice,m=r/w.purchasePrice*100;return r===0?"0%":`${r>0?"+":""}${m.toFixed(1)}%`},Z=w=>{const k={id:w.productId,name:w.name,currentPrice:y(w),trend:M(w),changePercent:h(w),category:w.category||"unknown"};u.value=k,n.value=!0},Y=()=>{n.value=!1,u.value=null},L=w=>{if(Y(),w.type==="sell"){let k=`已出售 ${w.quantity} 个 ${w.productName||w.productId}`;if(w.income&&(k+=`，获得 ${x(w.income)} 元`),w.profit){const r=w.profit>0?`，盈利 ${x(w.profit)}`:`，亏损 ${x(Math.abs(w.profit))}`;k+=r}f.value=k,$.value="sale-success",b.value="💰",p.value=!1,requestAnimationFrame(()=>{p.value=!0,setTimeout(()=>{p.value=!1},3e3)})}},h=w=>{const k=y(w),r=w.purchasePrice;return r===0?0:(k-r)/r*100},g=w=>{if(w.quantity>0){const k=t.sellProduct(w.productId,1);if(k.success){let r=`已出售 1 个 ${w.name}`;if(k.income&&(r+=`，获得 ${x(k.income)} 元`),k.profit){const m=k.profit>0?`，盈利 ${x(k.profit)}`:`，亏损 ${x(Math.abs(k.profit))}`;r+=m}f.value=r,$.value="sale-success",b.value="💰",p.value=!1,requestAnimationFrame(()=>{p.value=!0,setTimeout(()=>{p.value=!1},3e3)})}}},T=(w,k)=>{const r=Math.min(w.quantity,k);if(r>0){const m=t.sellProduct(w.productId,r);if(m.success){let o=`已出售 ${r} 个 ${w.name}`;if(m.income&&(o+=`，获得 ${x(m.income)} 元`),m.profit){const _=m.profit>0?`，盈利 ${x(m.profit)}`:`，亏损 ${x(Math.abs(m.profit))}`;o+=_}f.value=o,$.value="sale-success",b.value="💰",p.value=!1,requestAnimationFrame(()=>{p.value=!0,setTimeout(()=>{p.value=!1},3e3)})}}};return(w,k)=>(d(),v("div",Tc,[e("h2",Pc,a(w.$t("inventory.title")),1),e("div",Mc,[e("table",Ec,[e("thead",null,[e("tr",null,[e("th",null,a(w.$t("inventory.productName")),1),e("th",null,a(w.$t("inventory.quantity")),1),e("th",null,a(w.$t("inventory.purchasePrice")),1),e("th",null,a(w.$t("inventory.currentPrice")),1),e("th",null,a(w.$t("inventory.trend")),1),e("th",null,a(w.$t("inventory.profit")),1),e("th",null,a(w.$t("inventory.action")),1)])]),e("tbody",null,[(d(!0),v(J,null,ae(s.value,r=>(d(),v("tr",{key:r.productId},[e("td",null,a(r.name),1),e("td",null,a(r.quantity),1),e("td",Ic,"¥"+a(E(x)(r.purchasePrice)),1),e("td",Nc,[e("span",{class:G(N(r))},"¥"+a(E(x)(y(r))),3)]),e("td",null,[e("div",{class:G(["trend-indicator",U(r)])},[e("span",Lc,a(V(r)),1)],2)]),e("td",{class:G(R(r))},a(B(r)),3),e("td",null,[e("div",Rc,[e("div",xc,[e("button",{class:"sell-btn",onClick:m=>Z(r)},a(w.$t("inventory.sell")),9,Ac),e("button",{class:"quick-sell-btn",onClick:m=>g(r),title:"快速卖出1个"}," -1 ",8,Oc),e("button",{class:"quick-sell-btn-10",onClick:m=>T(r,10),title:"快速卖出10个",disabled:r.quantity<10}," -10 ",8,Dc)])])])]))),128)),s.value.length===0?(d(),v("tr",Vc,[e("td",Gc,a(w.$t("inventory.empty")),1)])):P("",!0)])])]),n.value?(d(),v("div",{key:0,class:"modal-backdrop",onClick:ue(Y,["self"])},[z(Cc,{product:u.value,onClose:Y,onTransactionComplete:L},null,8,["product"])])):P("",!0),z(re,{name:"fade"},{default:ie(()=>[p.value?(d(),v("div",{key:0,class:G(["transaction-toast",$.value])},[e("div",Hc,[e("span",Wc,a(b.value),1),e("span",Bc,a(f.value),1)]),k[0]||(k[0]=e("div",{class:"toast-progress-bar"},null,-1))],2)):P("",!0)]),_:1})]))}},Uc=oe(qc,[["__scopeId","data-v-91f0d922"]]);const Qc={class:"house-market"},Fc={class:"title"},zc={class:"houses-container"},jc={class:"house-image"},Kc=["src"],Yc={key:0,class:"affordable-badge"},Xc={key:1,class:"purchased-badge"},Jc={class:"house-info"},Zc={class:"house-description"},ed={class:"house-details"},td={class:"detail-item"},sd={class:"detail-label"},nd={class:"detail-value"},ad={class:"detail-item"},od={class:"detail-label"},ld={class:"detail-value"},id={class:"house-actions"},rd=["disabled","onClick"],ud={class:"modal-content"},cd={class:"house-purchase-info"},dd={class:"detail-item"},vd={class:"detail-label"},md={class:"detail-value"},pd={class:"detail-item"},gd={class:"detail-label"},yd={class:"detail-value"},fd={class:"detail-item"},hd={class:"detail-label"},_d={class:"detail-value"},bd={class:"modal-actions"},$d={__name:"HouseMarket",setup(l){const{t}=Me(),s=_e(),n=Le(),u=Pe(),{money:i}=fs(n),c=S([]);ce(()=>{const N=Gt();c.value=N.map(R=>{const Z={apartment:"small",second_hand:"medium",highend:"large",villa:"luxury",mansion:"mansion"}[R.id]||R.id;return{id:R.id,name:t(`houses.${Z}.name`),description:t(`houses.${Z}.description`),price:R.price,level:R.level,image:R.image}})});const p=S(!1),f=S(null),$=N=>{if(N&&N.image)return N.image.startsWith("./")?N.image.replace("./","/"):N.image.startsWith("/")?N.image:`/${N.image}`;const R="/resources/assets/images/house_1.jpeg";if(!N||!N.id)return R;try{const B=Ht(N.id);return B.startsWith("/")?B:`/${B}`}catch(B){return console.warn("获取房屋图片时出错:",B),R}},b=N=>n.money>=N.price,y=N=>n.purchasedHouses.some(R=>R.houseId===N),M=N=>{if(!b(N)){u.showToast({type:"error",message:t("market.houseMarket.notEnoughMoney",{price:x(N.price),money:x(n.money),shortfall:x(N.price-n.money)}),duration:5e3});return}f.value=N,p.value=!0},V=()=>{p.value=!1,f.value=null},U=()=>{if(!f.value)return;if(n.money<f.value.price){u.showToast({type:"error",message:t("market.houseMarket.fundsChanged",{price:x(f.value.price),money:x(n.money),shortfall:x(f.value.price-n.money)}),duration:5e3}),V();return}if(f.value.price>n.money*.9&&!confirm(t("market.houseMarket.significantConfirm",{percent:Math.round(f.value.price/n.money*100)}))){V();return}if(n.purchaseHouse(f.value)){try{Je().triggerImportantActionAutoSave("housePurchase")}catch(R){ee(R,"HouseMarket (market)",se.UNKNOWN,te.WARNING),console.warn("购房后自动保存失败",R)}s.achieveVictoryWithHouse(f.value)}else u.showToast({type:"error",message:t("market.houseMarket.purchaseFailed"),duration:5e3});V()};return(N,R)=>{var B,Z,Y;return d(),v("div",Qc,[e("h2",Fc,a(N.$t("market.houseMarket.title")),1),e("div",zc,[(d(!0),v(J,null,ae(c.value,L=>(d(),v("div",{key:L.id,class:G(["house-card",{affordable:b(L)&&!y(L.id),purchased:y(L.id)}])},[e("div",jc,[e("img",{src:$(L),alt:"房屋图片"},null,8,Kc),b(L)&&!y(L.id)?(d(),v("span",Yc,a(N.$t("market.houseMarket.affordable")),1)):P("",!0),y(L.id)?(d(),v("span",Xc,a(N.$t("market.houseMarket.purchased")),1)):P("",!0)]),e("div",Jc,[e("h3",null,a(L.name),1),e("p",Zc,a(L.description),1),e("div",ed,[e("div",td,[e("span",sd,a(N.$t("market.houseMarket.price")),1),e("span",nd,"¥"+a(E(x)(L.price)),1)]),e("div",ad,[e("span",od,a(N.$t("market.houseMarket.level")),1),e("span",ld,a(L.level),1)])]),e("div",id,[e("button",{disabled:!b(L)||y(L.id),class:"buy-btn",onClick:h=>M(L)},a(y(L.id)?N.$t("market.houseMarket.alreadyOwned"):N.$t("market.houseMarket.buyButton")),9,rd)])])],2))),128))]),p.value?(d(),v("div",{key:0,class:"modal-backdrop",onClick:ue(V,["self"])},[e("div",ud,[e("h3",null,a(N.$t("market.houseMarket.confirmTitle")),1),e("p",null,a(N.$t("market.houseMarket.confirmMessage",{house:(B=f.value)==null?void 0:B.name})),1),e("div",cd,[e("div",dd,[e("span",vd,a(N.$t("market.houseMarket.price")),1),e("span",md,"¥"+a(E(x)((Z=f.value)==null?void 0:Z.price)),1)]),e("div",pd,[e("span",gd,a(N.$t("market.houseMarket.yourMoney")),1),e("span",yd,"¥"+a(E(x)(E(i))),1)]),e("div",fd,[e("span",hd,a(N.$t("market.houseMarket.remaining")),1),e("span",_d,"¥"+a(E(x)(E(i)-(((Y=f.value)==null?void 0:Y.price)||0))),1)])]),e("div",bd,[e("button",{class:"btn cancel-btn",onClick:V},a(N.$t("common.cancel")),1),e("button",{class:"btn confirm-btn",onClick:U},a(N.$t("common.confirm")),1)])])])):P("",!0)])}}},kd=oe($d,[["__scopeId","data-v-aca00268"]]);const Sd={class:"event-modal-container"},wd={class:"event-header"},Cd={class:"event-header-content"},Td={class:"event-title"},Pd={class:"event-icon"},Md={class:"event-content"},Ed={class:"event-description"},Id={key:0,class:"event-image"},Nd=["src","alt"],Ld={class:"event-options"},Rd={key:0,class:"event-result"},xd={class:"result-message"},Ad={key:0,class:"effect-results"},Od={class:"effect-list"},Dd={key:0,class:"effect-icon"},Vd={key:1,class:"effect-icon"},Gd={key:2,class:"effect-icon"},Hd={key:3,class:"effect-icon"},Wd={key:4,class:"effect-icon"},Bd={key:5,class:"effect-icon"},qd={key:6,class:"effect-icon"},Ud={class:"effect-description"},Qd={class:"effect-description"},Fd={key:1,class:"event-option-list"},zd=["onClick","disabled"],jd={__name:"EventModal",setup(l,{expose:t}){const s=S(null),n=S(!1),u=S(null),i=S(null),c=S(!1),p=S([]),f=S([]);_e();const $=wt();ce(()=>{ye(()=>{console.log("EventModal - 组件挂载完成，模态框状态:",n.value)})});const b=h=>{if(!h)return null;if(h.startsWith("/assets/"))return h.replace(/^\/assets\//,"./resources/assets/");if(h.startsWith("/resources/"))return h.replace(/^\/resources\//,"./resources/");if(h.includes("/assets/images/")){const g=h.match(/\/assets\/images\/.*/);if(g)return`./resources${g[0]}`}return h},y=h=>{switch(h){case"market":return"📊";case"player":return"👤";case"house":return"🏠";case"random":return"🎲";case"news":return"📰";case"disaster":return"🌪️";case"opportunity":return"💼";default:return"📣"}},M=A(()=>{if(!s.value)return null;if(s.value.imageUrl)return console.log("EventModal - 从imageUrl属性获取图片:",s.value.imageUrl),b(s.value.imageUrl);const h=Object.values(s.value);return h.length>=9&&typeof h[8]=="string"&&h[8].includes("/assets/images/")?(console.log("EventModal - 从事件对象第9个参数获取图片:",h[8]),b(h[8])):null}),V=h=>({luck:"幸运",charisma:"魅力",intelligence:"智力",stamina:"体力"})[h]||h,U=h=>{if(!h||!h.effect)return["未知市场变化"];const g=h.effect,T=[];let w="";if(g.duration){let k=g.duration;g.duration>52&&(k=Math.round(g.duration/(7*24*3600))),w=`，持续 ${k} 周`}if(g.globalPriceModifier){const k=Math.round((g.globalPriceModifier-1)*100);k>0?T.push(`全球价格上涨 ${k}%${w}`):k<0&&T.push(`全球价格下跌 ${Math.abs(k)}%${w}`)}if(g.categoryModifiers)for(const[k,r]of Object.entries(g.categoryModifiers)){const m=Math.round((r-1)*100);m>0?T.push(`${k}类别价格上涨 ${m}%${w}`):m<0&&T.push(`${k}类别价格下跌 ${Math.abs(m)}%${w}`)}if(g.locationModifiers)for(const[k,r]of Object.entries(g.locationModifiers)){const m=Math.round((r-1)*100),o=N(k);m>0?T.push(`${o}价格上涨 ${m}%${w}`):m<0&&T.push(`${o}价格下跌 ${Math.abs(m)}%${w}`)}if(g.locationProductModifiers)for(const[k,r]of Object.entries(g.locationProductModifiers)){const m=N(k);for(const[o,_]of Object.entries(r)){const C=Math.round((_-1)*100),Q=R(o);C>0?T.push(`${m}的${Q}价格上涨 ${C}%${w}`):C<0&&T.push(`${m}的${Q}价格下跌 ${Math.abs(C)}%${w}`)}}if(g.productModifiers){const k=Object.entries(g.productModifiers);for(const[r,m]of k){const o=Math.round((m-1)*100),_=R(r);o>0?T.push(`${_}价格上涨 ${o}%${w}`):o<0&&T.push(`${_}价格下跌 ${Math.abs(o)}%${w}`)}}return T.length===0&&T.push(`市场没有明显变化${w}`),T},N=h=>({commodity_market:"大宗商品市场",second_hand_market:"二手市场",premium_mall:"高端商场",electronics_hub:"电子产品中心",black_market:"黑市"})[h]||h,R=h=>{var w,k;const g=String(h);return g.startsWith("house_")?`${((w=g.split("_")[1])==null?void 0:w.toUpperCase())||""}型房产`:g.startsWith("land_")?`${((k=g.split("_")[1])==null?void 0:k.toUpperCase())||""}类土地`:{phone:"手机",laptop:"笔记本电脑",smartwatch:"智能手表",tablet:"平板电脑",camera:"相机",tv:"电视",console:"游戏机",headphones:"耳机",speaker:"音箱",watch:"手表",jewelry:"珠宝",handbag:"手提包",painting:"画作",antique:"古董",collectible:"收藏品",gold:"黄金",silver:"白银",oil:"原油",wheat:"小麦",corn:"玉米",coffee:"咖啡",copper:"铜",steel:"钢铁",cotton:"棉花",rice:"大米",antique_painting:"古画",101:"卫生纸",102:"洗发水",103:"牙膏",104:"肥皂",105:"毛巾",106:"二手衣物",107:"二手家具",201:"鸡蛋",202:"大米",203:"食用油",204:"新鲜蔬菜",205:"水果",301:"手机",302:"电视",303:"笔记本电脑",304:"平板电脑",305:"智能手表",401:"名牌手表",402:"钻石项链",403:"设计师包包",404:"高级香水",405:"名牌服装",406:"高级红酒",501:"古董钟表",502:"邮票",503:"古画",504:"老式相机",505:"纪念币"}[g]||`商品(${g})`},B=()=>{(!s.value.options||s.value.options.length===0)&&L()},Z=h=>{if(console.log("EventModal - 尝试显示事件:",h?h.id:"undefined"),!h){console.warn("EventModal - 没有传入事件对象，无法显示事件");return}try{console.log("EventModal - 显示事件:",h.id,h.title),console.log("EventModal - 事件详情:",{title:h.title,description:h.description,options:h.options?h.options.length:0,imageUrl:h.imageUrl,rawEvent:JSON.stringify(h)}),(!h.options||!Array.isArray(h.options)||h.options.length===0)&&(console.warn("EventModal - 事件没有选项，添加默认选项"),h.options=[{id:"default_option",text:"确认",result:"你确认了这个事件。",effects:{}}]),s.value=h,n.value=!0,u.value=null,i.value&&(i.value=null),c.value&&(c.value=!1),f.value=[],h.id&&!p.value.includes(h.id)&&p.value.push(h.id),He.emit("event:shown",{eventId:h.id}),console.log("EventModal - 事件模态框已显示"),console.log("EventModal - 模态框状态:",{showModal:n.value,currentEvent:s.value?s.value.id:null,hasOptions:s.value&&s.value.options?s.value.options.length:0})}catch(g){console.error("EventModal - 显示事件时出错:",g)}},Y=h=>{var g;if(console.log("EventModal - 选择选项:",h),!c.value){c.value=!0;try{if(u.value=h,i.value=h.result||"你做出了选择。",f.value=[],$&&typeof $.handleEventOption=="function"){console.log("EventModal - 调用事件操作模块处理选项");const T=$.handleEventOption(h);if(console.log("EventModal - 选项处理结果:",T),T&&T.appliedEffects){f.value=T.appliedEffects.filter(r=>r.type!=="next_event"&&r.type!=="location_change"),console.log("EventModal - 应用的效果:",f.value);const w=[],k=new Set;if(f.value.forEach(r=>{if(r.type==="market"){const m=JSON.stringify(r.effect);k.has(m)||(k.add(m),w.push(r))}else k.has(r.type)||(k.add(r.type),w.push(r))}),f.value=w,f.value.length===0){let r="选项已生效";const m=s.value.title||"";m.includes("市场")||m.includes("价格")||m.includes("商品")?r="你将在市场中看到价格变化":m.includes("投资")||m.includes("理财")?r="你的投资决策已记录，结果将在后续显现":(m.includes("对话")||m.includes("交流")||m.includes("顾问"))&&(r="这次交流增加了你的见识和人脉"),f.value=[{type:"info",description:r}]}else f.value=f.value.map(r=>r.type==="info"&&!r.description?{...r,description:"选项已成功执行"}:typeof r.description=="object"?{...r,description:"选项效果已应用"}:r)}else{const w=s.value.title||"";let k="选项已执行，效果将逐渐显现";w.includes("市场")||w.includes("价格")?k="你的决策将影响后续市场行情":w.includes("投资")&&(k="你的投资已完成，回报将在未来显现"),f.value=[{type:"info",description:k}]}}else console.warn("EventModal - 事件操作模块不可用，无法处理选项效果"),f.value=[{type:"info",description:"选项已执行，但系统无法显示具体效果"}];He.emit("event:option_selected",{eventId:(g=s.value)==null?void 0:g.id,optionId:h.id||h.text}),setTimeout(()=>{c.value=!1},1e3)}catch(T){console.error("EventModal - 处理选项时出错:",T),c.value=!1,i.value="处理选项时出错，请稍后再试。",f.value=[{type:"error",description:"处理选项时出错: "+(T.message||"未知错误")}]}}},L=()=>{n.value=!1,s.value={}};return t({showEvent:Z,hideModal:L}),(h,g)=>{var T,w,k,r,m;return W((d(),v("div",Sd,[e("div",{class:"event-modal-overlay",onClick:ue(B,["self"])},[e("div",{class:G(["event-modal",{"with-result":i.value}])},[e("div",wd,[e("div",Cd,[e("h2",Td,a(((T=s.value)==null?void 0:T.title)||"事件"),1),e("div",Pd,a(y((w=s.value)==null?void 0:w.type)),1)])]),e("div",Md,[e("p",Ed,a((k=s.value)==null?void 0:k.description),1),M.value?(d(),v("div",Id,[e("img",{src:M.value,alt:(r=s.value)==null?void 0:r.title},null,8,Nd)])):P("",!0)]),e("div",Ld,[i.value?(d(),v("div",Rd,[e("div",xd,[g[0]||(g[0]=e("div",{class:"result-icon"},"✓",-1)),e("p",null,a(i.value),1)]),f.value.length>0?(d(),v("div",Ad,[g[2]||(g[2]=e("h3",null,"效果变化",-1)),e("div",Od,[(d(!0),v(J,null,ae(f.value.filter(o=>o.type!=="market"),(o,_)=>(d(),v("div",{key:`normal-${_}`,class:G(["effect-item",o.type])},[o.type==="money"?(d(),v("span",Dd,a(o.value>0?"💰":"💸"),1)):o.type==="debt"?(d(),v("span",Vd,a(o.value<0?"📉":"📈"),1)):o.type==="capacity"?(d(),v("span",Gd,"🎒")):o.type==="item_add"?(d(),v("span",Hd,"📦")):o.type==="item_remove"?(d(),v("span",Wd,"🗑️")):o.type==="info"?(d(),v("span",Bd,"ℹ️")):(d(),v("span",qd,"🔄")),e("span",Ud,[o.type==="money"?(d(),v(J,{key:0},[H(a(o.value>0?"获得金钱: ":"支出金钱: ")+a(Math.abs(o.value))+"元 ",1)],64)):o.type==="debt"?(d(),v(J,{key:1},[H(a(o.value>0?"增加债务: ":"减少债务: ")+a(Math.abs(o.value))+"元 ",1)],64)):o.type==="capacity"?(d(),v(J,{key:2},[H(" 背包容量增加: "+a(o.value),1)],64)):o.type==="item_add"?(d(),v(J,{key:3},[H(" 获得物品: "+a(o.productId)+" x "+a(o.quantity),1)],64)):o.type==="item_remove"?(d(),v(J,{key:4},[H(" 失去物品: "+a(o.productId)+" x "+a(o.quantity),1)],64)):o.type==="attribute"?(d(),v(J,{key:5},[H(a(V(o.attribute))+": "+a(o.oldValue)+" → "+a(o.newValue),1)],64)):o.type==="info"?(d(),v(J,{key:6},[H(a(o.description||"信息"),1)],64)):(d(),v(J,{key:7},[H(a(o.description||o.type),1)],64))])],2))),128)),(d(!0),v(J,null,ae(f.value.filter(o=>o.type==="market"),(o,_)=>(d(),v(J,{key:`market-${_}`},[(d(!0),v(J,null,ae(U(o),(C,Q)=>(d(),v("div",{key:`market-${_}-${Q}`,class:"effect-item market"},[g[1]||(g[1]=e("span",{class:"effect-icon"},"📊",-1)),e("span",Qd,a(C),1)]))),128))],64))),128))])])):P("",!0),e("button",{class:"event-confirm-button",onClick:L},"确定")])):(m=s.value)!=null&&m.options?(d(),v("div",Fd,[(d(!0),v(J,null,ae(s.value.options,o=>(d(),v("button",{key:o.id,class:"event-option-button",onClick:_=>Y(o),disabled:c.value},a(o.text),9,zd))),128))])):P("",!0)])],2)])],512)),[[rt,n.value]])}}},Kd=oe(jd,[["__scopeId","data-v-2d8ec16b"]]);const Yd={name:"GameOverView",props:{gameState:{type:Object,required:!0},player:{type:Object,required:!0},gameStats:{type:Object,required:!0}},data(){return{showDetailedView:!1,achievements:[]}},computed:{canContinueGame(){const l=this.gameStats.endReason==="houseVictory",t=this.gameStats.canContinue===!0,s=this.player.purchasedHouses&&this.player.purchasedHouses.length>0;return console.log("GameOverView - 继续游戏条件检查:",{isHouseVictory:l,hasCanContinueFlag:t,hasPurchasedHouse:s,endReason:this.gameStats.endReason,playerHouses:this.player.purchasedHouses}),(s||t||l)&&this.gameStats.endReason!=="bankruptcy"},resultClass(){const l=this.gameStats.endReason;return l==="victory"||l==="houseVictory"?"result-house-victory":l==="victoryTimeLimit"?"result-game-complete":l==="bankruptcy"?"result-bankruptcy":l==="timeLimit"?"result-time-expired":"result-neutral"},isVictory(){const l=this.gameStats.endReason;return l==="victory"||l==="achievement"||l==="victoryTimeLimit"||l==="victoryOther"||l==="houseVictory"},isBankruptcy(){return this.gameStats.endReason==="bankruptcy"},hasAchievements(){return this.achievements&&this.achievements.length>0},getGameOverTitle(){var u,i,c,p;const l=this.gameStats.endReason;let t="";const s=((u=this.player.purchasedHouses)==null?void 0:u.length)||0,n=((i=this.gameStats.purchasedHouse)==null?void 0:i.name)||((p=(c=this.player.purchasedHouses)==null?void 0:c[0])==null?void 0:p.name)||"房产";switch(s>1?t=`🏆 购置${s}套房产！`:t=`🎉 恭喜购得${n}！`,l){case"houseVictory":case"victory":return t;case"victoryTimeLimit":return"🏆 完美通关！事业有成！";case"timeLimit":return"⌛ 时间已到，未能实现购房梦";case"bankruptcy":return"💸 破产清算，游戏结束";case"playerChoice":return"你选择了结束游戏";default:return"游戏结束"}},getResultDescription(){var p,f,$,b,y;const l=this.gameStats.endReason,t=(p=this.gameStats.data)==null?void 0:p.firstVictoryWeek,s=this.gameStats.weeksPassed||0,n=this.formatNumber(this.gameStats.finalAssets||0),u=((f=this.gameStats.tradeStats)==null?void 0:f.totalTrades)||0,i=this.formatNumber(Math.abs((($=this.gameStats.tradeStats)==null?void 0:$.totalProfit)||0)),c=(((b=this.gameStats.tradeStats)==null?void 0:b.totalProfit)||0)>=0?"盈利":"亏损";switch(l){case"victory":case"houseVictory":return`恭喜你在第 ${s} 周成功实现购房梦想！
通过 ${u} 次交易，总计${c} ¥${i}。`;case"victoryTimeLimit":return`你用 ${t} 周买到了心仪的房子，并继续奋斗到第 ${s} 周！
最终资产达到 ¥${n}，完美诠释了"赢家通吃"！`;case"timeLimit":return`52周时间已到，你累积了 ¥${n} 的资产。
通过 ${u} 次交易，总计${c} ¥${i}。继续努力，下次一定能实现购房梦！`;case"bankruptcy":return`很遗憾，由于无力偿还 ¥${this.formatNumber(((y=this.gameStats.data)==null?void 0:y.debt)||0)} 的债务导致破产。
通过 ${u} 次交易，总计${c} ¥${i}。吸取教训，东山再起！`;case"playerChoice":return`你在第 ${this.gameStats.weeksPassed||0} 周选择结束游戏，最终资产达到 ¥${this.formatNumber(this.gameStats.finalAssets||0)}。`;default:return"游戏结束了，感谢你的游玩！"}},getBestHouse(){return!this.player.purchasedHouses||this.player.purchasedHouses.length===0?{}:this.player.purchasedHouses.reduce((l,t)=>t.level>l.level||t.level===l.level&&t.price>l.price?t:l,this.player.purchasedHouses[0])},getMostExpensiveHouse(){return!this.player.purchasedHouses||this.player.purchasedHouses.length===0?{}:this.player.purchasedHouses.reduce((l,t)=>t.price>l.price?t:l,this.player.purchasedHouses[0])},getVictoryBadgeText(){return this.player.purchasedHouses&&this.player.purchasedHouses.length>0?this.player.purchasedHouses.length>1?"豪华置业":"安家置业":"游戏通关!"},getVictoryDescription(){const l=this.player.purchasedHouses&&this.player.purchasedHouses.length>0?this.player.purchasedHouses[0]:null;if(!l)return`在${this.gameState.maxWeeks}周游戏中，您成功通关!`;const t=l.purchaseWeek||this.gameStats.week,s=this.player.purchasedHouses.length;return s>1?`在${this.gameState.maxWeeks}周游戏中，您共购买了${s}套房产，首套房产仅用了${t}周就购得!`:`在${this.gameState.maxWeeks}周游戏中，您仅用了${t}周就完成了购房目标!`},getScoreRank(){return this.gameStats.score?this.gameStats.score.rank?this.gameStats.score.rank:this.gameStats.score.score>=1e6?"S":this.gameStats.score.score>=8e5?"A":this.gameStats.score.score>=6e5?"B":this.gameStats.score.score>=4e5?"C":"D":"D"},getFinalScore(){return this.gameStats.score?this.gameStats.score.score?this.gameStats.score.score:this.gameStats.finalAssets?this.gameStats.finalAssets:0:0}},mounted(){this.loadAchievements(),this.$nextTick(()=>{this.animateScoreElements()}),console.log("GameOverView mounted - 原始游戏统计数据对象:",this.gameStats),console.log("GameOverView mounted - 游戏得分数据:",{score:this.gameStats.score,scoreDetails:this.gameStats.scoreDetails,endReason:this.gameStats.endReason,finalAssets:this.gameStats.finalAssets,reason:this.gameStats.reason}),this.gameStats.score!==void 0&&console.log("得分格式检查:",{scoreType:typeof this.gameStats.score,isNumber:!isNaN(this.gameStats.score),stringValue:String(this.gameStats.score)}),setTimeout(()=>{this.updateScoreDisplay()},100)},methods:{updateScoreDisplay(){if(console.log("强制刷新得分显示..."),this.getFinalScore===0&&this.gameStats.finalAssets>0){console.log("检测到得分为0但有净资产，尝试计算默认得分");const l=Math.floor(this.gameStats.finalAssets/500);this.$set(this.gameStats,"score",{score:l,rank:this.calculateScoreRank(l),details:{assetsScore:Math.floor(this.gameStats.finalAssets/800),timeScore:0,houseScore:0,tradeScore:0,bankScore:0,totalScore:l}})}this.$forceUpdate()},calculateScoreRank(l){return l>=1e6?"S":l>=8e5?"A":l>=6e5?"B":l>=4e5?"C":(l>=2e5,"D")},formatNumber(l){return x(l)},getHouseImage(l){if(!l)return"/resources/assets/images/house_1.jpeg";if(console.log("正在获取房产图片:",l),l.id||l.houseId){const t=l.id||l.houseId,s={apartment:"/resources/assets/images/house_1.jpeg",second_hand:"/resources/assets/images/house_2.jpeg",highend:"/resources/assets/images/house_3.jpeg",villa:"/resources/assets/images/house_4.jpeg",mansion:"/resources/assets/images/house_5.jpeg"};if(s[t])return s[t];const n=parseInt(t);return`/resources/assets/images/house_${isNaN(n)?1:n%5||1}.jpeg`}return l.imageUrl?l.imageUrl:l.image?l.image.startsWith("./")?l.image.replace("./","/"):l.image.startsWith("/")?l.image.includes("NaN")?"/resources/assets/images/house_1.jpeg":l.image:`/${l.image}`:"/resources/assets/images/house_1.jpeg"},returnToMainMenu(){this.$emit("return-to-main")},restartGame(){this.$emit("restart-game")},continueGame(){console.log("GameOverView - 继续游戏按钮被点击");try{const l=_e();if(console.log("GameOverView - 获取到gameStore:",!!l),!l){console.error("GameOverView - 无法获取gameStore");return}l.gameOver=!1,l.victoryAchieved=!0,typeof l.continueGame=="function"?(l.continueGame(),console.log("GameOverView - 成功调用continueGame方法")):console.error("GameOverView - continueGame方法不存在");try{const t=Pe();t&&t.showToast&&t.showToast({type:"success",message:"您选择继续游戏！您可以继续赚钱并购买更多房产，直到第52周游戏结束。",duration:5e3})}catch(t){console.warn("显示继续游戏提示失败",t)}this.$emit("continue-game"),console.log("GameOverView - 已发送continue-game事件")}catch(l){console.error("GameOverView - 继续游戏失败:",l)}},loadAchievements(){var n;this.achievements=[];const l=this.gameStats.endReason,t=this.gameStats.weeksPassed,s=((n=this.gameStats.data)==null?void 0:n.firstVictoryWeek)||t;this.isVictory&&(this.achievements.push({name:"安家梦想",description:"成功购买豪宅"}),s<30?this.achievements.push({name:"房产投资大师",description:"在30周内购买豪宅"}):s<40&&this.achievements.push({name:"高效购房",description:"在40周内购买豪宅"}),l==="victoryTimeLimit"&&(this.achievements.push({name:"坚持不懈",description:"在购买豪宅后继续游戏到最后一周"}),this.gameStats.finalAssets>2e6&&this.achievements.push({name:"财富帝国",description:"最终资产超过200万"}))),l==="achievement"&&this.achievements.push({name:"百万富翁",description:"资产超过100万"}),this.gameStats.tradeStats&&this.gameStats.tradeStats.totalProfit>5e5&&this.achievements.push({name:"交易大师",description:"总交易利润超过50万"}),this.gameStats.tradeStats&&this.gameStats.tradeStats.totalTrades>100&&this.achievements.push({name:"频繁交易者",description:"交易次数超过100次"}),this.player.purchasedHouses&&this.player.purchasedHouses.length>0&&(this.achievements.push({name:"房产投资专家",description:"成功购买至少一套房产"}),this.player.purchasedHouses.length>1&&this.achievements.push({name:"豪华置业",description:"成功购买多套房产"}),this.player.purchasedHouses.length>5&&this.achievements.push({name:"房产大亨",description:"成功购买超过5套房产"}),this.player.purchasedHouses.length>10&&this.achievements.push({name:"房产巨富",description:"成功购买超过10套房产"})),l==="bankruptcy"&&this.achievements.push({name:"东山再起",description:"经历破产是成功的第一步"}),this.achievements.length===0&&this.achievements.push({name:"初次尝试",description:"完成一次游戏"})},animateScoreElements(){document.querySelectorAll(".stat-item:not(.core-stats .stat-item), .achievement-item").forEach((s,n)=>{setTimeout(()=>{s.classList.add("animate-in")},n*100)});const t=document.querySelector(".rank-animation");t&&t.classList.add("animate")}}},Xd={class:"game-over-container"},Jd={class:"header-section"},Zd={class:"subtitle"},ev={class:"result-summary"},tv={class:"rank-display"},sv={class:"rank-value"},nv={class:"score-display"},av={class:"score-value"},ov={class:"core-stats"},lv={class:"stat-item"},iv={class:"stat-value"},rv={class:"stat-item"},uv={class:"stat-value"},cv={class:"stat-item"},dv={class:"stat-value"},vv={key:0,class:"house-info"},mv={class:"house-details"},pv={class:"house-image-container"},gv=["src"],yv={class:"house-text"},fv={class:"house-name"},hv={class:"best-house-badge"},_v={class:"house-price"},bv={class:"house-week"},$v={key:0,class:"all-houses-container"},kv={class:"houses-grid"},Sv={class:"mini-house-image"},wv=["src"],Cv={class:"mini-house-info"},Tv={class:"mini-house-name"},Pv={class:"mini-house-price"},Mv={class:"mini-house-week"},Ev={key:1,class:"house-info"},Iv={class:"house-details"},Nv={class:"house-image-container"},Lv=["src"],Rv={class:"house-text"},xv={class:"house-name"},Av={class:"house-price"},Ov={class:"house-week"},Dv={key:2,class:"statistics-section"},Vv={class:"statistics-grid"},Gv={class:"stat-item"},Hv={class:"stat-content"},Wv={class:"stat-value"},Bv={class:"stat-item"},qv={class:"stat-content"},Uv={key:3,class:"score-details-section"},Qv={class:"score-details-grid"},Fv={class:"stat-item"},zv={class:"stat-content"},jv={class:"stat-value"},Kv={class:"stat-item"},Yv={class:"stat-content"},Xv={class:"stat-value"},Jv={key:0,class:"stat-bonus"},Zv={class:"stat-item"},em={class:"stat-content"},tm={class:"stat-value"},sm={class:"stat-item"},nm={class:"stat-content"},am={class:"stat-value"},om={class:"stat-item"},lm={class:"stat-content"},im={class:"stat-value"},rm={key:4,class:"achievements-section"},um={class:"achievements-grid"},cm={class:"achievement-content"},dm={class:"achievement-name"},vm={class:"achievement-desc"},mm={class:"actions"};function pm(l,t,s,n,u,i){var c,p,f,$,b,y,M,V,U,N;return d(),v("div",{class:G(["game-over-view",i.resultClass])},[e("div",Xd,[e("div",Jd,[e("h1",{class:G(["title",{victory:i.isVictory,failure:i.isBankruptcy}])},a(i.getGameOverTitle),3),e("p",Zd,a(i.getResultDescription),1)]),e("div",ev,[e("div",tv,[e("div",{class:G(["rank-animation","rank-"+(i.getScoreRank||"D")])},[e("span",sv,a(i.getScoreRank||"D"),1)],2),e("div",nv,[t[3]||(t[3]=e("div",{class:"score-label"},"最终得分",-1)),e("div",av,a(i.formatNumber(i.getFinalScore||0)),1)])]),e("div",ov,[e("div",lv,[t[4]||(t[4]=e("div",{class:"stat-label"},"游戏周数",-1)),e("div",iv,a(s.gameStats.weeksPassed||0)+" / "+a(s.gameState.maxWeeks),1)]),e("div",rv,[t[5]||(t[5]=e("div",{class:"stat-label"},"最终资金",-1)),e("div",uv,"¥"+a(i.formatNumber(s.gameStats.finalMoney||0)),1)]),e("div",cv,[t[6]||(t[6]=e("div",{class:"stat-label"},"净资产",-1)),e("div",dv,"¥"+a(i.formatNumber(s.gameStats.finalAssets||0)),1)])])]),s.player.purchasedHouses&&s.player.purchasedHouses.length>0?(d(),v("div",vv,[e("h2",null,"已购房产 ("+a(s.player.purchasedHouses.length)+"套)",1),e("div",mv,[e("div",pv,[e("img",{src:i.getHouseImage(i.getBestHouse),alt:"房屋图片",class:"house-image"},null,8,gv)]),e("div",yv,[e("h3",fv,[H(a(i.getBestHouse.name)+" ",1),e("span",hv,a(i.getBestHouse===i.getMostExpensiveHouse?"最贵房产":"最高级房产"),1)]),e("p",_v,"价格: ¥"+a(i.formatNumber(i.getBestHouse.purchasePrice||i.getBestHouse.price)),1),e("p",bv,"购买时间: 第 "+a(i.getBestHouse.purchaseWeek||s.gameStats.week)+" 周",1)])]),s.player.purchasedHouses.length>1?(d(),v("div",$v,[t[7]||(t[7]=e("h3",null,"全部房产",-1)),e("div",kv,[(d(!0),v(J,null,ae(s.player.purchasedHouses,R=>(d(),v("div",{key:R.houseId,class:"mini-house-card"},[e("div",Sv,[e("img",{src:i.getHouseImage(R),alt:"房屋图片"},null,8,wv)]),e("div",Cv,[e("div",Tv,a(R.name),1),e("div",Pv,"¥"+a(i.formatNumber(R.purchasePrice)),1),e("div",Mv,"第"+a(R.purchaseWeek)+"周",1)])]))),128))])])):P("",!0)])):s.gameStats.purchasedHouse||s.gameStats.data&&s.gameStats.data.house?(d(),v("div",Ev,[e("div",Iv,[e("div",Nv,[e("img",{src:i.getHouseImage(s.gameStats.purchasedHouse||s.gameStats.data.house),alt:"房屋图片",class:"house-image"},null,8,Lv)]),e("div",Rv,[e("h3",xv,a((s.gameStats.purchasedHouse||s.gameStats.data.house).name),1),e("p",Av,"价格: ¥"+a(i.formatNumber((s.gameStats.purchasedHouse||s.gameStats.data.house).price)),1),e("p",Ov,"购买时间: 第 "+a(s.gameStats.week)+" 周",1)])])])):P("",!0),s.gameStats.tradeStats?(d(),v("div",Dv,[t[12]||(t[12]=e("h2",null,"交易统计",-1)),e("div",Vv,[e("div",Gv,[t[9]||(t[9]=e("div",{class:"stat-icon"},"📊",-1)),e("div",Hv,[t[8]||(t[8]=e("div",{class:"stat-label"},"交易笔数",-1)),e("div",Wv,a(((c=s.gameStats.tradeStats)==null?void 0:c.totalTrades)||0)+"次",1)])]),e("div",Bv,[t[11]||(t[11]=e("div",{class:"stat-icon"},"📈",-1)),e("div",qv,[t[10]||(t[10]=e("div",{class:"stat-label"},"总交易利润",-1)),e("div",{class:G(["stat-value",{positive:(((p=s.gameStats.tradeStats)==null?void 0:p.totalProfit)||0)>0,negative:(((f=s.gameStats.tradeStats)==null?void 0:f.totalProfit)||0)<0}])},a(((($=s.gameStats.tradeStats)==null?void 0:$.totalProfit)||0)>0?"+":"")+"¥"+a(i.formatNumber(((b=s.gameStats.tradeStats)==null?void 0:b.totalProfit)||0)),3)])])])])):P("",!0),s.gameStats.scoreDetails?(d(),v("div",Uv,[t[23]||(t[23]=e("h2",null,"得分明细",-1)),e("div",Qv,[e("div",Fv,[t[14]||(t[14]=e("div",{class:"stat-icon"},"💰",-1)),e("div",zv,[t[13]||(t[13]=e("div",{class:"stat-label"},"资产得分",-1)),e("div",jv,a(i.formatNumber(((y=s.gameStats.scoreDetails)==null?void 0:y.assetsScore)||0)),1)])]),e("div",Kv,[t[16]||(t[16]=e("div",{class:"stat-icon"},"🏡",-1)),e("div",Yv,[t[15]||(t[15]=e("div",{class:"stat-label"},"房产得分",-1)),e("div",Xv,a(i.formatNumber(((M=s.gameStats.scoreDetails)==null?void 0:M.houseScore)||0)),1),s.player.purchasedHouses&&s.player.purchasedHouses.length>1?(d(),v("div",Jv," 含"+a(s.player.purchasedHouses.length)+"套房产加成 ",1)):P("",!0)])]),e("div",Zv,[t[18]||(t[18]=e("div",{class:"stat-icon"},"⏱️",-1)),e("div",em,[t[17]||(t[17]=e("div",{class:"stat-label"},"时间效率",-1)),e("div",tm,a(i.formatNumber(((V=s.gameStats.scoreDetails)==null?void 0:V.timeScore)||0)),1)])]),e("div",sm,[t[20]||(t[20]=e("div",{class:"stat-icon"},"🔄",-1)),e("div",nm,[t[19]||(t[19]=e("div",{class:"stat-label"},"交易得分",-1)),e("div",am,a(i.formatNumber(((U=s.gameStats.scoreDetails)==null?void 0:U.tradeScore)||0)),1)])]),e("div",om,[t[22]||(t[22]=e("div",{class:"stat-icon"},"🏦",-1)),e("div",lm,[t[21]||(t[21]=e("div",{class:"stat-label"},"银行管理",-1)),e("div",im,a(i.formatNumber(((N=s.gameStats.scoreDetails)==null?void 0:N.bankScore)||0)),1)])])])])):P("",!0),i.hasAchievements?(d(),v("div",rm,[t[25]||(t[25]=e("h2",null,"解锁成就",-1)),e("div",um,[(d(!0),v(J,null,ae(u.achievements,(R,B)=>(d(),v("div",{key:B,class:"achievement-item"},[t[24]||(t[24]=e("div",{class:"achievement-icon"},"🏆",-1)),e("div",cm,[e("div",dm,a(R.name),1),e("div",vm,a(R.description),1)])]))),128))])])):P("",!0),e("div",mm,[i.canContinueGame?(d(),v("button",{key:0,onClick:t[0]||(t[0]=(...R)=>i.continueGame&&i.continueGame(...R)),class:"btn btn-primary"},t[26]||(t[26]=[e("span",{class:"btn-icon"},"🎮",-1),e("span",{class:"btn-text"},"继续游戏",-1)]))):P("",!0),e("button",{onClick:t[1]||(t[1]=(...R)=>i.restartGame&&i.restartGame(...R)),class:"btn btn-success"},t[27]||(t[27]=[e("span",{class:"btn-icon"},"🔄",-1),e("span",{class:"btn-text"},"重新开始",-1)])),e("button",{onClick:t[2]||(t[2]=(...R)=>i.returnToMainMenu&&i.returnToMainMenu(...R)),class:"btn btn-primary"},t[28]||(t[28]=[e("span",{class:"btn-icon"},"🏠",-1),e("span",{class:"btn-text"},"返回主菜单",-1)]))])])],2)}const It=oe(Yd,[["render",pm],["__scopeId","data-v-135a5d87"]]);const gm={name:"TutorialSystem",props:{currentWeek:{type:Number,required:!0},currentLocation:{type:Object,required:!0},activeTab:{type:String,required:!0}},setup(l){_e();const{t}=Me(),s=S(!1),n=S(0),u=S(!1),i=S(!1),c=S(!1),p=S("basics"),f=[{id:"basics",name:t("tutorial.help.basics")},{id:"trading",name:t("tutorial.help.trading")},{id:"events",name:t("tutorial.help.events")},{id:"settings",name:t("tutorial.help.settings")}],$=[{id:"welcome",title:t("tutorial.tips.welcome.title"),content:t("tutorial.tips.welcome.content"),trigger:{week:1,location:null,tab:null,onlyOnce:!0},seen:!1},{id:"market_intro",title:t("tutorial.tips.market_intro.title"),content:t("tutorial.tips.market_intro.content"),trigger:{week:1,location:null,tab:"market"},seen:!1},{id:"inventory_intro",title:t("tutorial.tips.inventory_intro.title"),content:t("tutorial.tips.inventory_intro.content"),trigger:{week:1,location:null,tab:"inventory"},seen:!1}],b=A(()=>$.filter(L=>{const h=!L.trigger.week||l.currentWeek>=L.trigger.week,g=!L.trigger.location||l.currentLocation&&l.currentLocation.id===L.trigger.location,T=!L.trigger.tab||l.activeTab===L.trigger.tab;return L.trigger.onlyOnce&&L.id==="welcome"&&($.some(r=>r.seen)||localStorage.getItem("welcome_tutorial_shown"))?!1:h&&g&&T&&!L.seen})),y=A(()=>b.value[n.value]||null);function M(){i.value||b.value.length>0&&!s.value&&(s.value=!0,n.value=0,u.value=!1)}ve(()=>l.currentWeek,M),ve(()=>l.activeTab,M),ve(()=>l.currentLocation,(L,h)=>{$.filter(T=>T.id!=="welcome"&&!T.seen&&(!T.trigger.tab||T.trigger.tab===l.activeTab)&&(!T.trigger.location||T.trigger.location===(L==null?void 0:L.id))).length>0&&M()},{deep:!0});function V(){n.value<b.value.length-1&&n.value++}function U(){n.value>0&&n.value--}function N(){if(y.value){const L=$.findIndex(h=>h.id===y.value.id);L!==-1&&($[L].seen=!0,$[L].id==="welcome"&&localStorage.setItem("welcome_tutorial_shown","true")),n.value<b.value.length-1?n.value++:s.value=!1}}function R(){s.value=!1}function B(){u.value=!u.value}function Z(){c.value=!c.value}function Y(){c.value=!1}return ce(()=>{M()}),{showTutorialTip:s,currentTipIndex:n,minimized:u,dontShowAgain:i,showHelpPanel:c,activeHelpTab:p,helpTabs:f,filteredTips:b,currentTip:y,showNextTip:V,showPreviousTip:U,acknowledgeTip:N,closeTip:R,toggleMinimize:B,toggleHelpPanel:Z,closeHelpPanel:Y}}},ym={class:"tutorial-system"},fm={class:"tip-title"},hm={class:"tip-controls"},_m={key:0,class:"tip-content"},bm=["innerHTML"],$m={class:"tip-footer"},km={class:"tip-navigation"},Sm=["disabled"],wm={class:"tip-counter"},Cm=["disabled"],Tm={class:"tip-actions"},Pm={class:"dont-show-again"},Mm={class:"help-button-container"},Em={class:"help-panel"},Im={class:"help-header"},Nm={class:"help-content"},Lm={class:"help-tabs"},Rm=["onClick"],xm={class:"tab-content"},Am={key:0,class:"help-section"},Om={key:1,class:"help-section"},Dm={key:2,class:"help-section"},Vm={key:3,class:"help-section"};function Gm(l,t,s,n,u,i){return d(),v("div",ym,[n.showTutorialTip&&n.currentTip?(d(),v("div",{key:0,class:G(["tutorial-tip",{minimized:n.minimized}])},[e("div",{class:"tip-header",onClick:t[2]||(t[2]=(...c)=>n.toggleMinimize&&n.toggleMinimize(...c))},[e("div",fm,[t[10]||(t[10]=e("span",{class:"tip-icon"},"💡",-1)),e("span",null,a(n.currentTip.title),1)]),e("div",hm,[n.minimized?P("",!0):(d(),v("button",{key:0,class:"minimize-btn",onClick:t[0]||(t[0]=ue(c=>n.minimized=!0,["stop"]))},t[11]||(t[11]=[e("span",{class:"minimize-icon"},null,-1)]))),e("button",{class:"close-btn",onClick:t[1]||(t[1]=ue((...c)=>n.closeTip&&n.closeTip(...c),["stop"]))},"×")])]),n.minimized?P("",!0):(d(),v("div",_m,[e("div",{class:"tip-body",innerHTML:n.currentTip.content},null,8,bm),e("div",$m,[e("div",km,[e("button",{class:"nav-btn prev",onClick:t[3]||(t[3]=(...c)=>n.showPreviousTip&&n.showPreviousTip(...c)),disabled:n.currentTipIndex<=0}," ← "+a(l.$t("tutorial.help.prev")),9,Sm),e("span",wm,a(n.currentTipIndex+1)+"/"+a(n.filteredTips.length),1),e("button",{class:"nav-btn next",onClick:t[4]||(t[4]=(...c)=>n.showNextTip&&n.showNextTip(...c)),disabled:n.currentTipIndex>=n.filteredTips.length-1},a(l.$t("tutorial.help.next"))+" → ",9,Cm)]),e("div",Tm,[e("label",Pm,[W(e("input",{type:"checkbox","onUpdate:modelValue":t[5]||(t[5]=c=>n.dontShowAgain=c)},null,512),[[ut,n.dontShowAgain]]),H(" "+a(l.$t("tutorial.help.dontShowAgain")),1)]),e("button",{class:"got-it-btn",onClick:t[6]||(t[6]=(...c)=>n.acknowledgeTip&&n.acknowledgeTip(...c))},a(l.$t("tutorial.help.gotIt")),1)])])]))],2)):P("",!0),e("div",Mm,[e("button",{class:"help-button",onClick:t[7]||(t[7]=(...c)=>n.toggleHelpPanel&&n.toggleHelpPanel(...c))},t[12]||(t[12]=[e("span",{class:"help-icon"},"?",-1)]))]),n.showHelpPanel?(d(),v("div",{key:1,class:"help-panel-overlay",onClick:t[9]||(t[9]=ue((...c)=>n.closeHelpPanel&&n.closeHelpPanel(...c),["self"]))},[e("div",Em,[e("div",Im,[e("h2",null,a(l.$t("tutorial.help.title")),1),e("button",{class:"close-btn",onClick:t[8]||(t[8]=(...c)=>n.closeHelpPanel&&n.closeHelpPanel(...c))},"×")]),e("div",Nm,[e("div",Lm,[(d(!0),v(J,null,ae(n.helpTabs,(c,p)=>(d(),v("button",{key:p,class:G(["tab-btn",{active:n.activeHelpTab===c.id}]),onClick:f=>n.activeHelpTab=c.id},a(c.name),11,Rm))),128))]),e("div",xm,[n.activeHelpTab==="basics"?(d(),v("div",Am,[e("h3",null,a(l.$t("game.title")),1),t[13]||(t[13]=We("<p data-v-1c9e21ea>在《买房记》中，你的目标是在52周的游戏时间内，通过商品交易赚取足够的资金来购买房产。游戏结束时，你的表现将根据获得的资产、购买的房屋和其他因素进行评分。</p><h3 data-v-1c9e21ea>基本操作</h3><ul data-v-1c9e21ea><li data-v-1c9e21ea><strong data-v-1c9e21ea>交易商品</strong>：在市场标签页中，你可以买入商品；在库存标签页中，你可以卖出商品。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>切换地点</strong>：在市场页面顶部的下拉菜单中选择不同地点，每个地点有不同的商品和价格。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>进入下一周</strong>：点击右上角的&quot;下一周&quot;按钮，游戏将进入下一周，商品价格会发生变化。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>购买房产</strong>：当你积累了足够的资金后，可以在房产标签页中购买房屋。</li></ul>",3))])):P("",!0),n.activeHelpTab==="trading"?(d(),v("div",Om,[t[22]||(t[22]=e("h3",null,"价格波动",-1)),t[23]||(t[23]=e("p",null,"商品价格会随时间波动，关注价格趋势是获利的关键。价格趋势分为以下几种：",-1)),e("ul",null,[e("li",null,[e("strong",null,a(l.$t("trends.rising_strong")),1),t[14]||(t[14]=H("：价格快速上涨，可能是卖出的好时机。"))]),e("li",null,[e("strong",null,a(l.$t("trends.rising")),1),t[15]||(t[15]=H("：价格稳步上涨，可以考虑持有或卖出。"))]),e("li",null,[e("strong",null,a(l.$t("trends.stable_high")),1),t[16]||(t[16]=H("：价格略有上涨，可能会继续上涨。"))]),e("li",null,[e("strong",null,a(l.$t("trends.stable")),1),t[17]||(t[17]=H("：价格相对稳定，波动较小。"))]),e("li",null,[e("strong",null,a(l.$t("trends.stable_low")),1),t[18]||(t[18]=H("：价格略有下跌，可能是买入的好时机。"))]),e("li",null,[e("strong",null,a(l.$t("trends.falling")),1),t[19]||(t[19]=H("：价格稳步下跌，可以考虑等待更低价格再买入。"))]),e("li",null,[e("strong",null,a(l.$t("trends.falling_strong")),1),t[20]||(t[20]=H("：价格快速下跌，可能是买入的好时机，但也要小心可能继续下跌。"))]),e("li",null,[e("strong",null,a(l.$t("trends.volatile")),1),t[21]||(t[21]=H("：价格波动较大，风险较高。"))])]),t[24]||(t[24]=e("h3",null,"交易策略",-1)),t[25]||(t[25]=e("ul",null,[e("li",null,[e("strong",null,"低买高卖"),H("：在价格低时购买，价格高时卖出，赚取差价。")]),e("li",null,[e("strong",null,"关注特色商品"),H("：每个地点都有特色商品，价格更优惠。")]),e("li",null,[e("strong",null,"利用价格趋势"),H("：根据价格趋势做出买卖决策。")]),e("li",null,[e("strong",null,"多地点比较"),H("：不同地点的同一商品价格可能不同，可以利用这一点赚取差价。")])],-1))])):P("",!0),n.activeHelpTab==="events"?(d(),v("div",Dm,t[26]||(t[26]=[We("<h3 data-v-1c9e21ea>事件类型</h3><p data-v-1c9e21ea>游戏中会随机触发各种事件，这些事件可能会影响商品价格、你的资金或其他游戏状态。事件类型包括：</p><ul data-v-1c9e21ea><li data-v-1c9e21ea><strong data-v-1c9e21ea>随机事件</strong>：任何时候都可能触发的普通事件。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>故事事件</strong>：与游戏剧情相关的事件，可能会连锁触发。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>地点事件</strong>：在特定地点才会触发的事件。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>市场事件</strong>：影响商品价格的事件。</li><li data-v-1c9e21ea><strong data-v-1c9e21ea>个人事件</strong>：与玩家状态相关的事件。</li></ul><h3 data-v-1c9e21ea>事件选择</h3><p data-v-1c9e21ea>大多数事件会提供多个选择，不同的选择会导致不同的结果。选择时要考虑当前的游戏状态和长期目标。</p>",5)]))):P("",!0),n.activeHelpTab==="settings"?(d(),v("div",Vm,[t[31]||(t[31]=e("h3",null,"游戏存档",-1)),t[32]||(t[32]=e("p",null,"你可以通过游戏菜单保存游戏进度，以便稍后继续。游戏也会在某些关键时刻自动保存。",-1)),t[33]||(t[33]=e("h3",null,"游戏设置",-1)),t[34]||(t[34]=e("p",null,"在设置菜单中，你可以调整游戏音量、显示设置等。",-1)),e("h3",null,a(l.$t("tutorial.help.shortcuts.title")),1),e("ul",null,[e("li",null,[t[27]||(t[27]=e("strong",null,"空格",-1)),H("："+a(l.$t("tutorial.help.shortcuts.space")),1)]),e("li",null,[t[28]||(t[28]=e("strong",null,"Tab",-1)),H("："+a(l.$t("tutorial.help.shortcuts.tab")),1)]),e("li",null,[t[29]||(t[29]=e("strong",null,"Esc",-1)),H("："+a(l.$t("tutorial.help.shortcuts.esc")),1)]),e("li",null,[t[30]||(t[30]=e("strong",null,"H",-1)),H("："+a(l.$t("tutorial.help.shortcuts.h")),1)])])])):P("",!0)])])])])):P("",!0)])}const Hm=oe(gm,[["render",Gm],["__scopeId","data-v-1c9e21ea"]]);const Wm={key:0,class:"game-loader"},Bm={class:"loader-container"},qm={class:"loader-content"},Um={class:"loader-title"},Qm={class:"loader-animation"},Fm={class:"progress-bar"},zm={class:"loader-status"},jm={class:"loader-tip"},Km={__name:"GameLoader",props:{visible:{type:Boolean,default:!0},title:{type:String,default:"正在加载游戏"},status:{type:String,default:"加载中..."},progress:{type:Number,default:0},autoProgress:{type:Boolean,default:!0}},emits:["update:progress","complete"],setup(l,{emit:t}){const s=l,n=t,u=["游戏提示：低买高卖是致富的关键！","游戏提示：关注市场趋势，把握最佳交易时机","游戏提示：不同地区的商品价格有差异，可以利用这一点赚取差价","游戏提示：随时关注你的资金状况，避免破产","游戏提示：购买房产是游戏的最终目标","游戏提示：每周市场价格都会变动，要把握时机","游戏提示：注意债务利息，不要让债务超过你的承受能力","游戏提示：特色商品通常有更高的利润空间","游戏提示：随机事件可能带来意外收获或损失","游戏提示：合理规划你的库存容量"],i=S(u[0]),c=S(s.progress);let p=null,f=null;function $(){let y=0;p=setInterval(()=>{y=(y+1)%u.length,i.value=u[y]},3e3)}function b(){s.autoProgress&&(f=setInterval(()=>{if(c.value<100){const y=Math.max(.1,(100-c.value)/50);c.value=Math.min(99,c.value+y),n("update:progress",c.value)}else clearInterval(f),n("complete")},100))}return ve(()=>s.progress,y=>{c.value=y,y>=100&&(clearInterval(f),n("complete"))}),ce(()=>{$(),s.autoProgress&&b()}),ps(()=>{clearInterval(p),clearInterval(f)}),(y,M)=>l.visible?(d(),v("div",Wm,[e("div",Bm,[e("div",qm,[e("h2",Um,a(l.title||"正在加载游戏"),1),e("div",Qm,[M[0]||(M[0]=e("div",{class:"spinner"},null,-1)),e("div",Fm,[e("div",{class:"progress-fill",style:Ce({width:`${l.progress}%`})},null,4)])]),e("div",zm,a(l.status||"加载中..."),1),e("div",jm,a(i.value),1)])])])):P("",!0)}},Nt=oe(Km,[["__scopeId","data-v-45147625"]]);const Ym={class:"game-view"},Xm={key:1,class:"game-header"},Jm={class:"left-info"},Zm={class:"week-indicator"},ep={class:"week-label"},tp={class:"week-value"},sp={class:"progress-bar"},np={class:"right-info"},ap={class:"menu-text"},op={key:2,class:"notifications-container"},lp={class:"notification-content"},ip=["onClick"],rp={class:"game-content"},up={class:"left-panel"},cp={class:"mini-inventory"},dp={class:"mini-header"},vp={class:"mini-title"},mp={class:"inventory-items"},pp={key:0,class:"empty-inventory"},gp={key:1,class:"inventory-list"},yp={class:"item-name"},fp={class:"item-details"},hp={class:"item-quantity"},_p={class:"item-price"},bp={class:"main-content"},$p={class:"tab-buttons"},kp={class:"tab-content"},Sp={class:"market-tab",key:"market"},wp={class:"inventory-tab",key:"inventory"},Cp={class:"houses-tab",key:"houses"},Tp={class:"dialog game-menu-dialog"},Pp={class:"dialog-title"},Mp={class:"menu-options"},Ep={class:"dialog save-dialog"},Ip={class:"dialog-title"},Np={class:"save-form"},Lp=["placeholder"],Rp={class:"dialog-buttons"},xp=["disabled"],Ap={key:0,class:"dialog-overlay game-over-overlay"},Op={class:"toast-content"},Dp={class:"toast-icon"},Vp={class:"toast-message"},Gp={__name:"GameView",setup(l){const t=Ee(),s=_e(),n=Le(),u=mt(),i=Ge(),c=vt(),p=Pe();Me();const f=S(null),$=S(null),b=S(null);console.log("GameView组件初始化，游戏状态:",{gameStarted:s.gameStarted,currentWeek:s.currentWeek,playerInitialized:n.initialized});const y=S("market"),M=S(!1),V=S(!1),U=S(!1),N=S(""),R=S(!1),B=S(!0),Z=S("初始化游戏..."),Y=S(0),L=A(()=>s.currentWeek),h=A(()=>s.maxWeeks),g=A(()=>s.gameOver),T=A(()=>s.notifications),w=A(()=>s.gameResult),k=A(()=>n),r=A(()=>u.currentLocation),m=A(()=>n.inventory||[]),o=A(()=>({currentWeek:L.value,maxWeeks:h.value,gameOver:g.value})),_=A(()=>s.gameProgress),C=A(()=>s.isEndlessMode);ve(()=>s.gameOver,O=>{var K,q,ge,$e;O&&(console.log("游戏结束 - GameView监听到gameOver变为true"),console.log("详细游戏结果数据:",{gameResult:s.gameResult,score:(K=s.gameResult)==null?void 0:K.score,scoreDetails:(q=s.gameResult)==null?void 0:q.scoreDetails,endReason:(ge=s.gameResult)==null?void 0:ge.endReason,playerNetWorth:n.netWorth,purchasedHouses:(($e=n.purchasedHouses)==null?void 0:$e.length)||0}),ye(()=>{U.value=!0}))});const Q=S(!1),le=S(""),me=S(""),F=S("");ce(()=>{console.log("GameView组件挂载"),B.value=!0,Y.value=0;try{R.value=!0,console.log("GameView - 当前模式: 开发模式")}catch(O){console.warn("GameView - 无法检测环境模式:",O),R.value=!0}if(!s.gameStarted){console.log("游戏未初始化，尝试从本地存储获取玩家名称");const O=localStorage.getItem("lastPlayerName")||"玩家";console.log("获取到玩家名称:",O),n.name=O}s.gameOver&&(console.log("重置游戏结束状态"),s.gameOver=!1,U.value=!1),ot(),window.addEventListener("keydown",de),window.addEventListener("beforeunload",je),setInterval(()=>{fe()},2e3),He.on("show:transaction_toast",Ke)}),qe(()=>{window.removeEventListener("keydown",de),window.removeEventListener("beforeunload",je),He.off("show:transaction_toast",Ke)});const de=O=>{if(!(M.value||V.value||U.value))switch(O.key){case" ":Ie();break;case"Tab":O.preventDefault(),O.shiftKey?y.value==="market"?y.value="houses":y.value==="inventory"?y.value="market":y.value==="houses"&&(y.value="inventory"):y.value==="market"?y.value="inventory":y.value==="inventory"?y.value="houses":y.value==="houses"&&(y.value="market");break;case"Escape":M.value?xe():Ue();break;case"h":case"H":$.value&&$.value.toggleHelpPanel();break}},be=O=>O.toLocaleString("zh-CN"),Ie=()=>{s.advanceWeek()&&fe()},fe=()=>{var K;console.log("GameView - 检查活跃事件");const O=Ge();if(O.activeEvent){console.log("GameView - 在EventStore中发现活跃事件:",O.activeEvent.id,O.activeEvent.title),ye(()=>{f.value?(console.log("GameView - 显示EventStore中的活跃事件"),f.value.showEvent(O.activeEvent)):console.error("GameView - 事件对话框组件未找到")});return}if(console.log("GameView - 检查GameCore中的活跃事件队列:",((K=s.activeEvents)==null?void 0:K.length)||0),s.activeEvents&&s.activeEvents.length>0){const q=s.activeEvents[0];console.log("GameView - 在GameCore中发现活跃事件:",q.id,q.title),s.activeEvents.shift(),ye(()=>{if(f.value){if(console.log("GameView - 显示GameCore中的活跃事件"),typeof f.value.showEvent!="function"){console.error("GameView - 事件模态框组件没有showEvent方法");return}(!q.options||!Array.isArray(q.options)||q.options.length===0)&&(console.warn("GameView - 事件没有选项，添加默认选项"),q.options=[{id:"default_option",text:"确认",result:"你确认了这个事件。",effects:{}}]);try{f.value.showEvent(q),console.log("GameView - 事件显示请求已发送")}catch(ge){console.error("GameView - 显示事件时出错:",ge)}}else console.error("GameView - 事件对话框组件未找到")})}else console.log("GameView - 没有活跃事件需要显示")},Ue=()=>{M.value=!0},xe=()=>{M.value=!1},tt=()=>{M.value=!1,V.value=!0;const O=new Date;N.value=`存档-${O.getFullYear()}${(O.getMonth()+1).toString().padStart(2,"0")}${O.getDate().toString().padStart(2,"0")}-${O.getHours().toString().padStart(2,"0")}${O.getMinutes().toString().padStart(2,"0")}`,ye(()=>{b.value&&(b.value.focus(),b.value.select())})},Qe=async()=>{if(N.value)try{(await Je().saveGame(N.value)).success?V.value=!1:p.showToast({type:"error",message:"保存游戏失败",duration:3e3})}catch(O){ee(O,"GameView (views)",se.UNKNOWN,te.ERROR),console.error("保存游戏时出错:",O),p.showToast({type:"error",message:"保存游戏时出错: "+(O.message||"未知错误"),duration:3e3})}},Fe=()=>{V.value=!1,N.value=""},ze=()=>{t.push("/")},st=O=>{s.notifications=s.notifications.filter(K=>K.id!==O)},nt=()=>{U.value=!1,s.continueGame()},at=()=>{s.startNewGame(k.value.name),U.value=!1},ot=async()=>{try{const O=[{name:"游戏核心",weight:20,action:()=>s.initializeGameCore()},{name:"玩家数据",weight:20,action:()=>n.initializePlayer(k.value.name)},{name:"市场数据",weight:25,action:()=>u.initializeMarket()},{name:"事件系统",weight:15,action:()=>i.initializeEvents()},{name:"教程事件",weight:10,action:()=>Promise.resolve(lt())},{name:"游戏界面",weight:10,action:()=>new Promise(q=>setTimeout(q,200))}];let K=5;for(const q of O){Z.value=`加载中: ${q.name}`,console.log(`加载步骤: ${q.name}`);try{await q.action(),K+=q.weight,Y.value=K}catch(ge){ee(ge,"GameView (views)",se.UNKNOWN,te.ERROR),console.error(`加载失败: ${q.name}`,ge)}}Z.value="加载完成！",Y.value=100,setTimeout(()=>{B.value=!1,console.log("游戏资源加载完成，隐藏加载界面"),fe()},500)}catch(O){console.error("加载游戏资源失败:",O),Z.value="加载失败，请刷新页面重试"}},lt=()=>{console.log("检查教程事件");try{return $.value?(console.log("检查教程提示系统"),!0):(s.currentWeek===1&&typeof i.triggerTutorialEvent=="function"&&(console.log("尝试触发初始教程事件"),i.triggerTutorialEvent("tutorial_trading")),!0)}catch(O){return ee(O,"GameView (views)",se.UNKNOWN,te.WARNING),console.warn("检查教程事件时出错:",O),!1}},it=()=>{console.log("GameView - 加载完成回调"),B.value=!1,fe()},je=async O=>{if(s.gameStarted&&!s.gameOver){const K=c.gameSettings;if(K&&K.autoSaveEnabled)try{const q=new Date,ge=`${q.getFullYear()}${String(q.getMonth()+1).padStart(2,"0")}${String(q.getDate()).padStart(2,"0")}_${String(q.getHours()).padStart(2,"0")}${String(q.getMinutes()).padStart(2,"0")}${String(q.getSeconds()).padStart(2,"0")}`,$e=`autoSave_exit_W${s.currentWeek}_${ge}`;await s.saveGame($e,!0)}catch(q){ee(q,"GameView (views)",se.UNKNOWN,te.ERROR),console.error("退出时自动保存失败:",q)}}},Ke=O=>{le.value=O.message,me.value=O.class,F.value=O.icon,Q.value=!1,requestAnimationFrame(()=>{Q.value=!0,setTimeout(()=>{Q.value=!1},3e3)})};return(O,K)=>(d(),v(J,null,[e("div",Ym,[B.value?(d(),Be(Nt,{key:0,title:"正在加载游戏资源",status:Z.value,progress:Y.value,onComplete:it},null,8,["status","progress"])):P("",!0),B.value?P("",!0):(d(),v("header",Xm,[e("div",Jm,[e("div",Zm,[e("div",ep,a(O.$t("game.week")),1),e("div",tp,a(L.value)+a(C.value?" / ∞":" / "+h.value),1),e("div",sp,[e("div",{class:"progress",style:Ce({width:`${_.value}%`})},null,4)])])]),e("div",np,[e("button",{class:"menu-button",onClick:Ue},[K[5]||(K[5]=e("span",{class:"menu-icon"},"≡",-1)),e("span",ap,a(O.$t("game.menu")),1)])])])),B.value?P("",!0):(d(),v("div",op,[z(Ze,{name:"notification"},{default:ie(()=>[(d(!0),v(J,null,ae(T.value,q=>(d(),v("div",{key:q.id,class:G(["notification",q.type])},[e("div",lp,a(q.message),1),e("button",{class:"close-btn",onClick:ge=>st(q.id)},"×",8,ip)],2))),128))]),_:1})])),e("div",rp,[e("div",up,[z(Ci),e("div",cp,[e("div",dp,[e("h3",vp,a(O.$t("inventory.title")),1),e("button",{class:"view-all-btn",onClick:K[0]||(K[0]=q=>y.value="inventory"),title:"查看完整背包"},K[6]||(K[6]=[e("i",{class:"icon-expand"},"⤢",-1)]))]),e("div",mp,[m.value.length===0?(d(),v("div",pp,a(O.$t("inventory.empty")),1)):(d(),v("div",gp,[(d(!0),v(J,null,ae(m.value,q=>(d(),v("div",{key:q.productId,class:"inventory-item"},[e("div",yp,a(q.name),1),e("div",fp,[e("span",hp,"x"+a(q.quantity),1),e("span",_p,"¥"+a(be(q.purchasePrice)),1)])]))),128))]))])])]),e("div",bp,[e("div",$p,[e("button",{class:G(["tab-button",{active:y.value==="market"}]),onClick:K[1]||(K[1]=q=>y.value="market")},a(O.$t("game.tabs.market")),3),e("button",{class:G(["tab-button",{active:y.value==="inventory"}]),onClick:K[2]||(K[2]=q=>y.value="inventory")},a(O.$t("game.tabs.inventory")),3),e("button",{class:G(["tab-button",{active:y.value==="houses"}]),onClick:K[3]||(K[3]=q=>y.value="houses")},a(O.$t("game.tabs.houses")),3)]),e("div",kp,[z(re,{name:"tab-fade",mode:"out-in"},{default:ie(()=>[y.value==="market"?(d(),v("div",Sp,[z(Jr)])):y.value==="inventory"?(d(),v("div",wp,[z(Uc)])):y.value==="houses"?(d(),v("div",Cp,[z(kd)])):P("",!0)]),_:1})])])]),z(Hm,{"current-week":L.value,"current-location":r.value,"active-tab":y.value,ref_key:"tutorialSystem",ref:$},null,8,["current-week","current-location","active-tab"]),z(Kd,{ref_key:"eventModal",ref:f},null,512),z(re,{name:"fade"},{default:ie(()=>[M.value?(d(),v("div",{key:0,class:"dialog-overlay",onClick:ue(xe,["self"])},[z(re,{name:"zoom-bounce"},{default:ie(()=>[e("div",Tp,[e("h2",Pp,a(O.$t("gameMenu.title")),1),e("div",Mp,[z(Ze,{name:"menu-item"},{default:ie(()=>[e("button",{class:"menu-option",onClick:tt,key:"save"},[K[7]||(K[7]=e("span",{class:"menu-icon"},"💾",-1)),H(" "+a(O.$t("gameMenu.save")),1)]),e("button",{class:"menu-option",onClick:ze,key:"main"},[K[8]||(K[8]=e("span",{class:"menu-icon"},"🏠",-1)),H(" "+a(O.$t("gameMenu.mainMenu")),1)]),e("button",{class:"menu-option",onClick:xe,key:"continue"},[K[9]||(K[9]=e("span",{class:"menu-icon"},"▶️",-1)),H(" "+a(O.$t("gameMenu.continue")),1)])]),_:1})])])]),_:1})])):P("",!0)]),_:1}),z(re,{name:"fade"},{default:ie(()=>[V.value?(d(),v("div",{key:0,class:"dialog-overlay",onClick:ue(Fe,["self"])},[z(re,{name:"slide-up"},{default:ie(()=>[e("div",Ep,[e("h2",Ip,a(O.$t("saveDialog.title")),1),e("div",Np,[W(e("input",{"onUpdate:modelValue":K[4]||(K[4]=q=>N.value=q),type:"text",class:"save-input",placeholder:O.$t("saveDialog.namePlaceholder"),ref_key:"saveInput",ref:b,onKeyup:Tt(Qe,["enter"])},null,40,Lp),[[ne,N.value]]),e("div",Rp,[e("button",{class:"dialog-button confirm",onClick:Qe,disabled:!N.value},a(O.$t("common.confirm")),9,xp),e("button",{class:"dialog-button cancel",onClick:Fe},a(O.$t("common.cancel")),1)])])])]),_:1})])):P("",!0)]),_:1}),z(re,{name:"fade"},{default:ie(()=>[g.value&&U.value?(d(),v("div",Ap,[z(re,{name:"scale-bounce"},{default:ie(()=>[z(It,{gameState:o.value,player:k.value,gameStats:w.value,onReturnToMain:ze,onRestartGame:at,onContinueGame:nt},null,8,["gameState","player","gameStats"])]),_:1})])):P("",!0)]),_:1})]),z(re,{name:"fade"},{default:ie(()=>[Q.value?(d(),v("div",{key:0,class:G(["transaction-toast",me.value])},[e("div",Op,[e("span",Dp,a(F.value),1),e("span",Vp,a(le.value),1)]),K[10]||(K[10]=e("div",{class:"toast-progress-bar"},null,-1))],2)):P("",!0)]),_:1})],64))}},Hp=oe(Gp,[["__scopeId","data-v-ac167917"]]);const Wp={class:"settings-view"},Bp={class:"settings-section"},qp={class:"setting-group"},Up={class:"setting-item"},Qp={class:"setting-item"},Fp={key:0,class:"setting-item description"},zp={class:"setting-description"},jp={key:1,class:"setting-item description"},Kp={class:"setting-item"},Yp={class:"settings-item"},Xp={for:"language-select"},Jp=["value"],Zp={class:"setting-group"},e1={class:"setting-item checkbox"},t1={class:"setting-item checkbox"},s1={class:"settings-actions"},n1={__name:"SettingsView",setup(l){const t=Ee(),s=vt(),n=Wt(),u=gs({difficulty:s.gameSettings.difficulty,autoSaveInterval:s.gameSettings.autoSaveInterval,soundEnabled:s.gameSettings.soundEnabled,fullScreen:s.gameSettings.fullScreen,textSpeed:s.gameSettings.textSpeed,language:s.gameSettings.language}),i=(b,y)=>{s.updateSetting(b,y)},c=async()=>{try{await s.updateSetting("language",u.language)}catch(b){ee(b,"SettingsView (views)",se.UNKNOWN,te.ERROR),console.error("Failed to update language:",b),u.language=s.gameSettings.language}},p=async()=>{try{const b=await window.electronAPI.toggleFullscreen();u.fullScreen=b,await s.updateSetting("fullScreen",b)}catch(b){ee(b,"SettingsView (views)",se.UNKNOWN,te.ERROR),console.error("Failed to toggle fullscreen:",b),u.fullScreen=s.gameSettings.fullScreen}},f=async()=>{await s.resetSettings(),u.difficulty=s.gameSettings.difficulty,u.autoSaveInterval=s.gameSettings.autoSaveInterval,u.soundEnabled=s.gameSettings.soundEnabled,u.fullScreen=s.gameSettings.fullScreen,u.textSpeed=s.gameSettings.textSpeed,u.language=s.gameSettings.language},$=()=>{t.back()};return ce(async()=>{await s.loadSettings(),u.difficulty=s.gameSettings.difficulty,u.autoSaveInterval=s.gameSettings.autoSaveInterval,u.soundEnabled=s.gameSettings.soundEnabled,u.fullScreen=s.gameSettings.fullScreen,u.textSpeed=s.gameSettings.textSpeed,u.language=s.gameSettings.language}),(b,y)=>(d(),v("div",Wp,[e("h1",null,a(b.$t("settings.title")),1),e("div",Bp,[e("div",qp,[y[17]||(y[17]=e("h2",null,"游戏设置",-1)),e("div",Up,[y[11]||(y[11]=e("label",{for:"difficulty"},"默认难度",-1)),W(e("select",{id:"difficulty","onUpdate:modelValue":y[0]||(y[0]=M=>u.difficulty=M),onChange:y[1]||(y[1]=M=>i("difficulty"))},y[10]||(y[10]=[e("option",{value:"easy"},"简单",-1),e("option",{value:"standard"},"标准",-1),e("option",{value:"hard"},"困难",-1)]),544),[[he,u.difficulty]])]),e("div",Qp,[y[13]||(y[13]=e("label",{for:"autoSaveInterval"},"自动保存频率",-1)),W(e("select",{id:"autoSaveInterval","onUpdate:modelValue":y[2]||(y[2]=M=>u.autoSaveInterval=M),onChange:y[3]||(y[3]=M=>i("autoSaveInterval"))},y[12]||(y[12]=[e("option",{value:0},"关闭自动保存",-1),e("option",{value:1},"每1周（频繁）",-1),e("option",{value:2},"每2周",-1),e("option",{value:5},"每5周（推荐）",-1),e("option",{value:10},"每10周",-1),e("option",{value:26},"每26周（半年）",-1)]),544),[[he,u.autoSaveInterval]])]),u.autoSaveInterval>0?(d(),v("div",Fp,[e("div",zp,[e("p",null," 当前设置：每"+a(u.autoSaveInterval)+"周自动保存一次。自动存档将在周数变化、 购买房产和退出游戏时触发。自动保存不会显示通知，最多保留5个最近的自动存档。 ",1)])])):(d(),v("div",jp,y[14]||(y[14]=[e("div",{class:"setting-description warning"},[e("p",null,[e("strong",null,"警告："),H("自动保存已关闭。游戏进度将不会自动保存， 请记得手动保存游戏以防止进度丢失。 ")])],-1)]))),e("div",Kp,[y[16]||(y[16]=e("label",{for:"textSpeed"},"文本显示速度",-1)),W(e("select",{id:"textSpeed","onUpdate:modelValue":y[4]||(y[4]=M=>u.textSpeed=M),onChange:y[5]||(y[5]=M=>i("textSpeed"))},y[15]||(y[15]=[e("option",{value:"slow"},"慢速",-1),e("option",{value:"normal"},"中速",-1),e("option",{value:"fast"},"快速",-1),e("option",{value:"instant"},"立即显示",-1)]),544),[[he,u.textSpeed]])])]),e("div",Yp,[e("label",Xp,a(b.$t("settings.language")),1),W(e("select",{id:"language-select","onUpdate:modelValue":y[6]||(y[6]=M=>u.language=M),onChange:c},[(d(!0),v(J,null,ae(E(n),M=>(d(),v("option",{key:M.code,value:M.code},a(M.name),9,Jp))),128))],544),[[he,u.language]])]),e("div",Zp,[y[20]||(y[20]=e("h2",null,"显示设置",-1)),e("div",e1,[W(e("input",{type:"checkbox",id:"soundEnabled","onUpdate:modelValue":y[7]||(y[7]=M=>u.soundEnabled=M),onChange:y[8]||(y[8]=M=>i("soundEnabled"))},null,544),[[ut,u.soundEnabled]]),y[18]||(y[18]=e("label",{for:"soundEnabled"},"启用音效",-1))]),e("div",t1,[W(e("input",{type:"checkbox",id:"fullScreen","onUpdate:modelValue":y[9]||(y[9]=M=>u.fullScreen=M),onChange:p},null,544),[[ut,u.fullScreen]]),y[19]||(y[19]=e("label",{for:"fullScreen"},"全屏模式",-1))])])]),e("div",s1,[e("button",{onClick:f,class:"btn-secondary"},a(b.$t("settings.reset")),1),e("button",{onClick:$,class:"btn-primary"},a(b.$t("common.back")),1)])]))}},a1=oe(n1,[["__scopeId","data-v-d4334a25"]]);const o1={class:"saves-view"},l1={class:"saves-container"},i1={class:"saves-content"},r1={key:0,class:"loading"},u1={key:1,class:"error"},c1={key:2,class:"empty-state"},d1={key:3,class:"saves-list"},v1=["onClick"],m1={class:"save-info"},p1={class:"save-header"},g1={key:0,class:"autosave-badge"},y1={class:"save-date"},f1={key:0,class:"save-details"},h1={class:"save-actions"},_1=["onClick"],b1=["onClick"],$1={class:"dialog"},k1={key:0,class:"loading-overlay"},S1={class:"loading-container"},w1={class:"loading-tip"},C1={__name:"SavesView",setup(l){const t=Ee(),s=we(),n=Pe(),u=S([]),i=S(null),c=S(!1),p=S(null),f=S({}),$=S(!1),b=S(""),y=S(0),M=["正在读取存档数据...","正在加载市场信息...","正在恢复玩家状态...","正在准备游戏环境...","准备进入游戏世界..."];async function V(){try{c.value=!0,p.value=null;const r=await window.electronAPI.listSaves();if(r.success){u.value=r.saves||[],console.log("已加载存档列表:",u.value);for(const m of u.value)await g(m.name)}else p.value=r.error||"加载存档失败",console.error("加载存档列表失败:",r.error)}catch(r){ee(r,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error("加载存档列表时出错:",r),p.value="加载存档时发生错误: "+(r.message||"未知错误")}finally{c.value=!1}}function U(r){i.value=r}function N(){y.value=0;const r=setInterval(()=>{y.value=(y.value+1)%M.length,c.value||clearInterval(r)},1500)}async function R(r){try{console.log("尝试加载存档:",r),c.value=!0,N(),n.showToast({type:"info",message:"正在加载存档...",duration:2e3}),await new Promise(C=>setTimeout(C,200));try{console.log("使用Electron API加载存档:",r);const C=await window.electronAPI.loadGame(r);if(C&&C.success&&C.gameState){console.log("存档从Electron加载成功，数据:",C.gameState),await Je().loadStoresFromSaveData(C.gameState),s.gameStarted=!0,n.showToast({type:"success",message:"存档加载成功！",duration:2e3}),t.push("/game");return}}catch(C){console.warn("Electron API加载存档失败，尝试备用方法:",C)}const m=Je();await m.loadSaveList();const o=m.saveList.find(C=>C.name===r);if(!o)throw new Error("找不到存档信息，无法加载");console.log("找到存档信息:",o);const _=await m.loadGame(o.id);_.success?(n.showToast({type:"success",message:"存档加载成功！",duration:2e3}),t.push("/game")):(n.showToast({type:"error",message:`加载失败: ${_.message||"未知错误"}`,duration:3e3}),c.value=!1)}catch(m){ee(m,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error("加载存档时出错:",m),n.showToast({type:"error",message:`加载存档时发生错误: ${m.message||"未知错误"}`,duration:3e3}),c.value=!1}}function B(r){b.value=r,$.value=!0}async function Z(){try{const r=await window.electronAPI.deleteSave(b.value);r.success?(i.value===b.value&&(i.value=null),await V(),n.showToast({type:"success",message:"存档已成功删除",duration:2e3})):n.showToast({type:"error",message:`删除存档失败: ${r.error||"未知错误"}`,duration:3e3})}catch(r){ee(r,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error("删除存档时出错:",r),n.showToast({type:"error",message:`删除存档时发生错误: ${r.message||"未知错误"}`,duration:3e3})}finally{$.value=!1,b.value=""}}function Y(){$.value=!1,b.value=""}function L(r){if(h(r)){const m=r.match(/W(\d+)/),o=m?m[1]:"?";let _="周期";return r.includes("_exit_")?_="退出时":r.includes("_buyHouse_")&&(_="购房时"),`自动存档 (${_}, 第${o}周)`}return r}function h(r){return r.startsWith("autosave_")}async function g(r){try{const m=await window.electronAPI.loadGame(r);if(m.success&&m.gameState){let o="未知位置",_="?",C=0;if(m.gameState.gameCore&&(_=m.gameState.gameCore.currentWeek||"?"),m.gameState.player&&(C=m.gameState.player.money||0),m.gameState.market&&m.gameState.market.currentLocation){const Q=m.gameState.market.currentLocation;if(typeof Q=="string"&&m.gameState.market.locations){const le=m.gameState.market.locations.find(me=>me.id===Q);le&&(o=le.name||"未知位置")}else typeof Q=="object"&&Q.name&&(o=Q.name)}f.value[r]={currentWeek:_,playerMoney:C,locationName:o},console.log(`加载存档 ${r} 详情:`,f.value[r])}else console.warn(`无法获取存档 ${r} 的详情:`,m.error||"未知错误")}catch(m){ee(m,"SavesView (views)",se.UNKNOWN,te.ERROR),console.error(`获取存档 ${r} 详情失败:`,m)}}function T(){t.push("/")}function w(){t.push({path:"/",query:{action:"new-game"}})}function k(){t.push("/")}return ce(()=>{V()}),(r,m)=>(d(),v("div",o1,[m[12]||(m[12]=e("div",{class:"game-particles"},null,-1)),e("div",l1,[e("div",{class:"header"},[m[0]||(m[0]=e("h1",null,[e("span",{class:"title-icon"},"💾"),H(" 游戏存档")],-1)),e("button",{class:"back-button",onClick:k},"返回")]),e("div",i1,[c.value?(d(),v("div",r1,m[1]||(m[1]=[e("div",{class:"loading-spinner-mini"},null,-1),e("p",null,"正在加载存档列表...",-1)]))):p.value?(d(),v("div",u1,[e("p",null,a(p.value),1),e("button",{class:"button",onClick:V},"重试")])):u.value.length===0?(d(),v("div",c1,[m[2]||(m[2]=e("div",{class:"empty-icon"},"📁",-1)),m[3]||(m[3]=e("h3",null,"暂无游戏存档",-1)),m[4]||(m[4]=e("p",null,"开始新游戏并保存进度后，存档将显示在这里",-1)),e("div",{class:"empty-actions"},[e("button",{class:"button primary",onClick:T},"返回主菜单"),e("button",{class:"button new-game",onClick:w},"开始新游戏")])])):(d(),v("div",d1,[z(Ze,{name:"save-item"},{default:ie(()=>[(d(!0),v(J,null,ae(u.value,(o,_)=>(d(),v("div",{key:o.name,class:G(["save-item",{selected:i.value===o.name,autosave:h(o.name)}]),onClick:C=>U(o.name),style:Ce({"--delay":_*.05+"s"})},[e("div",m1,[e("div",p1,[e("h3",null,a(L(o.name)),1),h(o.name)?(d(),v("span",g1,"自动")):P("",!0)]),e("p",y1,a(E(Ds)(o.lastModified)),1),f.value[o.name]?(d(),v("p",f1," 第"+a(f.value[o.name].currentWeek)+"周 | 金钱: "+a(E(gt)(f.value[o.name].playerMoney))+" | 地点: "+a(f.value[o.name].locationName||"未知"),1)):P("",!0)]),e("div",h1,[e("button",{class:"load-button",onClick:ue(C=>R(o.name),["stop"])},m[5]||(m[5]=[e("span",{class:"button-icon"},"▶️",-1),H("读取 ")]),8,_1),e("button",{class:"delete-button",onClick:ue(C=>B(o.name),["stop"])},m[6]||(m[6]=[e("span",{class:"button-icon"},"🗑️",-1),H("删除 ")]),8,b1)])],14,v1))),128))]),_:1})]))])]),z(re,{name:"fade"},{default:ie(()=>[$.value?(d(),v("div",{key:0,class:"dialog-overlay",onClick:ue(Y,["self"])},[z(re,{name:"zoom"},{default:ie(()=>[e("div",$1,[m[9]||(m[9]=e("h2",{class:"dialog-title"},"确认删除",-1)),e("p",null,'您确定要删除存档"'+a(b.value)+'"吗？此操作不可撤销。',1),e("div",{class:"dialog-actions"},[e("button",{class:"button danger",onClick:Z},m[7]||(m[7]=[e("span",{class:"button-icon"},"🗑️",-1),H("删除 ")])),e("button",{class:"button",onClick:Y},m[8]||(m[8]=[e("span",{class:"button-icon"},"❌",-1),H("取消 ")]))])])]),_:1})])):P("",!0)]),_:1}),z(re,{name:"fade"},{default:ie(()=>[c.value?(d(),v("div",k1,[z(re,{name:"zoom"},{default:ie(()=>[e("div",S1,[m[10]||(m[10]=e("div",{class:"loading-spinner"},null,-1)),m[11]||(m[11]=e("p",{class:"loading-text"},"正在加载游戏，请稍候...",-1)),e("p",w1,a(M[y.value]),1)])]),_:1})])):P("",!0)]),_:1})]))}},T1=oe(C1,[["__scopeId","data-v-8a96e221"]]);function P1(){console.log("===== 价格波动系统测试 =====");const l=[{id:101,name:"日常用品测试",category:"DAILY",minPrice:10,maxPrice:30,basePrice:15,volatility:2},{id:201,name:"食品测试",category:"FOOD",minPrice:20,maxPrice:60,basePrice:35,volatility:4},{id:301,name:"电子产品测试",category:"ELECTRONICS",minPrice:1e3,maxPrice:3e3,basePrice:1800,volatility:6},{id:401,name:"奢侈品测试",category:"LUXURY",minPrice:5e3,maxPrice:15e3,basePrice:8e3,volatility:8},{id:501,name:"收藏品测试",category:"COLLECTIBLE",minPrice:500,maxPrice:5e3,basePrice:1500,volatility:10}],t=[1,5,10,20,30,40,52],s={};l.forEach(u=>{s[u.id]={price:u.basePrice,trend:X.STABLE,history:[u.basePrice]}}),t.forEach(u=>{console.log(`
--- 第 ${u} 周价格 ---`),l.forEach(i=>{const c=s[i.id],p=pt(i,u,c);s[i.id]={price:p.price,trend:p.trend,history:[...c.history,p.price].slice(-10)},console.log(`${i.name}:`,`¥${p.price}`,`(${p.changePercent>0?"+":""}${p.changePercent.toFixed(1)}%)`,`趋势: ${p.trend}`,`价格范围: ${(100*(p.price-i.minPrice)/(i.maxPrice-i.minPrice)).toFixed(1)}%`)})}),console.log(`
--- 价格范围验证 ---`);let n=!0;return l.forEach(u=>{const i=s[u.id].history,c=Math.min(...i),p=Math.max(...i),f=c>=u.minPrice,$=p<=u.maxPrice,b=f&&$;console.log(`${u.name}:`,`范围检查: ${b?"通过":"失败"}`,`最低: ¥${c}`,`最高: ¥${p}`,`(预期范围: ¥${u.minPrice}-¥${u.maxPrice})`),b||(n=!1)}),console.log(`
总结: 价格范围测试 ${n?"全部通过":"存在失败"}`),n}function M1(){console.log(`
===== 地点价格修正测试 =====`);const l={id:101,name:"测试商品",category:"DAILY",minPrice:100,maxPrice:300,basePrice:200,volatility:5},t=[{id:"loc1",name:"便宜地点",priceModifier:.8,specialProducts:[]},{id:"loc2",name:"普通地点",priceModifier:1,specialProducts:[]},{id:"loc3",name:"昂贵地点",priceModifier:1.2,specialProducts:[]},{id:"loc4",name:"特价地点",priceModifier:1,specialProducts:[101]}],s={price:l.basePrice,trend:X.STABLE};t.forEach(n=>{const u={specialProducts:n.specialProducts},i=pt(l,10,s,n.priceModifier,u),c=i.price/l.basePrice;console.log(`${n.name}:`,`¥${i.price}`,`(基础价格比例: ${c.toFixed(2)})`,`修正系数: ${n.priceModifier}`,`特价商品: ${n.specialProducts.includes(l.id)?"是":"否"}`)})}function E1(){console.log(`
===== 市场修正因子测试 =====`);const l={id:201,name:"测试商品",category:"FOOD",minPrice:100,maxPrice:300,basePrice:200,volatility:5},t={price:l.basePrice,trend:X.STABLE};[{name:"无修正",modifiers:{}},{name:"全局上涨",modifiers:{globalPriceModifier:1.2}},{name:"全局下跌",modifiers:{globalPriceModifier:.8}},{name:"类别修正",modifiers:{categoryModifier:"FOOD",modifier:1.3}},{name:"商品修正",modifiers:{productModifiers:{201:1.5}}},{name:"组合修正",modifiers:{globalPriceModifier:1.1,categoryModifier:"FOOD",modifier:1.2,productModifiers:{201:1.1}}}].forEach(n=>{const u=pt(l,10,t,1,n.modifiers),i=u.price/l.basePrice;console.log(`${n.name}:`,`¥${u.price}`,`(基础价格比例: ${i.toFixed(2)})`)})}function Lt(){const l=P1();return M1(),E1(),console.log(`
===== 测试完成 =====`),l}typeof window<"u"&&window.runTest&&Lt();const I1={class:"dev-tools"},N1={class:"tool-section"},L1={key:0,class:"test-output"},R1={class:"tool-section"},x1={class:"tool-group"},A1={class:"control-buttons"},O1={class:"tool-group"},D1={class:"input-group"},V1={class:"tool-group"},G1={class:"input-group param-row"},H1={class:"input-group param-row"},W1={class:"input-group param-row"},B1={class:"input-group"},q1={class:"tool-group"},U1={class:"input-group param-row"},Q1=["max"],F1={class:"tool-group"},z1={class:"input-group"},j1=["value"],K1={class:"tool-section"},Y1={class:"scenarios"},X1={class:"tool-section"},J1={class:"status-grid"},Z1={class:"status-item"},eg={class:"status-item"},tg={class:"status-item"},sg={class:"status-item"},ng={class:"status-item"},ag={class:"status-item"},og={class:"status-item"},lg={class:"json-display"},ig={__name:"DevToolsView",setup(l){const t=we(),s=Ee(),n=S(""),u=S(1e3),i=S("global"),c=S(1.2),p=S(3),f=S("DAILY"),$=S(null),b=S({money:0,debt:0,capacity:0}),y=S(1),M=S(t.currentWeek),V=A(()=>t.products),U=A(()=>t.isEndlessMode),N=()=>{s.push("/")},R=()=>{const m=console.log;let o="";console.log=(..._)=>{o+=_.join(" ")+`
`,m(..._)};try{Lt(),n.value=o}finally{console.log=m}},B=()=>{t.advanceWeek()},Z=m=>{for(let o=0;o<m&&!t.gameOver;o++)t.advanceWeek()},Y=()=>{u.value&&(t.player.money+=u.value)},L=()=>{let m={value:c.value,duration:p.value};switch(i.value){case"category":m.category=f.value;break;case"product":m.productId=$.value;break}t.addMarketModifier(i.value,m)},h=()=>{b.value.money!==null&&b.value.money>=0&&(t.player.money=b.value.money),b.value.debt!==null&&b.value.debt>=0&&(t.player.debt=b.value.debt),b.value.capacity!==null&&b.value.capacity>0&&(t.player.capacity=b.value.capacity)},g=()=>{b.value={money:t.player.money,debt:t.player.debt,capacity:t.player.capacity}},T=()=>{t.player.inventory=[],t.player.inventoryUsed=0},w=()=>{const m=y.value;if(m<1)return;const o=V.value;if(o.length===0)return;const _=Math.floor(Math.random()*o.length),C=o[_],Q=St(),le=C.minPrice||C.basePrice*.7,me=C.maxPrice||C.basePrice*1.3,F=Math.floor(le+Math.random()*(me-le));Q.addToInventory(C,m,F)},k=()=>{M.value!==null&&M.value>=1&&M.value<=t.maxWeeks&&(t.currentWeek=M.value)},r=m=>{switch(m){case"early":t.currentWeek=5,t.player.money=3e3,t.player.debt=4500;break;case"mid":t.currentWeek=20,t.player.money=5e4,t.player.debt=2e3;break;case"late":t.currentWeek=35,t.player.money=2e5,t.player.debt=0;break}};return ce(()=>{V.value.length>0&&($.value=V.value[0].id),g()}),(m,o)=>{var _;return d(),v("div",I1,[e("div",{class:"header-with-back"},[e("button",{class:"back-button",onClick:N},o[16]||(o[16]=[e("span",{class:"back-icon"},"←",-1),H(" 返回 ")])),o[17]||(o[17]=e("h1",null,"开发工具",-1))]),e("div",N1,[o[18]||(o[18]=e("h2",null,"价格系统测试",-1)),e("button",{onClick:R,class:"test-button"},"运行价格系统测试"),n.value?(d(),v("pre",L1,a(n.value),1)):P("",!0)]),e("div",R1,[o[31]||(o[31]=e("h2",null,"游戏操作",-1)),e("div",x1,[o[19]||(o[19]=e("h3",null,"周数控制",-1)),e("div",A1,[e("button",{onClick:B,class:"action-button"},"前进一周"),e("button",{onClick:o[0]||(o[0]=C=>Z(5)),class:"action-button"},"前进5周"),e("button",{onClick:o[1]||(o[1]=C=>Z(10)),class:"action-button"},"前进10周")])]),e("div",O1,[o[20]||(o[20]=e("h3",null,"资金调整",-1)),e("div",D1,[W(e("input",{type:"number","onUpdate:modelValue":o[2]||(o[2]=C=>u.value=C),placeholder:"金额"},null,512),[[ne,u.value,void 0,{number:!0}]]),e("button",{onClick:Y,class:"action-button"},"增加资金")])]),e("div",V1,[o[24]||(o[24]=e("h3",null,"玩家参数调整",-1)),e("div",G1,[o[21]||(o[21]=e("label",null,"当前资金:",-1)),W(e("input",{type:"number","onUpdate:modelValue":o[3]||(o[3]=C=>b.value.money=C),placeholder:"资金"},null,512),[[ne,b.value.money,void 0,{number:!0}]])]),e("div",H1,[o[22]||(o[22]=e("label",null,"当前债务:",-1)),W(e("input",{type:"number","onUpdate:modelValue":o[4]||(o[4]=C=>b.value.debt=C),placeholder:"债务"},null,512),[[ne,b.value.debt,void 0,{number:!0}]])]),e("div",W1,[o[23]||(o[23]=e("label",null,"背包容量:",-1)),W(e("input",{type:"number","onUpdate:modelValue":o[5]||(o[5]=C=>b.value.capacity=C),placeholder:"容量"},null,512),[[ne,b.value.capacity,void 0,{number:!0}]])]),e("div",{class:"input-group actions"},[e("button",{onClick:h,class:"action-button success"},"应用参数"),e("button",{onClick:g,class:"action-button warning"},"重置参数")]),o[25]||(o[25]=e("h4",null,"库存操作",-1)),e("div",B1,[e("button",{onClick:T,class:"action-button warning"},"清空库存"),e("button",{onClick:w,class:"action-button"},"添加随机物品"),W(e("input",{type:"number","onUpdate:modelValue":o[6]||(o[6]=C=>y.value=C),placeholder:"物品数量",min:"1",max:"10"},null,512),[[ne,y.value,void 0,{number:!0}]])])]),e("div",q1,[o[27]||(o[27]=e("h3",null,"游戏周数调整",-1)),e("div",U1,[o[26]||(o[26]=e("label",null,"设置周数:",-1)),W(e("input",{type:"number","onUpdate:modelValue":o[7]||(o[7]=C=>M.value=C),placeholder:"周数",min:"1",max:E(t).maxWeeks},null,8,Q1),[[ne,M.value,void 0,{number:!0}]]),e("button",{onClick:k,class:"action-button"},"设置周数")])]),e("div",F1,[o[30]||(o[30]=e("h3",null,"市场修正",-1)),e("div",z1,[W(e("select",{"onUpdate:modelValue":o[8]||(o[8]=C=>i.value=C)},o[28]||(o[28]=[e("option",{value:"global"},"全局修正",-1),e("option",{value:"category"},"类别修正",-1),e("option",{value:"product"},"商品修正",-1)]),512),[[he,i.value]]),i.value==="category"?W((d(),v("select",{key:0,"onUpdate:modelValue":o[9]||(o[9]=C=>f.value=C)},o[29]||(o[29]=[We('<option value="DAILY" data-v-dd5bff4d>日常用品</option><option value="FOOD" data-v-dd5bff4d>食品</option><option value="ELECTRONICS" data-v-dd5bff4d>电子产品</option><option value="LUXURY" data-v-dd5bff4d>奢侈品</option><option value="COLLECTIBLE" data-v-dd5bff4d>收藏品</option>',5)]),512)),[[he,f.value]]):P("",!0),i.value==="product"?W((d(),v("select",{key:1,"onUpdate:modelValue":o[10]||(o[10]=C=>$.value=C)},[(d(!0),v(J,null,ae(V.value,C=>(d(),v("option",{key:C.id,value:C.id},a(C.name),9,j1))),128))],512)),[[he,$.value]]):P("",!0),W(e("input",{type:"number","onUpdate:modelValue":o[11]||(o[11]=C=>c.value=C),step:"0.1",min:"0.1",max:"2.0",placeholder:"修正值(0.1-2.0)"},null,512),[[ne,c.value,void 0,{number:!0}]]),W(e("input",{type:"number","onUpdate:modelValue":o[12]||(o[12]=C=>p.value=C),min:"1",placeholder:"持续周数"},null,512),[[ne,p.value,void 0,{number:!0}]]),e("button",{onClick:L,class:"action-button"},"应用修正")])])]),e("div",K1,[o[35]||(o[35]=e("h2",null,"游戏场景预设",-1)),e("div",Y1,[e("div",{class:"scenario-card",onClick:o[13]||(o[13]=C=>r("early"))},o[32]||(o[32]=[e("h3",null,"前期阶段",-1),e("p",null,"设置为游戏前期状态：",-1),e("ul",null,[e("li",null,"周数：5周"),e("li",null,"资金：3000元"),e("li",null,"债务：4500元")],-1)])),e("div",{class:"scenario-card",onClick:o[14]||(o[14]=C=>r("mid"))},o[33]||(o[33]=[e("h3",null,"中期阶段",-1),e("p",null,"设置为游戏中期状态：",-1),e("ul",null,[e("li",null,"周数：20周"),e("li",null,"资金：50000元"),e("li",null,"债务：2000元")],-1)])),e("div",{class:"scenario-card",onClick:o[15]||(o[15]=C=>r("late"))},o[34]||(o[34]=[e("h3",null,"后期阶段",-1),e("p",null,"设置为游戏后期状态：",-1),e("ul",null,[e("li",null,"周数：35周"),e("li",null,"资金：200000元"),e("li",null,"债务：0元")],-1)]))])]),e("div",X1,[o[43]||(o[43]=e("h2",null,"当前游戏状态",-1)),e("div",J1,[e("div",Z1,[o[36]||(o[36]=e("strong",null,"玩家名称:",-1)),H(" "+a(m.playerStore.name),1)]),e("div",eg,[o[37]||(o[37]=e("strong",null,"当前周数:",-1)),H(" "+a(E(t).currentWeek)+a(U.value?"":"/"+E(t).maxWeeks),1)]),e("div",tg,[o[38]||(o[38]=e("strong",null,"玩家资金:",-1)),H(" ¥"+a(E(x)(E(t).player.money)),1)]),e("div",sg,[o[39]||(o[39]=e("strong",null,"玩家债务:",-1)),H(" ¥"+a(E(x)(E(t).player.debt)),1)]),e("div",ng,[o[40]||(o[40]=e("strong",null,"背包使用:",-1)),H(" "+a(E(t).player.inventoryUsed)+"/"+a(E(t).player.capacity),1)]),e("div",ag,[o[41]||(o[41]=e("strong",null,"当前地点:",-1)),H(" "+a((_=E(t).currentLocation)==null?void 0:_.name),1)]),e("div",og,[o[42]||(o[42]=e("strong",null,"市场状态:",-1)),H(" "+a(E(t).marketStatus),1)])]),o[44]||(o[44]=e("h3",null,"市场调整因子",-1)),e("pre",lg,a(JSON.stringify(E(t).marketModifiers,null,2)),1)])])}}},rg=oe(ig,[["__scopeId","data-v-dd5bff4d"]]);const ug={class:"loading-test"},cg={key:0,class:"test-complete"},dg={__name:"LoadingTest",setup(l){const t=Ee(),s=S(!0),n=S("测试加载中..."),u=S(0);function i(){s.value=!1}return ce(()=>{const c=["初始化测试环境...","加载测试数据...","处理测试资源...","准备测试结果...","完成测试加载"];let p=0;const f=setInterval(()=>{p<c.length?(n.value=c[p],u.value=Math.min(100,(p+1)*20),p++):clearInterval(f)},1e3)}),(c,p)=>(d(),v("div",ug,[z(Nt,{title:"测试加载动画",status:n.value,progress:u.value,onComplete:i},null,8,["status","progress"]),s.value?P("",!0):(d(),v("div",cg,[p[1]||(p[1]=e("h1",null,"加载测试完成",-1)),e("button",{onClick:p[0]||(p[0]=f=>E(t).push("/"))},"返回主菜单")]))]))}},vg=oe(dg,[["__scopeId","data-v-2aa48468"]]);console.log("应用初始化开始");Bt();const ct=hs({history:_s(),routes:[{path:"/",component:Mo},{path:"/game",component:Hp},{path:"/settings",component:a1},{path:"/saves",component:T1},{path:"/dev-tools",component:rg},{path:"/game-over",component:It},{path:"/loading-test",component:vg}]});console.log("路由初始化完成");const mg=bs(),Re=ys(Xa);Re.use(mg);Re.use(ct);Re.use(pe);console.log("插件注册完成");ro(Re);qt(Re);console.log("第三方库和错误处理设置完成");(async function(){try{const{useUiStore:t}=await Ne(()=>import("./stores-6663fff5.js").then(p=>p.z),["./stores-6663fff5.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),{useGameCoreStore:s}=await Ne(()=>import("./stores-6663fff5.js").then(p=>p.B),["./stores-6663fff5.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),{useSettingsStore:n}=await Ne(()=>import("./stores-6663fff5.js").then(p=>p.A),["./stores-6663fff5.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),u=t(),i=s(),c=n();console.log("Pinia存储预初始化完成:",{uiStore:!!u,gameCoreStore:!!i,settingsStore:!!c}),pg()}catch(t){ee(t,"main.pinitaInit",se.SYSTEM,te.ERROR),console.error("Pinia存储预初始化失败:",t)}})();function pg(){try{console.log("开始验证关键资源..."),console.log("关键资源验证完成")}catch(l){console.error("验证资源时出错:",l)}}(async function(){try{if(Ut()){console.info("检测到异常退出，准备恢复");try{const s=await Ne(()=>import("./stores-6663fff5.js").then(c=>c.z),["./stores-6663fff5.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url),n=await Ne(()=>import("./stores-6663fff5.js").then(c=>c.B),["./stores-6663fff5.js","./vue-core-cd9800c2.js","./vendor-e7c44fa3.js"],import.meta.url);await Mt();const u=s.useUiStore(),i=n.useGameCoreStore();if(!u||!i)throw new Error("无法获取存储实例");setTimeout(async()=>{try{const c=await Ne(()=>Promise.resolve().then(()=>ao),void 0,import.meta.url),{loadLatestSnapshot:p,applySnapshot:f}=c,$=await p();$&&u.showRecoveryDialog({snapshot:$,message:"检测到游戏异常退出。是否恢复上次的游戏状态？",title:"游戏恢复",allowCancel:!0,onRecover:async()=>{try{await f(i,$)&&(u.showToast({type:"success",message:"游戏状态已成功恢复"}),ct.currentRoute.value.path!=="/game"&&ct.push("/game"))}catch(b){ee(b,"main.applySnapshot",se.STORAGE,te.ERROR),console.error("恢复游戏状态时出错:",b),u.showToast({type:"error",message:"恢复游戏状态失败"})}},onCancel:()=>{console.log("用户取消了恢复操作")}})}catch(c){ee(c,"main.loadSnapshot",se.STORAGE,te.ERROR),console.error("加载快照时出错:",c)}},1e3)}catch(s){ee(s,"main.initRecovery",se.SYSTEM,te.ERROR),console.error("准备恢复游戏状态时出错:",s)}}}catch(t){ee(t,"main.checkAbnormalExit",se.SYSTEM,te.ERROR),console.error("检查异常退出时出错:",t)}})();Ct();window.addEventListener("beforeunload",()=>{Qt()});setInterval(()=>{Ct()},6e4);let dt=!1;function Rt(){if(!dt)try{document.getElementById("app")?(console.log("找到挂载点，挂载应用"),Re.mount("#app"),dt=!0,console.log("应用挂载完成"),window.dispatchEvent(new Event("app-loaded")),window.electronAPI&&window.electronAPI.onMenuAction&&window.electronAPI.onMenuAction(t=>{console.log("收到菜单事件:",t),t==="menu:open-dev-tools"&&window.dispatchEvent(new CustomEvent("show-dev-tools"))})):console.error("找不到挂载点 #app")}catch(l){ee(l,"main.mountApp",se.SYSTEM,te.FATAL),console.error("应用挂载失败:",l)}}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM已加载，准备挂载应用"),Rt()});setTimeout(()=>{dt||(console.log("使用备用方法挂载应用"),Rt())},1e3);
